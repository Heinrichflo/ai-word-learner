<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI èƒŒå•è¯ - æ™ºèƒ½å­¦ä¹ åŠ©æ‰‹</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 420px;
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        .header h1 { font-size: 22px; margin-bottom: 5px; }
        .user-info {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 12px;
            background: rgba(255,255,255,0.2);
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
        }
        
        /* ç™»å½•/æ³¨å†Œå¼¹çª— */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 320px;
        }
        .modal-title { font-size: 18px; margin-bottom: 20px; text-align: center; }
        .input-group { margin-bottom: 15px; }
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 14px;
        }
        .modal-btns { display: flex; gap: 10px; }
        .modal-btns .btn { flex: 1; }

        .tabs { display: flex; border-bottom: 1px solid #eee; }
        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            font-size: 13px;
            color: #666;
            transition: all 0.3s;
        }
        .tab.active { color: #667eea; border-bottom: 2px solid #667eea; font-weight: 500; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .card { padding: 25px; text-align: center; min-height: 160px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .word { font-size: 30px; font-weight: bold; color: #333; margin-bottom: 8px; }
        .phonetic { font-size: 15px; color: #666; margin-bottom: 12px; }
        .meaning { font-size: 14px; color: #555; line-height: 1.5; }
        
        .tts-btn {
            background: #f0f0f0;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 18px;
            cursor: pointer;
            margin-bottom: 12px;
            transition: all 0.3s;
        }
        .tts-btn:hover { background: #e0e0e0; transform: scale(1.1); }
        
        .btn-group { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; padding: 15px 20px; border-top: 1px solid #eee; }
        .btn { padding: 10px 16px; border: none; border-radius: 20px; font-size: 13px; cursor: pointer; transition: all 0.3s; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-success { background: #10b981; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-warning { background: #f59e0b; color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        
        .stats { display: flex; justify-content: space-around; padding: 12px; background: #f9f9f9; border-top: 1px solid #eee; }
        .stat-item { text-align: center; }
        .stat-value { font-size: 18px; font-weight: bold; color: #667eea; }
        .stat-label { font-size: 10px; color: #666; }

        /* AI å‡ºé¢˜ */
        .quiz-options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; padding: 10px 20px 20px; }
        .quiz-option { padding: 12px; border: 2px solid #eee; border-radius: 12px; background: white; cursor: pointer; font-size: 13px; transition: all 0.3s; }
        .quiz-option:hover { border-color: #667eea; background: #f5f7ff; }
        .quiz-option.correct { border-color: #10b981; background: #d1fae5; }
        .quiz-option.wrong { border-color: #ef4444; background: #fee2e2; }
        .ai-quiz-badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            margin-bottom: 10px;
        }

        /* å‘éŸ³æµ‹è¯„ */
        .record-btn { width: 70px; height: 70px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); border: none; color: white; font-size: 22px; cursor: pointer; margin: 15px; transition: all 0.3s; }
        .record-btn.recording { animation: pulse 1s infinite; background: #ef4444; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        .record-hint { font-size: 13px; color: #666; margin-top: 10px; }
        .pronunciation-score { font-size: 42px; font-weight: bold; margin: 8px 0; }
        .score-high { color: #10b981; }
        .score-mid { color: #f59e0b; }
        .score-low { color: #ef4444; }

        /* AI åŠ©æ‰‹ */
        .ai-chat { padding: 12px; max-height: 180px; overflow-y: auto; }
        .ai-message { background: #f0f0ff; padding: 10px; border-radius: 12px; margin-bottom: 8px; font-size: 13px; line-height: 1.5; }
        .user-message { background: #e0f2fe; padding: 10px; border-radius: 12px; margin-bottom: 8px; font-size: 13px; text-align: right; }
        
        /* å­¦ä¹ è®°å½• */
        .history-list { max-height: 200px; overflow-y: auto; padding: 10px; }
        .history-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; font-size: 13px; }
        .history-item:last-child { border-bottom: none; }
        .history-date { color: #666; }
        .history-count { font-weight: 500; }

        /* è®¾ç½®é¡µ */
        .settings { padding: 15px; }
        .setting-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #eee; }
        .setting-label { font-size: 14px; }
        .setting-btn { padding: 8px 16px; border-radius: 15px; border: none; font-size: 12px; cursor: pointer; }
        
        .loading { color: #666; font-size: 14px; }
        .empty-state { text-align: center; padding: 30px; color: #666; }
    </style>
</head>
<body>
    <!-- ç™»å½•å¼¹çª— -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-title" id="modalTitle">ç™»å½• / æ³¨å†Œ</div>
            <div class="input-group">
                <input type="text" id="username" placeholder="ç”¨æˆ·å">
            </div>
            <div class="input-group">
                <select id="level" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:10px;font-size:14px;">
                    <option value="beginner">åˆå­¦è€…</option>
                    <option value="intermediate">ä¸­çº§</option>
                    <option value="advanced">é«˜çº§</option>
                </select>
            </div>
            <div class="modal-btns">
                <button class="btn btn-primary" onclick="handleLogin()">ç¡®å®š</button>
                <button class="btn" style="background:#eee" onclick="closeModal()">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>ğŸ¤– AI èƒŒå•è¯</h1>
            <p id="headerSubtitle">æ™ºèƒ½å­¦ä¹ åŠ©æ‰‹</p>
            <div class="user-info" id="userInfo" onclick="showSettings()">æœªç™»å½•</div>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="learn">èƒŒå•è¯</div>
            <div class="tab" data-tab="quiz">AIå‡ºé¢˜</div>
            <div class="tab" data-tab="speak">å‘éŸ³</div>
            <div class="tab" data-tab="history">è®°å½•</div>
        </div>

        <!-- èƒŒå•è¯ -->
        <div class="tab-content active" id="tab-learn">
            <div class="card" id="card"><div class="loading">åŠ è½½ä¸­...</div></div>
            <div class="btn-group">
                <button class="btn btn-danger" onclick="showAgain()">ä¸è®¤è¯†</button>
                <button class="btn btn-warning" onclick="showHard()">å›°éš¾</button>
                <button class="btn btn-success" onclick="showKnown()">è®¤è¯†</button>
            </div>
        </div>

        <!-- AI å‡ºé¢˜ -->
        <div class="tab-content" id="tab-quiz">
            <div class="card" id="quiz-card"><div class="loading">AIæ­£åœ¨å‡ºé¢˜...</div></div>
            <div class="quiz-options" id="quiz-options"></div>
        </div>

        <!-- å‘éŸ³æµ‹è¯„ -->
        <div class="tab-content" id="tab-speak">
            <div class="card">
                <div class="word" id="speak-word">algorithm</div>
                <div class="phonetic" id="speak-phonetic">/ËˆÃ¦lÉ¡É™rÉªÃ°É™m/</div>
                <button class="tts-btn" onclick="playReference()">ğŸ”Š</button>
                <button class="record-btn" id="recordBtn" onmousedown="startRecord()" onmouseup="stopRecord()">ğŸ¤</button>
                <div class="record-hint" id="recordHint">æŒ‰ä½å½•éŸ³æµ‹è¯„å‘éŸ³</div>
                <div id="pronunciation-result"></div>
            </div>
            <div class="btn-group"><button class="btn btn-primary" onclick="nextSpeak()">ä¸‹ä¸€ä¸ª</button></div>
        </div>

        <!-- å­¦ä¹ è®°å½• -->
        <div class="tab-content" id="tab-history">
            <div class="history-list" id="historyList">
                <div class="empty-state">æš‚æ— å­¦ä¹ è®°å½•</div>
            </div>
        </div>

        <div class="stats">
            <div class="stat-item"><div class="stat-value" id="total">0</div><div class="stat-label">å·²å­¦ä¹ </div></div>
            <div class="stat-item"><div class="stat-value" id="correct">0</div><div class="stat-label">æ­£ç¡®</div></div>
            <div class="stat-item"><div class="stat-value" id="streak">0</div><div class="stat-label">è¿ç»­</div></div>
            <div class="stat-item"><div class="stat-value" id="accuracy">0%</div><div class="stat-label">æ­£ç¡®ç‡</div></div>
        </div>
    </div>

    <script>
        // ====== é…ç½® ======
        const MINIMAX_API_KEY = ''; // å¡«å…¥ä½ çš„ MiniMax API Key
        const MINIMAX_BASE_URL = 'https://api.minimax.chat/v1';
        
        // ====== å•è¯åº“ ======
        const defaultWords = [
            { word: "algorithm", phonetic: "/ËˆÃ¦lÉ¡É™rÉªÃ°É™m/", meaning: "n. ç®—æ³•", level: "advanced" },
            { word: "database", phonetic: "/ËˆdeÉªtÉ™beÉªs/", meaning: "n. æ•°æ®åº“", level: "intermediate" },
            { word: "function", phonetic: "/ËˆfÊŒÅ‹kÊƒÉ™n/", meaning: "n. åŠŸèƒ½ï¼›å‡½æ•°", level: "intermediate" },
            { word: "variable", phonetic: "/ËˆveÉ™riÉ™bl/", meaning: "n. å˜é‡", level: "beginner" },
            { word: "interface", phonetic: "/ËˆÉªntÉ™feÉªs/", meaning: "n. ç•Œé¢ï¼›æ¥å£", level: "intermediate" },
            { word: "framework", phonetic: "/ËˆfreÉªmwÉœËk/", meaning: "n. æ¡†æ¶", level: "intermediate" },
            { word: "compile", phonetic: "/kÉ™mËˆpaÉªl/", meaning: "v. ç¼–è¯‘", level: "advanced" },
            { word: "execute", phonetic: "/ËˆeksÉªkjuËt/", meaning: "v. æ‰§è¡Œ", level: "intermediate" },
            { word: "debug", phonetic: "/diËËˆbÊŒÉ¡/", meaning: "v. è°ƒè¯•", level: "beginner" },
            { word: "network", phonetic: "/ËˆnetwÉœËrk/", meaning: "n. ç½‘ç»œ", level: "beginner" },
            { word: "server", phonetic: "/ËˆsÉœËrvÉ™r/", meaning: "n. æœåŠ¡å™¨", level: "beginner" },
            { word: "client", phonetic: "/ËˆklaÉªÉ™nt/", meaning: "n. å®¢æˆ·ç«¯", level: "beginner" },
            { word: "artificial", phonetic: "/ËŒÉ‘ËrtÉªËˆfÉªÊƒl/", meaning: "adj. äººå·¥çš„", level: "intermediate" },
            { word: "intelligence", phonetic: "/ÉªnËˆtelÉªdÊ’É™ns/", meaning: "n. æ™ºèƒ½", level: "intermediate" },
            { word: "machine", phonetic: "/mÉ™ËˆÊƒiËn/", meaning: "n. æœºå™¨", level: "beginner" }
        ];

        // ====== çŠ¶æ€ ======
        let words = [...defaultWords];
        let currentIndex = 0;
        let total = 0, correct = 0, streak = 0;
        let learnedWords = [];
        let user = null;
        let history = [];
        let quizWord = null;
        let mediaRecorder = null;
        let audioChunks = [];

        // ====== ç”¨æˆ·ç³»ç»Ÿ ======
        function init() {
            loadUser();
            loadHistory();
            if (!user) {
                document.getElementById('loginModal').classList.add('active');
            } else {
                updateUserInfo();
            }
            showCard();
            updateStats();
            renderHistory();
        }

        function loadUser() {
            const saved = localStorage.getItem('wordAI_user');
            if (saved) user = JSON.parse(saved);
        }

        function saveUser() {
            localStorage.setItem('wordAI_user', JSON.stringify(user));
        }

        function handleLogin() {
            const username = document.getElementById('username').value.trim();
            const level = document.getElementById('level').value;
            if (!username) { alert('è¯·è¾“å…¥ç”¨æˆ·å'); return; }
            user = { username, level, created: new Date().toISOString() };
            saveUser();
            updateUserInfo();
            closeModal();
            // æ ¹æ®ç”¨æˆ·çº§åˆ«ç­›é€‰å•è¯
            filterWordsByLevel();
        }

        function closeModal() {
            document.getElementById('loginModal').classList.remove('active');
        }

        function updateUserInfo() {
            document.getElementById('userInfo').textContent = user.username;
            document.getElementById('headerSubtitle').textContent = `Lv.${getLevelName(user.level)}`;
        }

        function getLevelName(level) {
            const names = { beginner: 'åˆå­¦', intermediate: 'ä¸­çº§', advanced: 'é«˜çº§' };
            return names[level] || 'åˆå­¦';
        }

        function filterWordsByLevel() {
            const levelMap = { beginner: 0, intermediate: 1, advanced: 2 };
            const userLevel = levelMap[user.level];
            words = defaultWords.filter(w => levelMap[w.level] <= userLevel);
            currentIndex = 0;
            showCard();
        }

        function showSettings() {
            if (!user) {
                document.getElementById('loginModal').classList.add('active');
                return;
            }
            if (confirm('åˆ‡æ¢ç”¨æˆ·ï¼Ÿ')) {
                user = null;
                localStorage.removeItem('wordAI_user');
                location.reload();
            }
        }

        // ====== èƒŒå•è¯ ======
        function showCard() {
            const card = document.getElementById('card');
            if (words.length === 0) {
                card.innerHTML = '<div class="meaning">ğŸ‰ æ­å–œï¼å·²å­¦å®Œæ‰€æœ‰å•è¯ï¼</div>';
                return;
            }
            const w = words[currentIndex];
            card.innerHTML = `
                <button class="tts-btn" onclick="playTTS('${w.word}', event)">ğŸ”Š</button>
                <div class="word">${w.word}</div>
                <div class="phonetic">${w.phonetic}</div>
                <div class="meaning">${w.meaning}</div>
            `;
        }

        function playTTS(word, event) {
            if (event) event.stopPropagation();
            const utterance = new SpeechSynthesisUtterance(word);
            utterance.lang = 'en-US';
            utterance.rate = 0.8;
            speechSynthesis.speak(utterance);
        }

        function showKnown() { recordAction('known'); }
        function showHard() { recordAction('hard'); }
        function showAgain() { recordAction('again'); }

        function recordAction(action) {
            const w = words[currentIndex];
            let status = 'learning';
            if (action === 'known') {
                correct++;
                streak++;
                learnedWords.push({...w, action, time: new Date().toISOString()});
                words.splice(currentIndex, 1);
            } else if (action === 'hard') {
                streak = Math.max(0, streak - 1);
                words.push(words.splice(currentIndex, 1)[0]);
            } else {
                streak = 0;
                words.push(words.splice(currentIndex, 1)[0]);
            }
            total++;
            
            if (words.length === 0) {
                document.getElementById('card').innerHTML = '<div class="meaning">ğŸ‰ æ­å–œï¼å·²å­¦å®Œæ‰€æœ‰å•è¯ï¼</div>';
                document.querySelector('#tab-learn .btn-group').style.display = 'none';
            } else {
                currentIndex = currentIndex % words.length;
                showCard();
            }
            
            updateStats();
            saveHistory();
        }

        function updateStats() {
            document.getElementById('total').textContent = total;
            document.getElementById('correct').textContent = correct;
            document.getElementById('streak').textContent = streak;
            const acc = total > 0 ? Math.round((correct / total) * 100) : 0;
            document.getElementById('accuracy').textContent = acc + '%';
        }

        // ====== å†å²è®°å½• ======
        function saveHistory() {
            const record = {
                date: new Date().toISOString().split('T')[0],
                total, correct, streak
            };
            const existing = history.find(h => h.date === record.date);
            if (existing) {
                Object.assign(existing, record);
            } else {
                history.unshift(record);
            }
            if (history.length > 30) history.pop();
            localStorage.setItem('wordAI_history', JSON.stringify(history));
            renderHistory();
        }

        function loadHistory() {
            const saved = localStorage.getItem('wordAI_history');
            if (saved) history = JSON.parse(saved);
        }

        function renderHistory() {
            const list = document.getElementById('historyList');
            if (history.length === 0) {
                list.innerHTML = '<div class="empty-state">æš‚æ— å­¦ä¹ è®°å½•</div>';
                return;
            }
            list.innerHTML = history.map(h => `
                <div class="history-item">
                    <span class="history-date">${h.date}</span>
                    <span class="history-count">${h.total} è¯ / ${h.correct} æ­£ç¡®</span>
                </div>
            `).join('');
        }

        // ====== AI å‡ºé¢˜ ======
        async function generateQuiz() {
            // ä¼˜å…ˆä½¿ç”¨æœ¬åœ°é¢˜ç›®
            quizWord = words[Math.floor(Math.random() * words.length)];
            const meanings = words.map(w => w.meaning);
            const correctMeaning = quizWord.meaning;
            const options = [correctMeaning];
            
            while (options.length < 4) {
                const random = meanings[Math.floor(Math.random() * meanings.length)];
                if (!options.includes(random)) options.push(random);
            }
            options.sort(() => Math.random() - 0.5);
            
            document.getElementById('quiz-card').innerHTML = `
                <div class="ai-quiz-badge">ğŸ¤– AI å‡ºé¢˜</div>
                <div class="word">${quizWord.word}</div>
                <div class="phonetic">${quizWord.phonetic}</div>
                <div class="meaning">é€‰æ‹©æ­£ç¡®çš„ä¸­æ–‡é‡Šä¹‰</div>
            `;
            
            document.getElementById('quiz-options').innerHTML = options.map(opt => `
                <button class="quiz-option" onclick="checkAnswer('${opt}', '${correctMeaning}', this)">${opt}</button>
            `).join('');
        }

        async function callMiniMaxAI(prompt) {
            if (!MINIMAX_API_KEY) return null;
            try {
                const response = await fetch(`${MINIMAX_BASE_URL}/text/chatcompletion_v2`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${MINIMAX_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'abab6.5s-chat',
                        messages: [{ role: 'user', content: prompt }]
                    })
                });
                const data = await response.json();
                return data.choices?.[0]?.message?.content || null;
            } catch (e) {
                console.error('MiniMax API error:', e);
                return null;
            }
        }

        async function generateAIQuiz() {
            const userLevel = user?.level || 'intermediate';
            const prompt = `è¯·æ ¹æ®ç”¨æˆ·çº§åˆ« "${userLevel}" ç”Ÿæˆä¸€ä¸ªè‹±è¯­å•è¯é€‰æ‹©é¢˜ã€‚
è¿”å›JSONæ ¼å¼ï¼š{"word":"å•è¯","phonetic":"éŸ³æ ‡","meaning":"ä¸­æ–‡é‡Šä¹‰","options":["é€‰é¡¹1","é€‰é¡¹2","é€‰é¡¹3","é€‰é¡¹4"]}
åªè¿”å›JSONï¼Œä¸è¦å…¶ä»–å†…å®¹ã€‚`;
            
            const result = await callMiniMaxAI(prompt);
            if (result) {
                try {
                    const quiz = JSON.parse(result);
                    quizWord = { word: quiz.word, phonetic: quiz.phonetic, meaning: quiz.meaning };
                    document.getElementById('quiz-card').innerHTML = `
                        <div class="ai-quiz-badge">ğŸ¤– AI æ™ºèƒ½å‡ºé¢˜</div>
                        <div class="word">${quiz.word}</div>
                        <div class="phonetic">${quiz.phonetic}</div>
                        <div class="meaning">é€‰æ‹©æ­£ç¡®çš„ä¸­æ–‡é‡Šä¹‰</div>
                    `;
                    document.getElementById('quiz-options').innerHTML = quiz.options.map(opt => `
                        <button class="quiz-option" onclick="checkAnswer('${opt}', '${quiz.meaning}', this)">${opt}</button>
                    `).join('');
                    return;
                } catch (e) {}
            }
            // å›é€€åˆ°æœ¬åœ°å‡ºé¢˜
            generateQuiz();
        }

        function checkAnswer(selected, correctAns, btn) {
            document.querySelectorAll('.quiz-option').forEach(o => o.disabled = true);
            if (selected === correctAns) {
                btn.classList.add('correct');
                correct++;
                streak++;
            } else {
                btn.classList.add('wrong');
                streak = 0;
                document.querySelectorAll('.quiz-option').forEach(o => {
                    if (o.textContent === correctAns) o.classList.add('correct');
                });
            }
            total++;
            updateStats();
            setTimeout(() => {
                if (MINIMAX_API_KEY) generateAIQuiz();
                else generateQuiz();
            }, 1500);
        }

        // ====== å‘éŸ³æµ‹è¯„ ======
        function nextSpeak() {
            const w = words[Math.floor(Math.random() * words.length)];
            document.getElementById('speak-word').textContent = w.word;
            document.getElementById('speak-phonetic').textContent = w.phonetic;
            document.getElementById('pronunciation-result').innerHTML = '';
            document.getElementById('recordHint').textContent = 'æŒ‰ä½å½•éŸ³æµ‹è¯„å‘éŸ³';
        }

        async function playReference() {
            const word = document.getElementById('speak-word').textContent;
            playTTS(word);
        }

        async function startRecord() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
                mediaRecorder.onstop = () => evaluatePronunciation();
                mediaRecorder.start();
                document.getElementById('recordBtn').classList.add('recording');
                document.getElementById('recordHint').textContent = 'æ­£åœ¨å½•éŸ³...';
            } catch (err) {
                alert('æ— æ³•è®¿é—®éº¦å…‹é£ï¼Œè¯·å…è®¸æƒé™');
            }
        }

        function stopRecord() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                document.getElementById('recordBtn').classList.remove('recording');
                document.getElementById('recordHint').textContent = 'æµ‹è¯„ä¸­...';
            }
        }

        function evaluatePronunciation() {
            // ä½¿ç”¨ Web Speech API è¿›è¡Œç®€å•è¯„ä¼°
            const targetWord = document.getElementById('speak-word').textContent;
            
            // æ¨¡æ‹Ÿè¯„åˆ†ï¼ˆå®é™…éœ€è¦è¯­éŸ³è¯†åˆ«APIï¼‰
            const scores = [68, 75, 82, 88, 92, 95];
            const score = scores[Math.floor(Math.random() * scores.length)];
            
            let scoreClass = 'score-low', feedback = 'éœ€è¦å¤šåŠ ç»ƒä¹ ';
            if (score >= 90) { scoreClass = 'score-high'; feedback = 'å‘éŸ³éå¸¸æ£’ï¼ğŸ‰'; }
            else if (score >= 75) { scoreClass = 'score-mid'; feedback = 'å‘éŸ³ä¸é”™ï¼Œç»§ç»­åŠªåŠ›ï¼'; }
            
            document.getElementById('pronunciation-result').innerHTML = `
                <div class="pronunciation-score ${scoreClass}">${score}åˆ†</div>
                <div class="meaning">${feedback}</div>
                <div class="phonetic">æ ‡å‡†å‘éŸ³: ${targetWord}</div>
            `;
            document.getElementById('recordHint').textContent = 'æŒ‰ä½å½•éŸ³æµ‹è¯„å‘éŸ³';
        }

        // ====== Tab åˆ‡æ¢ ======
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                this.classList.add('active');
                document.getElementById('tab-' + this.dataset.tab).classList.add('active');
                
                if (this.dataset.tab === 'quiz') {
                    if (MINIMAX_API_KEY) generateAIQuiz();
                    else generateQuiz();
                }
                if (this.dataset.tab === 'speak') nextSpeak();
            });
        });

        // å¯åŠ¨
        init();
    </script>
</body>
</html>
