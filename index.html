<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#667eea">
    <meta name="description" content="AIËÉåÂçïËØç - Êô∫ËÉΩÂ≠¶‰π†Âä©ÊâãÔºåËÆ©ËÉåÂçïËØçÂèòÂæóÊúâË∂£È´òÊïà">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="AIËÉåÂçïËØç">
    <link rel="manifest" href="manifest.json">
    
    <!-- ÂêØÂä®ÁîªÈù¢ -->
    <div class="splash-screen" id="splashScreen">
        <div class="splash-logo">üìö</div>
        <div class="splash-title">AI ËÉåÂçïËØç</div>
        <div class="splash-subtitle">Êô∫ËÉΩÂ≠¶‰π†Âä©Êâã</div>
        <div class="splash-progress"><div class="splash-progress-fill" id="splashProgress"></div></div>
    </div>
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìö</text></svg>">
    <title>AI ËÉåÂçïËØç - Êô∫ËÉΩÂ≠¶‰π†Âä©Êâã</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 420px;
            overflow: hidden;
            padding-bottom: 70px;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        .header h1 { font-size: 22px; margin-bottom: 5px; }
        .user-info {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 12px;
            background: rgba(255,255,255,0.2);
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
        }
        
        /* ÁôªÂΩï/Ê≥®ÂÜåÂºπÁ™ó */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 320px;
        }
        .modal-title { font-size: 18px; margin-bottom: 20px; text-align: center; }
        .input-group { margin-bottom: 15px; }
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 14px;
        }
        .modal-btns { display: flex; gap: 10px; }
        .modal-btns .btn { flex: 1; }

        .tabs { display: flex; border-bottom: 1px solid #eee; }
        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            font-size: 13px;
            color: #666;
            transition: all 0.3s;
        }
        .tab.active { color: #667eea; border-bottom: 2px solid #667eea; font-weight: 500; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .card { padding: 25px; text-align: center; min-height: 160px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .word { font-size: 30px; font-weight: bold; color: #333; margin-bottom: 8px; }
        .phonetic { font-size: 15px; color: #666; margin-bottom: 12px; }
        .meaning { font-size: 14px; color: #555; line-height: 1.5; }
        
        .tts-btn {
            background: #f0f0f0;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 18px;
            cursor: pointer;
            margin-bottom: 12px;
            transition: all 0.3s;
        }
        .tts-btn:hover { background: #e0e0e0; transform: scale(1.1); }
        
        /* Á¨îËÆ∞ÊåâÈíÆ */
        .note-btn {
            background: #fef3c7;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            font-size: 16px;
            cursor: pointer;
            margin-left: 8px;
            transition: all 0.3s;
            position: absolute;
            top: 15px;
            right: 15px;
        }
        .note-btn:hover { background: #fcd34d; transform: scale(1.1); }
        .note-btn.has-note { background: #dbeafe; }
        
        .word-note {
            background: #fef9c3;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            font-size: 12px;
            color: #666;
            text-align: left;
            border-left: 3px solid #f59e0b;
        }
        
        .btn-group { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; padding: 15px 20px; border-top: 1px solid #eee; }
        .btn { padding: 10px 16px; border: none; border-radius: 20px; font-size: 13px; cursor: pointer; transition: all 0.3s; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-success { background: #10b981; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-warning { background: #f59e0b; color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        
        .stats { display: flex; justify-content: space-around; padding: 12px; background: #f9f9f9; border-top: 1px solid #eee; }
        .stat-item { text-align: center; }
        .stat-value { font-size: 18px; font-weight: bold; color: #667eea; }
        .stat-label { font-size: 10px; color: #666; }

        /* AI Âá∫È¢ò */
        .quiz-options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; padding: 10px 20px 20px; }
        .quiz-option { padding: 12px; border: 2px solid #eee; border-radius: 12px; background: white; cursor: pointer; font-size: 13px; transition: all 0.3s; }
        .quiz-option:hover { border-color: #667eea; background: #f5f7ff; }
        .quiz-option.correct { border-color: #10b981; background: #d1fae5; }
        .quiz-option.wrong { border-color: #ef4444; background: #fee2e2; }
        .ai-quiz-badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            margin-bottom: 10px;
        }

        /* ÂèëÈü≥ÊµãËØÑ */
        .record-btn { width: 70px; height: 70px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); border: none; color: white; font-size: 22px; cursor: pointer; margin: 15px; transition: all 0.3s; }
        .record-btn.recording { animation: pulse 1s infinite; background: #ef4444; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        .record-hint { font-size: 13px; color: #666; margin-top: 10px; }
        .pronunciation-score { font-size: 42px; font-weight: bold; margin: 8px 0; }
        .score-high { color: #10b981; }
        .score-mid { color: #f59e0b; }
        .score-low { color: #ef4444; }

        /* AI Âä©Êâã */
        .ai-chat { padding: 12px; max-height: 180px; overflow-y: auto; }
        .ai-message { background: #f0f0ff; padding: 10px; border-radius: 12px; margin-bottom: 8px; font-size: 13px; line-height: 1.5; }
        .user-message { background: #e0f2fe; padding: 10px; border-radius: 12px; margin-bottom: 8px; font-size: 13px; text-align: right; }
        
        /* Â≠¶‰π†ËÆ∞ÂΩï */
        .history-list { max-height: 200px; overflow-y: auto; padding: 10px; }
        .history-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; font-size: 13px; }
        .history-item:last-child { border-bottom: none; }
        .history-date { color: #666; }
        .history-count { font-weight: 500; }

        /* ËÆæÁΩÆÈ°µ */
        .settings { padding: 15px; }
        .setting-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #eee; }
        .setting-label { font-size: 14px; }
        .setting-btn { padding: 8px 16px; border-radius: 15px; border: none; font-size: 12px; cursor: pointer; }
        
        .loading { color: #666; font-size: 14px; }
        .empty-state { text-align: center; padding: 30px; color: #666; }
        
        /* ÊØèÊó•ÊåëÊàò */
        .challenge-header { text-align: center; padding: 20px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .challenge-title { font-size: 20px; font-weight: bold; margin-bottom: 5px; }
        .challenge-date { font-size: 12px; opacity: 0.8; }
        .challenge-progress { padding: 20px; text-align: center; }
        .challenge-progress-text { font-size: 16px; margin-bottom: 10px; font-weight: 500; }
        .challenge-progress-bar { height: 12px; background: #eee; border-radius: 6px; overflow: hidden; }
        .challenge-progress-fill { height: 100%; background: linear-gradient(90deg, #52C41A, #73D13D); border-radius: 6px; transition: width 0.3s; width: 0%; }
        .challenge-status { text-align: center; padding: 15px; margin: 0 20px; background: #f9f9f9; border-radius: 12px; }
        .challenge-status-icon { font-size: 32px; margin-bottom: 8px; }
        .challenge-status-text { font-size: 14px; color: #666; }
        .challenge-status.completed { background: #f6ffed; }
        .challenge-status.completed .challenge-status-icon { animation: bounce 0.5s; }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        
        /* ÂæΩÁ´†Â¢ô */
        .badges-section { padding: 20px; }
        .badges-title { font-size: 14px; font-weight: 600; margin-bottom: 15px; }
        .badges-grid { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
        .badge-item { width: 60px; height: 70px; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .badge-icon { width: 48px; height: 48px; border-radius: 50%; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 24px; filter: grayscale(1); opacity: 0.5; transition: all 0.3s; }
        .badge-item.unlocked .badge-icon { filter: grayscale(0); opacity: 1; background: linear-gradient(135deg, #FFD700, #FFA500); box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4); }
        .badge-name { font-size: 10px; color: #999; text-align: center; }
        .badge-item.unlocked .badge-name { color: #333; }
        
        /* ‰ªäÊó•‰ªªÂä° */
        .today-tasks { padding: 0 20px 20px; }
        .tasks-title { font-size: 14px; font-weight: 600; margin-bottom: 12px; }
        .task-item { display: flex; align-items: center; gap: 10px; padding: 12px; background: white; border-radius: 10px; margin-bottom: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .task-icon { font-size: 18px; }
        .task-name { flex: 1; font-size: 13px; }
        .task-status { font-size: 12px; color: #999; }
        .task-item.completed .task-status { color: #52C41A; font-weight: 500; }
        
        /* ‰∏ªÈ¢òÂàáÊç¢ */
        :root { --bg: #F5F7FA; --card-bg: #FFFFFF; --text: #333; --text-secondary: #666; --border: #eee; }
        body.dark-theme { background: #1a1a2e; }
        body.dark-theme .container { background: #16213e; }
        body.dark-theme :root { --bg: #1a1a2e; --card-bg: #16213e; --text: #eee; --text-secondary: #aaa; --border: #333; }
        body.dark-theme .card, body.dark-theme .stats-card, body.dark-theme .scene-card { background: #1f2937; }
        body.dark-theme .word, body.dark-theme .meaning { color: #eee; }
        body.dark-theme .tab, body.dark-theme .collection-tabs { background: #1f2937; border-color: #333; }
        body.dark-theme .tab-item { color: #aaa; }
        body.dark-theme .header { background: linear-gradient(135deg, #1f2937, #374151); }
        body.dark-theme .stats { background: #1f2937; }
        body.dark-theme .stat-item { background: #1f2937; }
        body.dark-theme .stat-value { color: #667eea; }
        body.dark-theme .btn-group { background: #1f2937; }
        body.dark-theme .btn { background: #374151; color: #eee; }
        body.dark-theme .btn-primary { background: linear-gradient(135deg, #4f46e5, #7c3aed); }
        body.dark-theme .modal-content { background: #1f2937; }
        body.dark-theme .input-group input, body.dark-theme select, body.dark-theme textarea { background: #374151; border-color: #4b5563; color: #eee; }
        body.dark-theme .settings { background: #16213e; }
        body.dark-theme .setting-item { border-color: #374151; }
        body.dark-theme .quick-bar { background: #1f2937; border-top: 1px solid #374151; }
        body.dark-theme .quick-bar-label { color: #aaa; }
        body.dark-theme .insight-value { color: #818cf8; }
        body.dark-theme .milestone-status { background: #374151; color: #aaa; }
        body.dark-theme .milestone-icon { background: #374151; }
        body.dark-theme .book-card { background: #1f2937; border-color: #374151; }
        body.dark-theme .review-day { background: #1f2937; }
        body.dark-theme .goal-ring circle.gauge-bg { stroke: #374151; }
        .theme-toggle { position: absolute; top: 15px; left: 15px; cursor: pointer; font-size: 18px; }
        
        /* ‰∏™‰∫∫‰∏≠ÂøÉ */
        .profile-header { text-align: center; padding: 30px 20px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .profile-avatar { width: 80px; height: 80px; border-radius: 50%; background: white; margin: 0 auto 12px; display: flex; align-items: center; justify-content: center; font-size: 36px; }
        .profile-name { font-size: 18px; font-weight: 600; margin-bottom: 4px; }
        .profile-level { font-size: 12px; opacity: 0.8; }
        .profile-stats { display: flex; justify-content: space-around; padding: 20px; background: white; }
        .profile-stat { text-align: center; }
        .profile-stat-value { font-size: 20px; font-weight: bold; color: #667eea; }
        .profile-stat-label { font-size: 11px; color: #999; }
        
        /* Â≠¶‰π†Êä•Âëä */
        .report-card { background: white; border-radius: 12px; padding: 16px; margin-bottom: 12px; }
        .report-title { font-size: 14px; font-weight: 600; margin-bottom: 12px; }
        
        /* ÂàÜ‰∫´ */
        .share-buttons { display: flex; gap: 12px; justify-content: center; padding: 20px; }
        .share-btn { padding: 12px 20px; border: none; border-radius: 20px; font-size: 14px; cursor: pointer; }
        .share-wechat { background: #07C160; color: white; }
        
        /* ËØ≠Ë®ÄÂàáÊç¢ */
        .lang-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 16px; }
        .lang-card { background: white; border-radius: 12px; padding: 16px; text-align: center; cursor: pointer; border: 2px solid transparent; }
        .lang-card.active { border-color: #667eea; background: #f0f7ff; }
        .lang-flag { font-size: 32px; margin-bottom: 8px; }
        
        /* È¶ñÈ°µ‰ºòÂåñ */
        .home-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; padding: 12px; }
        .home-card { background: white; border-radius: 12px; padding: 12px; text-align: center; cursor: pointer; }
        
        /* Â≠¶‰π†Â∞èÁªÑ */
        .group-header { text-align: center; padding: 20px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .ranking-list { padding: 16px; }
        .ranking-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: white; border-radius: 10px; margin-bottom: 8px; }
        .ranking-num { font-size: 18px; font-weight: bold; width: 30px; color: #667eea; }
        
        /* Â≠¶‰π†Âú∞Âõæ */
        .map-container { padding: 16px; }
        .map-node { width: 50px; height: 50px; border-radius: 50%; background: #ddd; display: flex; align-items: center; justify-content: center; font-size: 24px; margin: 10px auto; }
        .map-node.unlocked { background: linear-gradient(135deg, #52C41A, #73D13D); }
        .map-node.current { background: linear-gradient(135deg, #667eea, #764ba2); animation: pulse 1s infinite; }
        
        /* PKÂØπÊàò */
        .pk-arena { text-align: center; padding: 20px; }
        .pk-vs { font-size: 32px; font-weight: bold; margin: 20px 0; }
        .pk-player { display: flex; align-items: center; justify-content: center; gap: 20px; }
        .pk-avatar { width: 60px; height: 60px; border-radius: 50%; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 28px; }
        .pk-score { font-size: 36px; font-weight: bold; }

        /* ÊØèÊó•‰∏ÄÂè• */
        .quote-card { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 30px; border-radius: 16px; margin: 16px; text-align: center; }
        .quote-text { font-size: 18px; line-height: 1.8; margin-bottom: 16px; font-style: italic; }
        .quote-author { font-size: 14px; opacity: 0.8; }

        /* VIP‰ºöÂëò */
        .vip-header { background: linear-gradient(135deg, #FFD700, #FFA500); padding: 30px; text-align: center; color: white; }
        .vip-badge { font-size: 48px; }
        .vip-title { font-size: 24px; font-weight: bold; margin: 10px 0; }
        .vip-features { padding: 20px; }
        .vip-feature { display: flex; align-items: center; gap: 12px; padding: 12px; background: white; border-radius: 10px; margin-bottom: 8px; }
        .vip-btn { background: linear-gradient(135deg, #FFD700, #FFA500); color: white; border: none; padding: 12px 30px; border-radius: 20px; font-size: 16px; cursor: pointer; }

        /* ÊµãÈ™åÊ®°Âºè */
        .quiz-mode-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 16px; }
        .quiz-mode-card { background: white; border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; border: 2px solid transparent; }
        .quiz-mode-card:hover { border-color: #667eea; }
        .quiz-mode-icon { font-size: 32px; margin-bottom: 8px; }
        .quiz-mode-name { font-size: 14px; font-weight: 500; }
        .quiz-mode-desc { font-size: 11px; color: #999; margin-top: 4px; }
        
        /* ÂæΩÁ´†Êî∂ÈõÜÂÜå */
        .badge-gallery { padding: 16px; }
        .badge-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
        .badge-item-large { text-align: center; padding: 12px; }
        .badge-icon-large { width: 50px; height: 50px; border-radius: 50%; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 24px; margin: 0 auto 8px; }
        .badge-item-large.unlocked .badge-icon-large { background: linear-gradient(135deg, #FFD700, #FFA500); }
        .badge-name-small { font-size: 10px; color: #999; }

        
        /* ÁªüËÆ°ÂõæË°®Â¢ûÂº∫ */
        .chart-wrapper { background: white; border-radius: 12px; padding: 16px; margin-bottom: 12px; }
        .chart-bar { display: flex; align-items: flex-end; height: 100px; gap: 4px; }
        .chart-bar-item { flex: 1; background: linear-gradient(180deg, #667eea, #764ba2); border-radius: 4px 4px 0 0; min-height: 4px; }
        
        /* Êî∂ËóèÂíåÈîôÈ¢òÊú¨ */
        .collection-header { display: flex; justify-content: space-between; padding: 12px 16px; background: white; border-bottom: 1px solid #eee; }
        .collection-tabs { display: flex; gap: 8px; padding: 12px; background: white; }
        .collection-tab { flex: 1; padding: 8px; text-align: center; border-radius: 8px; font-size: 13px; cursor: pointer; background: #f5f5f5; }
        .collection-tab.active { background: #667eea; color: white; }
        .word-card { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: white; border-bottom: 1px solid #f0f0f0; }
        .word-card-word { font-weight: 500; font-size: 14px; }
        .word-card-meaning { font-size: 12px; color: #999; }
        .word-card-actions { display: flex; gap: 8px; }
        .word-card-btn { padding: 4px 8px; border: none; border-radius: 4px; font-size: 12px; cursor: pointer; }
        .word-card-btn:hover { transform: scale(1.05); }
        .btn-remove { background: #fff1f0; color: #ff4d4f; }
        .btn-review { background: #e6f7ff; color: #1890ff; }
        
        /* ÊèêÈÜíËÆæÁΩÆ */
        .reminder-settings { padding: 16px; }
        .reminder-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f0f0f0; }
        .reminder-label { font-size: 14px; }
        .reminder-toggle { width: 44px; height: 24px; border-radius: 12px; background: #ccc; position: relative; cursor: pointer; }
        .reminder-toggle.active { background: #667eea; }
        .reminder-toggle::after { content: ''; position: absolute; width: 20px; height: 20px; background: white; border-radius: 50%; top: 2px; left: 2px; transition: 0.3s; }
        .reminder-toggle.active::after { left: 22px; }
        
        /* ÁªüËÆ°ÂõæË°® */
        .stats-container { padding: 20px; }
        .stats-card { background: white; border-radius: 12px; padding: 16px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .stats-title { font-size: 14px; font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .stats-item { text-align: center; padding: 12px; background: #f9f9f9; border-radius: 8px; }
        .stats-value { font-size: 24px; font-weight: bold; color: #667eea; }
        .stats-value.green { color: #52C41A; }
        .stats-value.orange { color: #FAAD14; }
        .stats-value.red { color: #FF4D4F; }
        .stats-label { font-size: 11px; color: #999; margin-top: 4px; }
        
        /* ËÆ∞ÂøÜÊõ≤Á∫øÂõæË°® */
        .memory-chart { height: 150px; display: flex; align-items: flex-end; justify-content: space-between; padding: 10px; gap: 4px; }
        
        /* Â§ç‰π†ËÆ°Âàí */
        .review-plan { padding: 16px; }
        .review-timeline { display: flex; gap: 8px; overflow-x: auto; padding: 10px 0; }
        .review-day { min-width: 60px; text-align: center; }
        .review-day-date { font-size: 11px; color: #999; margin-bottom: 5px; }
        .review-day-count { font-size: 16px; font-weight: bold; color: #667eea; }
        .review-day-label { font-size: 10px; color: #666; }
        .review-day.overdue .review-day-count { color: #ef4444; }
        .review-day.today { background: #f0f7ff; border-radius: 8px; padding: 5px; }
        
        /* ‰∏ìÊ≥®Ê®°Âºè */
        .focus-mode { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, #667eea, #764ba2); z-index: 9999; display: none; flex-direction: column; justify-content: center; align-items: center; color: white; }
        .focus-mode.active { display: flex; }
        .focus-timer { font-size: 72px; font-weight: bold; margin: 20px 0; font-variant-numeric: tabular-nums; }
        .focus-stats { display: flex; gap: 30px; margin: 20px 0; }
        .focus-stat { text-align: center; }
        .focus-stat-value { font-size: 28px; font-weight: bold; }
        .focus-stat-label { font-size: 12px; opacity: 0.8; }
        .focus-exit { position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.2); border: none; color: white; padding: 10px 20px; border-radius: 20px; cursor: pointer; }
        
        /* Êô∫ËÉΩÂª∫ËÆÆ */
        .smart-suggestion { background: linear-gradient(135deg, #667eea20, #764ba220); border-radius: 12px; padding: 16px; margin: 12px; }
        .suggestion-title { font-size: 14px; font-weight: 600; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .suggestion-item { display: flex; align-items: center; gap: 10px; padding: 8px 0; border-bottom: 1px solid #eee; }
        .suggestion-item:last-child { border-bottom: none; }
        .suggestion-icon { font-size: 20px; }
        .suggestion-text { flex: 1; font-size: 13px; }
        .suggestion-action { color: #667eea; font-size: 12px; cursor: pointer; }
        
        /* Â≠¶‰π†ÁõÆÊ†áËøõÂ∫¶ÁéØ */
        .goal-ring { width: 100px; height: 100px; margin: 10px auto; position: relative; }
        .goal-ring svg { transform: rotate(-90deg); }
        .goal-ring circle { fill: none; stroke-width: 8; }
        .goal-ring .bg { stroke: #eee; }
        .goal-ring .progress { stroke: #667eea; stroke-linecap: round; transition: stroke-dashoffset 0.5s; }
        .goal-ring.completed .progress { stroke: #52C41A; }
        .goal-ring-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }
        .goal-ring-value { font-size: 20px; font-weight: bold; }
        .goal-ring-label { font-size: 10px; color: #999; }
        
        /* ËØç‰π¶ÂàÜÁ±ª */
        .book-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 16px; }
        .book-card { background: white; border-radius: 12px; padding: 16px; text-align: center; cursor: pointer; border: 2px solid transparent; transition: all 0.3s; }
        .book-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .book-card.active { border-color: #667eea; background: #f0f7ff; }
        .book-icon { font-size: 32px; margin-bottom: 8px; }
        .book-name { font-size: 14px; font-weight: 500; }
        .book-count { font-size: 11px; color: #999; margin-top: 4px; }
        .book-progress { height: 4px; background: #eee; border-radius: 2px; margin-top: 8px; overflow: hidden; }
        .book-progress-fill { height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); border-radius: 2px; transition: width 0.3s; }
        
        /* ÈÅóÂøòÊõ≤Á∫øÂèØËßÜÂåñ */
        .forgetting-curve { padding: 16px; }
        .curve-container { height: 200px; position: relative; border-left: 2px solid #ddd; border-bottom: 2px solid #ddd; margin: 20px 10px; }
        .curve-point { position: absolute; width: 12px; height: 12px; border-radius: 50%; background: #667eea; transform: translate(-50%, 50%); cursor: pointer; transition: all 0.3s; }
        .curve-point:hover { transform: translate(-50%, 50%) scale(1.5); }
        .curve-line { position: absolute; height: 2px; background: #667eea; transform-origin: left center; }
        .curve-label { position: absolute; font-size: 10px; color: #999; }
        .curve-legend { display: flex; justify-content: center; gap: 20px; margin-top: 10px; }
        .curve-legend-item { display: flex; align-items: center; gap: 6px; font-size: 11px; }
        .curve-legend-dot { width: 10px; height: 10px; border-radius: 50%; }
        
        /* Â≠¶‰π†ÊèêÈÜíÊµÆÁ™ó */
        .study-reminder { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: white; border-radius: 12px; padding: 12px 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); z-index: 1000; display: none; align-items: center; gap: 12px; animation: slideDown 0.3s; }
        .study-reminder.active { display: flex; }
        .reminder-icon { font-size: 24px; }
        .reminder-text { flex: 1; font-size: 13px; }
        .reminder-close { background: none; border: none; font-size: 18px; cursor: pointer; color: #999; }
        
        @keyframes slideDown { from { opacity: 0; transform: translateX(-50%) translateY(-20px); } to { opacity: 1; transform: translateX(-50%) translateY(0); } }
        
        /* ÈîôÈ¢òÂàÜÊûê */
        .error-analysis { padding: 16px; }
        .error-chart { display: flex; align-items: flex-end; justify-content: space-around; height: 150px; padding: 10px; background: #f9f9f9; border-radius: 12px; margin: 10px 0; }
        .error-bar { width: 30px; background: linear-gradient(180deg, #667eea, #764ba2); border-radius: 4px 4px 0 0; transition: height 0.3s; position: relative; }
        .error-bar-label { position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%); font-size: 10px; color: #666; }
        .error-insight { background: white; border-radius: 12px; padding: 16px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .insight-title { font-size: 14px; font-weight: 600; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .insight-item { display: flex; align-items: center; gap: 10px; padding: 8px 0; border-bottom: 1px solid #f0f0f0; font-size: 13px; }
        .insight-item:last-child { border-bottom: none; }
        .insight-icon { font-size: 18px; }
        .insight-value { color: #667eea; font-weight: 500; }
        
        /* ÊïàÁéá‰ª™Ë°®Áõò */
        .efficiency-gauge { width: 150px; height: 150px; margin: 20px auto; position: relative; }
        .gauge-bg { fill: none; stroke: #eee; stroke-width: 12; }
        .gauge-fill { fill: none; stroke-width: 12; stroke-linecap: round; transform: rotate(-90deg); transform-origin: center; transition: stroke-dasharray 0.5s; }
        .gauge-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }
        .gauge-value { font-size: 28px; font-weight: bold; color: #667eea; }
        .gauge-label { font-size: 12px; color: #999; }
        
        /* Â≠¶‰π†ÈáåÁ®ãÁ¢ë */
        .milestone-timeline { padding: 16px; }
        .milestone-item { display: flex; gap: 12px; padding: 12px 0; border-bottom: 1px solid #eee; }
        .milestone-icon { width: 40px; height: 40px; border-radius: 50%; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .milestone-item.completed .milestone-icon { background: linear-gradient(135deg, #52C41A, #73D13D); }
        .milestone-content { flex: 1; }
        .milestone-title { font-size: 14px; font-weight: 500; }
        .milestone-desc { font-size: 12px; color: #999; }
        .milestone-status { font-size: 11px; padding: 2px 8px; border-radius: 10px; background: #f0f0f0; color: #999; }
        .milestone-item.completed .milestone-status { background: #f6ffed; color: #52C41A; }
        
        /* Êï∞ÊçÆÂ§á‰ªΩÂç°Áâá */
        .backup-card { background: white; border-radius: 12px; padding: 16px; margin-bottom: 12px; }
        .backup-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .backup-title { font-size: 14px; font-weight: 600; }
        .backup-status { font-size: 11px; padding: 2px 8px; border-radius: 10px; background: #f0f0f0; }
        .backup-status.success { background: #f6ffed; color: #52C41A; }
        .backup-info { font-size: 12px; color: #666; margin-bottom: 10px; }
        .backup-actions { display: flex; gap: 8px; }
        .backup-actions .btn { flex: 1; font-size: 12px; padding: 8px; }
        
        /* ‰∫ëÂêåÊ≠•Áä∂ÊÄÅ */
        .sync-status { display: flex; align-items: center; gap: 8px; padding: 10px; background: #f9f9f9; border-radius: 8px; margin-top: 10px; font-size: 12px; }
        .sync-dot { width: 8px; height: 8px; border-radius: 50%; background: #ccc; }
        .sync-dot.synced { background: #52C41A; }
        .sync-dot.syncing { background: #f59e0b; animation: pulse 1s infinite; }
        
        /* Âø´Êç∑Êìç‰Ωú */
        .quick-actions { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; padding: 12px; }
        .quick-action { background: white; border-radius: 12px; padding: 12px; text-align: center; cursor: pointer; transition: all 0.3s; }
        .quick-action:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .quick-action-icon { font-size: 24px; margin-bottom: 4px; }
        .quick-action-label { font-size: 11px; color: #666; }
        
        /* Â∫ïÈÉ®Âø´Êç∑Ê†è */
        .quick-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; display: flex; justify-content: space-around; padding: 10px 5px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 100; }
        .quick-bar-item { display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer; padding: 5px 10px; border-radius: 8px; transition: background 0.3s; }
        .quick-bar-item:hover { background: #f5f5f5; }
        .quick-bar-icon { font-size: 20px; }
        .quick-bar-label { font-size: 10px; color: #666; }
        
        /* È™®Êû∂Â±è */
        .skeleton { background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: skeleton-loading 1.5s infinite; }
        @keyframes skeleton-loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        
        /* Âä†ËΩΩÂä®Áîª */
        .loading-spinner { width: 30px; height: 30px; border: 3px solid #f3f3f3; border-top: 3px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* ÂçïËØçÂç°ÁâáÁøªËΩ¨Âä®Áîª */
        .card.flipping { animation: cardFlip 0.6s ease-in-out; }
        @keyframes cardFlip { 0% { transform: rotateY(0deg); } 50% { transform: rotateY(90deg); } 100% { transform: rotateY( }
        
        /*0deg); } ÊåâÈíÆÁÇπÂáªÊ≥¢Á∫πÊïàÊûú */
        .ripple { position: relative; overflow: hidden; }
        .ripple::after { content: ''; position: absolute; top: 50%; left: 50%; width: 0; height: 0; background: rgba(255,255,255,0.3); border-radius: 50%; transform: translate(-50%, -50%); transition: width 0.6s, height 0.6s; }
        .ripple:active::after { width: 300px; height: 300px; }
        
        /* Êï∞Â≠óÊªöÂä®Âä®Áîª */
        .counter { display: inline-block; transition: all 0.3s; }
        .counter.updated { transform: scale(1.2); color: #52C41A; }
        
        /* ËøõÂ∫¶Êù°Âä®Áîª */
        .progress-animate { transition: width 0.5s ease-out; }
        
        /* ÂºπË∑≥Âä®Áîª */
        .bounce { animation: bounce 0.5s; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        
        /* ËÑâÂÜ≤Âä®Áîª */
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        
        /* ÊëáÊôÉÂä®Áîª */
        .shake { animation: shake 0.5s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        
        /* Á¶ªÁ∫øÁä∂ÊÄÅ */
        body.offline::before { content: 'üì¥ Â∑≤Á¶ªÁ∫ø'; position: fixed; top: 0; left: 0; right: 0; background: #f59e0b; color: white; text-align: center; padding: 8px; font-size: 12px; z-index: 10000; }
        
        /* Êó†ÈöúÁ¢çÊîØÊåÅ */
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); border: 0; }
        
        /* ÂáèÂ∞ëÂä®ÁîªÔºàÊó†ÈöúÁ¢çÔºâ */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after { animation-duration: 0.01ms !important; transition-duration: 0.01ms !important; }
        }
        
        /* ÂçïËØçÊåëÊàòËµõ */
        .challenge-arena { padding: 16px; }
        .arena-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .arena-timer { font-size: 32px; font-weight: bold; color: #667eea; text-align: center; margin: 20px 0; font-variant-numeric: tabular-nums; }
        .arena-timer.warning { color: #f59e0b; }
        .arena-timer.danger { color: #ef4444; animation: pulse 0.5s infinite; }
        .arena-question { background: white; border-radius: 16px; padding: 30px; text-align: center; margin: 20px 0; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        .arena-word { font-size: 36px; font-weight: bold; margin-bottom: 10px; }
        .arena-options { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 20px; }
        .arena-option { padding: 16px; border: 2px solid #eee; border-radius: 12px; text-align: center; cursor: pointer; transition: all 0.2s; font-size: 14px; }
        .arena-option:hover { border-color: #667eea; background: #f0f7ff; }
        .arena-option.correct { background: #f6ffed; border-color: #52C41A; }
        .arena-option.wrong { background: #fff1f0; border-color: #ff4d4f; }
        .arena-score { display: flex; justify-content: space-around; margin: 20px 0; }
        .arena-score-item { text-align: center; }
        .arena-score-value { font-size: 28px; font-weight: bold; }
        .arena-score-label { font-size: 12px; color: #999; }
        
        /* ÈîôÈ¢òËß£Êûê */
        .error-detail { background: white; border-radius: 12px; padding: 16px; margin-bottom: 12px; }
        .error-word { font-size: 20px; font-weight: bold; color: #333; margin-bottom: 8px; }
        .error-meaning { font-size: 14px; color: #666; margin-bottom: 12px; }
        .error-tip { background: #fff7e6; border-left: 3px solid #fa8c16; padding: 12px; border-radius: 4px; font-size: 13px; color: #666; }
        .error-example { background: #f9f9f9; padding: 12px; border-radius: 8px; margin-top: 10px; font-size: 13px; }
        
        /* Â≠¶‰π†Â∞èÁªÑÂä®ÊÄÅ */
        .group-feed { padding: 16px; }
        .feed-item { display: flex; gap: 12px; padding: 12px 0; border-bottom: 1px solid #eee; }
        .feed-avatar { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; color: white; font-size: 18px; }
        .feed-content { flex: 1; }
        .feed-name { font-size: 14px; font-weight: 500; }
        .feed-action { font-size: 13px; color: #666; }
        .feed-time { font-size: 11px; color: #999; margin-top: 4px; }
        
        /* ÂçïËØçÊú¨È¢ÑËßà */
        .word-preview { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; padding: 12px; }
        .preview-word { background: white; border-radius: 8px; padding: 10px; text-align: center; font-size: 12px; cursor: pointer; transition: all 0.2s; }
        .preview-word:hover { transform: scale(1.05); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .preview-word.mastered { background: #f6ffed; border: 1px solid #52C41A; }
        .preview-word.learning { background: #f0f7ff; border: 1px solid #667eea; }
        .preview-word.new { background: #fff7e6; border: 1px solid #fa8c16; }
        
        /* ÁîüËØçÊú¨Â§ç‰π†Ê®°Âºè */
        .new-words-review { padding: 16px; }
        .review-progress { height: 8px; background: #eee; border-radius: 4px; margin: 15px 0; overflow: hidden; }
        .review-progress-fill { height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); border-radius: 4px; transition: width 0.3s; }
        .review-card { background: white; border-radius: 16px; padding: 30px; text-align: center; margin: 20px 0; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        .review-word { font-size: 32px; font-weight: bold; margin-bottom: 10px; }
        .review-phonetic { font-size: 16px; color: #666; margin-bottom: 15px; }
        .review-meaning { font-size: 18px; color: #333; margin-bottom: 20px; padding: 15px; background: #f9f9f9; border-radius: 12px; }
        .review-buttons { display: flex; gap: 12px; justify-content: center; }
        .review-btn { padding: 12px 24px; border-radius: 25px; font-size: 14px; cursor: pointer; border: none; }
        .review-btn.forgot { background: #fff1f0; color: #ff4d4f; }
        .review-btn.remember { background: #f6ffed; color: #52C41A; }
        
        /* Âø´Êç∑ÈîÆËá™ÂÆö‰πâ */
        .shortcut-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: white; border-radius: 8px; margin-bottom: 8px; }
        .shortcut-key { background: #f5f5f5; padding: 4px 10px; border-radius: 4px; font-size: 12px; font-family: monospace; }
        
        /* Â≠¶‰π†ÊèêÈÜíËÆæÁΩÆ */
        .reminder-option { display: flex; align-items: center; gap: 12px; padding: 12px; background: white; border-radius: 8px; margin-bottom: 8px; }
        .reminder-toggle { position: relative; width: 44px; height: 24px; background: #ddd; border-radius: 12px; cursor: pointer; transition: background 0.3s; }
        .reminder-toggle.active { background: #667eea; }
        .reminder-toggle::after { content: ''; position: absolute; top: 2px; left: 2px; width: 20px; height: 20px; background: white; border-radius: 50%; transition: transform 0.3s; }
        .reminder-toggle.active::after { transform: translateX(20px); }
        
        /* AI Âä©Êâã */
        .ai-assistant { padding: 16px; }
        .ai-messages { height: 400px; overflow-y: auto; padding: 10px; }
        .ai-message { display: flex; gap: 10px; margin-bottom: 15px; }
        .ai-message.ai { align-items: flex-start; }
        .ai-message.user { flex-direction: row-reverse; }
        .ai-avatar { width: 36px; height: 36px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; color: white; font-size: 18px; flex-shrink: 0; }
        .ai-message.user .ai-avatar { background: linear-gradient(135deg, #10b981, #34d399); }
        .ai-bubble { max-width: 80%; padding: 12px 16px; border-radius: 16px; font-size: 14px; line-height: 1.5; }
        .ai-message.ai .ai-bubble { background: #f5f5f5; border-bottom-left-radius: 4px; }
        .ai-message.user .ai-bubble { background: #667eea; color: white; border-bottom-right-radius: 4px; }
        .ai-input-container { display: flex; gap: 10px; padding: 12px; background: white; border-top: 1px solid #eee; position: sticky; bottom: 0; }
        .ai-input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 24px; font-size: 14px; outline: none; }
        .ai-input:focus { border-color: #667eea; }
        .ai-send-btn { width: 40px; height: 40px; border-radius: 50%; background: #667eea; color: white; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        
        /* ÂçïËØçËßÜÈ¢ëËÆ≤Ëß£ */
        .video-container { position: relative; padding: 56.25% 0 0 0; background: #000; border-radius: 12px; overflow: hidden; }
        .video-placeholder { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: white; font-size: 48px; background: linear-gradient(135deg, #1a1a2e, #16213e); }
        
        /* Â≠¶‰π†ÊàêÂ∞±ÂæΩÁ´†Â¢ô */
        .badge-wall { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; padding: 16px; }
        .badge-item { text-align: center; padding: 12px 8px; background: white; border-radius: 12px; cursor: pointer; transition: all 0.3s; }
        .badge-item:hover { transform: scale(1.05); }
        .badge-item.locked { opacity: 0.5; filter: grayscale(1); }
        .badge-icon { font-size: 32px; margin-bottom: 8px; }
        .badge-name { font-size: 11px; color: #666; }
        .badge-item.locked .badge-name { color: #999; }
        
        /* ÂàÜ‰∫´Êµ∑Êä• */
        .share-poster { background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 16px; padding: 30px; color: white; text-align: center; margin: 20px 0; }
        .poster-title { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
        .poster-stats { display: flex; justify-content: space-around; margin: 20px 0; }
        .poster-stat { text-align: center; }
        .poster-stat-value { font-size: 28px; font-weight: bold; }
        .poster-stat-label { font-size: 12px; opacity: 0.8; }
        .poster-qr { width: 100px; height: 100px; background: white; border-radius: 8px; margin: 20px auto; display: flex; align-items: center; justify-content: center; }
        
        /* ÊàêÂ∞±Âä®Áîª */
        .achievement-unlock { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 9999; }
        .achievement-unlock.active { display: flex; }
        .achievement-content { text-align: center; color: white; animation: achievementPop 0.5s; }
        @keyframes achievementPop { 0% { transform: scale(0); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
        .achievement-icon { font-size: 80px; margin-bottom: 20px; }
        .achievement-name { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
        .achievement-desc { font-size: 14px; opacity: 0.8; }
        
        /* Á≠æÂà∞Âä®Áîª */
        .checkin-animation { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 120px; animation: checkinBounce 1s; z-index: 9999; pointer-events: none; }
        @keyframes checkinBounce { 0% { transform: translate(-50%, -50%) scale(0); } 50% { transform: translate(-50%, -50%) scale(1.2); } 100% { transform: translate(-50%, -50%) scale(1); } }
        
        /* ÈÄöÁü•ÊùÉÈôêÊèêÁ§∫ */
        .notification-prompt { background: linear-gradient(135deg, #667eea20, #764ba220); border-radius: 12px; padding: 16px; margin: 12px; }
        .notification-btn { background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 20px; font-size: 14px; cursor: pointer; margin-top: 10px; }
        
        /* ÂçïËØçÊú¨ÁÆ°ÁêÜ */
        .wordbook-manager { padding: 16px; }
        .wordbook-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: white; border-radius: 12px; margin-bottom: 8px; }
        .wordbook-info { flex: 1; }
        .wordbook-name { font-size: 14px; font-weight: 500; }
        .wordbook-count { font-size: 12px; color: #666; }
        .wordbook-actions { display: flex; gap: 8px; }
        
        /* Â≠¶‰π†ÊâìÂç°Êó•ÂéÜ */
        .checkin-calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; padding: 10px; }
        .checkin-day { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; font-size: 10px; border-radius: 4px; background: #f5f5f5; }
        .checkin-day.checked { background: #52C41A; color: white; }
        .checkin-day.today { border: 2px solid #667eea; }
        
        /* ÊµÆÂä®ÊåâÈíÆ */
        .fab { position: fixed; bottom: 100px; right: 20px; width: 56px; height: 56px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; font-size: 24px; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; z-index: 99; }
        .fab:hover { transform: scale(1.1); }
        
        /* Â≠¶‰π†Êï∞ÊçÆÂØºÂá∫ */
        .export-option { display: flex; align-items: center; gap: 12px; padding: 12px; background: white; border-radius: 8px; margin-bottom: 8px; cursor: pointer; transition: all 0.2s; }
        .export-option:hover { background: #f5f5f5; }
        .export-icon { width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        
        /* ÊàêÂ∞±ÂæΩÁ´†ËØ¶ÊÉÖ */
        .badge-detail { text-align: center; padding: 20px; }
        .badge-detail-icon { font-size: 64px; margin-bottom: 15px; }
        .badge-detail-name { font-size: 20px; font-weight: bold; margin-bottom: 8px; }
        .badge-detail-desc { font-size: 14px; color: #666; margin-bottom: 15px; }
        .badge-detail-progress { background: #eee; height: 8px; border-radius: 4px; margin: 15px 0; overflow: hidden; }
        .badge-detail-progress-fill { height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); border-radius: 4px; }
        
        /* ÂçïËØçÈÖçÂØπÊ∏∏Êàè */
        .pair-game { padding: 16px; }
        .pair-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin: 15px 0; }
        .pair-card { aspect-ratio: 1; background: white; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: all 0.2s; }
        .pair-card:hover { transform: scale(1.05); }
        .pair-card.selected { background: #667eea; color: white; }
        .pair-card.matched { background: #52C41A; color: white; opacity: 0.5; }
        .pair-card.wrong { background: #ef4444; color: white; animation: shake 0.5s; }
        
        /* Â≠¶‰π†ÁõÆÊ†áËÆæÁΩÆ */
        .goal-setting { padding: 16px; }
        .goal-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: white; border-radius: 12px; margin-bottom: 10px; }
        .goal-label { font-size: 14px; }
        .goal-value { font-size: 24px; font-weight: bold; color: #667eea; }
        
        /* ËØ≠Èü≥Êåá‰ª§ */
        .voice-btn { width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; font-size: 24px; cursor: pointer; margin: 20px auto; display: block; }
        .voice-btn.recording { animation: pulse 1s infinite; background: #ef4444; }
        
        /* ÂçïËØçÊµãÈ™åÈóØÂÖ≥ */
        .level-game { padding: 16px; }
        .level-progress { height: 10px; background: #eee; border-radius: 5px; margin: 15px 0; overflow: hidden; }
        .level-progress-fill { height: 100%; background: linear-gradient(90deg, #52C41A, #73D13D); border-radius: 5px; transition: width 0.5s; }
        .level-badge { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 12px; margin: 2px; }
        .level-locked { background: #f5f5f5; color: #999; }
        .level-unlocked { background: #f6ffed; color: #52C41A; }
        .level-current { background: #667eea; color: white; }
        
        /* Â≠¶‰π†Âë®Êä• */
        .weekly-report { padding: 16px; }
        .report-card { background: white; border-radius: 12px; padding: 16px; margin-bottom: 12px; }
        .report-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .report-title { font-size: 14px; font-weight: 600; }
        .report-date { font-size: 12px; color: #999; }
        .report-stat { display: flex; justify-content: space-around; text-align: center; margin: 15px 0; }
        .report-stat-item { flex: 1; }
        .report-stat-value { font-size: 24px; font-weight: bold; color: #667eea; }
        .report-stat-label { font-size: 11px; color: #666; }
        
        /* ÂêØÂä®ÁîªÈù¢ */
        .splash-screen { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 99999; color: white; }
        .splash-logo { font-size: 64px; margin-bottom: 20px; animation: bounce 1s; }
        .splash-title { font-size: 28px; font-weight: bold; margin-bottom: 10px; }
        .splash-subtitle { font-size: 14px; opacity: 0.8; }
        .splash-progress { width: 200px; height: 4px; background: rgba(255,255,255,0.3); border-radius: 2px; margin-top: 30px; overflow: hidden; }
        .splash-progress-fill { height: 100%; background: white; width: 0%; transition: width 0.3s; }
        
        /* Ê¨¢ËøéÊñ∞ÊâãÂºïÂØº */
        .guide-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 9999; display: none; }
        .guide-overlay.active { display: block; }
        .guide-card { position: absolute; background: white; border-radius: 16px; padding: 20px; width: 280px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
        .guide-arrow { position: absolute; width: 0; height: 0; border: 10px solid transparent; }
        .guide-btn { background: #667eea; color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 14px; cursor: pointer; margin-top: 15px; width: 100%; }
        .learning-calendar { padding: 10px; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; margin-top: 10px; }
        .calendar-day { aspect-ratio: 1; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 10px; color: #999; }
        .calendar-day.learned { background: #667eea; color: white; }
        .calendar-day.today { border: 2px solid #667eea; }
        .calendar-header { display: flex; justify-content: space-between; font-size: 12px; color: #666; margin-bottom: 5px; }
        .calendar-legend { display: flex; gap: 10px; font-size: 10px; margin-top: 8px; }
        .legend-item { display: flex; align-items: center; gap: 4px; }
        .legend-dot { width: 10px; height: 10px; border-radius: 2px; }
        .memory-bar { flex: 1; background: linear-gradient(180deg, #667eea, #764ba2); border-radius: 4px 4px 0 0; min-height: 4px; transition: height 0.3s; position: relative; }
        .memory-bar::after { content: attr(data-day); position: absolute; bottom: -20px; left: 50%; transform: translateX(-50%); font-size: 9px; color: #999; }
        .memory-bar:hover { opacity: 0.8; }
        
        /* ÊàêÂ∞±Á≥ªÁªü */
        .achievement-list { display: flex; flex-direction: column; gap: 10px; }
        .achievement-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: white; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .achievement-icon { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; background: #f0f0f0; }
        .achievement-item.unlocked .achievement-icon { background: linear-gradient(135deg, #FFD700, #FFA500); }
        .achievement-info { flex: 1; }
        .achievement-name { font-size: 13px; font-weight: 500; }
        .achievement-desc { font-size: 11px; color: #999; }
        .achievement-status { font-size: 11px; padding: 4px 8px; border-radius: 10px; background: #f0f0f0; color: #999; }
        .achievement-item.unlocked .achievement-status { background: #f6ffed; color: #52C41A; }
        
        /* Â≠¶‰π†ËøõÂ∫¶ÁéØ */
        .progress-ring { width: 120px; height: 120px; margin: 20px auto; position: relative; }
        .progress-ring svg { transform: rotate(-90deg); }
        .progress-ring circle { fill: none; stroke-width: 8; }
        .progress-ring .bg { stroke: #eee; }
        .progress-ring .progress { stroke: #667eea; stroke-linecap: round; transition: stroke-dashoffset 0.5s; }
        .progress-ring-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }
        .progress-ring-value { font-size: 24px; font-weight: bold; }
        .progress-ring-label { font-size: 10px; color: #999; }
        
        /* Âú∫ÊôØÂ≠¶‰π† */
        .scene-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 16px; }
        .scene-card { background: white; border-radius: 12px; padding: 16px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); cursor: pointer; transition: all 0.3s; }
        .scene-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .scene-card.active { border: 2px solid #667eea; }
        .scene-icon { font-size: 32px; margin-bottom: 8px; }
        .scene-name { font-size: 14px; font-weight: 500; }
        .scene-count { font-size: 11px; color: #999; margin-top: 4px; }
        
        /* AIÂè£ËØ≠Èô™ÁªÉ */
        .dialogue-container { display: flex; flex-direction: column; height: 350px; }
        .dialogue-messages { flex: 1; overflow-y: auto; padding: 16px; }
        .dialogue-msg { margin-bottom: 12px; max-width: 80%; }
        .dialogue-msg.ai { align-self: flex-start; }
        .dialogue-msg.user { align-self: flex-end; text-align: right; }
        .dialogue-bubble { padding: 10px 14px; border-radius: 16px; font-size: 13px; line-height: 1.5; }
        .dialogue-msg.ai .dialogue-bubble { background: #f0f0ff; border-bottom-left-radius: 4px; }
        .dialogue-msg.user .dialogue-bubble { background: #667eea; color: white; border-bottom-right-radius: 4px; }
        .dialogue-input { display: flex; gap: 8px; padding: 12px; border-top: 1px solid #eee; }
        .dialogue-input input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 20px; outline: none; }
        .dialogue-input input:focus { border-color: #667eea; }
        .dialogue-input button { padding: 10px 16px; background: #667eea; color: white; border: none; border-radius: 20px; cursor: pointer; }
        
        /* ÂèëÈü≥ËØÑÂàÜ */
        .pronunciation-score-display { text-align: center; padding: 20px; }
        .score-circle { width: 100px; height: 100px; border-radius: 50%; margin: 0 auto 16px; display: flex; align-items: center; justify-content: center; font-size: 36px; font-weight: bold; }
        .score-high { background: linear-gradient(135deg, #52C41A, #73D13D); color: white; }
        .score-mid { background: linear-gradient(135deg, #FAAD14, #FFC53D); color: white; }
        .score-low { background: linear-gradient(135deg, #FF4D4F, #FF7875); color: white; }
        .score-label { font-size: 14px; color: #666; }
        .score-details { margin-top: 16px; font-size: 12px; color: #999; }
    </style>
</head>
<body>
    <!-- ÂêØÂä®ÁîªÈù¢ -->
    <div id="splashScreen" style="position:fixed;top:0;left:0;right:0;bottom:0;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:9999;color:white;">
        <div style="font-size:64px;margin-bottom:20px;">üìö</div>
        <div style="font-size:28px;font-weight:bold;margin-bottom:10px;">AI ËÉåÂçïËØç</div>
        <div style="font-size:14px;opacity:0.8;margin-bottom:30px;">Êô∫ËÉΩÂ≠¶‰π†Âä©Êâã</div>
        <div style="width:40px;height:40px;border:3px solid rgba(255,255,255,0.3);border-top-color:white;border-radius:50%;animation:spin 1s linear infinite;"></div>
        <style>@keyframes spin {to{transform:rotate(360deg);}}</style>
    </div>
    
    <script>
        // ÈöêËóèÂêØÂä®ÁîªÈù¢
        window.addEventListener('load', function() {
            setTimeout(function() {
                var splash = document.getElementById('splashScreen');
                if (splash) {
                    splash.style.opacity = '0';
                    splash.style.transition = 'opacity 0.5s';
                    setTimeout(function() {
                        splash.style.display = 'none';
                    }, 500);
                }
            }, 800);
        });
    </script>
    <!-- ÁôªÂΩïÂºπÁ™ó -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-title" id="modalTitle">ÁôªÂΩï / Ê≥®ÂÜå</div>
            <div style="text-align:center;margin-bottom:15px;">
                <div id="avatarPreview" style="font-size:48px;cursor:pointer;display:inline-block;" onclick="changeAvatar()">üòÄ</div>
                <div style="font-size:11px;color:#999;margin-top:5px;">ÁÇπÂáªÊõ¥Êç¢Â§¥ÂÉè</div>
            </div>
            <div class="input-group">
                <input type="text" id="username" placeholder="Áî®Êà∑Âêç">
            </div>
            <div class="input-group">
                <select id="level" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:10px;font-size:14px;">
                    <option value="beginner">ÂàùÂ≠¶ËÄÖ</option>
                    <option value="intermediate">‰∏≠Á∫ß</option>
                    <option value="advanced">È´òÁ∫ß</option>
                </select>
            </div>
            <div class="modal-btns">
                <button class="btn btn-primary" onclick="handleLogin()">Á°ÆÂÆö</button>
                <button class="btn" style="background:#eee" onclick="closeModal()">ÂèñÊ∂à</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div class="theme-toggle" onclick="toggleTheme()">üåô</div>
            <div id="streakIndicator" style="display:none;position:absolute;top:10px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#ff6b35,#f7931e);color:white;padding:2px 10px;border-radius:12px;font-size:11px;font-weight:bold;">üî• <span id="streakCount">0</span>Â§©</div>
            <div id="offlineIndicator" style="display:none;position:absolute;top:10px;left:50%;transform:translateX(-50%);background:#ff9800;color:white;padding:2px 8px;border-radius:10px;font-size:10px;">üì¥ Á¶ªÁ∫ø</div>
            <h1>ü§ñ AI ËÉåÂçïËØç</h1>
            <p id="headerSubtitle">Êô∫ËÉΩÂ≠¶‰π†Âä©Êâã</p>
            <div class="user-info" id="userInfo" onclick="showSettings()">Êú™ÁôªÂΩï</div>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="learn">ËÉåÂçïËØç</div>
            <div class="tab" data-tab="quote">ÊØèÊó•</div>
            <div class="tab" data-tab="vip">VIP</div>
            <div class="tab" data-tab="profile">ÊàëÁöÑ</div>
            <div class="tab" data-tab="map">Âú∞Âõæ</div>
            <div class="tab" data-tab="pk">PK</div>
            <div class="tab" data-tab="quizmode">ÊµãÈ™å</div>
            <div class="tab" data-tab="newwords">ÁîüËØç</div>
            <div class="tab" data-tab="challenge">ÊåëÊàò</div>
            <div class="tab" data-tab="scenes">Âú∫ÊôØ</div>
            <div class="tab" data-tab="dialogue">Âè£ËØ≠</div>
            <div class="tab" data-tab="stats">ÁªüËÆ°</div>
            <div class="tab" data-tab="speak">ÂèëÈü≥</div>
            <div class="tab" data-tab="flashcard">ÈÄüËÆ∞</div>
            <div class="tab" data-tab="dictation">Âê¨ÂÜô</div>
            <div class="tab" data-tab="review">Â§ç‰π†</div>
            <div class="tab" data-tab="favorites">Êî∂Ëóè</div>
            <div class="tab" data-tab="wrongbook">ÈîôÈ¢ò</div>
            <div class="tab" data-tab="reminder">ÊèêÈÜí</div>
            <div class="tab" data-tab="history">ËÆ∞ÂΩï</div>
            <div class="tab" data-tab="plan">ËÆ°Âàí</div>
            <div class="tab" data-tab="books">ËØç‰π¶</div>
            <div class="tab" data-tab="arena">ÊåëÊàò</div>
            <div class="tab" data-tab="analysis">ÂàÜÊûê</div>
            <div class="tab" data-tab="ai">AI</div>
            <div class="tab" data-tab="level">Á≠âÁ∫ß</div>
            <div class="tab" data-tab="game">Ê∏∏Êàè</div>
            <div class="tab" data-tab="settings">ËÆæÁΩÆ</div>
        </div>

        <!-- ËÉåÂçïËØç -->
        <div class="tab-content active" id="tab-learn">
            <div id="welcomeBanner" style="background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:12px 15px;text-align:center;font-size:13px;display:none;">
                <span id="welcomeText">üëã Ê¨¢ËøéÂõûÊù•ÔºÅ</span>
            </div>
            <!-- Â≠¶‰π†Â∞èË¥¥Â£´ -->
            <div id="tipBanner" style="background:#fff9e6;color:#856404;padding:10px 15px;text-align:center;font-size:12px;display:flex;align-items:center;justify-content:center;gap:6px;border-bottom:1px solid #ffeeba;">
                <span>üí°</span>
                <span id="tipText">ÊØèÂ§©Â§ç‰π†Ââç‰∏ÄÂ§©Â≠¶‰π†ÁöÑÂçïËØçÔºåËÆ∞ÂøÜÊïàÊûúÊõ¥Â•ΩÔºÅ</span>
            </div>
            <div id="learnProgress" style="padding:10px 15px;background:#f5f5f5;display:none;">
                <div style="display:flex;justify-content:space-between;font-size:11px;color:#666;margin-bottom:5px;">
                    <span>üìä ‰ªäÊó•ËøõÂ∫¶</span>
                    <span><span id="todayProgressText">0/10</span> ¬∑ ‚è±Ô∏è <span id="studyTimeDisplay">0ÂàÜÈíü</span></span>
                </div>
                <div style="height:6px;background:#ddd;border-radius:3px;overflow:hidden;">
                    <div id="todayProgressBar" style="height:100%;background:linear-gradient(90deg,#667eea,#764ba2);width:0%;transition:width 0.3s;"></div>
                </div>
            </div>
            <div class="card" id="card"><div class="loading">Âä†ËΩΩ‰∏≠...</div></div>
            <div class="btn-group">
                <button class="btn btn-danger" onclick="showAgain()">‰∏çËÆ§ËØÜ <span style="font-size:10px;opacity:0.7;">[1]</span></button>
                <button class="btn btn-warning" onclick="showHard()">Âõ∞Èöæ <span style="font-size:10px;opacity:0.7;">[2]</span></button>
                <button class="btn btn-success" onclick="showKnown()">ËÆ§ËØÜ <span style="font-size:10px;opacity:0.7;">[3]</span></button>
            </div>
            <div style="padding:8px 15px;background:#f0f0f0;text-align:center;font-size:11px;color:#888;">
                ‚å®Ô∏è Âø´Êç∑ÈîÆ: 1‰∏çËÆ§ËØÜ 2Âõ∞Èöæ 3ËÆ§ËØÜ Á©∫Ê†ºÂèëÈü≥ TÊç¢ËÇ§ N‰∏ã‰∏Ä‰∏™ PÊî∂Ëóè
            </div>
            <div style="padding:10px 15px;background:#f9f9f9;border-top:1px solid #eee;">
                <div style="font-size:12px;color:#666;margin-bottom:8px;">üí° ‰ªäÊó•Â≠¶‰π†Âª∫ËÆÆ</div>
                <div id="dailyTip" style="font-size:12px;color:#999;">ÊØèÂ§©Â≠¶‰π†5‰∏™Êñ∞ÂçïËØçÔºåÂùöÊåÅ21Â§©ÂΩ¢Êàê‰π†ÊÉØÔºÅ</div>
            </div>
        </div>

        <!-- ‰∏™‰∫∫‰∏≠ÂøÉ -->
        <div class="tab-content" id="tab-profile">
            <div class="profile-header">
                <div class="profile-avatar" id="profileAvatar" onclick="openAvatarSelector()" style="cursor:pointer;">üòÄ</div>
                <div class="profile-name" id="profileName">Â≠¶‰π†ËÄÖ</div>
                <div class="profile-level" id="profileLevel">ÂàùÂ≠¶ËÄÖ Lv.1</div>
                <div style="margin-top:8px;">
                    <div style="height:8px;background:rgba(255,255,255,0.3);border-radius:4px;overflow:hidden;width:200px;margin:0 auto;">
                        <div id="expProgressBar" style="height:100%;background:#FFD700;width:0%;border-radius:4px;transition:width 0.3s;"></div>
                    </div>
                    <div style="font-size:10px;margin-top:4px;" id="expProgressText">0 / 100 ÁªèÈ™åÂÄº</div>
                </div>
            </div>
            <div class="profile-stats">
                <div class="profile-stat">
                    <div class="profile-stat-value" id="profileTotal">0</div>
                    <div class="profile-stat-label">ÊÄªÂ≠¶‰π†</div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-value" id="profileStreak">0</div>
                    <div class="profile-stat-label">ËøûÁª≠Â§©Êï∞</div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-value" id="profileBadges">0</div>
                    <div class="profile-stat-label">ÂæΩÁ´†</div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-value" id="profileChallengeStreak">0</div>
                    <div class="profile-stat-label">ÊåëÊàòÊâìÂç°</div>
                </div>
            </div>
            <div style="padding:16px;">
                <button class="btn btn-primary" style="width:100%;" onclick="showReport()">üìä Â≠¶‰π†Êä•Âëä</button>
                <button class="btn" style="width:100%;margin-top:12px;background:#07C160;color:white;" onclick="shareAchievement()">üèÜ ÂàÜ‰∫´ÊàêÂ∞±</button>
            </div>
        </div>

        <!-- Â≠¶‰π†Êä•ÂëäÂºπÁ™ó -->
        <div class="modal" id="reportModal">
            <div class="modal-content" style="max-width:360px;">
                <div class="modal-title">üìä Â≠¶‰π†Êä•Âëä</div>
                <div id="reportContent"></div>
                <button class="btn btn-primary" style="width:100%;margin-top:16px;" onclick="document.getElementById('reportModal').classList.remove('active')">ÂÖ≥Èó≠</button>
            </div>
        </div>

        <!-- Êô∫ËÉΩÂª∫ËÆÆÊï∞ÊçÆ -->
        <script>
        // ====== Êô∫ËÉΩÂ≠¶‰π†Âª∫ËÆÆÁ≥ªÁªü ======
        function generateSmartSuggestions() {
            const container = document.getElementById('smartSuggestions');
            if (!container) return;
            
            const suggestions = [];
            const data = loadStats();
            
            // Âü∫‰∫éÂ≠¶‰π†Êï∞ÊçÆÂàÜÊûê
            if (data.today >= (challengeData.dailyGoal || 10)) {
                suggestions.push({ icon: 'üéâ', text: '‰ªäÊó•ÁõÆÊ†áÂ∑≤ËææÊàêÔºÅÂèØ‰ª•ÁªßÁª≠ÊåëÊàòÊõ¥È´òÁõÆÊ†á', action: 'ËÆæÁΩÆÊõ¥È´òÁõÆÊ†á', actionFn: 'showGoalSetting' });
            } else if (data.today === 0) {
                suggestions.push({ icon: 'üöÄ', text: '‰ªäÂ§©ËøòÊ≤°ÊúâÂºÄÂßãÂ≠¶‰π†ÔºåÂø´Êù•ËÉåÂçïËØçÂêßÔºÅ', action: 'ÂºÄÂßãÂ≠¶‰π†', actionFn: "showTab('tab-learn')" });
            } else {
                const remaining = (challengeData.dailyGoal || 10) - data.today;
                suggestions.push({ icon: 'üí™', text: `‰ªäÊó•ËøòÂ∑Æ ${remaining} ‰∏™ÂçïËØçÂ∞±ËÉΩËææÊàêÁõÆÊ†áÔºÅ`, action: 'ÁªßÁª≠Â≠¶‰π†', actionFn: "showTab('tab-learn')" });
            }
            
            // Ê£ÄÊü•ÈîôÈ¢ò
            if (wrongWords.length > 0) {
                suggestions.push({ icon: 'üìù', text: `‰Ω†Êúâ ${wrongWords.length} ‰∏™ÈîôÈ¢òÈúÄË¶ÅÂ§ç‰π†`, action: 'Â§ç‰π†ÈîôÈ¢ò', actionFn: 'practiceWrongWords' });
            }
            
            // Ê£ÄÊü•ÂæÖÂ§ç‰π†
            const reviewData = JSON.parse(localStorage.getItem('wordAI_review') || '[]');
            const now = Date.now();
            const dueCount = reviewData.filter(w => w.nextReview && w.nextReview <= now).length;
            if (dueCount > 0) {
                suggestions.push({ icon: 'üîî', text: `‰Ω†Êúâ ${dueCount} ‰∏™ÂçïËØçÈúÄË¶ÅÂ§ç‰π†`, action: 'ÂºÄÂßãÂ§ç‰π†', actionFn: "showTab('tab-review');startReview()" });
            }
            
            // Ê£ÄÊü•ËøûÁª≠ÊâìÂç°
            if (streak >= 7) {
                suggestions.push({ icon: 'üî•', text: `Â§™Ê£í‰∫ÜÔºÅÂ∑≤ÁªèËøûÁª≠Â≠¶‰π† ${streak} Â§©‰∫ÜÔºÅ`, action: 'ÂàÜ‰∫´ÊàêÂ∞±', actionFn: 'shareAchievement' });
            }
            
            // ÈöèÊú∫ÈºìÂä±
            const encouragements = [
                { icon: 'üåü', text: 'ÂùöÊåÅÂ∞±ÊòØËÉúÂà©ÔºåÊØèÂ§©ËøõÊ≠•‰∏ÄÁÇπÁÇπÔºÅ' },
                { icon: 'üìö', text: 'Áü•ËØÜÂ∞±ÊòØÂäõÈáèÔºåÂ≠¶‰π†ËÆ©‰Ω†Êõ¥Âº∫Â§ßÔºÅ' },
                { icon: '‚è∞', text: 'Âà©Áî®Á¢éÁâáÊó∂Èó¥ÔºåÈöèÊó∂ÈöèÂú∞ËÉåÂçïËØçÔºÅ' },
                { icon: 'üéØ', text: 'ËÆæÂÆöÁõÆÊ†áÔºåËÆ©Â≠¶‰π†Êõ¥ÊúâÊñπÂêëÔºÅ' }
            ];
            suggestions.push(encouragements[Math.floor(Math.random() * encouragements.length)]);
            
            container.innerHTML = suggestions.map(s => `
                <div class="suggestion-item">
                    <span class="suggestion-icon">${s.icon}</span>
                    <span class="suggestion-text">${s.text}</span>
                    ${s.action ? `<span class="suggestion-action" onclick="${s.actionFn}">${s.action}</span>` : ''}
                </div>
            `).join('');
        }
        
        // ====== Â§ç‰π†ËÆ°ÂàíÊó∂Èó¥Á∫ø ======
        function renderReviewTimeline() {
            const container = document.getElementById('reviewTimeline');
            if (!container) return;
            
            const reviewData = JSON.parse(localStorage.getItem('wordAI_review') || '[]');
            const today = new Date();
            let html = '';
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() + i);
                const dateStr = date.toISOString().split('T')[0];
                const dateDisplay = i === 0 ? '‰ªäÂ§©' : i === 1 ? 'ÊòéÂ§©' : (date.getMonth() + 1) + '/' + date.getDate();
                
                let reviewCount = 0;
                if (i === 0) {
                    reviewCount = reviewData.filter(w => w.nextReview && new Date(w.nextReview) <= today.getTime() + 86400000).length;
                } else {
                    const dayStart = new Date(date);
                    dayStart.setHours(0, 0, 0, 0);
                    const dayEnd = new Date(date);
                    dayEnd.setHours(23, 59, 59, 999);
                    reviewCount = reviewData.filter(w => w.nextReview && w.nextReview >= dayStart.getTime() && w.nextReview <= dayEnd.getTime()).length;
                }
                
                const isToday = i === 0;
                const isOverdue = i === 0 && reviewCount > 5;
                
                html += `
                    <div class="review-day ${isToday ? 'today' : ''} ${isOverdue ? 'overdue' : ''}">
                        <div class="review-day-date">${dateDisplay}</div>
                        <div class="review-day-count">${reviewCount}</div>
                        <div class="review-day-label">Â§ç‰π†</div>
                    </div>
                `;
            }
            container.innerHTML = html;
        }
        
        // ====== ÁõÆÊ†áËøõÂ∫¶ÁéØ ======
        function updateGoalRing() {
            const data = loadStats();
            const goal = challengeData.dailyGoal || 10;
            const progress = Math.min((data.today / goal) * 100, 100);
            const circumference = 264;
            const offset = circumference - (progress / 100) * circumference;
            
            const progressCircle = document.querySelector('#goalRing .progress');
            const goalPercent = document.getElementById('goalPercent');
            
            if (progressCircle) progressCircle.style.strokeDashoffset = offset;
            if (goalPercent) goalPercent.textContent = Math.round(progress) + '%';
            
            const goalRing = document.getElementById('goalRing');
            if (data.today >= goal) goalRing.classList.add('completed');
            else goalRing.classList.remove('completed');
        }
        
        // ====== ‰∏ìÊ≥®Ê®°Âºè ======
        let focusTimer = null;
        let focusTimeLeft = 25 * 60;
        let focusWordsLearned = 0;
        let focusCorrectCount = 0;
        
        function startFocusMode() {
            focusTimeLeft = 25 * 60;
            focusWordsLearned = 0;
            focusCorrectCount = 0;
            
            document.getElementById('focusMode').classList.add('active');
            updateFocusDisplay();
            
            focusTimer = setInterval(() => {
                focusTimeLeft--;
                updateFocusDisplay();
                if (focusTimeLeft <= 0) endFocusSession();
            }, 1000);
        }
        
        function updateFocusDisplay() {
            const minutes = Math.floor(focusTimeLeft / 60);
            const seconds = focusTimeLeft % 60;
            document.getElementById('focusTimer').textContent = String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');
            document.getElementById('focusWords').textContent = focusWordsLearned;
            document.getElementById('focusCorrect').textContent = focusCorrectCount;
            document.getElementById('focusTime').textContent = 25 - Math.ceil(focusTimeLeft / 60);
        }
        
        function exitFocusMode() {
            if (confirm('Á°ÆÂÆöË¶ÅÈÄÄÂá∫‰∏ìÊ≥®Ê®°ÂºèÂêóÔºü')) {
                clearInterval(focusTimer);
                document.getElementById('focusMode').classList.remove('active');
            }
        }
        
        function endFocusSession() {
            clearInterval(focusTimer);
            playSound('complete');
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="text-align:center;">
                    <div style="font-size:48px;margin-bottom:15px;">üéâ</div>
                    <div class="modal-title">‰∏ìÊ≥®ÂÆåÊàêÔºÅ</div>
                    <p style="color:#666;margin-bottom:15px;">25ÂàÜÈíü‰∏ìÊ≥®Â≠¶‰π†ÁªìÊùü</p>
                    <div style="display:flex;justify-content:space-around;margin:20px 0;">
                        <div><div style="font-size:24px;font-weight:bold;color:#667eea;">${focusWordsLearned}</div><div style="font-size:12px;color:#999;">Â≠¶‰π†ËØçÊï∞</div></div>
                        <div><div style="font-size:24px;font-weight:bold;color:#10b981;">${focusCorrectCount}</div><div style="font-size:12px;color:#999;">Ê≠£Á°ÆÊï∞</div></div>
                        <div><div style="font-size:24px;font-weight:bold;color:#f59e0b;">25</div><div style="font-size:12px;color:#999;">ÂàÜÈíü</div></div>
                    </div>
                    <button class="btn btn-primary" onclick="this.closest('.modal').remove();document.getElementById('focusMode').classList.remove('active');">Â§™Ê£í‰∫ÜÔºÅ</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        // ====== Toast ÊèêÁ§∫ÁªÑ‰ª∂ ======
        const Toast = {
            show(message, duration = 2000, type = 'info') {
                const toast = document.createElement('div');
                toast.className = 'toast toast-' + type;
                toast.innerHTML = '<span class="toast-icon">' + (type === 'success' ? '‚úì' : type === 'error' ? '‚úï' : '‚Ñπ') + '</span><span class="toast-message">' + message + '</span>';
                
                const style('style');
                = document.createElement style.textContent = '.toast{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#333;color:white;padding:12px 20px;border-radius:25px;font-size:14px;z-index:9999;display:flex;align-items:center;gap:8px;box-shadow:0 4px 12px rgba(0,0,0,0.3);animation:toastIn 0.3s ease}.toast-success{background:#10b981}.toast-error{background:#ef4444}.toast-info{background:#667eea}@keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(-20px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}.toast-icon{font-weight:bold}';
                if (!document.getElementById('toastStyle')) {
                    style.id = 'toastStyle';
                    document.head.appendChild(style);
                }
                document.body.appendChild(toast);
                setTimeout(() => { toast.style.animation = 'toastIn 0.3s ease reverse'; setTimeout(() => toast.remove(), 300); }, duration);
            },
            success(msg) { this.show(msg, 2000, 'success'); },
            error(msg) { this.show(msg, 3000, 'error'); },
            info(msg) { this.show(msg, 2000, 'info'); }
        };
        
        // ====== AlertÂÖºÂÆπÂáΩÊï∞ - Â∞ÜalertÊõøÊç¢‰∏∫Toast ======
        function alertToToast(msg) {
            if (!msg) return;
            // Âà§Êñ≠Ê∂àÊÅØÁ±ªÂûã
            if (msg.includes('‚úÖ') || msg.includes('ÊàêÂäü') || msg.includes('Â∑≤‰øùÂ≠ò') || msg.includes('Â∑≤ÂàáÊç¢')) {
                Toast.success(msg.replace(/^[‚úÖ‚ùå‚öîÔ∏èüìö]\s*/, ''));
            } else if (msg.includes('‚ùå') || msg.includes('Â§±Ë¥•') || msg.includes('ÈîôËØØ') || msg.includes('Êó†Êïà')) {
                Toast.error(msg.replace(/^[‚úÖ‚ùå]\s*/, ''));
            } else if (msg.includes('‚öîÔ∏è') || msg.includes('ËßÑÂàô') || msg.includes('ËØ∑')) {
                Toast.info(msg);
            } else {
                Toast.info(msg);
            }
        }
        
        function showTab(tabId) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelector('[data-tab="' + tabId.replace('tab-', '') + '"]').classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }
        
        // Êã¶Êà™Â≠¶‰π†ÂáΩÊï∞ËøΩË∏™‰∏ìÊ≥®Ê®°Âºè
        const originalOnWordLearned = onWordLearned;
        onWordLearned = function() {
            originalOnWordLearned();
            // Ê£ÄÊµãÊòØÂê¶Âú®‰∏ìÊ≥®Ê®°Âºè
            if (document.getElementById('focusMode').classList.contains('active')) {
                focusWordsLearned++;
                focusCorrectCount++;
                updateFocusDisplay();
            }
            // Êõ¥Êñ∞Êï∞Â≠óÂä®Áîª
            animateCounter('total');
        };
        
        // Êï∞Â≠óÂä®ÁîªÂáΩÊï∞
        function animateCounter(id) {
            const el = document.getElementById(id);
            if (el) {
                el.classList.add('updated');
                setTimeout(() => el.classList.remove('updated'), 300);
            }
        }
        
        // ====== Â≠¶‰π†Ë∂ãÂäøÂàÜÊûê ======
        function analyzeLearningTrend() {
            const history = JSON.parse(localStorage.getItem('wordAI_history') || '[]');
            if (history.length < 3) return null;
            
            const last7Days = history.slice(-7);
            const prev7Days = history.slice(-14, -7) || [];
            
            const thisWeekAvg = last7Days.reduce((a, b) => a + (b.count || 0), 0) / Math.max(last7Days.length, 1);
            const prevWeekAvg = prev7Days.length > 0 ? prev7Days.reduce((a, b) => a + (b.count || 0), 0) / prev7Days.length : thisWeekAvg;
            
            const trend = prevWeekAvg > 0 ? ((thisWeekAvg - prevWeekAvg) / prevWeekAvg * 100).toFixed(1) : 0;
            const trendType = trend > 0 ? 'up' : trend < 0 ? 'down' : 'stable';
            
            // ËÆ°ÁÆóÊúÄ‰Ω≥Â≠¶‰π†Êó∂Èó¥ÊÆµ
            const hourCounts = {};
            history.forEach(h => {
                if (h.hour !== undefined) {
                    hourCounts[h.hour] = (hourCounts[h.hour] || 0) + 1;
                }
            });
            const bestHour = Object.entries(hourCounts).sort((a, b) => b[1] - a[1])[0];
            
            return {
                thisWeekAvg: Math.round(thisWeekAvg),
                prevWeekAvg: Math.round(prevWeekAvg),
                trend: Math.abs(trend),
                trendType,
                bestHour: bestHour ? parseInt(bestHour[0]) : null,
                totalDays: history.length
            };
        }
        
        // ====== Êô∫ËÉΩÂ§ç‰π†Âª∫ËÆÆ ======
        function getSmartReviewSuggestion() {
            const reviewData = JSON.parse(localStorage.getItem('wordAI_review') || '[]');
            const wrongBook = JSON.parse(localStorage.getItem('wordAI_wrongBook') || '[]');
            const favorites = JSON.parse(localStorage.getItem('wordAI_favorites') || '[]');
            
            let suggestion = { type: 'normal', message: 'ÁªßÁª≠Âä†Ê≤πÔºÅ', priority: 0 };
            
            // ‰ºòÂÖàÂ§ç‰π†ÈîôÈ¢ò
            if (wrongBook.length > 0) {
                suggestion = { 
                    type: 'wrong', 
                    message: `‰Ω†Êúâ ${wrongBook.length} ‰∏™ÈîôÈ¢òÈúÄË¶ÅÂ§ç‰π†`, 
                    priority: 3,
                    action: () => showTab('tab-review')
                };
            }
            // ÂÖ∂Ê¨°Â§ç‰π†Êî∂ËóèÂçïËØç
            else if (favorites.length > 5) {
                suggestion = { 
                    type: 'favorite', 
                    message: `‰Ω†Êúâ ${favorites.length} ‰∏™Êî∂ËóèÂçïËØçÂèØ‰ª•Â§ç‰π†`, 
                    priority: 2,
                    action: () => showTab('tab-favorites')
                };
            }
            // Â§ç‰π†ÈÅóÂøòÊõ≤Á∫øÂçïËØç
            else if (reviewData.length > 0) {
                const dueCount = reviewData.filter(r => r.nextReview && new Date(r.nextReview) <= new Date()).length;
                if (dueCount > 0) {
                    suggestion = { 
                        type: 'review', 
                        message: `‰ªäÊó•Êúâ ${dueCount} ‰∏™ÂçïËØçÈúÄË¶ÅÂ§ç‰π†`, 
                        priority: 1,
                        action: () => showTab('tab-review')
                    };
                }
            }
            
            return suggestion;
        }
        
        // ====== Âπ¥Â∫¶Â≠¶‰π†Êä•Âëä ======
        function generateAnnualReport() {
            const report = {
                year: new Date().getFullYear(),
                totalWords: total,
                totalCorrect: correct,
                accuracy: total > 0 ? Math.round((correct / total) * 100) : 0,
                streak: streak,
                maxStreak: Math.max(streak, parseInt(localStorage.getItem('wordAI_maxStreak') || '0')),
                totalDays: history.length,
                totalTime: loadStats().totalTime || 0,
                books: Object.keys(JSON.parse(localStorage.getItem('wordAI_bookProgress') || '{}')).length
            };
            
            // ‰øùÂ≠òÊúÄÈ´òËøûÁª≠ËÆ∞ÂΩï
            if (streak > report.maxStreak) {
                localStorage.setItem('wordAI_maxStreak', streak.toString());
                report.maxStreak = streak;
            }
            
            return report;
        }
        
        function showAnnualReport() {
            const report = generateAnnualReport();
            const hours = Math.floor(report.totalTime / 60);
            const mins = report.totalTime % 60;
            
            // Ê†πÊçÆÂ≠¶‰π†ÊàêÂ∞±ÁîüÊàêËØÑ‰ª∑
            let evaluation = '';
            if (report.totalWords >= 1000) evaluation = 'üèÜ Â≠¶Èú∏Á∫ß‰∫∫Áâ©';
            else if (report.totalWords >= 500) evaluation = 'üìö Â≠¶‰π†Ëææ‰∫∫';
            else if (report.totalWords >= 100) evaluation = 'üí™ ËøõÊ≠•ÈùíÂπ¥';
            else if (report.totalWords >= 50) evaluation = 'üå± ÂàùÈú≤Â§¥Ëßí';
            else evaluation = 'üöÄ ÂàöÂàöËµ∑Ê≠•';
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width:360px;text-align:center;">
                    <div style="font-size:48px;margin-bottom:10px;">üìä</div>
                    <div class="modal-title">${report.year}Âπ¥Â∫¶Â≠¶‰π†Êä•Âëä</div>
                    <div style="font-size:20px;font-weight:bold;color:#667eea;margin-bottom:20px;">${evaluation}</div>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin:20px 0;">
                        <div style="background:#f9f9f9;padding:15px;border-radius:12px;">
                            <div style="font-size:24px;font-weight:bold;color:#667eea;">${report.totalWords}</div>
                            <div style="font-size:11px;color:#666;">Â≠¶‰π†ÂçïËØç</div>
                        </div>
                        <div style="background:#f9f9f9;padding:15px;border-radius:12px;">
                            <div style="font-size:24px;font-weight:bold;color:#10b981;">${report.accuracy}%</div>
                            <div style="font-size:11px;color:#666;">Ê≠£Á°ÆÁéá</div>
                        </div>
                        <div style="background:#f9f9f9;padding:15px;border-radius:12px;">
                            <div style="font-size:24px;font-weight:bold;color:#f59e0b;">${report.streak}</div>
                            <div style="font-size:11px;color:#666;">ÂΩìÂâçËøûÁª≠</div>
                        </div>
                        <div style="background:#f9f9f9;padding:15px;border-radius:12px;">
                            <div style="font-size:24px;font-weight:bold;color:#ef4444;">${report.maxStreak}</div>
                            <div style="font-size:11px;color:#666;">ÊúÄÈ´òËøûÁª≠</div>
                        </div>
                    </div>
                    <div style="background:#f0f7ff;padding:15px;border-radius:12px;margin:15px 0;">
                        <div style="font-size:14px;color:#333;">üìÖ Â≠¶‰π†Â§©Êï∞: <b>${report.totalDays}</b> Â§©</div>
                        <div style="font-size:14px;color:#333;margin-top:8px;">‚è±Ô∏è ÊÄªÂ≠¶‰π†Êó∂Èïø: <b>${hours}Â∞èÊó∂${mins}ÂàÜÈíü</b></div>
                        <div style="font-size:14px;color:#333;margin-top:8px;">üìñ ËØç‰π¶Êï∞Èáè: <b>${report.books}</b> Êú¨</div>
                    </div>
                    <button class="btn btn-primary" style="width:100%;" onclick="this.closest('.modal').remove()">Â§™Ê£í‰∫ÜÔºÅ</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        // Ê£ÄÊü•ÊòØÂê¶ÊòØÂë®Âπ¥Â∫ÜÔºàÊØèÊúàÂêå‰∏ÄÊó•ÊúüÔºâ
        function checkAnniversary() {
            const lastShown = localStorage.getItem('wordAI_anniversaryShown');
            const today = new Date().toDateString();
            
            if (lastShown !== today) {
                const data = loadStats();
                if (data.total > 50 && data.today === 0) {
                    // ÈöèÊú∫ÊòæÁ§∫Âπ¥Â∫¶Êä•Âëä
                    if (Math.random() < 0.3) {
                        setTimeout(showAnnualReport, 3000);
                        localStorage.setItem('wordAI_anniversaryShown', today);
                    }
                }
            }
        }
        
        // ====== ÂçïËØçÊåëÊàòËµõ ======
        let arenaTimer = null;
        let arenaTimeLeft = 60;
        let arenaCorrectCount = 0;
        let arenaWrongCount = 0;
        let arenaTotalScore = 0;
        let arenaCurrentWord = null;
        
        function showArenaRules() {
            alert('‚öîÔ∏è ÂçïËØçÊåëÊàòËµõËßÑÂàô\n\n‚Ä¢ 60ÁßíÊó∂Èó¥ÈôêÂà∂\n‚Ä¢ Á≠îÂØπ+10ÂàÜÔºåÁ≠îÈîô-5ÂàÜ\n‚Ä¢ ËøûÁª≠Á≠îÂØπËé∑ÂæóÈ¢ùÂ§ñÂä†ÂàÜ\n‚Ä¢ ÊåëÊàò‰Ω†ÁöÑÂçïËØçÊûÅÈôêÔºÅ');
        }
        
        function startArena() {
            arenaTimeLeft = 60;
            arenaCorrectCount = 0;
            arenaWrongCount = 0;
            arenaTotalScore = 0;
            
            document.getElementById('arenaStartScreen').style.display = 'none';
            document.getElementById('arenaGame').style.display = 'block';
            document.getElementById('arenaResult').style.display = 'none';
            
            document.getElementById('arenaTimer').textContent = arenaTimeLeft;
            document.getElementById('arenaCorrect').textContent = '0';
            document.getElementById('arenaWrong').textContent = '0';
            document.getElementById('arenaTotal').textContent = '0';
            
            nextArenaWord();
            
            arenaTimer = setInterval(() => {
                arenaTimeLeft--;
                const timerEl = document.getElementById('arenaTimer');
                timerEl.textContent = arenaTimeLeft;
                
                if (arenaTimeLeft <= 10) {
                    timerEl.classList.add('danger');
                } else if (arenaTimeLeft <= 20) {
                    timerEl.classList.add('warning');
                }
                
                if (arenaTimeLeft <= 0) {
                    endArena();
                }
            }, 1000);
        }
        
        function nextArenaWord() {
            arenaCurrentWord = words[Math.floor(Math.random() * words.length)];
            const meanings = words.map(w => w.meaning);
            const correctMeaning = arenaCurrentWord.meaning;
            const options = [correctMeaning];
            
            while (options.length < 4) {
                const random = meanings[Math.floor(Math.random() * meanings.length)];
                if (!options.includes(random)) options.push(random);
            }
            options.sort(() => Math.random() - 0.5);
            
            document.getElementById('arenaWord').textContent = arenaCurrentWord.word;
            document.getElementById('arenaOptions').innerHTML = options.map(opt => `
                <div class="arena-option" onclick="checkArenaAnswer('${opt}', '${correctMeaning}', this)">${opt}</div>
            `).join('');
        }
        
        function checkArenaAnswer(selected, correct, btn) {
            const options = document.querySelectorAll('.arena-option');
            options.forEach(o => o.style.pointerEvents = 'none');
            
            if (selected === correct) {
                btn.classList.add('correct');
                arenaCorrectCount++;
                arenaTotalScore += 10;
                playSound('correct');
            } else {
                btn.classList.add('wrong');
                arenaWrongCount++;
                arenaTotalScore = Math.max(0, arenaTotalScore - 5);
                options.forEach(o => {
                    if (o.textContent === correct) o.classList.add('correct');
                });
                playSound('wrong');
            }
            
            document.getElementById('arenaCorrect').textContent = arenaCorrectCount;
            document.getElementById('arenaWrong').textContent = arenaWrongCount;
            document.getElementById('arenaTotal').textContent = arenaTotalScore;
            
            setTimeout(() => {
                nextArenaWord();
            }, 300);
        }
        
        function endArena() {
            clearInterval(arenaTimer);
            document.getElementById('arenaGame').style.display = 'none';
            document.getElementById('arenaResult').style.display = 'block';
            
            const total = arenaCorrectCount + arenaWrongCount;
            const accuracy = total > 0 ? Math.round((arenaCorrectCount / total) * 100) : 0;
            
            document.getElementById('resultCorrect').textContent = arenaCorrectCount;
            document.getElementById('resultAccuracy').textContent = accuracy + '%';
            document.getElementById('resultScore').textContent = arenaTotalScore;
            
            // ‰øùÂ≠òÊúÄÈ´òÂàÜ
            const highScore = parseInt(localStorage.getItem('wordAI_arenaHighScore') || '0');
            if (arenaTotalScore > highScore) {
                localStorage.setItem('wordAI_arenaHighScore', arenaTotalScore.toString());
            }
            
            playSound('complete');
        }
        
        // ====== ËØç‰π¶ÂàÜÁ±ªÁ≥ªÁªü ======
        const wordBooks = [
            { id: 'cet4', name: 'CET-4', icon: 'üìö', desc: 'Â§ßÂ≠¶Ëã±ËØ≠ÂõõÁ∫ß', total: 2000, color: '#667eea' },
            { id: 'cet6', name: 'CET-6', icon: 'üìñ', desc: 'Â§ßÂ≠¶Ëã±ËØ≠ÂÖ≠Á∫ß', total: 1500, color: '#764ba2' },
            { id: 'ielts', name: 'IELTS', icon: 'üåç', desc: 'ÈõÖÊÄùËØçÊ±á', total: 3000, color: '#10b981' },
            { id: 'toefl', name: 'TOEFL', icon: 'üá∫üá∏', desc: 'ÊâòÁ¶èËØçÊ±á', total: 2500, color: '#f59e0b' },
            { id: 'gre', name: 'GRE', icon: 'üéì', desc: 'GREËØçÊ±á', total: 3000, color: '#ef4444' },
            { id: 'tech', name: 'ÁßëÊäÄËØçÊ±á', icon: 'üíª', desc: 'IT/ÁßëÊäÄ‰∏ì‰∏öËØç', total: 500, color: '#3b82f6' },
            { id: 'business', name: 'ÂïÜÂä°ËØçÊ±á', icon: 'üíº', desc: 'ÂïÜÂä°Ëã±ËØ≠ËØçÊ±á', total: 800, color: '#8b5cf6' },
            { id: 'daily', name: 'Êó•Â∏∏Âè£ËØ≠', icon: 'üó£Ô∏è', desc: 'Êó•Â∏∏‰∫§ÊµÅËØçÊ±á', total: 1000, color: '#ec4899' }
        ];
        
        let currentBook = 'tech';
        
        function loadWordBooks() {
            const container = document.getElementById('bookGrid');
            // ‰ªélocalStorageÂä†ËΩΩÁî®Êà∑ÈÄâÊã©ÁöÑËØç‰π¶ÂíåËøõÂ∫¶
            const userBookProgress = JSON.parse(localStorage.getItem('wordAI_bookProgress') || '{}');
            
            container.innerHTML = wordBooks.map(book => {
                const learned = userBookProgress[book.id] || 0;
                const progress = Math.round((learned / book.total) * 100);
                const isActive = currentBook === book.id;
                return `
                    <div class="book-card ${isActive ? 'active' : ''}" onclick="selectBook('${book.id}')">
                        <div class="book-icon">${book.icon}</div>
                        <div class="book-name">${book.name}</div>
                        <div class="book-count">${learned}/${book.total} ËØç</div>
                        <div class="book-progress">
                            <div class="book-progress-fill" style="width:${progress}%;background:${book.color}"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function selectBook(bookId) {
            currentBook = bookId;
            localStorage.setItem('wordAI_currentBook', bookId);
            loadWordBooks();
            
            // Âä†ËΩΩÂØπÂ∫îËØç‰π¶ÁöÑÂçïËØç
            const bookWords = getBookWords(bookId);
            words = [...bookWords, ...defaultWords.filter(w => w.level === 'beginner')];
            currentIndex = 0;
            showCard();
            Toast.success('Â∑≤ÂàáÊç¢Âà∞ ' + wordBooks.find(b => b.id === bookId).name + ' ËØç‰π¶');
        }
        
        function getBookWords(bookId) {
            // Ê†πÊçÆËØç‰π¶IDËøîÂõûÂØπÂ∫îÂçïËØç
            const bookWordMap = {
                'tech': [
                    { word: 'algorithm', phonetic: '/Àà√¶l…°…ôr…™√∞…ôm/', meaning: 'n. ÁÆóÊ≥ï', level: 'intermediate' },
                    { word: 'database', phonetic: '/Ààde…™t…ôbe…™s/', meaning: 'n. Êï∞ÊçÆÂ∫ì', level: 'intermediate' },
                    { word: 'framework', phonetic: '/Ààfre…™mw…úÀêrk/', meaning: 'n. Ê°ÜÊû∂', level: 'intermediate' },
                    { word: 'interface', phonetic: '/Àà…™nt…ôrfe…™s/', meaning: 'n. ÁïåÈù¢', level: 'intermediate' },
                    { word: 'backend', phonetic: '/Ààb√¶kend/', meaning: 'n. ÂêéÁ´Ø', level: 'beginner' },
                    { word: 'frontend', phonetic: '/Ààfr åntend/', meaning: 'n. ÂâçÁ´Ø', level: 'beginner' },
                    { word: 'deployment', phonetic: '/d…™Ààpl…î…™m…ônt/', meaning: 'n. ÈÉ®ÁΩ≤', level: 'advanced' },
                    { word: 'container', phonetic: '/k…ônÀàte…™n…ôr/', meaning: 'n. ÂÆπÂô®', level: 'advanced' },
                    { word: 'microservice', phonetic: '/Àåma…™kr…ô äÀàs…úÀêv…™s/', meaning: 'n. ÂæÆÊúçÂä°', level: 'advanced' },
                    { word: 'encryption', phonetic: '/…™nÀàkr…™p É…ôn/', meaning: 'n. Âä†ÂØÜ', level: 'advanced' },
                    { word: 'paradigm', phonetic: '/Ààp√¶r…ôda…™m/', meaning: 'n. ËåÉÂºè', level: 'advanced' },
                    { word: 'paradigm shift', phonetic: '/Ààp√¶r…ôda…™m  É…™ft/', meaning: 'ËåÉÂºèËΩ¨Âèò', level: 'advanced' },
                    { word: 'paradigm', phonetic: '/Ààp√¶r…ôda…™m/', meaning: 'n. ÂÖ∏ËåÉ; ËåÉÂºè', level: 'advanced' }
                ],
                'cet4': [
                    { word: 'abandon', phonetic: '/…ôÀàb√¶nd…ôn/', meaning: 'v. ÊîæÂºÉ', level: 'beginner' },
                    { word: 'ability', phonetic: '/…ôÀàb…™l…ôti/', meaning: 'n. ËÉΩÂäõ', level: 'beginner' },
                    { word: 'able', phonetic: '/Ààe…™bl/', meaning: 'adj. ËÉΩÂ§üÁöÑ', level: 'beginner' },
                    { word: 'about', phonetic: '/…ôÀàba ät/', meaning: 'prep. ÂÖ≥‰∫é', level: 'beginner' },
                    { word: 'above', phonetic: '/…ôÀàb åv/', meaning: 'prep. Âú®...‰∏äÈù¢', level: 'beginner' },
                    { word: 'abroad', phonetic: '/…ôÀàbr…îÀêd/', meaning: 'adv. Âú®ÂõΩÂ§ñ', level: 'beginner' },
                    { word: 'absence', phonetic: '/Àà√¶bs…ôns/', meaning: 'n. Áº∫Â∏≠', level: 'intermediate' },
                    { word: 'absolute', phonetic: '/Àà√¶bs…ôluÀêt/', meaning: 'adj. ÁªùÂØπÁöÑ', level: 'intermediate' },
                    { word: 'abundant', phonetic: '/…ôÀàb ånd…ônt/', meaning: 'adj. ‰∏∞ÂØåÁöÑ', level: 'intermediate' },
                    { word: 'academic', phonetic: '/Àå√¶k…ôÀàdem…™k/', meaning: 'adj. Â≠¶ÊúØÁöÑ', level: 'intermediate' },
                    { word: 'access', phonetic: '/Àà√¶kses/', meaning: 'n. ÂÖ•Âè£; v. ËÆøÈóÆ', level: 'intermediate' },
                    { word: 'accident', phonetic: '/Àà√¶ks…™d…ônt/', meaning: 'n. ‰∫ãÊïÖ', level: 'beginner' },
                    { word: 'accompany', phonetic: '/…ôÀàk åmp…ôni/', meaning: 'v. Èô™‰º¥', level: 'intermediate' },
                    { word: 'accomplish', phonetic: '/…ôÀàk åmpl…™ É/', meaning: 'v. ÂÆåÊàê', level: 'intermediate' },
                    { word: 'account', phonetic: '/…ôÀàka änt/', meaning: 'n. Ë¥¶Êà∑; ÂèôËø∞', level: 'intermediate' },
                    { word: 'accurate', phonetic: '/Àà√¶kj…ôr…ôt/', meaning: 'adj. ÂáÜÁ°ÆÁöÑ', level: 'intermediate' },
                    { word: 'achieve', phonetic: '/…ôÀàt ÉiÀêv/', meaning: 'v. ËææÂà∞; ÂÆûÁé∞', level: 'intermediate' },
                    { word: 'acknowledge', phonetic: '/…ôkÀàn…íl…™d í/', meaning: 'v. ÊâøËÆ§; ËÆ§ÂèØ', level: 'intermediate' },
                    { word: 'acquire', phonetic: '/…ôÀàkwa…™…ôr/', meaning: 'v. Ëé∑Âæó', level: 'intermediate' },
                    { word: 'across', phonetic: '/…ôÀàkr…ís/', meaning: 'prep. Á©øËøá', level: 'beginner' },
                    { word: 'action', phonetic: '/Àà√¶k É…ôn/', meaning: 'n. Ë°åÂä®', level: 'beginner' },
                    { word: 'active', phonetic: '/Àà√¶kt…™v/', meaning: 'adj. ÁßØÊûÅÁöÑ', level: 'beginner' },
                    { word: 'activity', phonetic: '/√¶kÀàt…™v…ôti/', meaning: 'n. Ê¥ªÂä®', level: 'beginner' },
                    { word: 'actor', phonetic: '/Àà√¶kt…ôr/', meaning: 'n. ÊºîÂëò', level: 'beginner' },
                    { word: 'actual', phonetic: '/Àà√¶kt Éu…ôl/', meaning: 'adj. ÂÆûÈôÖÁöÑ', level: 'intermediate' },
                    { word: 'adapt', phonetic: '/…ôÀàd√¶pt/', meaning: 'v. ÈÄÇÂ∫î; ÊîπÁºñ', level: 'intermediate' },
                    { word: 'add', phonetic: '/√¶d/', meaning: 'v. Ê∑ªÂä†', level: 'beginner' },
                    { word: 'address', phonetic: '/…ôÀàdres/', meaning: 'n. Âú∞ÂùÄ', level: 'beginner' },
                    { word: 'adequate', phonetic: '/Àà√¶d…™kw…ôt/', meaning: 'adj. Ë∂≥Â§üÁöÑ', level: 'intermediate' },
                    { word: 'adjust', phonetic: '/…ôÀàd í åst/', meaning: 'v. Ë∞ÉÊï¥', level: 'intermediate' }
                ],
                'cet6': [
                    { word: 'abandon', phonetic: '/…ôÀàb√¶nd…ôn/', meaning: 'v. ÊîæÂºÉ', level: 'intermediate' },
                    { word: 'abnormal', phonetic: '/√¶bÀàn…îÀêrml/', meaning: 'adj. ÂèçÂ∏∏ÁöÑ', level: 'advanced' },
                    { word: 'aboard', phonetic: '/…ôÀàb…îÀêrd/', meaning: 'prep. Âú®Ëàπ‰∏ä', level: 'intermediate' },
                    { word: 'abolish', phonetic: '/…ôÀàb…íl…™ É/', meaning: 'v. Â∫üÈô§', level: 'advanced' },
                    { word: 'abound', phonetic: '/…ôÀàba änd/', meaning: 'v. ÂÖÖÊª°', level: 'advanced' },
                    { word: 'abrupt', phonetic: '/…ôÀàbr åpt/', meaning: 'adj. Á™ÅÁÑ∂ÁöÑ', level: 'advanced' },
                    { word: 'absence', phonetic: '/Àà√¶bs…ôns/', meaning: 'n. Áº∫Â∏≠', level: 'intermediate' },
                    { word: 'absolute', phonetic: '/Àà√¶bs…ôluÀêt/', meaning: 'adj. ÁªùÂØπÁöÑ', level: 'intermediate' },
                    { word: 'absorb', phonetic: '/…ôbÀàz…îÀêrb/', meaning: 'v. Âê∏Êî∂', level: 'intermediate' },
                    { word: 'abstract', phonetic: '/Àà√¶bstr√¶kt/', meaning: 'adj. ÊäΩË±°ÁöÑ', level: 'intermediate' },
                    { word: 'abundant', phonetic: '/…ôÀàb ånd…ônt/', meaning: 'adj. ‰∏∞ÂØåÁöÑ', level: 'intermediate' },
                    { word: 'abuse', phonetic: '/…ôÀàbjuÀêz/', meaning: 'v. Êª•Áî®', level: 'intermediate' },
                    { word: 'academic', phonetic: '/Àå√¶k…ôÀàdem…™k/', meaning: 'adj. Â≠¶ÊúØÁöÑ', level: 'intermediate' },
                    { word: 'accelerate', phonetic: '/…ôkÀàsel…ôre…™t/', meaning: 'v. Âä†ÈÄü', level: 'advanced' },
                    { word: 'accept', phonetic: '/…ôkÀàsept/', meaning: 'v. Êé•Âèó', level: 'intermediate' },
                    { word: 'access', phonetic: '/Àà√¶kses/', meaning: 'n. ÂÖ•Âè£; v. ËÆøÈóÆ', level: 'intermediate' },
                    { word: 'accident', phonetic: '/Àà√¶ks…™d…ônt/', meaning: 'n. ‰∫ãÊïÖ', level: 'intermediate' },
                    { word: 'accompany', phonetic: '/…ôÀàk åmp…ôni/', meaning: 'v. Èô™‰º¥', level: 'intermediate' },
                    { word: 'accomplish', phonetic: '/…ôÀàk åmpl…™ É/', meaning: 'v. ÂÆåÊàê', level: 'intermediate' },
                    { word: 'account', phonetic: '/…ôÀàka änt/', meaning: 'n. Ë¥¶Êà∑', level: 'intermediate' },
                    { word: 'accumulate', phonetic: '/…ôÀàkjuÀêmj…ôle…™t/', meaning: 'v. ÁßØÁ¥Ø', level: 'advanced' },
                    { word: 'accurate', phonetic: '/Àà√¶kj…ôr…ôt/', meaning: 'adj. ÂáÜÁ°ÆÁöÑ', level: 'intermediate' },
                    { word: 'achieve', phonetic: '/…ôÀàt ÉiÀêv/', meaning: 'v. ÂÆûÁé∞', level: 'intermediate' },
                    { word: 'acknowledge', phonetic: '/…ôkÀàn…íl…™d í/', meaning: 'v. ÊâøËÆ§', level: 'advanced' },
                    { word: 'acquire', phonetic: '/…ôÀàkwa…™…ôr/', meaning: 'v. Ëé∑Âæó', level: 'intermediate' }
                ],
                'ielts': [
                    { word: 'accomplish', phonetic: '/…ôÀàk åmpl…™ É/', meaning: 'v. ÂÆåÊàê', level: 'intermediate' },
                    { word: 'adequate', phonetic: '/Àà√¶d…™kw…ôt/', meaning: 'adj. Ë∂≥Â§üÁöÑ', level: 'intermediate' },
                    { word: 'adjust', phonetic: '/…ôÀàd í åst/', meaning: 'v. Ë∞ÉÊï¥', level: 'intermediate' },
                    { word: 'advocate', phonetic: '/Àà√¶dv…ôke…™t/', meaning: 'v. ÊèêÂÄ°', level: 'advanced' },
                    { word: 'aesthetic', phonetic: '/iÀêsÀàŒ∏et…™k/', meaning: 'adj. ÂÆ°ÁæéÁöÑ', level: 'advanced' },
                    { word: 'affluent', phonetic: '/Àà√¶flu…ônt/', meaning: 'adj. ÂØåÊúâÁöÑ', level: 'advanced' },
                    { word: 'aggregate', phonetic: '/Àà√¶…°r…™…°…ôt/', meaning: 'v. ËÅöÈõÜ', level: 'advanced' },
                    { word: 'alleviate', phonetic: '/…ôÀàliÀêv…™e…™t/', meaning: 'v. ÂáèËΩª', level: 'advanced' },
                    { word: 'alternative', phonetic: '/…îÀêlÀàt…úÀêrn…ôt…™v/', meaning: 'n. Êõø‰ª£ÂìÅ', level: 'intermediate' },
                    { word: 'ambiguous', phonetic: '/√¶mÀàb…™…°ju…ôs/', meaning: 'adj. Ê®°Á≥äÁöÑ', level: 'advanced' },
                    { word: 'amend', phonetic: '/…ôÀàmend/', meaning: 'v. ‰øÆÊîπ', level: 'advanced' },
                    { word: 'analyze', phonetic: '/Àà√¶n…ôla…™z/', meaning: 'v. ÂàÜÊûê', level: 'intermediate' },
                    { word: 'annual', phonetic: '/Àà√¶nju…ôl/', meaning: 'adj. Âπ¥Â∫¶ÁöÑ', level: 'intermediate' },
                    { word: 'anticipate', phonetic: '/√¶nÀàt…™s…™pe…™t/', meaning: 'v. È¢ÑÊúü', level: 'advanced' },
                    { word: 'apparent', phonetic: '/…ôÀàp√¶r…ônt/', meaning: 'adj. ÊòéÊòæÁöÑ', level: 'intermediate' },
                    { word: 'appreciate', phonetic: '/…ôÀàpriÀê Éie…™t/', meaning: 'v. Ê¨£Ëµè', level: 'intermediate' },
                    { word: 'approach', phonetic: '/…ôÀàpro ät É/', meaning: 'n. ÊñπÊ≥ï', level: 'intermediate' },
                    { word: 'appropriate', phonetic: '/…ôÀàpro äpri…ôt/', meaning: 'adj. ÈÄÇÂΩìÁöÑ', level: 'intermediate' },
                    { word: 'approximate', phonetic: '/…ôÀàpr…íks…™m…ôt/', meaning: 'adj. Â§ßÁ∫¶ÁöÑ', level: 'advanced' },
                    { word: 'arbitrary', phonetic: '/Àà…ëÀêrb…™treri/', meaning: 'adj. ‰ªªÊÑèÁöÑ', level: 'advanced' }
                ],
                'toefl': [
                    { word: 'abandon', phonetic: '/…ôÀàb√¶nd…ôn/', meaning: 'v. ÊîæÂºÉ', level: 'intermediate' },
                    { word: 'abdomen', phonetic: '/Àà√¶bd…ôm…ôn/', meaning: 'n. ËÖπÈÉ®', level: 'advanced' },
                    { word: 'aberrant', phonetic: '/√¶Ààber…ônt/', meaning: 'adj. ÂºÇÂ∏∏ÁöÑ', level: 'advanced' },
                    { word: 'abide', phonetic: '/…ôÀàba…™d/', meaning: 'v. ÈÅµÂÆà', level: 'advanced' },
                    { word: 'abolish', phonetic: '/…ôÀàb…íl…™ É/', meaning: 'v. Â∫üÈô§', level: 'advanced' },
                    { word: 'abort', phonetic: '/…ôÀàb…îÀêrt/', meaning: 'v. ‰∏≠Ê≠¢', level: 'advanced' },
                    { word: 'abrasion', phonetic: '/…ôÀàbre…™ í…ôn/', meaning: 'n. Á£®Êçü', level: 'advanced' },
                    { word: 'abrupt', phonetic: '/…ôÀàbr åpt/', meaning: 'adj. Á™ÅÁÑ∂ÁöÑ', level: 'advanced' },
                    { word: 'abscond', phonetic: '/…ôbÀàsk…índ/', meaning: 'v. ÊΩúÈÄÉ', level: 'advanced' },
                    { word: 'absolute', phonetic: '/Àà√¶bs…ôluÀêt/', meaning: 'adj. ÁªùÂØπÁöÑ', level: 'intermediate' },
                    { word: 'absolve', phonetic: '/…ôbÀàz…ílv/', meaning: 'v. Ëµ¶ÂÖç', level: 'advanced' },
                    { word: 'absorb', phonetic: '/…ôbÀàz…îÀêrb/', meaning: 'v. Âê∏Êî∂', level: 'intermediate' },
                    { word: 'abstract', phonetic: '/Àà√¶bstr√¶kt/', meaning: 'adj. ÊäΩË±°ÁöÑ', level: 'intermediate' },
                    { word: 'abundant', phonetic: '/…ôÀàb ånd…ônt/', meaning: 'adj. ‰∏∞ÂØåÁöÑ', level: 'intermediate' },
                    { word: 'academic', phonetic: '/Àå√¶k…ôÀàdem…™k/', meaning: 'adj. Â≠¶ÊúØÁöÑ', level: 'intermediate' },
                    { word: 'accentuate', phonetic: '/…ôkÀàsent Éue…™t/', meaning: 'v. Âº∫Ë∞É', level: 'advanced' },
                    { word: 'accommodate', phonetic: '/…ôÀàk…ím…ôde…™t/', meaning: 'v. ÈÄÇÂ∫î', level: 'intermediate' },
                    { word: 'accompany', phonetic: '/…ôÀàk åmp…ôni/', meaning: 'v. Èô™‰º¥', level: 'intermediate' },
                    { word: 'accomplice', phonetic: '/…ôÀàk åmpl…™s/', meaning: 'n. ÂêåË∞ã', level: 'advanced' },
                    { word: 'accord', phonetic: '/…ôÀàk…îÀêrd/', meaning: 'n. ÂçèËÆÆ', level: 'advanced' }
                ],
                'gre': [
                    { word: 'aberrant', phonetic: '/√¶Ààber…ônt/', meaning: 'adj. ÂºÇÂ∏∏ÁöÑ', level: 'advanced' },
                    { word: 'abeyance', phonetic: '/…ôÀàbe…™…ôns/', meaning: 'n. ‰∏≠Ê≠¢', level: 'advanced' },
                    { word: 'abscond', phonetic: '/…ôbÀàsk…índ/', meaning: 'v. ÊΩúÈÄÉ', level: 'advanced' },
                    { word: 'abstain', phonetic: '/…ôbÀàste…™n/', meaning: 'v. ÊàíÈô§', level: 'advanced' },
                    { word: 'accolade', phonetic: '/Àà√¶k…ôle…™d/', meaning: 'n. Ëç£Ë™â', level: 'advanced' },
                    { word: 'acerbic', phonetic: '/…ôÀàs…úÀêrb…™k/', meaning: 'adj. Â∞ñÈÖ∏ÁöÑ', level: 'advanced' },
                    { word: 'acquiesce', phonetic: '/Àå√¶kwiÀàes/', meaning: 'v. ÈªòËÆ∏', level: 'advanced' },
                    { word: 'acumen', phonetic: '/Àà√¶kj äm…ôn/', meaning: 'n. ÊïèÈîê', level: 'advanced' },
                    { word: 'admonish', phonetic: '/…ôdÀàm…ín…™ É/', meaning: 'v. Ë≠¶Âëä', level: 'advanced' },
                    { word: 'aesthetic', phonetic: '/iÀêsÀàŒ∏et…™k/', meaning: 'adj. ÂÆ°ÁæéÁöÑ', level: 'advanced' },
                    { word: 'affable', phonetic: '/Àà√¶f…ôbl/', meaning: 'adj. ÂíåËîºÁöÑ', level: 'advanced' },
                    { word: 'alacrity', phonetic: '/…ôÀàl√¶kr…ôti/', meaning: 'n. ÊïèÊç∑', level: 'advanced' },
                    { word: 'amalgamate', phonetic: '/…ôÀàm√¶l…°…ôme…™t/', meaning: 'v. ÂêàÂπ∂', level: 'advanced' },
                    { word: 'ambiguous', phonetic: '/√¶mÀàb…™…°ju…ôs/', meaning: 'adj. Ê®°Á≥äÁöÑ', level: 'advanced' },
                    { word: 'ambivalent', phonetic: '/√¶mÀàb…™v…ôl…ônt/', meaning: 'adj. ÁüõÁõæÁöÑ', level: 'advanced' },
                    { word: 'ameliorate', phonetic: '/…ôÀàmiÀêli…ôre…™t/', meaning: 'v. ÊîπÂñÑ', level: 'advanced' },
                    { word: 'anachronism', phonetic: '/…ôÀàn√¶kr…ôn…™z…ôm/', meaning: 'n. Êó∂‰ª£ÈîôËØØ', level: 'advanced' },
                    { word: 'anathema', phonetic: '/…ôÀàn√¶Œ∏…ôm…ô/', meaning: 'n. ËØÖÂíí', level: 'advanced' },
                    { word: 'anecdote', phonetic: '/Àà√¶n…™kdo ät/', meaning: 'n. Ë∂£Èóª', level: 'advanced' },
                    { word: 'anguish', phonetic: '/Àà√¶≈ã…°w…™ É/', meaning: 'n. ÁóõËã¶', level: 'advanced' }
                ],
                'business': [
                    { word: 'account', phonetic: '/…ôÀàka änt/', meaning: 'n. Ë¥¶Êà∑', level: 'intermediate' },
                    { word: 'acquisition', phonetic: '/Àå√¶kw…™Ààz…™ É…ôn/', meaning: 'n. Êî∂Ë¥≠', level: 'advanced' },
                    { word: 'agenda', phonetic: '/…ôÀàd íend…ô/', meaning: 'n. ËÆÆÁ®ã', level: 'intermediate' },
                    { word: 'agreement', phonetic: '/…ôÀà…°riÀêm…ônt/', meaning: 'n. ÂçèËÆÆ', level: 'intermediate' },
                    { word: 'audit', phonetic: '/Àà…îÀêd…™t/', meaning: 'n. ÂÆ°ËÆ°', level: 'advanced' },
                    { word: 'benchmark', phonetic: '/Ààbent Ém…ëÀêrk/', meaning: 'n. Âü∫ÂáÜ', level: 'advanced' },
                    { word: 'budget', phonetic: '/Ààb åd í…™t/', meaning: 'n. È¢ÑÁÆó', level: 'intermediate' },
                    { word: 'capital', phonetic: '/Ààk√¶p…™tl/', meaning: 'n. ËµÑÊú¨', level: 'intermediate' },
                    { word: 'cash flow', phonetic: '/k√¶ É flo ä/', meaning: 'Áé∞ÈáëÊµÅ', level: 'intermediate' },
                    { word: 'CEO', phonetic: '/ÀåsiÀê iÀê Àào ä/', meaning: 'È¶ñÂ∏≠ÊâßË°åÂÆò', level: 'beginner' },
                    { word: 'CFO', phonetic: '/ÀåsiÀê ef Àào ä/', meaning: 'È¶ñÂ∏≠Ë¥¢Âä°ÂÆò', level: 'intermediate' },
                    { word: 'collaborate', phonetic: '/k…ôÀàl√¶b…ôre…™t/', meaning: 'v. Âêà‰Ωú', level: 'intermediate' },
                    { word: 'commission', phonetic: '/k…ôÀàm…™ É…ôn/', meaning: 'n. ‰Ω£Èáë', level: 'intermediate' },
                    { word: 'compensation', phonetic: '/Àåk…ímpenÀàse…™ É…ôn/', meaning: 'n. Ëñ™ÈÖ¨', level: 'advanced' },
                    { word: 'competitor', phonetic: '/k…ômÀàpet…™t…ôr/', meaning: 'n. Á´û‰∫âÂØπÊâã', level: 'intermediate' },
                    { word: 'contract', phonetic: '/Ààk…íntr√¶kt/', meaning: 'n. ÂêàÂêå', level: 'intermediate' },
                    { word: 'corporate', phonetic: '/Ààk…îÀêrp…ôr…ôt/', meaning: 'adj. ÂÖ¨Âè∏ÁöÑ', level: 'intermediate' },
                    { word: 'credential', phonetic: '/kr…ôÀàden É…ôl/', meaning: 'n. ËµÑË¥®', level: 'advanced' },
                    { word: 'dividend', phonetic: '/Ààd…™v…™dend/', meaning: 'n. ËÇ°ÊÅØ', level: 'advanced' },
                    { word: 'equity', phonetic: '/Ààekw…™ti/', meaning: 'n. ËÇ°ÊùÉ', level: 'advanced' }
                ],
                'daily': [
                    { word: 'hello', phonetic: '/h…ôÀàlo ä/', meaning: 'int. ‰Ω†Â•Ω', level: 'beginner' },
                    { word: 'goodbye', phonetic: '/…° ädÀàba…™/', meaning: 'int. ÂÜçËßÅ', level: 'beginner' },
                    { word: 'thanks', phonetic: '/Œ∏√¶≈ãks/', meaning: 'int. Ë∞¢Ë∞¢', level: 'beginner' },
                    { word: 'sorry', phonetic: '/Ààs…íri/', meaning: 'adj. ÂØπ‰∏çËµ∑', level: 'beginner' },
                    { word: 'please', phonetic: '/pliÀêz/', meaning: 'adv. ËØ∑', level: 'beginner' },
                    { word: 'excuse me', phonetic: '/…™kÀàskjuÀêz mi/', meaning: 'Âä≥È©æ', level: 'beginner' },
                    { word: 'how are you', phonetic: '/ha ä …ëÀêr juÀê/', meaning: '‰Ω†Â•ΩÂêó', level: 'beginner' },
                    { word: 'nice to meet you', phonetic: '/na…™s tuÀê miÀêt juÀê/', meaning: 'ÂæàÈ´òÂÖ¥ËßÅÂà∞‰Ω†', level: 'beginner' },
                    { word: 'what time is it', phonetic: '/w…ít ta…™m …™z …™t/', meaning: 'Áé∞Âú®Âá†ÁÇπ', level: 'beginner' },
                    { word: 'where is the bathroom', phonetic: '/wer …™z √∞…ô Ààb√¶Œ∏ruÀêm/', meaning: 'Ê¥óÊâãÈó¥Âú®Âì™', level: 'beginner' },
                    { word: 'how much', phonetic: '/ha ä m åt É/', meaning: 'Â§öÂ∞ëÈí±', level: 'beginner' },
                    { word: 'can you help me', phonetic: '/k√¶n juÀê help miÀê/', meaning: '‰Ω†ËÉΩÂ∏ÆÊàëÂêó', level: 'beginner' },
                    { word: 'I dont understand', phonetic: '/a…™ do änt Àå ånd…ôrÀàst√¶nd/', meaning: 'Êàë‰∏çÊáÇ', level: 'beginner' },
                    { word: 'could you repeat', phonetic: '/k äd juÀê r…™ÀàpiÀêt/', meaning: 'ËØ∑ÂÜçËØ¥‰∏ÄÈÅç', level: 'intermediate' },
                    { word: 'what do you mean', phonetic: '/w…ít duÀê juÀê miÀên/', meaning: '‰Ω†‰ªÄ‰πàÊÑèÊÄù', level: 'intermediate' },
                    { word: 'I think', phonetic: '/a…™ Œ∏…™≈ãk/', meaning: 'ÊàëËÆ§‰∏∫', level: 'beginner' },
                    { word: 'in my opinion', phonetic: '/…™n ma…™ …ôÀàp…™nj…ôn/', meaning: 'Âú®ÊàëÁúãÊù•', level: 'intermediate' },
                    { word: 'to be honest', phonetic: '/tuÀê biÀê Àà…ín…™st/', meaning: 'ËØ¥ÂÆûËØù', level: 'intermediate' },
                    { word: 'by the way', phonetic: '/ba…™ √∞…ô we…™/', meaning: 'È°∫‰æøÈóÆ‰∏Ä‰∏ã', level: 'intermediate' },
                    { word: 'as a matter of fact', phonetic: '/√¶z …ô Ààm√¶t…ôr …ôv f√¶kt/', meaning: '‰∫ãÂÆû‰∏ä', level: 'intermediate' }
                ]
            };
            return bookWordMap[bookId] || [];
        }
        
        // ‰øùÂ≠òÂ≠¶‰π†ËøõÂ∫¶Âà∞ËØç‰π¶
        function saveBookProgress(bookId) {
            const userBookProgress = JSON.parse(localStorage.getItem('wordAI_bookProgress') || '{}');
            userBookProgress[bookId] = (userBookProgress[bookId] || 0) + 1;
            localStorage.setItem('wordAI_bookProgress', JSON.stringify(userBookProgress));
            loadWordBooks();
        }
        
        // ====== ÈÅóÂøòÊõ≤Á∫øÂèØËßÜÂåñ ======
        function renderForgettingCurve() {
            const container = document.getElementById('forgettingCurve');
            if (!container) return;
            
            // ËâæÂÆæÊµ©ÊñØÈÅóÂøòÊõ≤Á∫øÊï∞ÊçÆÁÇπÔºàÊó∂Èó¥/ËÆ∞ÂøÜ‰øùÊåÅÁéáÔºâ
            const points = [
                { time: 0, retention: 100 },
                { time: 1, retention: 58 },
                { time: 3, retention: 40 },
                { time: 7, retention: 28 },
                { time: 14, retention: 20 },
                { time: 30, retention: 15 }
            ];
            
            // ÊúÄ‰Ω≥Â§ç‰π†ÁÇπ
            const reviewPoints = [
                { time: 1, retention: 58 },
                { time: 3, retention: 40 },
                { time: 7, retention: 28 },
                { time: 14, retention: 20 }
            ];
            
            const width = container.offsetWidth - 20;
            const height = 180;
            
            let html = '';
            
            // ÁªòÂà∂Êõ≤Á∫øÁÇπ
            points.forEach((p, i) => {
                const x = (p.time / 30) * width;
                const y = height - (p.retention / 100) * height;
                html += `<div class="curve-point" style="left:${x + 10}px;bottom:${y}px;" title="${p.time}Â§©Âêé: ${p.retention}%"></div>`;
            });
            
            // ÁªòÂà∂ÊúÄ‰Ω≥Â§ç‰π†ÁÇπ
            reviewPoints.forEach(p => {
                const x = (p.time / 30) * width;
                const y = height - (p.retention / 100) * height;
                html += `<div class="curve-point" style="left:${x + 10}px;bottom:${y}px;background:#10b981;width:14px;height:14px;" title="ÊúÄ‰Ω≥Â§ç‰π†ÁÇπ: ${p.time}Â§©Âêé"></div>`;
            });
            
            // ÁªòÂà∂ËøûÊé•Á∫ø
            for (let i = 0; i < points.length - 1; i++) {
                const x1 = (points[i].time / 30) * width;
                const y1 = height - (points[i].retention / 100) * height;
                const x2 = (points[i + 1].time / 30) * width;
                const y2 = height - (points[i + 1].retention / 100) * height;
                const length = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
                const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
                html += `<div style="position:absolute;left:${x1 + 10}px;bottom:${y1}px;width:${length}px;height:2px;background:#667eea;transform-origin:left center;transform:rotate(${angle}deg);"></div>`;
            }
            
            // Ê∑ªÂä†ÂùêÊ†áËΩ¥Ê†áÁ≠æ
            html += `<div class="curve-label" style="left:0;bottom:-20px;">0Â§©</div>`;
            html += `<div class="curve-label" style="left:33%;bottom:-20px;">10Â§©</div>`;
            html += `<div class="curve-label" style="left:66%;bottom:-20px;">20Â§©</div>`;
            html += `<div class="curve-label" style="right:-10px;bottom:0;transform:rotate(-90deg);">ËÆ∞ÂøÜ‰øùÊåÅÁéá</div>`;
            
            container.innerHTML = html;
        }
        
        // ====== Â≠¶‰π†ÊèêÈÜíÁ≥ªÁªü ======
        function showStudyReminder(message) {
            const reminder = document.getElementById('studyReminder');
            document.getElementById('reminderText').textContent = message;
            reminder.classList.add('active');
            
            // 5ÁßíÂêéËá™Âä®Ê∂àÂ§±
            setTimeout(() => {
                reminder.classList.remove('active');
            }, 5000);
        }
        
        function dismissReminder() {
            document.getElementById('studyReminder').classList.remove('active');
        }
        
        // ÂÆöÊó∂Ê£ÄÊü•ÊòØÂê¶ÈúÄË¶ÅÊèêÈÜí
        function checkReminder() {
            const now = new Date();
            const hour = now.getHours();
            
            // Ê£ÄÊü•ÊòØÂê¶ÊòØÂ≠¶‰π†Êó∂Èó¥ÔºàÊó©‰∏ä9ÁÇπÊàñÊôö‰∏ä8ÁÇπÔºâ
            if ((hour === 9 || hour === 20) && now.getMinutes() === 0) {
                const data = loadStats();
                if (data.today < (challengeData.dailyGoal || 10)) {
                    showStudyReminder('ÊòØÊó∂ÂÄôÂ≠¶‰π†‰∫ÜÔºÅ‰ªäÊó•ËøòÈúÄÂ≠¶‰π† ' + ((challengeData.dailyGoal || 10) - data.today) + ' ‰∏™ÂçïËØç');
                }
            }
        }
        
        // ÊØèÂàÜÈíüÊ£ÄÊü•‰∏ÄÊ¨°
        setInterval(checkReminder, 60000);
        
        // ====== ÈÄöÁü•ÊùÉÈôêËØ∑Ê±Ç ======
        function requestNotificationPermission() {
            if (!('Notification' in window)) {
                alert('ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅÈÄöÁü•ÂäüËÉΩ');
                return;
            }
            
            Notification.requestPermission().then(permission => {
                if (permission === 'granted') {
                    localStorage.setItem('wordAI_notifications', 'true');
                    alert('ÈÄöÁü•ÊùÉÈôêÂ∑≤ÂºÄÂêØÔºÅ');
                    new Notification('AIËÉåÂçïËØç', { body: 'ÈÄöÁü•ÂäüËÉΩÂ∑≤ÂºÄÂêØÔºåÊàë‰ºöÂèäÊó∂ÊèêÈÜí‰Ω†Â≠¶‰π†~' });
                } else {
                    alert('ÈúÄË¶ÅÈÄöÁü•ÊùÉÈôêÊâçËÉΩÊé•Êî∂Â≠¶‰π†ÊèêÈÜí');
                }
            });
        }
        
        // ====== ÂèëÈÄÅÂ≠¶‰π†ÊèêÈÜíÈÄöÁü• ======
        function sendStudyNotification(title, body) {
            if (Notification.permission === 'granted') {
                new Notification(title, { body, icon: 'üìö' });
            }
        }
        
        // ====== ÊµÆÂä®Âø´Êç∑Êìç‰Ωú ======
        function showQuickActions() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width:300px;">
                    <div class="modal-title">‚ö° Âø´Êç∑Êìç‰Ωú</div>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:15px;">
                        <button class="btn" style="padding:15px;" onclick="this.closest('.modal').remove();showTab('tab-arena')">‚öîÔ∏è ÊåëÊàò</button>
                        <button class="btn" style="padding:15px;" onclick="this.closest('.modal').remove();showTab('tab-ai')">ü§ñ AIÂä©Êâã</button>
                        <button class="btn" style="padding:15px;" onclick="this.closest('.modal').remove();showTab('tab-plan')">‚è±Ô∏è ‰∏ìÊ≥®</button>
                        <button class="btn" style="padding:15px;" onclick="this.closest('.modal').remove();generateSharePoster()">üì§ ÂàÜ‰∫´</button>
                    </div>
                    <button class="btn" style="width:100%;margin-top:15px;" onclick="this.closest('.modal').remove()">ÂÖ≥Èó≠</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        // ====== Â≠¶‰π†ÊâìÂç°Êó•ÂéÜ ======
        function renderCheckinCalendar() {
            const container = document.getElementById('checkinCalendar');
            if (!container) return;
            
            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth();
            const firstDay = new Date(year, month, 1);
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Ëé∑ÂèñÊú¨ÊúàÁ≠æÂà∞Êï∞ÊçÆ
            const checkinData = JSON.parse(localStorage.getItem('wordAI_checkinHistory') || '{}');
            const monthKey = `${year}-${month}`;
            const checkedDays = checkinData[monthKey] || [];
            
            const weekDays = ['Êó•', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠'];
            let html = `<div style="display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin-bottom:8px;">`;
            weekDays.forEach(w => html += `<div style="text-align:center;font-size:10px;color:#999;">${w}</div>`);
            html += '</div>';
            
            html += '<div style="display:grid;grid-template-columns:repeat(7,1fr);gap:4px;">';
            
            // Â°´ÂÖÖÁ©∫ÁôΩ
            for (let i = 0; i < firstDay.getDay(); i++) {
                html += '<div></div>';
            }
            
            // Êó•Êúü
            for (let d = 1; d <= daysInMonth; d++) {
                const isChecked = checkedDays.includes(d);
                const isToday = d === today.getDate();
                html += `<div class="checkin-day ${isChecked ? 'checked' : ''} ${isToday ? 'today' : ''}">${d}</div>`;
            }
            html += '</div>';
            
            container.innerHTML = html;
        }
        
        // ====== ‰∏™ÊÄßÂåñËÆæÁΩÆ ======
        function showAdvancedSettings() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width:360px;">
                    <div class="modal-title">‚öôÔ∏è È´òÁ∫ßËÆæÁΩÆ</div>
                    
                    <div style="margin-top:15px;">
                        <div style="font-size:14px;font-weight:600;margin-bottom:10px;">üîî ÈÄöÁü•ËÆæÁΩÆ</div>
                        <div class="export-option" onclick="requestNotificationPermission()">
                            <div class="export-icon" style="background:#f0f7ff;">üîî</div>
                            <div style="flex:1;">
                                <div style="font-size:14px;">ÂºÄÂêØÂ≠¶‰π†ÊèêÈÜí</div>
                                <div style="font-size:12px;color:#666;">Êé•Êî∂ÊØèÊó•Â≠¶‰π†ÊèêÈÜíÈÄöÁü•</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top:15px;">
                        <div style="font-size:14px;font-weight:600;margin-bottom:10px;">üé® ‰∏ªÈ¢òËÆæÁΩÆ</div>
                        <div class="export-option" onclick="toggleManualTheme()">
                            <div class="export-icon" style="background:#f0f7ff;" id="themeToggleIcon">üåì</div>
                            <div style="flex:1;">
                                <div style="font-size:14px;" id="themeToggleText">ÂàáÊç¢Âà∞Ê∑±Ëâ≤Ê®°Âºè</div>
                                <div style="font-size:12px;color:#666;">ÁÇπÂáªÊâãÂä®ÂàáÊç¢</div>
                            </div>
                        </div>
                        <div class="export-option" onclick="toggleAutoDarkMode()">
                            <div class="export-icon" style="background:#fff7e6;">üåô</div>
                            <div style="flex:1;">
                                <div style="font-size:14px;">Ëá™Âä®Â§úÈó¥Ê®°Âºè</div>
                                <div style="font-size:12px;color:#666;">22:00-06:00Ëá™Âä®ÂàáÊç¢</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top:15px;">
                        <div style="font-size:14px;font-weight:600;margin-bottom:10px;">üìä Êï∞ÊçÆÂØºÂá∫</div>
                        <div class="export-option" onclick="exportToCSV()">
                            <div class="export-icon" style="background:#f6ffed;">üìä</div>
                            <div style="flex:1;">
                                <div style="font-size:14px;">ÂØºÂá∫CSV</div>
                                <div style="font-size:12px;color:#666;">ExcelÂèØÊâìÂºÄ</div>
                            </div>
                        </div>
                        <div class="export-option" onclick="exportToTxt()">
                            <div class="export-icon" style="background:#fff1f0;">üìù</div>
                            <div style="flex:1;">
                                <div style="font-size:14px;">ÂØºÂá∫TXT</div>
                                <div style="font-size:12px;color:#666;">Á∫ØÊñáÊú¨Ê†ºÂºè</div>
                            </div>
                        </div>
                        <div class="export-option" onclick="exportToMarkdown()">
                            <div class="export-icon" style="background:#f0f7ff;">üìÑ</div>
                            <div style="flex:1;">
                                <div style="font-size:14px;">ÂØºÂá∫Markdown</div>
                                <div style="font-size:12px;color:#666;">‰ºòÈõÖÁöÑÁ¨îËÆ∞Ê†ºÂºè</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top:15px;">
                        <div style="font-size:14px;font-weight:600;margin-bottom:10px;">üìù ÊàëÁöÑÁ¨îËÆ∞</div>
                        <div class="export-option" onclick="showAllNotes()">
                            <div class="export-icon" style="background:#fef3c7;">üí°</div>
                            <div style="flex:1;">
                                <div style="font-size:14px;">Êü•ÁúãÊâÄÊúâÁ¨îËÆ∞</div>
                                <div style="font-size:12px;color:#666;">ÁÆ°ÁêÜÂçïËØçÁ¨îËÆ∞</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top:15px;">
                        <div style="font-size:14px;font-weight:600;margin-bottom:10px;">üíæ Êï∞ÊçÆÂ§á‰ªΩ‰∏éÊÅ¢Â§ç</div>
                        <div class="export-option" onclick="exportAllData()">
                            <div class="export-icon" style="background:#f6ffed;">üíæ</div>
                            <div style="flex:1;">
                                <div style="font-size:14px;">ÂÆåÊï¥Êï∞ÊçÆÂ§á‰ªΩ</div>
                                <div style="font-size:12px;color:#666;">ÂØºÂá∫ÊâÄÊúâÊï∞ÊçÆ(JSON)</div>
                            </div>
                        </div>
                        <div class="export-option" onclick="importAllData()">
                            <div class="export-icon" style="background:#e6f7ff;">üì•</div>
                            <div style="flex:1;">
                                <div style="font-size:14px;">‰ªéÂ§á‰ªΩÊÅ¢Â§ç</div>
                                <div style="font-size:12px;color:#666;">ÂØºÂÖ•JSONÂ§á‰ªΩÊñá‰ª∂</div>
                            </div>
                        </div>
                        <div class="export-option" onclick="clearAllData()" style="border:2px solid #ffccc7;">
                            <div class="export-icon" style="background:#fff1f0;">üóëÔ∏è</div>
                            <div style="flex:1;">
                                <div style="font-size:14px;color:#ff4d4f;">Ê∏ÖÈô§ÊâÄÊúâÊï∞ÊçÆ</div>
                                <div style="font-size:12px;color:#666;">Âç±Èô©Êìç‰ΩúÔºå‰∏çÂèØÊÅ¢Â§ç</div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" style="width:100%;margin-top:20px;" onclick="this.closest('.modal').remove()">ÂÆåÊàê</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        // ====== Êü•ÁúãÊâÄÊúâÁ¨îËÆ∞ ======
        function showAllNotes() {
            const noteData = JSON.parse(localStorage.getItem('wordAI_wordNotes') || '{}');
            const notes = Object.entries(noteData);
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            
            if (notes.length === 0) {
                modal.innerHTML = `
                    <div class="modal-content" style="max-width:360px;">
                        <div class="modal-title">üìù ÊàëÁöÑÁ¨îËÆ∞</div>
                        <div style="text-align:center;padding:30px;color:#666;">
                            <div style="font-size:40px;margin-bottom:15px;">üìù</div>
                            <div>ËøòÊ≤°ÊúâÁ¨îËÆ∞</div>
                            <div style="font-size:12px;margin-top:5px;">Âú®Â≠¶‰π†ÂçïËØçÊó∂ÂèØ‰ª•Ê∑ªÂä†Á¨îËÆ∞</div>
                        </div>
                        <button class="btn btn-primary" style="width:100%;" onclick="this.closest('.modal').remove()">ÂÖ≥Èó≠</button>
                    </div>
                `;
            } else {
                const notesHtml = notes.map(([word, note]) => `
                    <div style="background:#fef9c3;padding:12px;border-radius:8px;margin-bottom:8px;">
                        <div style="font-weight:bold;color:#667eea;margin-bottom:4px;">${word}</div>
                        <div style="font-size:13px;color:#666;">${note}</div>
                    </div>
                `).join('');
                
                modal.innerHTML = `
                    <div class="modal-content" style="max-width:360px;max-height:80vh;overflow-y:auto;">
                        <div class="modal-title">üìù ÊàëÁöÑÁ¨îËÆ∞ (${notes.length})</div>
                        <div style="max-height:400px;overflow-y:auto;">
                            ${notesHtml}
                        </div>
                        <button class="btn btn-primary" style="width:100%;margin-top:15px;" onclick="this.closest('.modal').remove()">ÂÖ≥Èó≠</button>
                    </div>
                `;
            }
            document.body.appendChild(modal);
        }
        
        // ====== Âø´ÈÄüÁªüËÆ°Â∞èÈÉ®‰ª∂ ======
        function renderQuickStats() {
            const container = document.getElementById('quickStats');
            if (!container) return;
            
            const data = loadStats();
            const level = loadUserLevel();
            const trend = analyzeLearningTrend();
            const suggestion = getSmartReviewSuggestion();
            
            let trendHtml = '';
            if (trend && trend.trendType !== 'stable') {
                const trendIcon = trend.trendType === 'up' ? 'üìà' : 'üìâ';
                const trendColor = trend.trendType === 'up' ? '#10b981' : '#ef4444';
                trendHtml = `<div style="font-size:10px;color:${trendColor};margin-top:4px;">${trendIcon} ${trend.trend}% vs‰∏äÂë®</div>`;
            }
            
            let suggestionHtml = '';
            if (suggestion && suggestion.priority > 0) {
                const typeIcon = { wrong: '‚ùå', favorite: '‚≠ê', review: 'üìñ' }[suggestion.type] || 'üí°';
                suggestionHtml = `<div onclick="${suggestion.action ? suggestion.action.name + '()' : ''}" style="font-size:11px;background:#fef3c7;color:#92400e;padding:4px 8px;border-radius:8px;margin-top:8px;cursor:pointer;text-align:center;">${typeIcon} ${suggestion.message}</div>`;
            }
            
            container.innerHTML = `
                <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;text-align:center;">
                    <div>
                        <div style="font-size:16px;font-weight:bold;color:#667eea;">${data.today || 0}</div>
                        <div style="font-size:10px;color:#666;">‰ªäÊó•</div>
                    </div>
                    <div>
                        <div style="font-size:16px;font-weight:bold;color:#10b981;">${streak}</div>
                        <div style="font-size:10px;color:#666;">ËøûÁª≠</div>
                    </div>
                    <div>
                        <div style="font-size:16px;font-weight:bold;color:#f59e0b;">${level}</div>
                        <div style="font-size:10px;color:#666;">Á≠âÁ∫ß</div>
                    </div>
                    <div>
                        <div style="font-size:16px;font-weight:bold;color:#667eea;">${data.total || 0}</div>
                        <div style="font-size:10px;color:#666;">ÊÄªËÆ°</div>
                    </div>
                </div>
                ${trendHtml}
                ${suggestionHtml}
            `;
        }
        
        // ====== ÊØèÊó•‰∏ÄËØç ======
        function getWordOfDay() {
            const today = new Date().toDateString();
            const saved = localStorage.getItem('wordAI_wotd_date');
            const word = localStorage.getItem('wordAI_wotd_word');
            
            if (saved === today && word) {
                return JSON.parse(word);
            }
            
            // ‰ªéËØç‰π¶ÈöèÊú∫ÈÄâÊã©
            const allWords = [];
            const wordBooksList = ['cet4', 'cet6', 'ielts', 'toefl', 'gre', 'tech'];
            wordBooksList.forEach(bookId => {
                const words = getBookWords(bookId);
                allWords.push(...words);
            });
            
            const randomWord = allWords[Math.floor(Math.random() * allWords.length)];
            const wotd = { ...randomWord, date: today };
            
            localStorage.setItem('wordAI_wotd_date', today);
            localStorage.setItem('wordAI_wotd_word', JSON.stringify(wotd));
            
            return wotd;
        }
        
        function renderWordOfDay() {
            const container = document.getElementById('wordOfDay');
            if (!container) return;
            
            const wotd = getWordOfDay();
            container.innerHTML = `
                <div style="background:linear-gradient(135deg,#667eea,#764ba2);border-radius:12px;padding:12px;color:white;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                        <span style="font-size:12px;opacity:0.9;">üåü ÊØèÊó•‰∏ÄËØç</span>
                        <span style="font-size:10px;opacity:0.7;">${wotd.date}</span>
                    </div>
                    <div style="font-size:20px;font-weight:bold;margin-bottom:4px;">${wotd.word}</div>
                    <div style="font-size:12px;opacity:0.9;margin-bottom:4px;">${wotd.phonetic}</div>
                    <div style="font-size:13px;opacity:0.9;">${wotd.meaning}</div>
                    <button onclick="playPronunciation('${wotd.word}')" style="margin-top:8px;padding:4px 12px;background:rgba(255,255,255,0.2);border:none;border-radius:15px;color:white;font-size:11px;cursor:pointer;">üîä ÊúóËØª</button>
                </div>
            `;
        }
        
        // ====== Á≠âÁ∫ßÁ≥ªÁªü ======
        const levels = [
            { level: 1, name: 'ÂàùÂ≠¶ËÄÖ', exp: 0, icon: 'üå±' },
            { level: 2, name: 'ÂÖ•Èó®', exp: 100, icon: 'üìñ' },
            { level: 3, name: 'ËøõÈò∂', exp: 300, icon: 'üìö' },
            { level: 4, name: 'ÁÜüÁªÉ', exp: 600, icon: 'üí™' },
            { level: 5, name: 'Á≤æÈÄö', exp: 1000, icon: 'üèÜ' },
            { level: 6, name: '‰∏ìÂÆ∂', exp: 1500, icon: 'üéì' },
            { level: 7, name: 'Â§ßÂ∏à', exp: 2200, icon: 'üëë' },
            { level: 8, name: 'ÁéãËÄÖ', exp: 3000, icon: 'üíé' }
        ];
        
        // ====== ÂçïËØçÈóØÂÖ≥ÂÖ≥Âç°Êï∞ÊçÆ ======
        const levelWords = {
            1: [  // ÂàùÂ≠¶ËÄÖ
                { word: "hello", phonetic: "/h…ôÀàlo ä/", meaning: "int. ‰Ω†Â•Ω" },
                { word: "world", phonetic: "/w…úÀêrld/", meaning: "n. ‰∏ñÁïå" },
                { word: "book", phonetic: "/b äk/", meaning: "n. ‰π¶" },
                { word: "water", phonetic: "/Ààw…îÀêt…ôr/", meaning: "n. Ê∞¥" },
                { word: "food", phonetic: "/fuÀêd/", meaning: "n. È£üÁâ©" }
            ],
            2: [  // ÂÖ•Èó®
                { word: "friend", phonetic: "/frend/", meaning: "n. ÊúãÂèã" },
                { word: "family", phonetic: "/Ààf√¶m…ôli/", meaning: "n. ÂÆ∂Â∫≠" },
                { word: "school", phonetic: "/skuÀêl/", meaning: "n. Â≠¶Ê†°" },
                { word: "time", phonetic: "/ta…™m/", meaning: "n. Êó∂Èó¥" },
                { word: "money", phonetic: "/Ààm åni/", meaning: "n. Èí±" }
            ],
            3: [  // ËøõÈò∂
                { word: "code", phonetic: "/ko äd/", meaning: "n. ‰ª£Á†Å" },
                { word: "web", phonetic: "/web/", meaning: "n. ÁΩëÈ°µ" },
                { word: "data", phonetic: "/Ààde…™t…ô/", meaning: "n. Êï∞ÊçÆ" },
                { word: "bug", phonetic: "/b å…°/", meaning: "n. Áº∫Èô∑" },
                { word: "network", phonetic: "/Àànetw…úÀêrk/", meaning: "n. ÁΩëÁªú" }
            ],
            4: [  // ÁÜüÁªÉ
                { word: "server", phonetic: "/Ààs…úÀêrv…ôr/", meaning: "n. ÊúçÂä°Âô®" },
                { word: "client", phonetic: "/Ààkla…™…ônt/", meaning: "n. ÂÆ¢Êà∑Á´Ø" },
                { word: "database", phonetic: "/Ààde…™t…ôbe…™s/", meaning: "n. Êï∞ÊçÆÂ∫ì" },
                { word: "function", phonetic: "/Ààf å≈ãk É…ôn/", meaning: "n. ÂäüËÉΩ" },
                { word: "interface", phonetic: "/Àà…™nt…ôfe…™s/", meaning: "n. ÁïåÈù¢" }
            ],
            5: [  // Á≤æÈÄö
                { word: "framework", phonetic: "/Ààfre…™mw…úÀêk/", meaning: "n. Ê°ÜÊû∂" },
                { word: "algorithm", phonetic: "/Àà√¶l…°…ôr…™√∞…ôm/", meaning: "n. ÁÆóÊ≥ï" },
                { word: "cloud", phonetic: "/kla äd/", meaning: "n. ‰∫ë" },
                { word: "security", phonetic: "/s…™Ààkj är…ôti/", meaning: "n. ÂÆâÂÖ®" },
                { word: "intelligence", phonetic: "/…™nÀàtel…™d í…ôns/", meaning: "n. Êô∫ËÉΩ" }
            ],
            6: [  // ‰∏ìÂÆ∂
                { word: "artificial", phonetic: "/Àå…ëÀêrt…™Ààf…™ Él/", meaning: "adj. ‰∫∫Â∑•ÁöÑ" },
                { word: "machine", phonetic: "/m…ôÀà ÉiÀên/", meaning: "n. Êú∫Âô®" },
                { word: "execute", phonetic: "/Ààeks…™kjuÀêt/", meaning: "v. ÊâßË°å" },
                { word: "compile", phonetic: "/k…ômÀàpa…™l/", meaning: "v. ÁºñËØë" },
                { word: "optimize", phonetic: "/Àà…ëÀêpt…™ma…™z/", meaning: "v. ‰ºòÂåñ" }
            ],
            7: [  // Â§ßÂ∏à
                { word: "architecture", phonetic: "/Àà…ëÀêrk…™tekt É…ôr/", meaning: "n. Êû∂ÊûÑ" },
                { word: "microservice", phonetic: "/Àåma…™kro äÀàs…úÀêrv…™s/", meaning: "n. ÂæÆÊúçÂä°" },
                { word: "container", phonetic: "/k…ônÀàte…™n…ôr/", meaning: "n. ÂÆπÂô®" },
                { word: "scalability", phonetic: "/Àåske…™l…ôÀàb…™l…ôti/", meaning: "n. ÂèØÊâ©Â±ïÊÄß" },
                { word: "blockchain", phonetic: "/Ààbl…íkt Ée…™n/", meaning: "n. Âå∫ÂùóÈìæ" }
            ],
            8: [  // ÁéãËÄÖ
                { word: "deployment", phonetic: "/d…™Ààpl…î…™m…ônt/", meaning: "n. ÈÉ®ÁΩ≤" },
                { word: "concurrent", phonetic: "/k…ônÀàk…úÀêr…ônt/", meaning: "adj. Âπ∂ÂèëÁöÑ" },
                { word: "paradigm", phonetic: "/Ààp√¶r…ôda…™m/", meaning: "n. ËåÉÂºè" },
                { word: "strategy", phonetic: "/Ààstr√¶t…ôd íi/", meaning: "n. ÊàòÁï•" },
                { word: "investment", phonetic: "/…™nÀàvestm…ônt/", meaning: "n. ÊäïËµÑ" }
            ]
        };
        
        // ÂΩìÂâçÈóØÂÖ≥Áä∂ÊÄÅ
        let currentLevelChallenge = null;
        
        function loadUserLevel() {
            return parseInt(localStorage.getItem('wordAI_userLevel') || '1');
        }
        
        function getUserExp() {
            return parseInt(localStorage.getItem('wordAI_userExp') || '0');
        }
        
        function addExp(amount) {
            const currentExp = getUserExp();
            let newExp = currentExp + amount;
            let newLevel = loadUserLevel();
            
            // Ê£ÄÊü•ÂçáÁ∫ß
            while (newLevel < levels.length && newExp >= levels[newLevel].exp) {
                newLevel++;
                if (newLevel <= levels.length) {
                    showLevelUp(newLevel);
                }
            }
            
            localStorage.setItem('wordAI_userExp', newExp.toString());
            localStorage.setItem('wordAI_userLevel', newLevel.toString());
            
            updateLevelUI();
        }
        
        function updateLevelUI() {
            const level = loadUserLevel();
            const exp = getUserExp();
            const currentLevelData = levels[level - 1];
            const nextLevelData = levels[level] || { exp: currentLevelData.exp + 500 };
            
            document.getElementById('currentLevel').textContent = `Lv.${level}`;
            document.getElementById('currentExp').textContent = exp;
            
            const expInLevel = exp - currentLevelData.exp;
            const expNeeded = nextLevelData.exp - currentLevelData.exp;
            const progress = Math.min((expInLevel / expNeeded) * 100, 100);
            
            document.getElementById('expProgress').style.width = progress + '%';
            document.getElementById('expNeeded').textContent = nextLevelData.exp - exp;
            
            // Êõ¥Êñ∞ÂÖ≥Âç°ÂàóË°®
            renderLevelList();
        }
        
        function showLevelUp(newLevel) {
            const levelData = levels[newLevel - 1];
            playSound('levelup');
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="text-align:center;">
                    <div style="font-size:64px;margin-bottom:15px;">üéâ</div>
                    <div class="modal-title">ÂçáÁ∫ßÂï¶ÔºÅ</div>
                    <div style="font-size:48px;margin-bottom:10px;">${levelData.icon}</div>
                    <div style="font-size:24px;font-weight:bold;color:#667eea;">${levelData.name}</div>
                    <p style="color:#666;margin-top:15px;">ÊÅ≠ÂñúËææÂà∞ Lv.${newLevel}ÔºÅ</p>
                    <button class="btn btn-primary" style="width:100%;margin-top:20px;" onclick="this.closest('.modal').remove()">ÁªßÁª≠Âä†Ê≤π</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function renderLevelList() {
            const container = document.getElementById('levelList');
            if (!container) return;
            
            const currentLevel = loadUserLevel();
            
            container.innerHTML = levels.map((l, i) => {
                const isUnlocked = (i + 1) <= currentLevel;
                const isCurrent = (i + 1) === currentLevel;
                return `
                    <div class="level-badge ${isCurrent ? 'level-current' : isUnlocked ? 'level-unlocked' : 'level-locked'}" onclick="${isUnlocked ? `selectLevel(${i + 1})` : ''}">
                        ${l.icon} ${l.name}
                    </div>
                `;
            }).join('');
        }
        
        function selectLevel(level) {
            const currentLevel = loadUserLevel();
            if (level > currentLevel) {
                alert(`ÈúÄË¶ÅËææÂà∞ Lv.${level} ${levels[level-1].name} ÊâçËÉΩËß£ÈîÅÊ≠§ÂÖ≥Âç°ÔºÅ`);
                return;
            }
            
            // ÊòæÁ§∫ÂÖ≥Âç°ËØ¶ÊÉÖÂºπÁ™ó
            const words = levelWords[level];
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width:350px;">
                    <div class="modal-title">${levels[level-1].icon} ${levels[level-1].name} - ÂÖ≥Âç° ${level}</div>
                    <div style="text-align:center;margin:15px 0;">
                        <div style="font-size:48px;">${levels[level-1].icon}</div>
                        <div style="font-size:14px;color:#666;margin-top:10px;">ÂÖ± ${words.length} ‰∏™ÂçïËØç</div>
                    </div>
                    <div style="background:#f9f9f9;border-radius:10px;padding:12px;max-height:150px;overflow-y:auto;">
                        ${words.map(w => `<div style="font-size:13px;padding:4px 0;border-bottom:1px solid #eee;">${w.word} - ${w.meaning}</div>`).join('')}
                    </div>
                    <div style="display:flex;gap:10px;margin-top:15px;">
                        <button class="btn" style="flex:1;background:#666;color:white;" onclick="this.closest('.modal').remove()">ÂèñÊ∂à</button>
                        <button class="btn btn-primary" style="flex:1;" onclick="this.closest('.modal').remove();startLevelChallenge(${level})">ÂºÄÂßãÈóØÂÖ≥</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function startLevelChallenge(level) {
            // Â¶ÇÊûúÊ≤°ÊúâÊåáÂÆöÁ∫ßÂà´Ôºå‰ΩøÁî®ÂΩìÂâçÁî®Êà∑Á≠âÁ∫ß
            if (!level) {
                level = loadUserLevel();
            }
            
            const words = levelWords[level];
            if (!words || words.length === 0) {
                alert('ÊöÇÊó†ÂÖ≥Âç°Êï∞ÊçÆ');
                return;
            }
            
            // ÂàùÂßãÂåñÈóØÂÖ≥Áä∂ÊÄÅ
            currentLevelChallenge = {
                level: level,
                words: words.map(w => ({...w, answered: false})),
                currentIndex: 0,
                correct: 0,
                wrong: 0,
                score: 0
            };
            
            showLevelChallengeUI();
        }
        
        function showLevelChallengeUI() {
            const challenge = currentLevelChallenge;
            if (!challenge) return;
            
            const word = challenge.words[challenge.currentIndex];
            
            // ÂàõÂª∫ÈóØÂÖ≥ÁïåÈù¢
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.id = 'levelChallengeModal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width:380px;padding:20px;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
                        <div style="font-size:14px;font-weight:600;">${levels[challenge.level-1].icon} ${levels[challenge.level-1].name} ÈóØÂÖ≥</div>
                        <div style="font-size:12px;color:#666;">${challenge.currentIndex + 1}/${challenge.words.length}</div>
                    </div>
                    <div class="level-progress" style="margin-bottom:20px;">
                        <div class="level-progress-fill" style="width:${((challenge.currentIndex) / challenge.words.length) * 100}%"></div>
                    </div>
                    
                    <div class="card" style="min-height:120px;margin-bottom:15px;">
                        <div class="word" style="font-size:28px;">${word.word}</div>
                        <div class="phonetic">${word.phonetic}</div>
                    </div>
                    
                    <div id="challengeOptions" class="quiz-options" style="padding:0;"></div>
                    
                    <div style="display:flex;justify-content:space-around;margin-top:15px;">
                        <div style="text-align:center;">
                            <div style="font-size:18px;font-weight:bold;color:#10b981;">${challenge.correct}</div>
                            <div style="font-size:11px;color:#666;">Ê≠£Á°Æ</div>
                        </div>
                        <div style="text-align:center;">
                            <div style="font-size:18px;font-weight:bold;color:#ef4444;">${challenge.wrong}</div>
                            <div style="font-size:11px;color:#666;">ÈîôËØØ</div>
                        </div>
                        <div style="text-align:center;">
                            <div style="font-size:18px;font-weight:bold;color:#667eea;">${challenge.score}</div>
                            <div style="font-size:11px;color:#666;">ÂæóÂàÜ</div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // ÁîüÊàêÈÄâÈ°π
            generateChallengeOptions(word);
        }
        
        function generateChallengeOptions(word) {
            const challenge = currentLevelChallenge;
            const words = challenge.words;
            
            // ÈöèÊú∫ÈÄâÊã©3‰∏™ÈîôËØØÈÄâÈ°π
            const otherWords = words.filter(w => w.word !== word.word);
            const wrongOptions = otherWords.sort(() => Math.random() - 0.5).slice(0, 3);
            
            // ÂêàÂπ∂Âπ∂Êâì‰π±
            const options = [word, ...wrongOptions].sort(() => Math.random() - 0.5);
            
            const container = document.getElementById('challengeOptions');
            container.innerHTML = options.map(opt => 
                `<button class="quiz-option" onclick="checkChallengeAnswer('${opt.word}', '${word.word}', this)">${opt.meaning}</button>`
            ).join('');
        }
        
        function checkChallengeAnswer(selected, correct, btn) {
            const challenge = currentLevelChallenge;
            const isCorrect = selected === correct;
            
            // Á¶ÅÁî®ÊâÄÊúâÊåâÈíÆ
            document.querySelectorAll('#challengeOptions .quiz-option').forEach(b => {
                b.disabled = true;
                if (b.textContent === challenge.words[challenge.currentIndex].meaning) {
                    b.classList.add('correct');
                }
            });
            
            if (isCorrect) {
                challenge.correct++;
                challenge.score += 10;
                btn.classList.add('correct');
            } else {
                challenge.wrong++;
                challenge.score = Math.max(0, challenge.score - 5);
                btn.classList.add('wrong');
            }
            
            challenge.words[challenge.currentIndex].answered = true;
            
            // Âª∂ËøüËøõÂÖ•‰∏ã‰∏ÄÈ¢ò
            setTimeout(() => {
                challenge.currentIndex++;
                
                if (challenge.currentIndex >= challenge.words.length) {
                    // ÈóØÂÖ≥ÂÆåÊàê
                    completeLevelChallenge();
                } else {
                    showLevelChallengeUI();
                }
            }, 1000);
        }
        
        function completeLevelChallenge() {
            const challenge = currentLevelChallenge;
            const total = challenge.words.length;
            const correct = challenge.correct;
            const accuracy = Math.round((correct / total) * 100);
            
            // ËÆ°ÁÆóÂ•ñÂä±ÁªèÈ™åÂÄº
            let expReward = 0;
            if (accuracy >= 80) {
                expReward = 50 + (challenge.level * 10);  // ‰ºòÁßÄÈ¢ùÂ§ñÂ•ñÂä±
            } else if (accuracy >= 60) {
                expReward = 30 + (challenge.level * 5);
            } else {
                expReward = 10 + (challenge.level * 2);
            }
            
            // Ê∑ªÂä†ÁªèÈ™åÂÄº
            addExp(expReward);
            
            // ÊòæÁ§∫ÁªìÊûú
            const modal = document.getElementById('levelChallengeModal');
            if (modal) {
                modal.innerHTML = `
                    <div class="modal-content" style="max-width:350px;text-align:center;padding:30px;">
                        <div style="font-size:48px;margin-bottom:15px;">${accuracy >= 60 ? 'üéâ' : 'üí™'}</div>
                        <div style="font-size:20px;font-weight:bold;margin-bottom:10px;">${accuracy >= 80 ? 'ÂÆåÁæéÈÄöÂÖ≥ÔºÅ' : accuracy >= 60 ? 'ÈóØÂÖ≥ÊàêÂäüÔºÅ' : 'ÁªßÁª≠Âä™ÂäõÔºÅ'}</div>
                        <div style="background:#f9f9f9;border-radius:12px;padding:20px;margin:20px 0;">
                            <div style="display:flex;justify-content:space-around;">
                                <div>
                                    <div style="font-size:24px;font-weight:bold;color:#10b981;">${correct}</div>
                                    <div style="font-size:12px;color:#666;">Ê≠£Á°Æ</div>
                                </div>
                                <div>
                                    <div style="font-size:24px;font-weight:bold;color:#ef4444;">${total - correct}</div>
                                    <div style="font-size:12px;color:#666;">ÈîôËØØ</div>
                                </div>
                                <div>
                                    <div style="font-size:24px;font-weight:bold;color:#667eea;">${accuracy}%</div>
                                    <div style="font-size:12px;color:#666;">Ê≠£Á°ÆÁéá</div>
                                </div>
                            </div>
                        </div>
                        <div style="background:#fef3c7;border-radius:8px;padding:12px;margin-bottom:20px;">
                            <div style="font-size:14px;">üéÅ Ëé∑Âæó <b style="color:#f59e0b;">${expReward}</b> ÁªèÈ™åÂÄºÂ•ñÂä±ÔºÅ</div>
                        </div>
                        <button class="btn btn-primary" style="width:100%;" onclick="this.closest('.modal').remove();renderLevelList();">ÂÆåÊàê</button>
                    </div>
                `;
            }
            
            currentLevelChallenge = null;
        }
        
        // ====== Â≠¶‰π†Âë®Êä• ======
        function generateWeeklyReport() {
            const history = JSON.parse(localStorage.getItem('wordAI_history') || '[]');
            const now = new Date();
            const weekAgo = new Date(now.getTime() - 7 * 24 *60 * 1000);
            
            // ÁªüËÆ°Êú¨Âë®Êï∞ÊçÆ
            let weekTotal = 0, weekCorrect = 0, weekDays = 0;
            history.forEach(h => {
                const date = new Date(h.date);
                if (date >= weekAgo) {
                    weekTotal += h.total || 0;
                    weekCorrect += h.correct || 0;
                    if (h.total > 0) weekDays++;
                }
            });
            
            const accuracy = weekTotal > 0 ? Math.round((weekCorrect / weekTotal) * 100) : 0;
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width:360px;">
                    <div class="modal-title">üìä Êú¨Âë®Â≠¶‰π†Êä•Âëä</div>
                    <div class="weekly-report">
                        <div class="report-card">
                            <div class="report-stat">
                                <div class="report-stat-item">
                                    <div class="report-stat-value">${weekTotal}</div>
                                    <div class="report-stat-label">Â≠¶‰π†ÂçïËØç</div>
                                </div>
                                <div class="report-stat-item">
                                    <div class="report-stat-value">${weekDays}</div>
                                    <div class="report-stat-label">Â≠¶‰π†Â§©Êï∞</div>
                                </div>
                                <div class="report-stat-item">
                                    <div class="report-stat-value">${accuracy}%</div>
                                    <div class="report-stat-label">Ê≠£Á°ÆÁéá</div>
                                </div>
                            </div>
                        </div>
                        <div class="report-card">
                            <div style="font-size:14px;font-weight:600;margin-bottom:10px;">üìà Êú¨Âë®ËøõÊ≠•</div>
                            <div style="font-size:13px;color:#666;">
                                ${weekDays >= 5 ? '‚úÖ Â≠¶‰π†ÈùûÂ∏∏Âã§Â•ãÔºÅ' : weekDays >= 3 ? 'üí™ ‰øùÊåÅ‰∏çÈîôÔºÅ' : 'üìö Ë¶ÅÁªßÁª≠Âä†Ê≤πÂì¶~'}
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-primary" style="width:100%;" onclick="this.closest('.modal').remove()">ÂÖ≥Èó≠</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        // ====== ÂçïËØçÈÖçÂØπÊ∏∏Êàè ======
        let pairGameActive = false;
        let pairSelected = [];
        let pairMatched = 0;
        let pairLives = 3;
        let pairStartTime = 0;
        let pairTimerInterval = null;
        
        function startPairGame() {
            // ÈÄâÊã©6ÂØπÂçïËØç
            const gameWords = [...words].sort(() => Math.random() - 0.5).slice(0, 6);
            const cards = [];
            
            // ÂàõÂª∫ÂçïËØçÂíåÈáä‰πâÂç°Áâá
            gameWords.forEach(w => {
                cards.push({ id: w.word, text: w.word, type: 'word' });
                cards.push({ id: w.word, text: w.meaning, type: 'meaning' });
            });
            
            // ÈöèÊú∫Êâì‰π±
            cards.sort(() => Math.random() - 0.5);
            
            // ÊòæÁ§∫Ê∏∏ÊàèÈù¢Êùø
            document.getElementById('pairGameStart').style.display = 'none';
            document.getElementById('pairGameBoard').style.display = 'block';
            document.getElementById('pairGameResult').style.display = 'none';
            
            // ÈáçÁΩÆÊ∏∏ÊàèÁä∂ÊÄÅ
            pairSelected = [];
            pairMatched = 0;
            pairLives = 3;
            pairGameActive = true;
            
            document.getElementById('pairLives').textContent = pairLives;
            document.getElementById('pairTimer').textContent = '0';
            
            // Ê∏≤ÊüìÂç°Áâá
            const grid = document.getElementById('pairGrid');
            grid.innerHTML = cards.map((c, i) => `
                <div class="pair-card" data-id="${c.id}" data-type="${c.type}" data-index="${i}" onclick="selectPairCard(this)">
                    ${c.text.length > 8 ? c.text.substring(0, 6) + '...' : c.text}
                </div>
            `).join('');
            
            // ÂºÄÂßãËÆ°Êó∂
            pairStartTime = Date.now();
            pairTimerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - pairStartTime) / 1000);
                document.getElementById('pairTimer').textContent = elapsed;
            }, 1000);
        }
        
        function selectPairCard(card) {
            if (!pairGameActive || card.classList.contains('matched') || card.classList.contains('selected')) return;
            if (pairSelected.length >= 2) return;
            
            card.classList.add('selected');
            pairSelected.push(card);
            
            if (pairSelected.length === 2) {
                const [c1, c2] = pairSelected;
                
                if (c1.dataset.id === c2.dataset.id && c1.dataset.type !== c2.dataset.type) {
                    // ÈÖçÂØπÊàêÂäü
                    c1.classList.add('matched');
                    c2.classList.add('matched');
                    pairMatched++;
                    playSound('correct');
                    
                    if (pairMatched >= 6) {
                        endPairGame();
                    }
                } else {
                    // ÈÖçÂØπÂ§±Ë¥•
                    c1.classList.add('wrong');
                    c2.classList.add('wrong');
                    pairLives--;
                    document.getElementById('pairLives').textContent = pairLives;
                    playSound('wrong');
                    
                    if (pairLives <= 0) {
                        endPairGame();
                    }
                }
                
                setTimeout(() => {
                    pairSelected.forEach(c => {
                        c.classList.remove('selected', 'wrong');
                    });
                    pairSelected = [];
                }, 500);
            }
        }
        
        function endPairGame() {
            pairGameActive = false;
            clearInterval(pairTimerInterval);
            
            document.getElementById('pairGameBoard').style.display = 'none';
            document.getElementById('pairGameResult').style.display = 'block';
            
            const elapsed = Math.floor((Date.now() - pairStartTime) / 1000);
            document.getElementById('pairResultTime').textContent = elapsed;
            
            if (pairMatched >= 6) {
                playSound('complete');
            }
        }
        
        // ====== ÁõÆÊ†áËÆæÁΩÆ ======
        function showGoalSettings() {
            const currentGoal = challengeData.dailyGoal || 10;
            const newGoal = prompt('ËÆæÁΩÆÊØèÊó•Â≠¶‰π†ÁõÆÊ†áÔºà5-50‰∏™ÂçïËØçÔºâ:', currentGoal);
            if (newGoal && newGoal >= 5 && newGoal <= 50) {
                challengeData.dailyGoal = parseInt(newGoal);
                saveChallenge();
                document.getElementById('dailyGoalDisplay').textContent = newGoal;
                alert('ÊØèÊó•ÁõÆÊ†áÂ∑≤ËÆæÁΩÆ‰∏∫ ' + newGoal + ' ‰∏™ÂçïËØçÔºÅ');
            }
        }
        
        function updateGoalDisplays() {
            const data = loadStats();
            document.getElementById('dailyGoalDisplay').textContent = challengeData.dailyGoal || 10;
            document.getElementById('streakGoalDisplay').textContent = streak;
            document.getElementById('todayGoalDisplay').textContent = data.today || 0;
        }
        
        // ====== ËØ≠Èü≥ËæìÂÖ• ======
        let voiceRecognition = null;
        
        function toggleVoiceInput() {
            const btn = document.getElementById('voiceBtn');
            
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅËØ≠Èü≥ËØÜÂà´ÂäüËÉΩ');
                return;
            }
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            
            if (voiceRecognition) {
                voiceRecognition.stop();
                voiceRecognition = null;
                btn.classList.remove('recording');
                return;
            }
            
            voiceRecognition = new SpeechRecognition();
            voiceRecognition.continuous = false;
            voiceRecognition.interimResults = false;
            
            btn.classList.add('recording');
            btn.textContent = 'üî¥';
            
            voiceRecognition.start();
            
            voiceRecognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                alert('‰Ω†ËØ¥ÁöÑÊòØ: ' + transcript);
                // ÂèØ‰ª•Ê∑ªÂä†ÊêúÁ¥¢ÂäüËÉΩ
                quickSearch(transcript);
            };
            
            voiceRecognition.onerror = () => {
                btn.classList.remove('recording');
                btn.textContent = 'üé§';
                alert('ËØ≠Èü≥ËØÜÂà´Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
            };
            
            voiceRecognition.onend = () => {
                btn.classList.remove('recording');
                btn.textContent = 'üé§';
            };
        }
        
        // ====== Â¢ûÂº∫Êï∞ÊçÆÂØºÂá∫ ======
        function exportToCSV() {
            const data = {
                words: words,
                favorites: favorites,
                wrongWords: wrongWords,
                newWords: newWords,
                history: history,
                stats: loadStats()
            };
            
            let csv = 'ÂçïËØç,Èü≥Ê†á,Èáä‰πâ,Áä∂ÊÄÅ\n';
            words.forEach(w => {
                csv += `${w.word},${w.phonetic || ''},${w.meaning},${w.status || 'new'}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `AIËÉåÂçïËØç_ÂçïËØçÊú¨_${new Date().toLocaleDateString()}.csv`;
            link.click();
        }
        
        function exportToTxt() {
            let txt = '=== AIËÉåÂçïËØç - Â≠¶‰π†Êï∞ÊçÆ ===\n\n';
            txt += `ÊÄªÂ≠¶‰π†ÂçïËØç: ${total}‰∏™\n`;
            txt += `Ê≠£Á°ÆÊï∞: ${correct}‰∏™\n`;
            txt += `Ê≠£Á°ÆÁéá: ${total > 0 ? Math.round((correct/total)*100) : 0}%\n`;
            txt += `ËøûÁª≠Â≠¶‰π†: ${streak}Â§©\n\n`;
            
            txt += '=== Êî∂ËóèÁöÑÂçïËØç ===\n';
            favorites.forEach(w => {
                txt += `${w.word} - ${w.meaning}\n`;
            });
            
            txt += '\n=== ÈîôÈ¢òÊú¨ ===\n';
            wrongWords.forEach(w => {
                txt += `${w.word} - ${w.meaning}\n`;
            });
            
            const blob = new Blob([txt], { type: 'text/plain;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `AIËÉåÂçïËØç_Â≠¶‰π†ËÆ∞ÂΩï_${new Date().toLocaleDateString()}.txt`;
            link.click();
        }
        
        function exportToMarkdown() {
            let md = '# AIËÉåÂçïËØçÂ≠¶‰π†Êä•Âëä\n\n';
            md += `> ÁîüÊàêÊó∂Èó¥: ${new Date().toLocaleString()}\n\n`;
            
            const data = loadStats();
            md += '## Â≠¶‰π†ÁªüËÆ°\n\n';
            md += `- ÊÄªÂ≠¶‰π†ÂçïËØç: **${total}** ‰∏™\n`;
            md += `- Ê≠£Á°ÆÊï∞: **${correct}** ‰∏™\n`;
            md += `- Ê≠£Á°ÆÁéá: **${total > 0 ? Math.round((correct/total)*100) : 0}%**\n`;
            md += `- ËøûÁª≠Â≠¶‰π†: **${streak}** Â§©\n`;
            md += `- ‰ªäÊó•Â≠¶‰π†: **${data.today || 0}** ‰∏™\n`;
            md += `- Á¨îËÆ∞Êï∞Èáè: **${Object.keys(JSON.parse(localStorage.getItem("wordAI_wordNotes") || "{}")).length}** Êù°\n\n`;
            
            // ÂØºÂá∫Á¨îËÆ∞
            const noteData = JSON.parse(localStorage.getItem('wordAI_wordNotes') || '{}');
            const notes = Object.entries(noteData);
            if (notes.length > 0) {
                md += '## ÊàëÁöÑÁ¨îËÆ∞\n\n';
                notes.forEach(([word, note]) => {
                    md += `- **${word}**: ${note}\n`;
                });
                md += '\n';
            }
            
            md += '## Êî∂ËóèÁöÑÂçïËØç\n\n';
            favorites.forEach(w => {
                md += `- **${w.word}** - ${w.meaning}\n`;
            });
            
            md += '\n## ÈîôÈ¢òÊú¨\n\n';
            wrongWords.forEach(w => {
                md += `- ~~${w.word}~~ - ${w.meaning}\n`;
            });
            
            const blob = new Blob([md], { type: 'text/markdown;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `AIËÉåÂçïËØç_Â≠¶‰π†Êä•Âëä_${new Date().toLocaleDateString()}.md`;
            link.click();
        }
        
        // ====== [Êñ∞Â¢û] ÂÆåÊï¥Êï∞ÊçÆÂ§á‰ªΩÂäüËÉΩ ======
        function exportAllData() {
            const backupData = {
                version: '1.0',
                exportTime: new Date().toISOString(),
                words: words,
                favorites: favorites,
                wrongWords: wrongWords,
                newWords: newWords,
                history: history,
                stats: loadStats(),
                user: user,
                notes: JSON.parse(localStorage.getItem('wordAI_wordNotes') || '{}'),
                review: JSON.parse(localStorage.getItem('wordAI_review') || '[]'),
                bookProgress: JSON.parse(localStorage.getItem('wordAI_bookProgress') || '{}'),
                settings: {
                    dailyGoal: localStorage.getItem('wordAI_dailyGoal'),
                    notifications: localStorage.getItem('wordAI_notifications'),
                    theme: localStorage.getItem('wordAI_theme'),
                    autoDark: localStorage.getItem('wordAI_autoDark')
                }
            };
            
            const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `AIËÉåÂçïËØç_ÂÆåÊï¥Â§á‰ªΩ_${new Date().toISOString().slice(0,10)}.json`;
            link.click();
            alertToToast('‚úÖ Êï∞ÊçÆÂ§á‰ªΩÊàêÂäüÔºÅÂª∫ËÆÆÂ¶•ÂñÑ‰øùÂ≠òÊ≠§Êñá‰ª∂„ÄÇ');
        }
        
        // ====== [Êñ∞Â¢û] ‰ªéÂ§á‰ªΩÊÅ¢Â§çÊï∞ÊçÆ ======
        function importAllData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                try {
                    const text = await file.text();
                    const data = JSON.parse(text);
                    
                    if (!data.version) {
                        alert('‚ùå Êó†ÊïàÁöÑÂ§á‰ªΩÊñá‰ª∂Ê†ºÂºè');
                        return;
                    }
                    
                    if (confirm('‚ö†Ô∏è ÂØºÂÖ•Â∞ÜË¶ÜÁõñÂΩìÂâçÊâÄÊúâÊï∞ÊçÆÔºÅ\n\nÁ°ÆËÆ§ÁªßÁª≠ÂêóÔºü')) {
                        if (data.words) { words = data.words; localStorage.setItem('wordAI_words', JSON.stringify(words)); }
                        if (data.favorites) { favorites = data.favorites; localStorage.setItem('wordAI_favorites', JSON.stringify(favorites)); }
                        if (data.wrongWords) { wrongWords = data.wrongWords; localStorage.setItem('wordAI_wrongWords', JSON.stringify(wrongWords)); }
                        if (data.newWords) { newWords = data.newWords; localStorage.setItem('wordAI_newWords', JSON.stringify(newWords)); }
                        if (data.history) { history = data.history; localStorage.setItem('wordAI_history', JSON.stringify(history)); }
                        if (data.notes) { localStorage.setItem('wordAI_wordNotes', JSON.stringify(data.notes)); }
                        if (data.review) { localStorage.setItem('wordAI_review', JSON.stringify(data.review)); }
                        if (data.bookProgress) { localStorage.setItem('wordAI_bookProgress', JSON.stringify(data.bookProgress)); }
                        if (data.settings) {
                            if (data.settings.dailyGoal) localStorage.setItem('wordAI_dailyGoal', data.settings.dailyGoal);
                            if (data.settings.notifications) localStorage.setItem('wordAI_notifications', data.settings.notifications);
                            if (data.settings.theme) localStorage.setItem('wordAI_theme', data.settings.theme);
                            if (data.settings.autoDark) localStorage.setItem('wordAI_autoDark', data.settings.autoDark);
                        }
                        alertToToast('‚úÖ Êï∞ÊçÆÊÅ¢Â§çÊàêÂäüÔºÅÈ°µÈù¢Â∞ÜÂà∑Êñ∞„ÄÇ');
                        setTimeout(() => location.reload(), 1000);
                    }
                } catch (err) {
                    alertToToast('‚ùå ÂØºÂÖ•Â§±Ë¥•ÔºöÊñá‰ª∂Ê†ºÂºèÈîôËØØ');
                }
            };
            input.click();
        }
        
        // ====== [Êñ∞Â¢û] Ê∏ÖÈô§ÊâÄÊúâÊï∞ÊçÆ ======
        function clearAllData() {
            if (confirm('‚ö†Ô∏è Âç±Èô©Êìç‰ΩúÔºÅ\n\nËøôÂ∞ÜÊ∏ÖÈô§ÊâÄÊúâÂ≠¶‰π†Êï∞ÊçÆÔºåÂåÖÊã¨Ôºö\n- ÂçïËØçËÆ∞ÂΩï\n- Â≠¶‰π†ÂéÜÂè≤\n- Á¨îËÆ∞\n- Êî∂Ëóè\n\nÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ\n\nÁ°ÆËÆ§Ê∏ÖÈô§ÂêóÔºü')) {
                if (confirm('ÊúÄÂêé‰∏ÄÊ¨°Á°ÆËÆ§ÔºöÊ∏ÖÈô§ÊâÄÊúâÊï∞ÊçÆÔºü')) {
                    const keys = ['wordAI_words', 'wordAI_favorites', 'wordAI_wrongWords', 'wordAI_newWords', 'wordAI_history', 'wordAI_wordNotes', 'wordAI_review', 'wordAI_bookProgress', 'wordAI_user', 'wordAI_dailyGoal', 'wordAI_notifications', 'wordAI_streak', 'wordAI_lastCheckin', 'wordAI_checkinHistory'];
                    keys.forEach(k => localStorage.removeItem(k));
                    alertToToast('‚úÖ Êï∞ÊçÆÂ∑≤Ê∏ÖÈô§ÔºåÈ°µÈù¢Â∞ÜÂà∑Êñ∞„ÄÇ');
                    setTimeout(() => location.reload(), 1000);
                }
            }
        }
        
        // ====== ÂçïËØçÊú¨ÁÆ°ÁêÜ ======
        function showWordbookManager() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width:360px;">
                    <div class="modal-title">üìö ÂçïËØçÊú¨ÁÆ°ÁêÜ</div>
                    <div class="wordbook-manager" id="wordbookManager">
                        <div class="wordbook-item">
                            <div class="wordbook-info">
                                <div class="wordbook-name">‚ù§Ô∏è Êî∂ËóèÊú¨</div>
                                <div class="wordbook-count">${favorites.length} ‰∏™ÂçïËØç</div>
                            </div>
                            <div class="wordbook-actions">
                                <button class="btn" style="font-size:11px;padding:6px;" onclick="showTab('tab-favorites')">Êü•Áúã</button>
                            </div>
                        </div>
                        <div class="wordbook-item">
                            <div class="wordbook-info">
                                <div class="wordbook-name">‚ùå ÈîôÈ¢òÊú¨</div>
                                <div class="wordbook-count">${wrongWords.length} ‰∏™ÂçïËØç</div>
                            </div>
                            <div class="wordbook-actions">
                                <button class="btn" style="font-size:11px;padding:6px;" onclick="showTab('tab-wrongbook')">Êü•Áúã</button>
                            </div>
                        </div>
                        <div class="wordbook-item">
                            <div class="wordbook-info">
                                <div class="wordbook-name">üìñ ÁîüËØçÊú¨</div>
                                <div class="wordbook-count">${newWords.length} ‰∏™ÂçïËØç</div>
                            </div>
                            <div class="wordbook-actions">
                                <button class="btn" style="font-size:11px;padding:6px;" onclick="showTab('tab-newwords')">Êü•Áúã</button>
                            </div>
                        </div>
                        <div class="wordbook-item">
                            <div class="wordbook-info">
                                <div class="wordbook-name">üîî ÂæÖÂ§ç‰π†</div>
                                <div class="wordbook-count">${(JSON.parse(localStorage.getItem('wordAI_review') || '[]')).length} ‰∏™ÂçïËØç</div>
                            </div>
                            <div class="wordbook-actions">
                                <button class="btn" style="font-size:11px;padding:6px;" onclick="showTab('tab-review')">Â§ç‰π†</button>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-primary" style="width:100%;margin-top:15px;" onclick="this.closest('.modal').remove()">ÂÖ≥Èó≠</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        // È°µÈù¢Âä†ËΩΩÊó∂Ê£ÄÊü•
        window.addEventListener('load', () => {
            setTimeout(checkReminder, 3000);
        });
        
        // ====== Â≠¶‰π†ÂàÜÊûêÁ≥ªÁªü ======
        function calculateEfficiency() {
            // ËÆ°ÁÆóÂ≠¶‰π†ÊïàÁéáÔºöÂü∫‰∫éÊ≠£Á°ÆÁéáÂíåÂ≠¶‰π†ÈÄüÂ∫¶
            const data = loadStats();
            const accuracy = data.total > 0 ? (data.correct / data.total) * 100 : 0;
            const todayProgress = data.today || 0;
            const goal = challengeData.dailyGoal || 10;
            const goalCompletion = Math.min((todayProgress / goal) * 100, 100);
            
            // ÁªºÂêàÊïàÁéáÂæóÂàÜ
            const efficiency = Math.round((accuracy * 0.6) + (goalCompletion * 0.4));
            return efficiency;
        }
        
        function renderEfficiencyGauge() {
            const efficiency = calculateEfficiency();
            const circumference = 2 * Math.PI * 60;
            const offset = circumference - (efficiency / 100) * circumference;
            
            const fill = document.getElementById('efficiencyFill');
            const value = document.getElementById('efficiencyValue');
            
            if (fill) fill.style.strokeDasharray = `${offset} ${circumference}`;
            if (value) {
                value.textContent = efficiency + '%';
                // Ê†πÊçÆÊïàÁéáÂÄºÊîπÂèòÈ¢úËâ≤
                if (efficiency >= 80) fill.style.stroke = '#52C41A';
                else if (efficiency >= 60) fill.style.stroke = '#667eea';
                else if (efficiency >= 40) fill.style.stroke = '#f59e0b';
                else fill.style.stroke = '#ef4444';
            }
        }
        
        function generateLearningInsights() {
            const container = document.getElementById('learningInsights');
            if (!container) return;
            
            const data = loadStats();
            const insights = [];
            const accuracy = data.total > 0 ? Math.round((data.correct / data.total) * 100) : 0;
            
            // Âü∫‰∫éÊï∞ÊçÆÁîüÊàêÊ¥ûÂØü
            if (accuracy >= 90) {
                insights.push({ icon: 'üåü', text: 'Ê≠£Á°ÆÁéáÂæàÈ´òÔºåÁªßÁª≠‰øùÊåÅÔºÅ', value: accuracy + '%' });
            } else if (accuracy >= 70) {
                insights.push({ icon: 'üí™', text: 'Ê≠£Á°ÆÁéá‰∏çÈîôÔºåËøòÊúâÊèêÂçáÁ©∫Èó¥', value: accuracy + '%' });
            } else if (accuracy >= 50) {
                insights.push({ icon: 'üìö', text: 'Âª∫ËÆÆÂ§öÂ§ç‰π†Âü∫Á°ÄÂçïËØç', value: accuracy + '%' });
            } else {
                insights.push({ icon: 'üéØ', text: '‰ªéÁÆÄÂçïÂçïËØçÂºÄÂßãÊõ¥ÊúâÊïà', value: accuracy + '%' });
            }
            
            // ËøûÁª≠Â≠¶‰π†ÂàÜÊûê
            if (streak >= 7) {
                insights.push({ icon: 'üî•', text: 'ËøûÁª≠Â≠¶‰π†' + streak + 'Â§©ÔºåÂ§™Ê£í‰∫ÜÔºÅ', value: streak + 'Â§©' });
            } else if (streak > 0) {
                insights.push({ icon: 'üí™', text: 'ÂùöÊåÅ' + streak + 'Â§©ÔºåÂÖªÊàêÂ•Ω‰π†ÊÉØÔºÅ', value: streak + 'Â§©' });
            }
            
            // ‰ªäÊó•ËøõÂ∫¶
            const goal = challengeData.dailyGoal || 10;
            const todayProgress = data.today || 0;
            if (todayProgress >= goal) {
                insights.push({ icon: 'üéâ', text: '‰ªäÊó•ÁõÆÊ†áÂ∑≤ËææÊàêÔºÅ', value: todayProgress + '/' + goal });
            } else {
                insights.push({ icon: 'üìå', text: '‰ªäÊó•ËøõÂ∫¶', value: todayProgress + '/' + goal });
            }
            
            // ÈîôÈ¢òÂàÜÊûê
            if (wrongWords.length > 0) {
                insights.push({ icon: 'üìù', text: 'ÈîôÈ¢òÊï∞Èáè', value: wrongWords.length + '‰∏™' });
            }
            
            container.innerHTML = insights.map(i => `
                <div class="insight-item">
                    <span class="insight-icon">${i.icon}</span>
                    <span style="flex:1">${i.text}</span>
                    <span class="insight-value">${i.value}</span>
                </div>
            `).join('');
        }
        
        function renderErrorChart() {
            const container = document.getElementById('errorChart');
            if (!container) return;
            
            // ÁîüÊàê7Â§©ÁöÑÊ®°ÊãüÈîôÈ¢òÊï∞ÊçÆ
            const days = ['Âë®‰∏Ä', 'Âë®‰∫å', 'Âë®‰∏â', 'Âë®Âõõ', 'Âë®‰∫î', 'Âë®ÂÖ≠', 'Âë®Êó•'];
            const data = [];
            for (let i = 0; i < 7; i++) {
                data.push(Math.floor(Math.random() * 10) + 1);
            }
            const maxVal = Math.max(...data);
            
            container.innerHTML = days.map((day, i) => {
                const height = (data[i] / maxVal) * 100;
                return `
                    <div class="error-bar" style="height:${height}px">
                        <div class="error-bar-label">${day}</div>
                    </div>
                `;
            }).join('');
        }
        
        function renderMilestones() {
            const container = document.getElementById('milestoneTimeline');
            if (!container) return;
            
            const milestones = [
                { id: 1, title: 'È¶ñÊ¨°Â≠¶‰π†', desc: 'ÂÆåÊàêÁ¨¨‰∏Ä‰∏™ÂçïËØç', icon: 'üå±', condition: total >= 1 },
                { id: 2, title: 'ÂçÅ‰∏™ÂçïËØç', desc: 'Â≠¶‰π†10‰∏™ÂçïËØç', icon: '‚≠ê', condition: total >= 10 },
                { id: 3, title: '‰∫îÂçÅËØçÊñ©', desc: 'Â≠¶‰π†50‰∏™ÂçïËØç', icon: 'üìö', condition: total >= 50 },
                { id: 4, title: 'ÁôæËØçÂ§ßÂÖ≥', desc: 'Â≠¶‰π†100‰∏™ÂçïËØç', icon: 'üíØ', condition: total >= 100 },
                { id: 5, title: '‰∏âÂ§©ÂùöÊåÅ', desc: 'ËøûÁª≠Â≠¶‰π†3Â§©', icon: 'üî•', condition: streak >= 3 },
                { id: 6, title: '‰∏ÄÂë®Â≠¶Èú∏', desc: 'ËøûÁª≠Â≠¶‰π†7Â§©', icon: 'üëë', condition: streak >= 7 },
                { id: 7, title: 'ÁõÆÊ†áËææÊàê', desc: 'ÂÆåÊàêÊØèÊó•ÁõÆÊ†á', icon: 'üéØ', condition: (loadStats().today || 0) >= (challengeData.dailyGoal || 10) },
                { id: 8, title: 'ÈîôÈ¢òÊ∏ÖÈõ∂', desc: 'ÊéåÊè°ÊâÄÊúâÈîôÈ¢ò', icon: '‚úÖ', condition: wrongWords.length === 0 && total > 20 }
            ];
            
            container.innerHTML = milestones.map(m => `
                <div class="milestone-item ${m.condition ? 'completed' : ''}">
                    <div class="milestone-icon">${m.icon}</div>
                    <div class="milestone-content">
                        <div class="milestone-title">${m.title}</div>
                        <div class="milestone-desc">${m.desc}</div>
                    </div>
                    <div class="milestone-status">${m.condition ? 'Â∑≤ÂÆåÊàê' : 'Êú™ÂÆåÊàê'}</div>
                </div>
            `).join('');
        }
        
        function loadAnalysis() {
            renderEfficiencyGauge();
            generateLearningInsights();
            renderErrorChart();
            renderMilestones();
        }
        </script>

        <!-- ËØ≠Ë®ÄÂàáÊç¢ -->
        <div class="tab-content" id="tab-lang">
            <div class="lang-grid">
                <div class="lang-card active" onclick="switchLanguage('en')">
                    <div class="lang-flag">üá∫üá∏</div>
                    <div class="lang-name">Ëã±ËØ≠</div>
                </div>
                <div class="lang-card" onclick="switchLanguage('ja')">
                    <div class="lang-flag">üáØüáµ</div>
                    <div class="lang-name">Êó•ËØ≠</div>
                </div>
                <div class="lang-card" onclick="switchLanguage('ko')">
                    <div class="lang-flag">üá∞üá∑</div>
                    <div class="lang-name">Èü©ËØ≠</div>
                </div>
                <div class="lang-card" onclick="switchLanguage('fr')">
                    <div class="lang-flag">üá´üá∑</div>
                    <div class="lang-name">Ê≥ïËØ≠</div>
                </div>
            </div>
        </div>

        <!-- Â≠¶‰π†Â∞èÁªÑ -->
        <div class="tab-content" id="tab-group">
            <div class="group-header">
                <div class="group-avatar">üë•</div>
                <div style="font-size:16px;font-weight:600;">Â≠¶‰π†Â∞èÁªÑ</div>
                <div style="font-size:12px;opacity:0.8;margin-top:4px;">ÂíåÂ•ΩÂèã‰∏ÄËµ∑Â≠¶‰π†</div>
            </div>
            <div style="padding:16px;">
                <button class="group-btn" style="width:100%;background:#667eea;" onclick="createGroup()">ÂàõÂª∫Â∞èÁªÑ</button>
                <button class="group-btn" style="width:100%;background:#fff;border:1px solid #667eea;color:#667eea;" onclick="joinGroup()">Âä†ÂÖ•Â∞èÁªÑ</button>
            </div>
            <div class="group-feed" id="groupFeed">
                <!-- Â∞èÁªÑÂäüËÉΩÂç≥Â∞Ü‰∏äÁ∫ø -->
                <div style="padding:20px;text-align:center;color:#999;">
                    <div style="font-size:24px;margin-bottom:8px;">üîú</div>
                    <div>Â∞èÁªÑÂäüËÉΩÂºÄÂèë‰∏≠</div>
                    <div style="font-size:12px;margin-top:4px;">Âç≥Â∞Ü‰∏äÁ∫øÔºåÊï¨ËØ∑ÊúüÂæÖ</div>
                </div>
                <div id="feedList"></div>
            </div>
            <div class="ranking-list">
                <!-- ÊéíË°åÊ¶ú‰ªÖÊú¨Âú∞ -->
                <div style="padding:20px;text-align:center;color:#666;">
                    <div style="font-size:24px;margin-bottom:8px;">üìä</div>
                    <div>Êú¨Âú∞ÊéíË°åÊ¶ú</div>
                    <div style="font-size:12px;margin-top:4px;">ËÆ∞ÂΩïÊÇ®ÁöÑ‰∏™‰∫∫Â≠¶‰π†ËøõÂ∫¶</div>
                </div>
                <div id="rankingList"></div>
            </div>
            <div style="padding:16px;">
                <!-- Â•ΩÂèãÂäüËÉΩÂºÄÂèë‰∏≠ -->
                <div style="padding:20px;text-align:center;color:#999;">
                    <div style="font-size:24px;margin-bottom:8px;">üë´</div>
                    <div>Â•ΩÂèãÂäüËÉΩÂºÄÂèë‰∏≠</div>
                </div>
                <div id="friendRecommendations"></div>
            </div>
        </div>

        <!-- Â≠¶‰π†Âú∞Âõæ -->
        <div class="tab-content" id="tab-map">
            <div class="map-container">
                <div style="text-align:center;font-size:16px;font-weight:600;margin-bottom:20px;">üó∫Ô∏è Â≠¶‰π†Âú∞Âõæ</div>

        <!-- ÊØèÊó•‰∏ÄÂè• -->
        <!-- VIP‰ºöÂëò -->
        <div class="tab-content" id="tab-vip">
            <div class="vip-header">
                <div class="vip-badge">üíé</div>
                <div class="vip-title">VIP‰ºöÂëò</div>
                <div>Ëß£ÈîÅÂÖ®ÈÉ®È´òÁ∫ßÂäüËÉΩ</div>
            </div>
            <div class="vip-features">
                <div class="vip-feature"><span>‚òÅÔ∏è</span><span>‰∫ëÁ´ØÊï∞ÊçÆÂêåÊ≠•</span></div>
                <div class="vip-feature"><span>üë•</span><span>Â•ΩÂèãPKÂØπÊàò</span></div>
                <div class="vip-feature"><span>üìä</span><span>È´òÁ∫ßÂ≠¶‰π†Êä•Âëä</span></div>
                <div class="vip-feature"><span>üéØ</span><span>AIÁ≤æÂáÜÂá∫È¢ò</span></div>
                <div class="vip-feature"><span>üèÜ</span><span>‰∏ìÂ±ûÂæΩÁ´†</span></div>
            </div>
            <div style="text-align:center;padding:20px;">
                <button class="vip-btn" onclick="upgradeVIP()">Á´ãÂç≥ÂºÄÈÄöVIP</button>
            </div>
        </div>
        <div class="tab-content" id="tab-quote">
            <div id="dailyQuote"></div>
        </div>
                <div id="mapNodes"></div>
            </div>
        </div>

        <!-- PKÂØπÊàò -->
        <div class="tab-content" id="tab-pk">
            <div class="pk-arena">
                <div style="font-size:16px;font-weight:600;">‚öîÔ∏è Â≠¶‰π†PK</div>
                <div class="pk-player">
                    <div>
                        <div class="pk-avatar">üòÄ</div>
                        <div>Êàë</div>
                        <div class="pk-score" id="pkMyScore">0</div>
                    </div>
                    <div class="pk-vs">VS</div>
                    <div>
                        <div class="pk-avatar">ü§ñ</div>
                        <div>AIÂØπÊâã</div>
                        <div class="pk-score" id="pkAiScore">0</div>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="startPK()">ÂºÄÂßãPK</button>
                <div class="pk-result" id="pkResult"></div>
            </div>
        </div>

        <!-- ÁîüËØçÊú¨ -->
        <div class="tab-content" id="tab-newwords">
            <div class="collection-header">
                <span>üìù ÁîüËØçÊú¨</span>
                <span id="newWordsCount" style="font-size:12px;color:#999;">0 ‰∏™</span>
            </div>
            <div id="newWordsList"></div>
            <div style="padding:16px;">
                <button class="btn btn-primary" style="width:100%;" onclick="reviewNewWords()">Â§ç‰π†ÁîüËØç</button>
            </div>
        </div>

        <!-- AI Âá∫È¢ò -->
        <div class="tab-content" id="tab-quiz">
            <div class="card" id="quiz-card"><div class="loading">AIÊ≠£Âú®Âá∫È¢ò...</div></div>
            <div class="quiz-options" id="quiz-options"></div>
        </div>

        <!-- ÊØèÊó•ÊåëÊàò -->
        <div class="tab-content" id="tab-challenge">
            <!-- Á≠æÂà∞Âå∫Âüü -->
            <div id="checkinSection" style="background:white;margin:15px;border-radius:12px;padding:15px;box-shadow:0 2px8px rgba(0,0,0,0.05);">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                    <span style="font-size:14px;font-weight:600;">üìÖ ÊØèÊó•Á≠æÂà∞</span>
                    <span id="checkinStreak" style="font-size:12px;color:#f59e0b;">ËøûÁª≠Á≠æÂà∞: 0Â§©</span>
                </div>
                <div style="display:flex;justify-content:space-around;margin-bottom:10px;" id="checkinDays">
                    <!-- 7Â§©Á≠æÂà∞Êó•ÂéÜÁî±JSÁîüÊàê -->
                </div>
                <button id="checkinBtn" class="btn btn-primary" style="width:100%;" onclick="doCheckin()">üìù Á´ãÂç≥Á≠æÂà∞</button>
            </div>
            <div class="challenge-header">
                <div class="challenge-title">üéØ ÊØèÊó•ÊåëÊàò</div>
                <div class="challenge-date" id="challengeDate"></div>
            </div>
            <div class="challenge-progress">
                <div class="challenge-progress-text">
                    <span id="challengeProgress">0</span> / <span id="challengeGoal">10</span> ÂçïËØç
                </div>
                <div class="challenge-progress-bar">
                    <div class="challenge-progress-fill" id="challengeProgressFill"></div>
                </div>
            </div>
            <div style="display:flex;gap:10px;padding:10px 20px;">
                <button class="btn" style="flex:1;font-size:12px;padding:8px;" onclick="showGoalSetting()">‚öôÔ∏è ËÆæÁΩÆÁõÆÊ†á</button>
                <button class="btn btn-primary" style="flex:1;font-size:12px;padding:8px;" onclick="shareDailyChallenge()">üì§ ÂàÜ‰∫´ÊâìÂç°</button>
            </div>
            <div style="text-align:center;padding:0 20px 10px;">
                <button class="btn" id="streakShieldBtn" style="font-size:11px;padding:6px 12px;background:#f59e0b;color:white;" onclick="useStreakShield()">üõ°Ô∏è ÊâìÂç°‰øùÊä§Âç°</button>
            </div>
            <div class="challenge-status" id="challengeStatus">
                <div class="challenge-status-icon">üî•</div>
                <div class="challenge-status-text">Â≠¶‰π†‰∏≠...</div>
            </div>
            <div class="badges-section">
                <div class="badges-title">üèÜ ÂæΩÁ´†Â¢ô</div>
                <div class="badges-grid" id="badgesGrid"></div>
            </div>
            <div class="today-tasks">
                <div class="tasks-title">üìã ‰ªäÊó•‰ªªÂä°</div>
                <div class="task-item" id="task1">
                    <span class="task-icon">üìö</span>
                    <span class="task-name">Â≠¶‰π†10‰∏™ÂçïËØç</span>
                    <span class="task-status" id="task1Status">0/10</span>
                </div>
                <div class="task-item" id="task2">
                    <span class="task-icon">‚ùì</span>
                    <span class="task-name">ÂÆåÊàê5ÈÅìÈÄâÊã©È¢ò</span>
                    <span class="task-status" id="task2Status">0/5</span>
                </div>
                <div class="task-item" id="task3">
                    <span class="task-icon">üéØ</span>
                    <span class="task-name">Ê≠£Á°ÆÁéáËææÂà∞80%</span>
                    <span class="task-status" id="task3Status">0%</span>
                </div>
            </div>
        </div>

        <!-- Âú∫ÊôØÂ≠¶‰π† -->
        <div class="tab-content" id="tab-scenes">
            <div class="scene-grid">
                <div class="scene-card active" onclick="selectScene('travel')">
                    <div class="scene-icon">‚úàÔ∏è</div>
                    <div class="scene-name">ÊóÖË°å</div>
                    <div class="scene-count">12 ÂçïËØç</div>
                </div>
                <div class="scene-card" onclick="selectScene('business')">
                    <div class="scene-icon">üíº</div>
                    <div class="scene-name">ËÅåÂú∫</div>
                    <div class="scene-count">12 ÂçïËØç</div>
                </div>
                <div class="scene-card" onclick="selectScene('daily')">
                    <div class="scene-icon">üè†</div>
                    <div class="scene-name">Êó•Â∏∏</div>
                    <div class="scene-count">12 ÂçïËØç</div>
                </div>
                <div class="scene-card" onclick="selectScene('tech')">
                    <div class="scene-icon">üíª</div>
                    <div class="scene-name">ÁßëÊäÄ</div>
                    <div class="scene-count">12 ÂçïËØç</div>
                </div>
                <div class="scene-card" onclick="selectScene('medical')">
                    <div class="scene-icon">üè•</div>
                    <div class="scene-name">ÂåªÁñó</div>
                    <div class="scene-count">10 ÂçïËØç</div>
                </div>
                <div class="scene-card" onclick="selectScene('finance')">
                    <div class="scene-icon">üí∞</div>
                    <div class="scene-name">ÈáëËûç</div>
                    <div class="scene-count">10 ÂçïËØç</div>
                </div>
                <div class="scene-card" onclick="selectScene('education')">
                    <div class="scene-icon">üìñ</div>
                    <div class="scene-name">ÊïôËÇ≤</div>
                    <div class="scene-count">10 ÂçïËØç</div>
                </div>
                <div class="scene-card" onclick="selectScene('fitness')">
                    <div class="scene-icon">üèãÔ∏è</div>
                    <div class="scene-name">ÂÅ•Ë∫´</div>
                    <div class="scene-count">10 ÂçïËØç</div>
                </div>
            </div>
            <div class="card" id="scene-card">
                <div class="word" id="scene-word">travel</div>
                <div class="phonetic" id="scene-phonetic">/Ààtr√¶v…ôl/</div>
                <div class="meaning" id="scene-meaning">v. ÊóÖË°å</div>
                <button class="btn btn-primary" style="margin-top:16px;" onclick="nextSceneWord()">‰∏ã‰∏Ä‰∏™</button>
            </div>
        </div>

        <!-- AIÂè£ËØ≠Èô™ÁªÉ -->
        <div class="tab-content" id="tab-dialogue">
            <div class="dialogue-container">
                <div class="dialogue-messages" id="dialogueMessages">
                    <div class="dialogue-msg ai">
                        <div class="dialogue-bubble">‰Ω†Â•ΩÔºÅÊàëÊòØ‰Ω†ÁöÑAIÂè£ËØ≠Èô™ÁªÉ„ÄÇËÆ©ÊàëÁî®Ëã±ËØ≠Âíå‰Ω†ÂØπËØùÂêßÔºÅTry to respond in English. üåü</div>
                    </div>
                </div>
                <div class="dialogue-input">
                    <input type="text" id="dialogueInput" placeholder="Áî®Ëã±ËØ≠ÂõûÂ§ç..." onkeypress="if(event.key==='Enter')sendDialogue()">
                    <button onclick="sendDialogue()">ÂèëÈÄÅ</button>
                </div>
            </div>
        </div>

        <!-- ÁªüËÆ° -->
        <div class="tab-content" id="tab-stats">
            <div class="stats-container">
                <div class="stats-card">
                    <div class="stats-title">üìä Â≠¶‰π†Ê¶ÇËßà</div>
                    <div class="stats-grid">
                        <div class="stats-item">
                            <div class="stats-value" id="statsTotal">0</div>
                            <div class="stats-label">ÊÄªÂ≠¶‰π†</div>
                        </div>
                        <div class="stats-item">
                            <div class="stats-value green" id="statsCorrect">0</div>
                            <div class="stats-label">Ê≠£Á°ÆÊï∞</div>
                        </div>
                        <div class="stats-item">
                            <div class="stats-value orange" id="statsStreak">0</div>
                            <div class="stats-label">ËøûÁª≠Â§©Êï∞</div>
                        </div>
                        <div class="stats-item">
                            <div class="stats-value" id="statsAccuracy">0%</div>
                            <div class="stats-label">Ê≠£Á°ÆÁéá</div>
                        </div>
                    </div>
                </div>
                
                <div class="stats-card">
                    <div class="stats-title">üìà ËØçÊ±áÈáèËØÑ‰º∞</div>
                    <div class="vocab-estimate" id="vocabEstimate">
                        <div class="vocab-level" id="vocabLevel">Lv.1</div>
                        <div class="vocab-desc">ÂàùÂ≠¶ËÄÖ</div>
                        <div class="vocab-bar" style="height:8px;background:#eee;border-radius:4px;margin:10px 0;">
                            <div id="vocabBar" style="height:100%;background:linear-gradient(90deg,#667eea,#764ba2);width:5%;border-radius:4px;transition:width 0.3s;"></div>
                        </div>
                        <div class="vocab-next" style="font-size:11px;color:#999;">Ë∑ùÁ¶ª‰∏ã‰∏ÄÁ∫ßËøòÈúÄÂ≠¶‰π† <span id="vocabNeed">95</span> ËØç</div>
                    </div>
                </div>
                
                <div class="stats-card">
                    <div class="stats-title">üß† ËÆ∞ÂøÜÊõ≤Á∫øÔºà7Â§©Ôºâ</div>
                    <div class="memory-chart" id="memoryChart"></div>
                </div>
                
                <div class="stats-card">
                    <div class="stats-title">üìÖ Â≠¶‰π†Êó•ÂéÜ</div>
                    <div class="learning-calendar" id="learningCalendar"></div>
                </div>
                
                <div class="stats-card">
                    <div class="stats-title">üèÜ ÊàêÂ∞±Á≥ªÁªü</div>
                    <div class="achievement-list" id="achievementList"></div>
                </div>
            </div>
        </div>

        <!-- ÂèëÈü≥ÊµãËØÑ -->
        <div class="tab-content" id="tab-speak">
            <div class="card">
                <div class="word" id="speak-word">algorithm</div>
                <div class="phonetic" id="speak-phonetic">/Àà√¶l…°…ôr…™√∞…ôm/</div>
                <button class="tts-btn" onclick="playReference()">üîä</button>
                <button class="record-btn" id="recordBtn" onmousedown="startRecord()" onmouseup="stopRecord()">üé§</button>
                <div class="record-hint" id="recordHint">Êåâ‰ΩèÂΩïÈü≥ÊµãËØÑÂèëÈü≥</div>
                <div id="pronunciation-result"></div>
            </div>
            <div class="btn-group"><button class="btn btn-primary" onclick="nextSpeak()">‰∏ã‰∏Ä‰∏™</button></div>
        </div>

        <!-- ÈÄüËÆ∞Ê®°Âºè -->
        <div class="tab-content" id="tab-flashcard">
            <div style="padding:15px;background:#f0f7ff;border-bottom:1px solid #eee;">
                <div style="display:flex;justify-content:space-between;align-items:center;">
                    <span style="font-size:13px;color:#666;">‚ö° ÈÄüËÆ∞Ê®°Âºè</span>
                    <span id="flashcardCount" style="font-size:12px;color:#667eea;">0/10</span>
                </div>
                <div style="height:4px;background:#eee;border-radius:2px;margin-top:8px;">
                    <div id="flashcardProgress" style="height:100%;background:#667eea;width:0%;border-radius:2px;transition:width 0.3s;"></div>
                </div>
            </div>
            <div class="card" id="flashcardCard" onclick="flipFlashcard()">
                <div class="word" id="flashcardWord" style="font-size:36px;">-</div>
                <div class="phonetic" id="flashcardPhonetic" style="font-size:16px;margin:10px 0;">-</div>
                <div class="meaning" id="flashcardMeaning" style="font-size:14px;display:none;">-</div>
                <div style="font-size:11px;color:#999;margin-top:15px;">ÁÇπÂáªÂç°ÁâáÊòæÁ§∫Èáä‰πâ</div>
            </div>
            <div class="btn-group">
                <button class="btn btn-danger" onclick="flashcardKnow(false)">‰∏çËÆ§ËØÜ</button>
                <button class="btn btn-success" onclick="flashcardKnow(true)">ËÆ§ËØÜ</button>
            </div>
            <div style="padding:15px;text-align:center;">
                <button class="btn" style="background:#667eea;color:white;" onclick="startFlashcard()">üîÑ ÈáçÊñ∞ÂºÄÂßã</button>
            </div>
        </div>

        <!-- Â§ç‰π†ÊµãËØï -->
        <div class="tab-content" id="tab-review">
            <div style="padding:20px;text-align:center;">
                <h3 style="margin-bottom:15px;">üìù Â§ç‰π†ÊµãËØï</h3>
                <p style="font-size:13px;color:#666;margin-bottom:20px;">Âü∫‰∫éËâæÂÆæÊµ©ÊñØÈÅóÂøòÊõ≤Á∫øÔºåÊô∫ËÉΩÂÆâÊéíÂ§ç‰π†</p>
                <div class="stats-grid" style="margin-bottom:20px;">
                    <div class="stats-item" style="background:white;padding:15px;border-radius:12px;">
                        <div class="stats-value" id="reviewDueCount" style="font-size:28px;">0</div>
                        <div class="stats-label">ÂæÖÂ§ç‰π†</div>
                    </div>
                    <div class="stats-item" style="background:white;padding:15px;border-radius:12px;">
                        <div class="stats-value" id="reviewMasteredCount" style="font-size:28px;color:#10b981;">0</div>
                        <div class="stats-label">Â∑≤ÊéåÊè°</div>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="startReview()" style="width:100%;margin-bottom:10px;" id="startReviewBtn">ÂºÄÂßãÂ§ç‰π†</button>
                <button class="btn" style="width:100%;background:#f5f5f5;" onclick="showTab('tab-newwords')">Êü•ÁúãÁîüËØçÊú¨</button>
            </div>
            <div id="reviewCard" style="display:none;padding:20px;">
                <div class="card" id="reviewWordCard">
                    <div class="word" id="reviewWord">-</div>
                    <div class="phonetic" id="reviewPhonetic">-</div>
                </div>
                <div style="padding:20px;">
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
                        <button class="btn" style="background:#fee2e2;color:#ef4444;" onclick="rateReview(1)">üò´ Âøò‰∫Ü</button>
                        <button class="btn" style="background:#fef3c7;color:#f59e0b;" onclick="rateReview(2)">ü§î ËÆ∞Âæó</button>
                        <button class="btn" style="background:#d1fae5;color:#10b981;" onclick="rateReview(3)">üòä ËÆ∞‰Ωè</button>
                        <button class="btn" style="background:#dbeafe;color:#3b82f6;" onclick="rateReview(4)">üéØ Á≤æÈÄö</button>
                    </div>
                    <button class="btn" style="width:100%;margin-top:10px;background:#f5f5f5;" onclick="showTab('tab-review')">ÈÄÄÂá∫Â§ç‰π†</button>
                </div>
            </div>
        </div>

        <!-- Âê¨ÂÜôÊ®°Âºè -->
        <div class="tab-content" id="tab-dictation">
            <div style="padding:20px;text-align:center;">
                <div style="font-size:14px;color:#666;margin-bottom:15px;">‚úçÔ∏è Âê¨ÂÜôÊµãËØï</div>
                <div style="font-size:12px;color:#999;margin-bottom:20px;">Âê¨ÂèëÈü≥ÔºåÊãºÂÜôÂçïËØç</div>
            </div>
            <div class="card" id="dictationCard">
                <button class="tts-btn" onclick="playDictationWord()" style="width:60px;height:60px;font-size:24px;margin-bottom:15px;">üîä</button>
                <div id="dictationHint" style="font-size:13px;color:#666;margin:10px 0;">ÁÇπÂáªÊí≠ÊîæÊåâÈíÆÂê¨ÂçïËØç</div>
                <input type="text" id="dictationInput" placeholder="ËæìÂÖ•ÂçïËØçÊãºÂÜô..." style="width:80%;padding:12px;border:2px solid #ddd;border-radius:10px;font-size:16px;text-align:center;margin:10px auto;">
                <div id="dictationResult" style="margin-top:15px;font-size:14px;"></div>
            </div>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="checkDictation()">‚úì Ê£ÄÊü•</button>
                <button class="btn" style="background:#667eea;color:white;" onclick="nextDictation()">‰∏ã‰∏Ä‰∏™</button>
            </div>
            <div style="padding:15px;text-align:center;">
                <div style="display:flex;justify-content:space-around;font-size:12px;color:#666;">
                    <span>Ê≠£Á°Æ: <b id="dictCorrect" style="color:#10b981;">0</b></span>
                    <span>ÈîôËØØ: <b id="dictWrong" style="color:#ef4444;">0</b></span>
                    <span>Ê≠£Á°ÆÁéá: <b id="dictAcc">0%</b></span>
                </div>
            </div>
        </div>

        <!-- Â≠¶‰π†ËÆ∞ÂΩï -->
        <div class="tab-content" id="tab-settings">
            <div class="settings">
                <h3>üîä Èü≥ÊïàËÆæÁΩÆ</h3>
                <div class="reminder-item">
                    <span class="reminder-label">ÂºÄÂêØÂ≠¶‰π†Èü≥Êïà</span>
                    <div class="reminder-toggle active" id="soundToggle" onclick="toggleSound()"></div>
                </div>
                
                <h3 style="margin-top:20px;">üéØ ÊØèÊó•ÁõÆÊ†á</h3>
                <div class="reminder-item">
                    <span class="reminder-label">Â≠¶‰π†ÂçïËØçÊï∞</span>
                    <select id="dailyGoalSelect" onchange="updateDailyGoal()" style="padding:6px 10px;border:1px solid #ddd;border-radius:8px;">
                        <option value="5">5 ‰∏™</option>
                        <option value="10" selected>10 ‰∏™</option>
                        <option value="15">15 ‰∏™</option>
                        <option value="20">20 ‰∏™</option>
                        <option value="30">30 ‰∏™</option>
                    </select>
                </div>
                <p style="font-size:11px;color:#999;margin-top:5px;">ÂÆåÊàêÁõÆÊ†áÂêéÊòæÁ§∫Â∫ÜÁ•ùÂä®Áîª</p>
                
                <h3 style="margin-top:20px;">API ËÆæÁΩÆ</h3>
                <p style="font-size:12px;color:#666;margin:10px 0;">ËæìÂÖ• MiniMax API Key ‰ª•ÂêØÁî® AI Âá∫È¢òÂäüËÉΩ</p>
                <input type="text" id="apiKey" placeholder="sk-xxx" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:5px;margin-bottom:10px;">
                <button class="btn btn-primary" onclick="saveApiKey()" style="width:100%;">‰øùÂ≠ò API Key</button>
                <p id="apiKeyStatus" style="font-size:12px;margin-top:10px;color:#10b981;"></p>
                
                <h3 style="margin-top:24px;">üèÜ ÊéíË°åÊ¶ú</h3>
                <button class="btn btn-primary" onclick="showRankings()" style="width:100%;margin-bottom:12px;">üìä Êü•ÁúãÊéíË°åÊ¶ú</button>
                
                <h3 style="margin-top:24px;">‚ûï Ê∑ªÂä†Ëá™ÂÆö‰πâÂçïËØç</h3>
                <div style="margin-top:12px;">
                    <input type="text" id="customWord" placeholder="ÂçïËØç" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:5px;margin-bottom:8px;">
                    <input type="text" id="customPhonetic" placeholder="Èü≥Ê†á Â¶Ç: /test/" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:5px;margin-bottom:8px;">
                    <input type="text" id="customMeaning" placeholder="Âê´‰πâ" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:5px;margin-bottom:8px;">
                    <button class="btn btn-primary" onclick="addCustomWord()" style="width:100%;">Ê∑ªÂä†ÂçïËØç</button>
                    <p id="customWordStatus" style="font-size:12px;margin-top:8px;color:#10b981;"></p>
                </div>
                
                <h3 style="margin-top:24px;">üìö ÊâπÈáèÂØºÂÖ•ÂçïËØç</h3>
                <p style="font-size:11px;color:#666;margin:8px 0;">ÊØèË°å‰∏Ä‰∏™ÂçïËØçÔºåÊ†ºÂºèÔºöÂçïËØç,Èü≥Ê†á,Âê´‰πâ</p>
                <textarea id="batchImport" placeholder="apple,/Àà√¶p…ôl/,ËãπÊûú&#10;banana,/b…ôÀàn…ëÀên…ô/,È¶ôËïâ&#10;orange,/Àà…îÀêr…™nd í/,Ê©ôÂ≠ê" style="width:100%;height:80px;padding:10px;border:1px solid #ddd;border-radius:5px;font-size:12px;margin-bottom:8px;"></textarea>
                <button class="btn btn-primary" onclick="batchImportWords()" style="width:100%;">ÊâπÈáèÂØºÂÖ•</button>
                <p id="batchImportStatus" style="font-size:12px;margin-top:8px;color:#10b981;"></p>
                
                <h3 style="margin-top:24px;">üì¶ Êï∞ÊçÆÁÆ°ÁêÜ</h3>
                <div class="backup-card">
                    <div class="backup-header">
                        <span class="backup-title">üíæ Êï∞ÊçÆÂ§á‰ªΩ</span>
                        <span class="backup-status success" id="backupStatus">Â∑≤Ëá™Âä®Â§á‰ªΩ</span>
                    </div>
                    <div class="backup-info" id="backupInfo">ÊúÄËøëÂ§á‰ªΩ: ÂàöÂàö</div>
                    <div class="backup-actions">
                        <button class="btn btn-primary" onclick="exportAllData()">üì§ ÂØºÂá∫</button>
                        <button class="btn" style="background:#f5f5f5;" onclick="document.getElementById('importFile').click()">üì• ÂØºÂÖ•</button>
                        <button class="btn" style="background:#e6f7ff;color:#1890ff;" onclick="autoBackup()">üîÑ Â§á‰ªΩ</button>
                    </div>
                    <input type="file" id="importFile" style="display:none;" accept=".json" onchange="importAllData(this)">
                </div>
                
                <h3 style="margin-top:20px;">üìä CSV ÂØºÂá∫</h3>
                <div style="display:flex;gap:10px;margin-top:10px;">
                    <button class="btn" style="flex:1;background:#f0fdf4;color:#16a34a;font-size:12px;padding:10px;" onclick="exportWordsToCSV()">üìÑ ÂçïËØç</button>
                    <button class="btn" style="flex:1;background:#f0f9ff;color:#0284c7;font-size:12px;padding:10px;" onclick="exportHistoryToCSV()">üìà ÂéÜÂè≤</button>
                </div>
                
                <div class="sync-status">
                    <div class="sync-dot synced" id="syncDot"></div>
                    <span id="syncText">Êï∞ÊçÆÂ∑≤Ëá™Âä®ÂêåÊ≠•Âà∞Êú¨Âú∞Â≠òÂÇ®</span>
                </div>
                
                <button class="btn" style="width:100%;margin-top:12px;background:#fff1f0;color:#ff4d4f;" onclick="clearAllData()">üóëÔ∏è Ê∏ÖÁ©∫ÊâÄÊúâÊï∞ÊçÆ</button>
                
                <h3 style="margin-top:24px;">üìà Â≠¶‰π†ÁªüËÆ°</h3>
                <div style="margin-top:12px;padding:15px;background:#f9f9f9;border-radius:12px;">
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;font-size:12px;">
                        <div style="text-align:center;"><div style="font-weight:bold;font-size:16px;color:#667eea;" id="statTotalWords">${words.length}</div><div style="color:#999;">ÂçïËØçÊÄªÊï∞</div></div>
                        <div style="text-align:center;"><div style="font-weight:bold;font-size:16px;color:#10b981;" id="statFavorites">${favorites.length}</div><div style="color:#999;">Êî∂ËóèÊï∞</div></div>
                        <div style="text-align:center;"><div style="font-weight:bold;font-size:16px;color:#f59e0b;" id="statWrong">${wrongWords.length}</div><div style="color:#999;">ÈîôÈ¢òÊï∞</div></div>
                        <div style="text-align:center;"><div style="font-weight:bold;font-size:16px;color:#8b5cf6;" id="statNotes">${Object.keys(JSON.parse(localStorage.getItem('wordAI_wordNotes') || '{}')).length}</div><div style="color:#999;">Á¨îËÆ∞Êï∞</div></div>
                    </div>
                </div>
                
                <h3 style="margin-top:24px;">üìñ ‰ΩøÁî®Â∏ÆÂä©</h3>
                <div style="margin-top:12px;padding:15px;background:#f0f7ff;border-radius:12px;font-size:12px;line-height:1.8;">
                    <div><b>üéØ ÊØèÊó•ÊåëÊàò</b>ÔºöÂÆåÊàêÊØèÊó•Â≠¶‰π†ÁõÆÊ†áËé∑ÂæóÂæΩÁ´†</div>
                    <div><b>‚å®Ô∏è Âø´Êç∑ÈîÆ</b>Ôºö1‰∏çËÆ§ËØÜ 2Âõ∞Èöæ 3ËÆ§ËØÜ Á©∫Ê†ºÂèëÈü≥</div>
                    <div><b>üìä Â§ç‰π†</b>ÔºöÂü∫‰∫éËâæÂÆæÊµ©ÊñØÈÅóÂøòÊõ≤Á∫ø</div>
                    <div><b>‚≠ê Êî∂Ëóè</b>ÔºöÊåâPÊî∂ËóèÂΩìÂâçÂçïËØç</div>
                    <div><b>üèÜ ÊéíË°åÊ¶ú</b>Ôºö‰∏éÂÖ®ÂõΩÂ≠¶‰π†ËÄÖÊØîÊãº</div>
                    <div style="margin-top:10px;color:#667eea;"><b>üí° ÊèêÁ§∫</b>ÔºöÊï∞ÊçÆËá™Âä®‰øùÂ≠òÂú®Êú¨Âú∞</div>
                </div>
            </div>
        </div>

        <!-- Êî∂ËóèÂçïËØç -->
        <div class="tab-content" id="tab-favorites">
            <div class="collection-tabs">
                <div class="collection-tab active" onclick="switchCollectionTab('favorites')">‚ù§Ô∏è Êî∂ËóèÊú¨</div>
                <div class="collection-tab" onclick="switchCollectionTab('wrong')">‚ùå ÈîôÈ¢òÊú¨</div>
            </div>
            <div style="padding:10px;">
                <input type="text" id="wordSearchInput" placeholder="üîç ÊêúÁ¥¢ÂçïËØç..." onkeyup="quickSearch(this.value)" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;font-size:14px;">
            </div>
            <div id="collectionList"></div>
        </div>

        <!-- ÈîôÈ¢òÊú¨ -->
        <div class="tab-content" id="tab-wrongbook">
            <div class="collection-header">
                <span>‚ùå ÈîôÈ¢òÊú¨</span>
                <span id="wrongCount" style="font-size:12px;color:#999;">0 È¢ò</span>
            </div>
            <div style="padding:15px;">
                <button class="btn btn-primary" style="width:100%;margin-bottom:15px;" onclick="practiceWrongWords()">üîÑ ÈáçÊñ∞ÁªÉ‰π†ÈîôÈ¢ò</button>
            </div>
            <div id="wrongList"></div>
        </div>

        <!-- ÊèêÈÜíËÆæÁΩÆ -->
        <div class="tab-content" id="tab-reminder">
            <div class="reminder-settings">
                <div class="reminder-item">
                    <span class="reminder-label">üîî Â≠¶‰π†ÊèêÈÜí</span>
                    <div class="reminder-toggle" id="reminderToggle" onclick="toggleReminder()"></div>
                </div>
                <div class="reminder-item">
                    <span class="reminder-label">‚è∞ ÊèêÈÜíÊó∂Èó¥</span>
                    <input type="time" id="reminderTime" value="09:00" style="padding:8px;border:1px solid #ddd;border-radius:8px;">
                </div>
                <div class="reminder-item">
                    <span class="reminder-label">üîÑ ÈáçÂ§ç</span>
                    <select id="reminderRepeat" style="padding:8px;border:1px solid #ddd;border-radius:8px;">
                        <option value="daily">ÊØèÂ§©</option>
                        <option value="weekday">Â∑•‰ΩúÊó•</option>
                    </select>
                </div>
                <button class="btn btn-primary" style="width:100%;margin-top:20px;" onclick="saveReminder()">‰øùÂ≠òËÆæÁΩÆ</button>
            </div>
        </div>

        <div class="tab-content" id="tab-history">
            <div class="history-list" id="historyList">
                <div class="empty-state">ÊöÇÊó†Â≠¶‰π†ËÆ∞ÂΩï</div>
            </div>
        </div>

        <!-- Â≠¶‰π†ËÆ°Âàí -->
        <div class="tab-content" id="tab-plan">
            <div class="review-plan">
                <div style="font-size:16px;font-weight:600;margin-bottom:15px;">üìÖ Â§ç‰π†ËÆ°Âàí</div>
                <div class="smart-suggestion">
                    <div class="suggestion-title">üí° Êô∫ËÉΩÂ≠¶‰π†Âª∫ËÆÆ</div>
                    <div id="smartSuggestions"></div>
                </div>
                <div style="margin-top:15px;">
                    <div style="font-size:14px;font-weight:600;margin-bottom:10px;">üìä Êú™Êù•7Â§©Â§ç‰π†ÂÆâÊéí</div>
                    <div class="review-timeline" id="reviewTimeline"></div>
                </div>
                <div style="margin-top:15px;display:flex;justify-content:space-around;">
                    <div class="goal-ring" id="goalRing">
                        <svg width="100" height="100">
                            <circle cx="50" cy="50" r="42" class="bg"/>
                            <circle cx="50" cy="50" r="42" class="progress" stroke-dasharray="264" stroke-dashoffset="264"/>
                        </svg>
                        <div class="goal-ring-text">
                            <div class="goal-ring-value" id="goalPercent">0%</div>
                            <div class="goal-ring-label">‰ªäÊó•ÁõÆÊ†á</div>
                        </div>
                    </div>
                    <div style="text-align:center;padding-top:20px;">
                        <div style="font-size:14px;color:#666;margin-bottom:8px;">üéØ ‰∏ìÊ≥®Ê®°Âºè</div>
                        <button class="btn btn-primary" onclick="startFocusMode()" style="width:100%;">ÂºÄÂßã‰∏ìÊ≥®</button>
                        <p style="font-size:11px;color:#999;margin-top:8px;">Áï™ËåÑÂ∑•‰ΩúÊ≥ïÔºå25ÂàÜÈíü‰∏ìÊ≥®Â≠¶‰π†</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‰∏ìÊ≥®Ê®°ÂºèÈÅÆÁΩ© -->
        <div class="focus-mode" id="focusMode">
            <button class="focus-exit" onclick="exitFocusMode()">‚úï ÈÄÄÂá∫</button>
            <div style="font-size:24px;margin-bottom:10px;">üéØ ‰∏ìÊ≥®Â≠¶‰π†‰∏≠</div>
            <div class="focus-timer" id="focusTimer">25:00</div>
            <div class="focus-stats">
                <div class="focus-stat">
                    <div class="focus-stat-value" id="focusWords">0</div>
                    <div class="focus-stat-label">Â∑≤Â≠¶ÂçïËØç</div>
                </div>
                <div class="focus-stat">
                    <div class="focus-stat-value" id="focusCorrect">0</div>
                    <div class="focus-stat-label">Ê≠£Á°ÆÊï∞</div>
                </div>
                <div class="focus-stat">
                    <div class="focus-stat-value" id="focusTime">0</div>
                    <div class="focus-stat-label">ÂàÜÈíü</div>
                </div>
            </div>
            <div style="font-size:14px;opacity:0.8;margin-top:20px;">‰øùÊåÅ‰∏ìÊ≥®ÔºåÊãíÁªùÂπ≤Êâ∞</div>
        </div>

        <!-- Â≠¶‰π†ÊèêÈÜíÊµÆÁ™ó -->
        <div class="study-reminder" id="studyReminder">
            <span class="reminder-icon">üîî</span>
            <span class="reminder-text" id="reminderText">ÊòØÊó∂ÂÄôÂ≠¶‰π†‰∫ÜÔºÅ</span>
            <button class="reminder-close" onclick="dismissReminder()">‚úï</button>
        </div>

        <!-- ËØç‰π¶ÂàÜÁ±ª -->
        <div class="tab-content" id="tab-books">
            <div class="book-grid" id="bookGrid"></div>
            <div style="padding:16px;">
                <div style="font-size:14px;font-weight:600;margin-bottom:12px;">üìñ ÈÅóÂøòÊõ≤Á∫øÔºàËâæÂÆæÊµ©ÊñØÔºâ</div>
                <div class="forgetting-curve">
                    <div class="curve-container" id="forgettingCurve"></div>
                    <div class="curve-legend">
                        <div class="curve-legend-item"><div class="curve-legend-dot" style="background:#667eea"></div>ËÆ∞ÂøÜ‰øùÊåÅÁéá</div>
                        <div class="curve-legend-item"><div class="curve-legend-dot" style="background:#10b981"></div>ÊúÄ‰Ω≥Â§ç‰π†ÁÇπ</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÂçïËØçÊåëÊàòËµõÔºàÂçïÊú∫Ôºâ -->
        <div class="tab-content" id="tab-arena">
            <div class="challenge-arena">
                <div class="arena-header">
                    <div style="font-size:16px;font-weight:600;">‚öîÔ∏è ÂçïËØçÊåëÊàòËµõ</div>
                    <span style="font-size:11px;background:#f0f0f0;padding:4px 8px;border-radius:4px;">ÂçïÊú∫Ê®°Âºè</span>
                </div>
                <div id="arenaStartScreen">
                    <div style="text-align:center;padding:40px 20px;">
                        <div style="font-size:64px;margin-bottom:20px;">üèÜ</div>
                        <div style="font-size:18px;font-weight:600;margin-bottom:10px;">ÊåëÊàò‰Ω†ÁöÑÊûÅÈôê</div>
                        <div style="font-size:14px;color:#666;margin-bottom:30px;">60ÁßíÂÜÖÂõûÁ≠îÂ∞ΩÂèØËÉΩÂ§öÁöÑÂçïËØç<br><span style="font-size:12px;color:#999;">ÂçïÊú∫ÁªÉ‰π†Ê®°Âºè</span></div>
                        <button class="btn btn-primary" style="width:200px;font-size:16px;" onclick="startArena()">ÂºÄÂßãÊåëÊàò</button>
                    </div>
                </div>
                <div id="arenaGame" style="display:none;">
                    <div class="arena-timer" id="arenaTimer">60</div>
                    <div class="arena-score">
                        <div class="arena-score-item">
                            <div class="arena-score-value" id="arenaCorrect" style="color:#52C41A;">0</div>
                            <div class="arena-score-label">Ê≠£Á°Æ</div>
                        </div>
                        <div class="arena-score-item">
                            <div class="arena-score-value" id="arenaWrong" style="color:#ef4444;">0</div>
                            <div class="arena-score-label">ÈîôËØØ</div>
                        </div>
                        <div class="arena-score-item">
                            <div class="arena-score-value" id="arenaTotal">0</div>
                            <div class="arena-score-label">ÊÄªÂàÜ</div>
                        </div>
                    </div>
                    <div class="arena-question">
                        <div class="arena-word" id="arenaWord">-</div>
                        <div style="font-size:14px;color:#666;margin-bottom:15px;">ÈÄâÊã©Ê≠£Á°ÆÁöÑ‰∏≠ÊñáÈáä‰πâ</div>
                        <div class="arena-options" id="arenaOptions"></div>
                    </div>
                </div>
                <div id="arenaResult" style="display:none;text-align:center;padding:30px;">
                    <div style="font-size:48px;margin-bottom:20px;">üéâ</div>
                    <div style="font-size:24px;font-weight:bold;margin-bottom:20px;">ÊåëÊàòÁªìÊùüÔºÅ</div>
                    <div style="display:flex;justify-content:space-around;margin:30px 0;">
                        <div><div style="font-size:32px;font-weight:bold;color:#52C41A;" id="resultCorrect">0</div><div style="font-size:12px;color:#666;">Ê≠£Á°Æ</div></div>
                        <div><div style="font-size:32px;font-weight:bold;color:#667eea;" id="resultAccuracy">0%</div><div style="font-size:12px;color:#666;">Ê≠£Á°ÆÁéá</div></div>
                        <div><div style="font-size:32px;font-weight:bold;color:#f59e0b;" id="resultScore">0</div><div style="font-size:12px;color:#666;">ÂæóÂàÜ</div></div>
                    </div>
                    <button class="btn btn-primary" style="width:200px;" onclick="startArena()">ÂÜçÊàò‰∏ÄÊ¨°</button>
                </div>
            </div>
        </div>

        <!-- ÂçïËØçÈóØÂÖ≥ -->
        <div class="tab-content" id="tab-level">
            <div class="level-game">
                <div style="font-size:16px;font-weight:600;margin-bottom:15px;">üéÆ ÂçïËØçÈóØÂÖ≥</div>
                
                <div class="report-card">
                    <div style="display:flex;justify-content:space-between;align-items:center;">
                        <div>
                            <div style="font-size:14px;">ÂΩìÂâçÁ≠âÁ∫ß</div>
                            <div style="font-size:24px;font-weight:bold;color:#667eea;" id="currentLevel">Lv.1</div>
                        </div>
                        <div style="text-align:right;">
                            <div style="font-size:14px;">ÁªèÈ™åÂÄº</div>
                            <div style="font-size:18px;font-weight:bold;" id="currentExp">0</div>
                        </div>
                    </div>
                    <div class="level-progress">
                        <div class="level-progress-fill" id="expProgress" style="width:0%"></div>
                    </div>
                    <div style="font-size:12px;color:#666;text-align:center;">Ë∑ùÁ¶ª‰∏ã‰∏ÄÁ∫ßËøòÈúÄ <span id="expNeeded">100</span> ÁªèÈ™å</div>
                </div>
                
                <div style="margin:20px 0;">
                    <div style="font-size:14px;font-weight:600;margin-bottom:10px;">ÂÖ≥Âç°ÈÄâÊã©</div>
                    <div id="levelList"></div>
                </div>
                
                <button class="btn btn-primary" style="width:100%;margin-top:15px;" onclick="startLevelChallenge()">ÂºÄÂßãÈóØÂÖ≥</button>
            </div>
        </div>

        <!-- ÂçïËØçÊ∏∏Êàè -->
        <div class="tab-content" id="tab-game">
            <div class="pair-game">
                <div style="font-size:16px;font-weight:600;margin-bottom:15px;">üÉè ÂçïËØçÈÖçÂØπ</div>
                
                <div id="pairGameStart">
                    <div style="text-align:center;padding:40px 20px;">
                        <div style="font-size:64px;margin-bottom:20px;">üÉè</div>
                        <div style="font-size:18px;font-weight:600;margin-bottom:10px;">ÂçïËØçÈÖçÂØπÊ∏∏Êàè</div>
                        <div style="font-size:14px;color:#666;margin-bottom:30px;">ÊâæÂá∫ÂçïËØçÂíåÈáä‰πâÁöÑÂØπÂ∫îÂÖ≥Á≥ª</div>
                        <button class="btn btn-primary" style="width:200px;font-size:16px;" onclick="startPairGame()">ÂºÄÂßãÊ∏∏Êàè</button>
                    </div>
                </div>
                
                <div id="pairGameBoard" style="display:none;">
                    <div style="display:flex;justify-content:space-between;margin-bottom:15px;">
                        <span>‚è±Ô∏è <span id="pairTimer">0</span>Áßí</span>
                        <span>‚ù§Ô∏è <span id="pairLives">3</span></span>
                    </div>
                    <div class="pair-grid" id="pairGrid"></div>
                    <div style="text-align:center;margin-top:15px;">
                        <button class="btn" onclick="startPairGame()">ÈáçÊñ∞ÂºÄÂßã</button>
                    </div>
                </div>
                
                <div id="pairGameResult" style="display:none;text-align:center;padding:30px;">
                    <div style="font-size:48px;margin-bottom:20px;">üéâ</div>
                    <div style="font-size:24px;font-weight:bold;margin-bottom:20px;">Ê∏∏ÊàèÁªìÊùüÔºÅ</div>
                    <div style="font-size:18px;margin-bottom:30px;">Áî®Êó∂: <span id="pairResultTime">0</span>Áßí</div>
                    <button class="btn btn-primary" style="width:200px;" onclick="startPairGame()">ÂÜçÊù•‰∏ÄÂ±Ä</button>
                </div>
            </div>
            
            <!-- ÊãºÂÜôÊåëÊàò -->
            <div style="padding:16px;border-top:1px solid #eee;margin-top:10px;">
                <div style="font-size:16px;font-weight:600;margin-bottom:15px;">‚úçÔ∏è ÊãºÂÜôÊåëÊàò</div>
                <div id="spellingChallenge">
                    <div style="text-align:center;padding:20px;">
                        <div style="font-size:48px;margin-bottom:15px;">‚úçÔ∏è</div>
                        <div style="font-size:14px;color:#666;margin-bottom:20px;">Âê¨Èü≥ÊãºÂÜôÂçïËØç</div>
                        <button class="btn btn-primary" style="width:180px;" onclick="startSpellingChallenge()">ÂºÄÂßãÊåëÊàò</button>
                    </div>
                </div>
                <div id="spellingGame" style="display:none;">
                    <div style="text-align:center;margin-bottom:20px;">
                        <div style="font-size:14px;color:#666;margin-bottom:10px;">ËØ∑ÊãºÂÜô‰ª•‰∏ãÂçïËØç:</div>
                        <div style="font-size:24px;font-weight:bold;margin-bottom:10px;" id="spellingWord">-</div>
                        <button class="btn" style="background:#667eea;color:white;" onclick="playSpellingWord()">üîä Êí≠ÊîæÂèëÈü≥</button>
                    </div>
                    <input type="text" id="spellingInput" placeholder="ËæìÂÖ•ÂçïËØçÊãºÂÜô..." style="width:100%;padding:12px;border:1px solid #ddd;border-radius:8px;font-size:16px;margin-bottom:10px;text-align:center;" onkeypress="if(event.key==='Enter')checkSpelling()">
                    <div style="text-align:center;">
                        <button class="btn btn-primary" style="width:100%;" onclick="checkSpelling()">Êèê‰∫§</button>
                    </div>
                    <div id="spellingResult" style="text-align:center;margin-top:15px;font-size:16px;font-weight:bold;"></div>
                    <div style="text-align:center;margin-top:10px;">
                        <button class="btn" style="background:#666;color:white;" onclick="endSpellingChallenge()">ÈÄÄÂá∫</button>
                    </div>
                </div>
            </div>
            
            <div style="padding:16px;">
                <div style="font-size:16px;font-weight:600;margin-bottom:15px;">üéØ Â≠¶‰π†ÁõÆÊ†á</div>
                <div class="goal-setting">
                    <div class="goal-item">
                        <div class="goal-label">ÊØèÊó•ÂçïËØçÁõÆÊ†á</div>
                        <div class="goal-value" id="dailyGoalDisplay">10</div>
                    </div>
                    <div class="goal-item">
                        <div class="goal-label">ÂΩìÂâçËøûÁª≠Â§©Êï∞</div>
                        <div class="goal-value" id="streakGoalDisplay">0</div>
                    </div>
                    <div class="goal-item">
                        <div class="goal-label">‰ªäÊó•Â∑≤Â≠¶</div>
                        <div class="goal-value" id="todayGoalDisplay">0</div>
                    </div>
                    <button class="btn btn-primary" style="width:100%;margin-top:15px;" onclick="showGoalSettings()">‰øÆÊîπÁõÆÊ†á</button>
                </div>
            </div>
            
            <div style="padding:16px;">
                <div style="font-size:16px;font-weight:600;margin-bottom:15px;">üé§ ËØ≠Èü≥Êåá‰ª§</div>
                <div style="text-align:center;">
                    <button class="voice-btn" id="voiceBtn" onclick="toggleVoiceInput()">üé§</button>
                    <div style="font-size:14px;color:#666;margin-top:10px;">Êåâ‰ΩèËØ¥ËØùÊü•ÂçïËØç</div>
                </div>
            </div>
        </div>

        <!-- AI Âä©Êâã -->
        <div class="tab-content" id="tab-ai">
            <div class="ai-assistant">
                <div style="font-size:16px;font-weight:600;margin-bottom:15px;">ü§ñ AI Â≠¶‰π†Âä©Êâã</div>
                <div class="ai-messages" id="aiMessages">
                    <div class="ai-message ai">
                        <div class="ai-avatar">ü§ñ</div>
                        <div class="ai-bubble">
                            ‰Ω†Â•ΩÔºÅÊàëÊòØAIÂ≠¶‰π†Âä©ÊâãÔºåÊúâ‰ªÄ‰πàÂèØ‰ª•Â∏ÆÂä©‰Ω†ÁöÑÂêóÔºü
                        </div>
                    </div>
                </div>
                <div class="ai-input-container">
                    <input type="text" class="ai-input" id="aiInput" placeholder="ÈóÆÊàë‰ªª‰ΩïÂÖ≥‰∫éÂ≠¶‰π†ÁöÑÈóÆÈ¢ò..." onkeypress="if(event.key==='Enter')sendAIMessage()">
                    <button class="ai-send-btn" onclick="sendAIMessage()">‚û§</button>
                </div>
                <div style="margin-top:15px;">
                    <div style="font-size:12px;color:#999;margin-bottom:10px;">üí° ËØïËØïËøôÊ†∑ÈóÆÔºö</div>
                    <div style="display:flex;flex-wrap:wrap;gap:8px;">
                        <button class="btn" style="font-size:12px;padding:8px 12px;background:#f0f7ff;color:#667eea;" onclick="askAI('ÊÄé‰πàÂø´ÈÄüËÉåÂçïËØçÔºü')">ÊÄé‰πàÂø´ÈÄüËÉåÂçïËØçÔºü</button>
                        <button class="btn" style="font-size:12px;padding:8px 12px;background:#f0f7ff;color:#667eea;" onclick="askAI('ÊàëÁöÑÂçïËØçÈáèÂ§Ñ‰∫é‰ªÄ‰πàÊ∞¥Âπ≥Ôºü')">ÊàëÁöÑÊ∞¥Âπ≥Â¶Ç‰ΩïÔºü</button>
                        <button class="btn" style="font-size:12px;padding:8px 12px;background:#f0f7ff;color:#667eea;" onclick="askAI('‰ªäÂ§©ËØ•Â§ç‰π†‰ªÄ‰πàÔºü')">‰ªäÂ§©ËØ•Â§ç‰π†‰ªÄ‰πàÔºü</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Â≠¶‰π†ÂàÜÊûê -->
        <div class="tab-content" id="tab-analysis">
            <div style="padding:16px;">
                <div style="font-size:16px;font-weight:600;margin-bottom:15px;">üìä Â≠¶‰π†Êï∞ÊçÆÂàÜÊûê</div>
                
                <div class="efficiency-gauge" id="efficiencyGauge">
                    <svg width="150" height="150" viewBox="0 0 150 150">
                        <circle cx="75" cy="75" r="60" class="gauge-bg"/>
                        <circle cx="75" cy="75" r="60" class="gauge-fill" id="efficiencyFill" stroke="#667eea" stroke-dasharray="0 377"/>
                    </svg>
                    <div class="gauge-text">
                        <div class="gauge-value" id="efficiencyValue">0%</div>
                        <div class="gauge-label">Â≠¶‰π†ÊïàÁéá</div>
                    </div>
                </div>
                
                <div class="error-insight">
                    <div class="insight-title">üí° Â≠¶‰π†Ê¥ûÂØü</div>
                    <div id="learningInsights"></div>
                </div>
                
                <div class="error-insight">
                    <div class="insight-title">üìà ÈîôÈ¢òÂàÜÊûê</div>
                    <div class="error-chart" id="errorChart"></div>
                    <div style="font-size:11px;color:#999;text-align:center;margin-top:10px;">Êú¨Âë®ÈîôÈ¢òÂàÜÂ∏É</div>
                </div>
                
                <div style="font-size:14px;font-weight:600;margin:15px 0;">üèÜ Â≠¶‰π†ÈáåÁ®ãÁ¢ë</div>
                <div class="milestone-timeline" id="milestoneTimeline"></div>
            </div>
        </div>

        <!-- ÊéíË°åÊ¶úÔºàÊú¨Âú∞Ôºâ -->
        <div class="tab-content" id="tab-rank">
            <div class="profile-header">
                <div class="profile-avatar">üìä</div>
                <div class="profile-name">ÊàëÁöÑÂ≠¶‰π†ËÆ∞ÂΩï</div>
                <div class="profile-level">‰∏™‰∫∫Â≠¶‰π†Êï∞ÊçÆÁªüËÆ°</div>
            </div>
            
            <div style="padding:20px;text-align:center;color:#666;">
                <p>üìà ËøôÊòØÊÇ®‰∏™‰∫∫ÁöÑÂ≠¶‰π†ËÆ∞ÂΩï</p>
                <p style="font-size:12px;color:#999;">ËÅîÁΩëÂäüËÉΩÂºÄÂèë‰∏≠ÔºåÂÆåÊàêÂêéÂ∞ÜÊîØÊåÅÂÖ®ÂõΩÊéíË°åÊ¶ú</p>
            </div>
            <div class="rank-tabs" style="display:flex;background:white;padding:10px;border-bottom:1px solid #eee;">
                <div class="rank-tab active" onclick="switchRankTab('total')" style="flex:1;text-align:center;padding:8px;cursor:pointer;border-radius:8px;background:#667eea;color:white;">ÊÄªÊ¶ú</div>
                <div class="rank-tab" onclick="switchRankTab('streak')" style="flex:1;text-align:center;padding:8px;cursor:pointer;border-radius:8px;">ËøûËÉúÊ¶ú</div>
                <div class="rank-tab" onclick="switchRankTab('today')" style="flex:1;text-align:center;padding:8px;cursor:pointer;border-radius:8px;">‰ªäÊó•Ê¶ú</div>
            </div>
            <div id="rankList" style="padding:10px;max-height:400px;overflow-y:auto;"></div>
            <div style="padding:20px;text-align:center;">
                <p style="font-size:12px;color:#999;">üì¢ ÊéíË°åÊ¶úÊï∞ÊçÆÂü∫‰∫éÊú¨Âú∞Â≠òÂÇ®ÔºåÂ≠¶‰π†Êï∞ÊçÆË∂äÂ§öÊéíÂêçË∂äÂáÜÁ°ÆÔºÅ</p>
            </div>
        </div>

        <div class="stats" id="quickStats" style="display:none;"></div>
        
        <!-- ÊØèÊó•‰∏ÄËØç -->
        <div id="wordOfDay" style="padding:10px 15px;"></div>
        
        <div class="stats">
            <div class="stat-item"><div class="stat-value" id="total">0</div><div class="stat-label">Â∑≤Â≠¶‰π†</div></div>
            <div class="stat-item"><div class="stat-value" id="correct">0</div><div class="stat-label">Ê≠£Á°Æ</div></div>
            <div class="stat-item"><div class="stat-value" id="streak">0</div><div class="stat-label">ËøûÁª≠</div></div>
            <div class="stat-item"><div class="stat-value" id="accuracy">0%</div><div class="stat-label">Ê≠£Á°ÆÁéá</div></div>
        </div>
        
        <!-- Â∫ïÈÉ®Âø´Êç∑Êìç‰ΩúÊ†è -->
        <div class="quick-bar">
            <div class="quick-bar-item" onclick="showTab('tab-learn')">
                <span class="quick-bar-icon">üìö</span>
                <span class="quick-bar-label">ËÉåÂçïËØç</span>
            </div>
            <div class="quick-bar-item" onclick="showTab('tab-review')">
                <span class="quick-bar-icon">üìù</span>
                <span class="quick-bar-label">Â§ç‰π†</span>
            </div>
            <div class="quick-bar-item" onclick="showTab('tab-challenge')">
                <span class="quick-bar-icon">üéØ</span>
                <span class="quick-bar-label">ÊåëÊàò</span>
            </div>
            <div class="quick-bar-item" onclick="showTab('tab-plan')">
                <span class="quick-bar-icon">‚è±Ô∏è</span>
                <span class="quick-bar-label">‰∏ìÊ≥®</span>
            </div>
            <div class="quick-bar-item" onclick="showTab('tab-profile')">
                <span class="quick-bar-icon">üë§</span>
                <span class="quick-bar-label">ÊàëÁöÑ</span>
            </div>
        </div>
        
        <!-- ÊµÆÂä®ÊåâÈíÆ -->
        <button class="fab" onclick="showQuickActions()">‚ö°</button>
    </div>

    <script>
        // ====== ÈÖçÁΩÆ ======
        // ÁªèÈ™åÂÄºÁ≥ªÁªüÈÖçÁΩÆ
        const expConfig = {
            perWord: 10, // ÊØè‰∏™ÂçïËØç10ÁªèÈ™åÂÄº
            perQuiz: 5, // ÊØèÈÅìÈ¢ò5ÁªèÈ™åÂÄº
            perStreak: 20, // ËøûÁª≠ÊâìÂç°ÊØèÂ§©20ÁªèÈ™åÂÄº
            levelThresholds: [0, 100, 300, 600, 1000, 1500, 2200, 3000, 4000, 5500], // ÂêÑÁ∫ßÂà´ÊâÄÈúÄÁªèÈ™å
            levelNames: ['ÂàùÂ≠¶ËÄÖ', 'ÂÖ•Èó®', 'ËøõÈò∂', 'ÁÜüÁªÉ', 'Á≤æÈÄö', '‰∏ìÂÆ∂', 'Â§ßÂ∏à', 'ÁéãËÄÖ', '‰º†Â•á', 'Á•ûËØù']
        };
        
        // ====== Â∑•ÂÖ∑ÂáΩÊï∞ ======
        // Èò≤ÊäñÂáΩÊï∞ - ÈôêÂà∂ÂáΩÊï∞ÊâßË°åÈ¢ëÁéá
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // ËäÇÊµÅÂáΩÊï∞ - Á°Æ‰øùÂáΩÊï∞Âú®ÊåáÂÆöÊó∂Èó¥Èó¥ÈöîÂÜÖÊúÄÂ§öÊâßË°å‰∏ÄÊ¨°
        function throttle(func, limit) {
            let inThrottle;
            return function(...args) {
                if (!inThrottle) {
                    func.apply(this, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            };
        }
        
        // Áî®Êà∑ÁªèÈ™åÂÄºÊï∞ÊçÆ
        // ====== Storage Â∑•ÂÖ∑Á±ªÂ¢ûÂº∫Áâà ======
        const Storage = {
            prefix: 'wordAI_',
            get(key, defaultValue = null) {
                try {
                    const value = localStorage.getItem(this.prefix + key);
                    return value ? JSON.parse(value) : defaultValue;
                } catch (e) {
                    console.error('Storage get error:', e);
                    return defaultValue;
                }
            },
            set(key, value) {
                try {
                    localStorage.setItem(this.prefix + key, JSON.stringify(value));
                    return true;
                } catch (e) {
                    console.error('Storage set error:', e);
                    return false;
                }
            },
            remove(key) {
                localStorage.removeItem(this.prefix + key);
            },
            getString(key, defaultValue = '') {
                return localStorage.getItem(this.prefix + key) || defaultValue;
            },
            getNumber(key, defaultValue = 0) {
                const value = localStorage.getItem(this.prefix + key);
                return value ? parseFloat(value) : defaultValue;
            },
            getBoolean(key, defaultValue = false) {
                const value = localStorage.getItem(this.prefix + key);
                return value === 'true' ? true : (value === 'false' ? false : defaultValue);
            },
            // Ëé∑ÂèñÂ≠òÂÇ®Á©∫Èó¥‰ΩøÁî®ÊÉÖÂÜµ
            getStorageUsage() {
                let total = 0;
                for (let key in localStorage) {
                    if (localStorage.hasOwnProperty(key) && key.startsWith(this.prefix)) {
                        total += localStorage[key].length + key.length;
                    }
                }
                return {
                    used: total,
                    usedKB: (total / 1024).toFixed(2),
                    usedMB: (total / 1024 / 1024).toFixed(2)
                };
            },
            // È™åËØÅÊï∞ÊçÆÂÆåÊï¥ÊÄß
            validate(key) {
                try {
                    const value = localStorage.getItem(this.prefix + key);
                    if (!value) return { valid: false, reason: 'not_found' };
                    JSON.parse(value);
                    return { valid: true };
                } catch (e) {
                    return { valid: false, reason: 'corrupted', error: e.message };
                }
            },
            // ÊâπÈáèËé∑ÂèñÂ§ö‰∏™ÈîÆÂÄº
            getMultiple(keys) {
                const result = {};
                keys.forEach(key => {
                    result[key] = this.get(key);
                });
                return result;
            },
            // ÊâπÈáèËÆæÁΩÆÂ§ö‰∏™ÈîÆÂÄº
            setMultiple(data) {
                let success = true;
                Object.keys(data).forEach(key => {
                    if (!this.set(key, data[key])) {
                        success = false;
                    }
                });
                return success;
            },
            // Ê∏ÖÈô§ÊâÄÊúâÂ∫îÁî®Êï∞ÊçÆ
            clearAll() {
                const keys = [];
                for (let key in localStorage) {
                    if (localStorage.hasOwnProperty(key) && key.startsWith(this.prefix)) {
                        keys.push(key);
                    }
                }
                keys.forEach(key => localStorage.removeItem(key));
                return keys.length;
            }
        };
        
        let userExp = {
            total: 0,
            level: 1,
            todayExp: 0
        };
        
        const MINIMAX_API_KEY = Storage.getString('apiKey', '');
        const MINIMAX_BASE_URL = 'https://api.minimax.chat/v1';
        
        // ====== ÂçïËØçÂ∫ì ======
        const defaultWords = [
            // Âü∫Á°ÄÁ∫ß - ÁßëÊäÄËØçÊ±á
            { word: "variable", phonetic: "/Ààve…ôri…ôbl/", meaning: "n. ÂèòÈáè", level: "beginner" },
            { word: "debug", phonetic: "/diÀêÀàb å…°/", meaning: "v. Ë∞ÉËØï", level: "beginner" },
            { word: "network", phonetic: "/Àànetw…úÀêrk/", meaning: "n. ÁΩëÁªú", level: "beginner" },
            { word: "server", phonetic: "/Ààs…úÀêrv…ôr/", meaning: "n. ÊúçÂä°Âô®", level: "beginner" },
            { word: "client", phonetic: "/Ààkla…™…ônt/", meaning: "n. ÂÆ¢Êà∑Á´Ø", level: "beginner" },
            { word: "machine", phonetic: "/m…ôÀà ÉiÀên/", meaning: "n. Êú∫Âô®", level: "beginner" },
            { word: "data", phonetic: "/Ààde…™t…ô/", meaning: "n. Êï∞ÊçÆ", level: "beginner" },
            { word: "code", phonetic: "/ko äd/", meaning: "n. ‰ª£Á†Å", level: "beginner" },
            { word: "bug", phonetic: "/b å…°/", meaning: "n. Áº∫Èô∑", level: "beginner" },
            { word: "web", phonetic: "/web/", meaning: "n. ÁΩëÈ°µ", level: "beginner" },
            // Âü∫Á°ÄÁ∫ß - Êó•Â∏∏ËØçÊ±á
            { word: "hello", phonetic: "/h…ôÀàlo ä/", meaning: "int. ‰Ω†Â•Ω", level: "beginner" },
            { word: "world", phonetic: "/w…úÀêrld/", meaning: "n. ‰∏ñÁïå", level: "beginner" },
            { word: "water", phonetic: "/Ààw…îÀêt…ôr/", meaning: "n. Ê∞¥", level: "beginner" },
            { word: "food", phonetic: "/fuÀêd/", meaning: "n. È£üÁâ©", level: "beginner" },
            { word: "book", phonetic: "/b äk/", meaning: "n. ‰π¶", level: "beginner" },
            { word: "school", phonetic: "/skuÀêl/", meaning: "n. Â≠¶Ê†°", level: "beginner" },
            { word: "friend", phonetic: "/frend/", meaning: "n. ÊúãÂèã", level: "beginner" },
            { word: "family", phonetic: "/Ààf√¶m…ôli/", meaning: "n. ÂÆ∂Â∫≠", level: "beginner" },
            { word: "time", phonetic: "/ta…™m/", meaning: "n. Êó∂Èó¥", level: "beginner" },
            { word: "money", phonetic: "/Ààm åni/", meaning: "n. Èí±", level: "beginner" },
            // ‰∏≠Á∫ß - ÁßëÊäÄËØçÊ±á
            { word: "database", phonetic: "/Ààde…™t…ôbe…™s/", meaning: "n. Êï∞ÊçÆÂ∫ì", level: "intermediate" },
            { word: "function", phonetic: "/Ààf å≈ãk É…ôn/", meaning: "n. ÂäüËÉΩÔºõÂáΩÊï∞", level: "intermediate" },
            { word: "interface", phonetic: "/Àà…™nt…ôfe…™s/", meaning: "n. ÁïåÈù¢ÔºõÊé•Âè£", level: "intermediate" },
            { word: "framework", phonetic: "/Ààfre…™mw…úÀêk/", meaning: "n. Ê°ÜÊû∂", level: "intermediate" },
            { word: "execute", phonetic: "/Ààeks…™kjuÀêt/", meaning: "v. ÊâßË°å", level: "intermediate" },
            { word: "artificial", phonetic: "/Àå…ëÀêrt…™Ààf…™ Él/", meaning: "adj. ‰∫∫Â∑•ÁöÑ", level: "intermediate" },
            { word: "intelligence", phonetic: "/…™nÀàtel…™d í…ôns/", meaning: "n. Êô∫ËÉΩ", level: "intermediate" },
            { word: "algorithm", phonetic: "/Àà√¶l…°…ôr…™√∞…ôm/", meaning: "n. ÁÆóÊ≥ï", level: "intermediate" },
            { word: "cloud", phonetic: "/kla äd/", meaning: "n. ‰∫ë", level: "intermediate" },
            { word: "security", phonetic: "/s…™Ààkj är…ôti/", meaning: "n. ÂÆâÂÖ®", level: "intermediate" },
            // ‰∏≠Á∫ß - Êó•Â∏∏ËØçÊ±á
            { word: "communication", phonetic: "/k…ôÀåmjuÀên…™Ààke…™ É…ôn/", meaning: "n. ‰∫§ÊµÅ", level: "intermediate" },
            { word: "environment", phonetic: "/…™nÀàva…™r…ônm…ônt/", meaning: "n. ÁéØÂ¢É", level: "intermediate" },
            { word: "technology", phonetic: "/tekÀàn…ëÀêl…ôd íi/", meaning: "n. ÊäÄÊúØ", level: "intermediate" },
            { word: "education", phonetic: "/Àåed íuÀàke…™ É…ôn/", meaning: "n. ÊïôËÇ≤", level: "intermediate" },
            { word: "experience", phonetic: "/…™kÀàsp…™ri…ôns/", meaning: "n. ÁªèÈ™å", level: "intermediate" },
            { word: "information", phonetic: "/Àå…™nf…ôrÀàme…™ É…ôn/", meaning: "n. ‰ø°ÊÅØ", level: "intermediate" },
            { word: "development", phonetic: "/d…™Ààvel…ôpm…ônt/", meaning: "n. ÂèëÂ±ï", level: "intermediate" },
            { word: "application", phonetic: "/Àå√¶pl…™Ààke…™ É…ôn/", meaning: "n. Â∫îÁî®", level: "intermediate" },
            { word: "management", phonetic: "/Ààm√¶n…™d ím…ônt/", meaning: "n. ÁÆ°ÁêÜ", level: "intermediate" },
            { word: "organization", phonetic: "/Àå…îÀêr…°…ôn…™Ààze…™ É…ôn/", meaning: "n. ÁªÑÁªá", level: "intermediate" },
            // È´òÁ∫ß - ÁßëÊäÄËØçÊ±á
            { word: "compile", phonetic: "/k…ômÀàpa…™l/", meaning: "v. ÁºñËØë", level: "advanced" },
            { word: "paradigm", phonetic: "/Ààp√¶r…ôda…™m/", meaning: "n. ËåÉÂºè", level: "advanced" },
            { word: "optimize", phonetic: "/Àà…ëÀêpt…™ma…™z/", meaning: "v. ‰ºòÂåñ", level: "advanced" },
            { word: "concurrent", phonetic: "/k…ônÀàk…úÀêr…ônt/", meaning: "adj. Âπ∂ÂèëÁöÑ", level: "advanced" },
            { word: "architecture", phonetic: "/Àà…ëÀêrk…™tekt É…ôr/", meaning: "n. Êû∂ÊûÑ", level: "advanced" },
            { word: "deployment", phonetic: "/d…™Ààpl…î…™m…ônt/", meaning: "n. ÈÉ®ÁΩ≤", level: "advanced" },
            { word: "scalability", phonetic: "/Àåske…™l…ôÀàb…™l…ôti/", meaning: "n. ÂèØÊâ©Â±ïÊÄß", level: "advanced" },
            { word: "microservice", phonetic: "/Àåma…™kro äÀàs…úÀêrv…™s/", meaning: "n. ÂæÆÊúçÂä°", level: "advanced" },
            { word: "container", phonetic: "/k…ônÀàte…™n…ôr/", meaning: "n. ÂÆπÂô®", level: "advanced" },
            { word: "blockchain", phonetic: "/Ààbl…íkt Ée…™n/", meaning: "n. Âå∫ÂùóÈìæ", level: "advanced" },
            // È´òÁ∫ß - ÂïÜÂä°ËØçÊ±á
            { word: "strategy", phonetic: "/Ààstr√¶t…ôd íi/", meaning: "n. ÊàòÁï•", level: "advanced" },
            { word: "investment", phonetic: "/…™nÀàvestm…ônt/", meaning: "n. ÊäïËµÑ", level: "advanced" },
            { word: "revenue", phonetic: "/Ààrev…ônuÀê/", meaning: "n. Êî∂ÂÖ•", level: "advanced" },
            { word: "performance", phonetic: "/p…ôrÀàf…îÀêrm…ôns/", meaning: "n. ÊÄßËÉΩ", level: "advanced" },
            { word: "innovation", phonetic: "/Àå…™n…ôÀàve…™ É…ôn/", meaning: "n. ÂàõÊñ∞", level: "advanced" },
            { word: "collaboration", phonetic: "/k…ôÀål√¶b…ôÀàre…™ É…ôn/", meaning: "n. Âçè‰Ωú", level: "advanced" },
            { word: "authentication", phonetic: "/…îÀêÀåŒ∏ent…™Ààke…™ É…ôn/", meaning: "n. ËÆ§ËØÅ", level: "advanced" },
            { word: "authorization", phonetic: "/Àå…îÀêŒ∏…ôr…™Ààze…™ É…ôn/", meaning: "n. ÊéàÊùÉ", level: "advanced" },
            { word: "encryption", phonetic: "/…™nÀàkr…™p É…ôn/", meaning: "n. Âä†ÂØÜ", level: "advanced" },
            { word: "virtualization", phonetic: "/Àåv…úÀêrt Éu…ôl…™Ààze…™ É…ôn/", meaning: "n. ËôöÊãüÂåñ", level: "advanced" },
            // È´òÁ∫ß - AI/MLËØçÊ±á
            { word: "neural", phonetic: "/Ààn är…ôl/", meaning: "adj. Á•ûÁªèÁöÑ", level: "advanced" },
            { word: "neuron", phonetic: "/Ààn är…ín/", meaning: "n. Á•ûÁªèÂÖÉ", level: "advanced" },
            { word: "deep learning", phonetic: "/diÀêp Ààl…úÀêrn…™≈ã/", meaning: "n. Ê∑±Â∫¶Â≠¶‰π†", level: "advanced" },
            { word: "machine learning", phonetic: "/m…ôÀà ÉiÀên Ààl…úÀêrn…™≈ã/", meaning: "n. Êú∫Âô®Â≠¶‰π†", level: "advanced" },
            { word: "neural network", phonetic: "/Ààn är…ôl Àànetw…úÀêrk/", meaning: "n. Á•ûÁªèÁΩëÁªú", level: "advanced" },
            { word: "tensor", phonetic: "/Ààtens…îÀêr/", meaning: "n. Âº†Èáè", level: "advanced" },
            { word: "gradient", phonetic: "/Àà…°re…™di…ônt/", meaning: "n. Ê¢ØÂ∫¶", level: "advanced" },
            { word: "backpropagation", phonetic: "/Àåb√¶kpr…íp…ôÀà…°e…™ É…ôn/", meaning: "n. ÂèçÂêë‰º†Êí≠", level: "advanced" },
            { word: "transformer", phonetic: "/tr√¶nsÀàf…îÀêrm…ôr/", meaning: "n. TransformerÊ®°Âûã", level: "advanced" },
            { word: "embedding", phonetic: "/…™mÀàbed…™≈ã/", meaning: "n. ÂµåÂÖ•", level: "advanced" },
            { word: "token", phonetic: "/Ààto äk…ôn/", meaning: "n. Ê†áËÆ∞", level: "advanced" },
            { word: "GPT", phonetic: "/d íiÀê piÀê tiÀê/", meaning: "n. ÁîüÊàêÂºèÈ¢ÑËÆ≠ÁªÉTransformer", level: "advanced" },
            { word: "LLM", phonetic: "/…õl …õl …õm/", meaning: "n. Â§ßËØ≠Ë®ÄÊ®°Âûã", level: "advanced" },
            { word: "prompt", phonetic: "/pro ämpt/", meaning: "n. ÊèêÁ§∫ËØç", level: "advanced" },
            { word: "fine-tuning", phonetic: "/fa…™n ÀàtjuÀên…™≈ã/", meaning: "n. ÂæÆË∞É", level: "advanced" },
            { word: "inference", phonetic: "/Àà…™nf…ôr…ôns/", meaning: "n. Êé®ÁêÜ", level: "advanced" },
            { word: "training", phonetic: "/Ààtre…™n…™≈ã/", meaning: "n. ËÆ≠ÁªÉ", level: "advanced" },
            { word: "dataset", phonetic: "/Ààde…™t…ôset/", meaning: "n. Êï∞ÊçÆÈõÜ", level: "advanced" },
            { word: "model", phonetic: "/Ààm…ëÀêdl/", meaning: "n. Ê®°Âûã", level: "advanced" },
            // ÊâòÁ¶è/IELTS ËØçÊ±á
            { word: "abundant", phonetic: "/…ôÀàb ånd…ônt/", meaning: "adj. ‰∏∞ÂØåÁöÑ", level: "intermediate" },
            { word: "acknowledge", phonetic: "/…ôkÀàn…íl…™d í/", meaning: "v. ÊâøËÆ§", level: "intermediate" },
            { word: "adequate", phonetic: "/Àà√¶d…™kw…ôt/", meaning: "adj. Ë∂≥Â§üÁöÑ", level: "intermediate" },
            { word: "aggregate", phonetic: "/Àà√¶…°r…™…°…ôt/", meaning: "v. ËÅöÈõÜ", level: "advanced" },
            { word: "alleviate", phonetic: "/…ôÀàliÀêv…™e…™t/", meaning: "v. ÂáèËΩª", level: "advanced" },
            { word: "ambiguous", phonetic: "/√¶mÀàb…™…°ju…ôs/", meaning: "adj. Ê®°Á≥äÁöÑ", level: "advanced" },
            { word: "amend", phonetic: "/…ôÀàmend/", meaning: "v. ‰øÆÊîπ", level: "advanced" },
            { word: "anticipate", phonetic: "/√¶nÀàt…™s…™pe…™t/", meaning: "v. È¢ÑÊúü", level: "intermediate" },
            { word: "apparent", phonetic: "/…ôÀàp√¶r…ônt/", meaning: "adj. ÊòéÊòæÁöÑ", level: "intermediate" },
            { word: "appreciate", phonetic: "/…ôÀàpriÀê Éie…™t/", meaning: "v. Ê¨£Ëµè", level: "beginner" },
            { word: "approach", phonetic: "/…ôÀàpro ät É/", meaning: "n. ÊñπÊ≥ï", level: "beginner" },
            { word: "appropriate", phonetic: "/…ôÀàpro äpri…ôt/", meaning: "adj. ÈÄÇÂΩìÁöÑ", level: "intermediate" },
            { word: "approximate", phonetic: "/…ôÀàpr…íks…™m…ôt/", meaning: "adj. Â§ßÁ∫¶ÁöÑ", level: "intermediate" },
            { word: "arbitrary", phonetic: "/Àà…ëÀêrb…™treri/", meaning: "adj. ‰ªªÊÑèÁöÑ", level: "advanced" },
            { word: "aspect", phonetic: "/Àà√¶spekt/", meaning: "n. ÊñπÈù¢", level: "beginner" },
            { word: "assemble", phonetic: "/…ôÀàsembl/", meaning: "v. ÁªÑË£Ö", level: "intermediate" },
            { word: "assess", phonetic: "/…ôÀàses/", meaning: "v. ËØÑ‰º∞", level: "intermediate" },
            { word: "assign", phonetic: "/…ôÀàsa…™n/", meaning: "v. ÂàÜÈÖç", level: "intermediate" },
            { word: "assist", phonetic: "/…ôÀàs…™st/", meaning: "v. Â∏ÆÂä©", level: "beginner" },
            { word: "assume", phonetic: "/…ôÀàsjuÀêm/", meaning: "v. ÂÅáËÆæ", level: "intermediate" },
            // Êñ∞Â¢ûAI/Â§ßÊ®°ÂûãËØçÊ±á (2026)
            { word: "generative", phonetic: "/Ààd íen…ôr…ôt…™v/", meaning: "adj. ÁîüÊàêÂºèÁöÑ", level: "advanced" },
            { word: "multimodal", phonetic: "/Àåm åltiÀàmo ädl/", meaning: "adj. Â§öÊ®°ÊÄÅÁöÑ", level: "advanced" },
            { word: "pre-training", phonetic: "/priÀê Ààtre…™n…™≈ã/", meaning: "n. È¢ÑËÆ≠ÁªÉ", level: "advanced" },
            { word: "reinforcement", phonetic: "/ÀåriÀê…™nÀàf…îÀêrsm…ônt/", meaning: "n. Âº∫Âåñ", level: "advanced" },
            { word: "reward", phonetic: "/r…™Ààw…îÀêrd/", meaning: "n. Â•ñÂä±", level: "advanced" },
            { word: "policy", phonetic: "/Ààp…íl…ôsi/", meaning: "n. Á≠ñÁï•", level: "advanced" },
            { word: "agent", phonetic: "/Ààe…™d í…ônt/", meaning: "n. Êô∫ËÉΩ‰Ωì", level: "advanced" },
            { word: "autonomous", phonetic: "/…îÀêÀàt…ín…ôm…ôs/", meaning: "adj. Ëá™‰∏ªÁöÑ", level: "advanced" },
            { word: "benchmark", phonetic: "/Ààbent Ém…ëÀêrk/", meaning: "n. Âü∫ÂáÜ", level: "advanced" },
            { word: "evaluation", phonetic: "/…™Àåv√¶ljuÀàe…™ É…ôn/", meaning: "n. ËØÑ‰º∞", level: "advanced" },
            { word: "hallucination", phonetic: "/h…ôÀåluÀês…™Ààne…™ É…ôn/", meaning: "n. ÂπªËßâ", level: "advanced" },
            { word: "grounding", phonetic: "/Àà…°ra änd…™≈ã/", meaning: "n. Êé•Âú∞/‰∫ãÂÆû‰æùÊçÆ", level: "advanced" },
            { word: "retrieval", phonetic: "/r…™ÀàtriÀêvl/", meaning: "n. Ê£ÄÁ¥¢", level: "advanced" },
            { word: "augmented", phonetic: "/…îÀê…°Ààment…™d/", meaning: "adj. Â¢ûÂº∫ÁöÑ", level: "advanced" },
            { word: "RAG", phonetic: "/r√¶…°/", meaning: "Ê£ÄÁ¥¢Â¢ûÂº∫ÁîüÊàê", level: "advanced" },
            { word: "vector", phonetic: "/Ààvekt…ôr/", meaning: "n. ÂêëÈáè", level: "advanced" },
            { word: "dimension", phonetic: "/da…™Ààmen É…ôn/", meaning: "n. Áª¥Â∫¶", level: "advanced" },
            { word: "similarity", phonetic: "/Àås…™m…ôÀàl√¶r…ôti/", meaning: "n. Áõ∏‰ººÂ∫¶", level: "advanced" },
            { word: "cosine", phonetic: "/Ààko äsa…™n/", meaning: "n. ‰ΩôÂº¶", level: "advanced" },
            { word: "quantization", phonetic: "/Àåkw…ínt…™Ààze…™ É…ôn/", meaning: "n. ÈáèÂåñ", level: "advanced" },
            { word: "pruning", phonetic: "/ÀàpruÀên…™≈ã/", meaning: "n. Ââ™Êûù", level: "advanced" },
            { word: "knowledge distillation", phonetic: "/Ààn…íl…™d í d…™st…™Ààle…™ É…ôn/", meaning: "n. Áü•ËØÜËí∏È¶è", level: "advanced" },
            { word: " LoRA", phonetic: "/Ààlo är…ô/", meaning: "n. ‰ΩéÁß©ÈÄÇÈÖç", level: "advanced" },
            { word: "parameter", phonetic: "/p…ôÀàr√¶m…™t…ôr/", meaning: "n. ÂèÇÊï∞", level: "advanced" },
            { word: "attention", phonetic: "/…ôÀàten É…ôn/", meaning: "n. Ê≥®ÊÑèÂäõ", level: "advanced" },
            { word: "self-attention", phonetic: "/self …ôÀàten É…ôn/", meaning: "n. Ëá™Ê≥®ÊÑèÂäõ", level: "advanced" },
            { word: "feedforward", phonetic: "/ÀàfiÀêdf…îÀêrw…ôrd/", meaning: "n. ÂâçÈ¶à", level: "advanced" },
            { word: "batch normalization", phonetic: "/b√¶t É Àån…îÀêrm…ôl…™Ààze…™ É…ôn/", meaning: "n. ÊâπÂΩí‰∏ÄÂåñ", level: "advanced" },
            { word: "residual", phonetic: "/Ààrez…™dju…ôl/", meaning: "adj. ÊÆãÂ∑ÆÁöÑ", level: "advanced" },
            { word: "skip connection", phonetic: "/sk…™p k…ôÀànek É…ôn/", meaning: "n. Ë∑≥Ë∑ÉËøûÊé•", level: "advanced" },
            // ÁîüÊ¥ªÂú∫ÊôØËØçÊ±á
            { word: "restaurant", phonetic: "/Ààrest…ôr…ëÀênt/", meaning: "n. È§êÂéÖ", level: "beginner" },
            { word: "hospital", phonetic: "/Ààh…ísp…™tl/", meaning: "n. ÂåªÈô¢", level: "beginner" },
            { word: "airport", phonetic: "/Ààerp…îÀêrt/", meaning: "n. Êú∫Âú∫", level: "beginner" },
            { word: "supermarket", phonetic: "/ÀàsuÀêp…ôrm…ëÀêrk…™t/", meaning: "n. Ë∂ÖÂ∏Ç", level: "beginner" },
            { word: "library", phonetic: "/Ààla…™breri/", meaning: "n. Âõæ‰π¶È¶Ü", level: "beginner" },
            { word: "museum", phonetic: "/mjuÀàziÀê…ôm/", meaning: "n. ÂçöÁâ©È¶Ü", level: "intermediate" },
            { word: "gymnasium", phonetic: "/d í…™mÀàne…™zi…ôm/", meaning: "n. ÂÅ•Ë∫´Êàø", level: "intermediate" },
            { word: "pharmacy", phonetic: "/Ààf…ëÀêrm…ôsi/", meaning: "n. ËçØÊàø", level: "intermediate" }
        ];

        // ====== Áä∂ÊÄÅ ======
        let words = [...defaultWords];
        let currentIndex = 0;
        let total = 0, correct = 0, streak = 0;
        let learnedWords = [];
        let user = null;
        let history = [];
        let quizWord = null;
        let mediaRecorder = null;
        let audioChunks = [];
        let studyStartTime = null; // Â≠¶‰π†ÂºÄÂßãÊó∂Èó¥
        let todayStudyMinutes = 0; // ‰ªäÊó•Â≠¶‰π†ÂàÜÈíüÊï∞
        
        // ====== ÊØèÊó•ÊåëÊàòÁ≥ªÁªü ======
        let challengeData = {
            date: '',
            wordsLearned: 0,
            quizzesDone: 0,
            accuracy: 0,
            completed: false,
            badges: [], // Â∑≤Ëß£ÈîÅÁöÑÂæΩÁ´†
            streakDays: 0, // ËøûÁª≠ÊâìÂç°Â§©Êï∞
            lastCompleteDate: '', // ‰∏äÊ¨°ÂÆåÊàêÊåëÊàòÁöÑÊó•Êúü
            dailyGoal: 10 // ÊØèÊó•Â≠¶‰π†ÁõÆÊ†áÔºàÂçïËØçÊï∞Ôºâ
        };
        
        const badges = [
            { id: 'first', name: 'ÂàùÂ≠¶ËÄÖ', icon: 'üå±', condition: 'wordsLearned >= 1' },
            { id: 'ten', name: 'Â∞èËØïÁâõÂàÄ', icon: '‚≠ê', condition: 'wordsLearned >= 10' },
            { id: 'fifty', name: 'ÂùöÊåÅ‰∏çÊáà', icon: 'üèÉ', condition: 'wordsLearned >= 50' },
            { id: 'streak3', name: '‰∏âËøûËÉú', icon: 'üî•', condition: 'streak >= 3' },
            { id: 'streak7', name: 'Âë®ÂÜ†ÂÜõ', icon: 'üëë', condition: 'streak >= 7' },
            { id: 'streak30', name: 'ÊúàÂ∫¶ÁéãËÄÖ', icon: 'üèÖ', condition: 'challengeData.streakDays >= 30' },
            { id: 'perfect', name: 'ÂÖ®ÂØπ', icon: 'üéØ', condition: 'accuracy >= 100 && quizzesDone >= 5' },
            { id: 'quiz10', name: 'Âà∑È¢òËææ‰∫∫', icon: 'üìù', condition: 'quizzesDone >= 10' },
            { id: 'month', name: 'ÊúàÂ∫¶ÊåëÊàò', icon: 'üèÜ', condition: 'streak >= 30' },
            { id: 'first_challenge', name: 'È¶ñÊ¨°ÊåëÊàò', icon: 'üéñÔ∏è', condition: 'challengeData.completed === true' },
            { id: 'streak_7days', name: '‰∏ÄÂë®ÊâìÂç°', icon: 'üìÖ', condition: 'challengeData.streakDays >= 7' },
            // Êñ∞Â¢ûÂæΩÁ´†
            { id: 'hundred', name: 'ÁôæËØçÊñ©', icon: 'üíØ', condition: 'wordsLearned >= 100' },
            { id: 'five_hundred', name: 'ËØçÊ±áÈáè', icon: 'üìö', condition: 'wordsLearned >= 500' },
            { id: 'thousand', name: 'ÂçÉËØçÁéã', icon: 'üëë', condition: 'wordsLearned >= 1000' },
            { id: 'speech_master', name: 'Âè£ËØ≠Â§ßÂ∏à', icon: 'üó£Ô∏è', condition: 'challengeData.speakCount >= 10' },
            { id: 'dialogue_hero', name: 'ÂØπËØùËææ‰∫∫', icon: 'üí¨', condition: 'challengeData.dialogueCount >= 20' },
            { id: 'night_owl', name: 'Â§úÁå´Â≠ê', icon: 'ü¶â', condition: 'challengeData.nightStudy === true' },
            { id: 'early_bird', name: 'Êó©Ëµ∑È∏ü', icon: 'üê¶', condition: 'challengeData.morningStudy === true' },
            { id: 'review_master', name: 'Â§ç‰π†Â§ßÂ∏à', icon: 'üìñ', condition: 'challengeData.reviewCount >= 50' },
            { id: 'streak_100', name: 'ÁôæÊó•Ëã±ÈõÑ', icon: 'üèÖ', condition: 'challengeData.streakDays >= 100' },
            { id: 'perfectionist', name: 'ÂÆåÁæé‰∏ª‰πâËÄÖ', icon: 'üíé', condition: 'challengeData.perfectDays >= 10' }
        ];

        // ====== ‰∏™‰∫∫‰∏≠ÂøÉ ======
        function updateProfile() {
            const name = user ? user.username : 'Â≠¶‰π†ËÄÖ';
            // ‰ΩøÁî®ÁªèÈ™åÂÄºÁ≠âÁ∫ß
            const levelName = expConfig.levelNames[userExp.level - 1] || 'Á•ûËØù';
            document.getElementById('profileName').textContent = name;
            document.getElementById('profileLevel').textContent = `${levelName} Lv.${userExp.level}`;
            document.getElementById('profileTotal').textContent = total;
            document.getElementById('profileStreak').textContent = streak;
            document.getElementById('profileBadges').textContent = challengeData.badges ? challengeData.badges.length : 0;
            document.getElementById('profileChallengeStreak').textContent = challengeData.streakDays || 0;
            
            // Êõ¥Êñ∞Â§¥ÂÉè
            if (user && user.avatar) {
                document.getElementById('profileAvatar').textContent = user.avatar;
            }
        }
        
        // ====== ÊãºÂÜôÊåëÊàò ======
        let spellingWord = null;
        let spellingScore = 0;
        
        function startSpellingChallenge() {
            // ÈÄâÊã©‰∏Ä‰∏™ÈöèÊú∫ÂçïËØç
            spellingWord = words[Math.floor(Math.random() * words.length)];
            document.getElementById('spellingChallenge').style.display = 'none';
            document.getElementById('spellingGame').style.display = 'block';
            document.getElementById('spellingWord').textContent = spellingWord.meaning;
            document.getElementById('spellingInput').value = '';
            document.getElementById('spellingResult').textContent = '';
            spellingScore = 0;
            // Ëá™Âä®Êí≠ÊîæÂèëÈü≥
            setTimeout(playSpellingWord, 500);
        }
        
        function playSpellingWord() {
            if (!spellingWord) return;
            const utterance = new SpeechSynthesisUtterance(spellingWord.word);
            utterance.lang = 'en-US';
            utterance.rate = 0.8;
            speechSynthesis.speak(utterance);
        }
        
        function checkSpelling() {
            const input = document.getElementById('spellingInput').value.trim().toLowerCase();
            const result = document.getElementById('spellingResult');
            
            if (!input) {
                result.textContent = 'ËØ∑ËæìÂÖ•ÂçïËØçÊãºÂÜô';
                result.style.color = '#666';
                return;
            }
            
            if (input === spellingWord.word.toLowerCase()) {
                result.textContent = '‚úÖ Ê≠£Á°ÆÔºÅ' + spellingWord.word + ' /' + spellingWord.phonetic + '/';
                result.style.color = '#52c41a';
                spellingScore++;
                // Á≠îÂØπ‰∫ÜÔºåÂàáÊç¢Âà∞‰∏ã‰∏Ä‰∏™ÂçïËØç
                setTimeout(() => {
                    spellingWord = words[Math.floor(Math.random() * words.length)];
                    document.getElementById('spellingWord').textContent = spellingWord.meaning;
                    document.getElementById('spellingInput').value = '';
                    document.getElementById('spellingResult').textContent = '';
                    playSpellingWord();
                }, 1500);
            } else {
                result.textContent = '‚ùå ÈîôËØØÔºÅÊ≠£Á°ÆÊãºÂÜô: ' + spellingWord.word;
                result.style.color = '#ff4d4f';
            }
        }
        
        function endSpellingChallenge() {
            document.getElementById('spellingChallenge').style.display = 'block';
            document.getElementById('spellingGame').style.display = 'none';
        }
        
        // ====== Â≠¶‰π†Êä•Âëä ======
        function showReport() {
            const report = document.getElementById('reportContent');
            const weekTotal = history.slice(-7).reduce((s, h) => s + (h.total || 0), 0);
            const weekCorrect = history.slice(-7).reduce((s, h) => s + (h.correct || 0), 0);
            const monthTotal = history.slice(-30).reduce((s, h) => s + (h.total || 0), 0);
            const monthCorrect = history.slice(-30).reduce((s, h) => s + (h.correct || 0), 0);
            const mastered = words.filter(w => w.status === 'mastered').length;
            
            // ËÆ°ÁÆóÊú¨Âë®Â≠¶‰π†Â§©Êï∞
            const weekDays = history.slice(-7).filter(h => h.total > 0).length;
            const weekAvg = weekDays > 0 ? Math.round(weekTotal / weekDays) : 0;
            
            // ÁîüÊàêÈºìÂä±ËØ≠
            const encouragements = [
                'Â§™Ê£í‰∫ÜÔºÅÁªßÁª≠‰øùÊåÅÔºÅüåü',
                'Â≠¶‰π†ÊòØ‰∏ÄÁßç‰π†ÊÉØÔºåÂùöÊåÅÂ∞±ÊòØËÉúÂà©ÔºÅüí™',
                'ÊØèÂ§©ËøõÊ≠•‰∏ÄÁÇπÁÇπÔºåÁªàÂ∞ÜÊàêÂ∞±‰ºüÂ§ßÁöÑËá™Â∑±ÔºÅüöÄ',
                '‰Ω†Ê≠£Âú®ÂèòÂæóË∂äÊù•Ë∂äÂº∫Â§ßÔºÅüî•',
                'Â≠¶‰π†ÊòØÊúÄÂ•ΩÁöÑÊäïËµÑÔºå‰∏∫Ëá™Â∑±ÁÇπËµûÔºÅ‚≠ê'
            ];
            const encouragement = encouragements[Math.floor(Math.random() * encouragements.length)];
            
            report.innerHTML = `
                <div class="report-card" style="background:linear-gradient(135deg,#667eea,#764ba2);color:white;">
                    <div style="text-align:center;">
                        <div style="font-size:36px;margin-bottom:10px;">üìä</div>
                        <div style="font-size:14px;opacity:0.9;">${new Date().toLocaleDateString('zh-CN', {month:'long'})} Â≠¶‰π†Êä•Âëä</div>
                        <div style="font-size:24px;font-weight:bold;margin-top:10px;">${encouragement}</div>
                    </div>
                </div>
                <div class="report-card">
                    <div class="report-title">üìÖ Êú¨Âë®Êï∞ÊçÆ</div>
                    <div class="report-summary">
                        <div class="report-item"><div class="report-value">${weekTotal}</div><div class="report-label">Â≠¶‰π†ËØçÊï∞</div></div>
                        <div class="report-item"><div class="report-value">${weekDays}/7</div><div class="report-label">Â≠¶‰π†Â§©Êï∞</div></div>
                        <div class="report-item"><div class="report-value">${weekAvg}</div><div class="report-label">Êó•Âùá</div></div>
                        <div class="report-item"><div class="report-value">${weekTotal > 0 ? Math.round((weekCorrect/weekTotal)*100) : 0}%</div><div class="report-label">Ê≠£Á°ÆÁéá</div></div>
                    </div>
                </div>
                <div class="report-card">
                    <div class="report-title">üìÜ Êú¨ÊúàÊï∞ÊçÆ</div>
                    <div class="report-summary">
                        <div class="report-item"><div class="report-value">${monthTotal}</div><div class="report-label">Â≠¶‰π†ËØçÊï∞</div></div>
                        <div class="report-item"><div class="report-value">${monthTotal > 0 ? Math.round((monthCorrect/monthTotal)*100) : 0}%</div><div class="report-label">Ê≠£Á°ÆÁéá</div></div>
                    </div>
                </div>
                <div class="report-card">
                    <div class="report-title">üéØ Á¥ØËÆ°ÊàêÂ∞±</div>
                    <div class="report-summary">
                        <div class="report-item"><div class="report-value">${total}</div><div class="report-label">ÊÄªÂ≠¶‰π†</div></div>
                        <div class="report-item"><div class="report-value">${mastered}</div><div class="report-label">Â∑≤ÊéåÊè°</div></div>
                        <div class="report-item"><div class="report-value">${streak}</div><div class="report-label">ËøûÁª≠Â§©Êï∞</div></div>
                        <div class="report-item"><div class="report-value">${challengeData.badges?.length || 0}</div><div class="report-label">ÂæΩÁ´†Êï∞</div></div>
                    </div>
                </div>
                <button class="btn" style="width:100%;margin-top:10px;background:#07C160;color:white;" onclick="shareWeeklyReport()">üì§ ÂàÜ‰∫´Âë®Êä•</button>
            `;
            document.getElementById('reportModal').classList.add('active');
        }
        
        // ====== ÂàÜ‰∫´Âë®Êä• ======
        function shareWeeklyReport() {
            const weekTotal = history.slice(-7).reduce((s, h) => s + (h.total || 0), 0);
            const weekCorrect = history.slice(-7).reduce((s, h) => s + (h.correct || 0), 0);
            const accuracy = weekTotal > 0 ? Math.round((weekCorrect/weekTotal)*100) : 0;
            
            const text = `üìä ÊàëÁöÑ AI ËÉåÂçïËØçÂë®Êä•

üìÖ ${new Date().toLocaleDateString('zh-CN', {year:'numeric', month:'long', day:'numeric'})}

‚úÖ Êú¨Âë®Â≠¶‰π†Ôºö${weekTotal} ‰∏™ÂçïËØç
üéØ Ê≠£Á°ÆÁéáÔºö${accuracy}%
üî• ËøûÁª≠ÊâìÂç°Ôºö${streak} Â§©
‚≠ê ÂΩìÂâçÁ≠âÁ∫ßÔºöLv.${userExp.level} ${expConfig.levelNames[userExp.level-1]}

ü§ñ ‰∏ÄËµ∑Áî® AI ËÉåÂçïËØçÂ∞èÁ®ãÂ∫èÂ≠¶‰π†Ëã±ËØ≠ÂêßÔºÅ

#AIËÉåÂçïËØç #Ëã±ËØ≠Â≠¶‰π† #Âë®Êä•`;

            if (navigator.share) {
                navigator.share({ title: 'AIËÉåÂçïËØçÂë®Êä•', text: text });
            } else {
                navigator.clipboard.writeText(text).then(() => {
                    alertToToast('Âë®Êä•Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ');
                });
            }
        }
        
        // ====== ÂàÜ‰∫´ÂäüËÉΩ ======
        // ====== Á§æ‰∫§ÂàÜ‰∫´ÂäüËÉΩ ======
        function shareToSocial(platform) {
            const data = loadStats();
            const shareText = getShareText();
            
            const shareUrls = {
                'weibo': `https://service.weibo.com/share/share.php?text=${encodeURIComponent(shareText)}`,
                'qq': `http://connect.qq.com/widget/shareqq/index.html?url=${encodeURIComponent(window.location.href)}&title=${encodeURIComponent(shareText)}`,
                'wechat': 'ÁîüÊàê‰∫åÁª¥Á†ÅÂàÜ‰∫´'
            };
            
            if (platform === 'wechat') {
                showWechatShareQR();
            } else if (shareUrls[platform]) {
                window.open(shareUrls[platform], '_blank');
            }
        }
        
        function getShareText() {
            const data = loadStats();
            const streak = data.streak || 0;
            const total = data.total || 0;
            
            const texts = [
                `ÊàëÁî®AIËÉåÂçïËØçÂ∞èÁ®ãÂ∫èÂ∑≤ÁªèÂ≠¶‰π†‰∫Ü${total}‰∏™ÂçïËØçÔºåËøûÁª≠Â≠¶‰π†${streak}Â§©Âï¶ÔºÅ`,
                `‰ªäÊó•Â≠¶‰π†ÂÆåÊàêÔºÅAIËÉåÂçïËØçËÆ©ÊàëÁà±‰∏äÂ≠¶‰π†ÔºåÂø´Êù•‰∏ÄËµ∑ÂêßÔºÅ`,
                `ËÉåÂçïËØç‰πüËÉΩËøô‰πàÊúâË∂£ÔºÅAIËÉåÂçïËØçÂ∞èÁ®ãÂ∫èÔºåÊô∫ËÉΩÂèàÈ´òÊïàÔºÅ`,
                `Â≠¶‰π†ÊòØ‰∏ÄÁßç‰π†ÊÉØ„ÄÇÊàëÂ∑≤ÁªèËøûÁª≠Â≠¶‰π†${streak}Â§©Ôºå‰∏ÄËµ∑Âä†Ê≤πÔºÅ`
            ];
            return texts[Math.floor(Math.random() * texts.length)] + ' #AIËÉåÂçïËØç#';
        }
        
        function showWechatShareQR() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="text-align:center;max-width:300px;">
                    <div class="modal-title">ÂæÆ‰ø°ÂàÜ‰∫´</div>
                    <div style="padding:20px;background:white;border-radius:12px;margin:15px 0;">
                        <div style="width:150px;height:150px;margin:0 auto;background:#f5f5f5;display:flex;align-items:center;justify-content:center;">
                            <span style="font-size:48px;">üì±</span>
                        </div>
                        <div style="font-size:12px;color:#666;margin-top:10px;">Êâ´Á†ÅÊàñÊêúÁ¥¢"AIËÉåÂçïËØç"</div>
                    </div>
                    <button class="btn btn-primary" style="width:100%;" onclick="this.closest('.modal').remove()">ÂÖ≥Èó≠</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function shareAchievement() {
            const mastered = words.filter(w => w.status === 'mastered').length;
            const text = `üéâ ÊàëÊ≠£Âú®‰ΩøÁî® AI ËÉåÂçïËØçÂ∞èÁ®ãÂ∫èÂ≠¶‰π†ÔºÅ\n\nüìä ÂΩìÂâçËøõÂ∫¶Ôºö\n- Â∑≤Â≠¶‰π† ${total} ‰∏™ÂçïËØç\n- ËøûÁª≠ÊâìÂç° ${streak} Â§©\n- ÊéåÊè° ${mastered} ‰∏™ÂçïËØç\n\nü§ñ ‰∏ÄËµ∑Áî® AI Â≠¶‰π†Ëã±ËØ≠ÂêßÔºÅ`;
            
            if (navigator.share) {
                navigator.share({ title: 'AIËÉåÂçïËØç', text: text });
            } else {
                // Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø
                navigator.clipboard.writeText(text).then(() => {
                    alertToToast('ÊàêÂ∞±Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ');
                });
            }
        }

        // ====== Â§¥ÂÉèÁ≥ªÁªü ======
        const avatars = ['üòÄ', 'üòé', 'ü§ì', 'üßë‚Äçüíª', 'üë®‚Äçüéì', 'üë©‚Äçüéì', 'ü¶ä', 'üêº', 'üê®', 'ü¶Å', 'üêØ', 'üê±', 'üê∂', 'üêµ', 'üê∏', 'üêô', 'ü¶Ñ', 'üê≤', 'üåü', 'üíé', 'üéØ', 'üèÜ', 'üéñÔ∏è', 'üåà', '‚òÄÔ∏è', 'üåô', '‚ö°', 'üî•', 'üí™', 'üéâ'];
        let selectedAvatar = 'üòÄ';
        
        function changeAvatar() {
            const avatarHtml = avatars.map(a => 
                `<span style="font-size:28px;cursor:pointer;margin:5px;display:inline-block;" onclick="selectAvatar('${a}')">${a}</span>`
            ).join('');
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width:300px;">
                    <div class="modal-title">ÈÄâÊã©Â§¥ÂÉè</div>
                    <div style="text-align:center;padding:10px;">${avatarHtml}</div>
                    <button class="btn btn-primary" style="width:100%;" onclick="document.querySelectorAll('.modal')[document.querySelectorAll('.modal').length-1].remove()">Á°ÆÂÆö</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function selectAvatar(avatar) {
            selectedAvatar = avatar;
            document.getElementById('avatarPreview').textContent = avatar;
        }

        // ====== Áî®Êà∑Á≥ªÁªü ======
        // Â≠¶‰π†Â∞èË¥¥Â£´
        const learningTips = [
            "ÊØèÂ§©Â§ç‰π†Ââç‰∏ÄÂ§©Â≠¶‰π†ÁöÑÂçïËØçÔºåËÆ∞ÂøÜÊïàÊûúÊõ¥Â•ΩÔºÅ",
            "‰ΩøÁî®Á©∫Ê†ºÈîÆÂèØ‰ª•Êí≠ÊîæÂçïËØçÂèëÈü≥ÔºåÂ∞ùËØïË∑üËØªÔºÅ",
            "Êåâ P ÈîÆÂèØ‰ª•Êî∂ËóèÂΩìÂâçÂçïËØçÂà∞Êî∂ËóèÂ§π",
            "Ê≠£Á°ÆÁéá‰Ωé‰∫é60%Êó∂ÔºåÂª∫ËÆÆÈôç‰ΩéÂ≠¶‰π†ÈöæÂ∫¶",
            "ËâæÂÆæÊµ©ÊñØÈÅóÂøòÊõ≤Á∫øÔºöÂ§ç‰π†ÊúÄ‰Ω≥Êó∂Èó¥ÊòØ1Â§©Âêé„ÄÅ3Â§©Âêé„ÄÅ7Â§©Âêé",
            "ÊØèÂ§©Â≠¶‰π†5‰∏™Êñ∞ÂçïËØçÔºåÂùöÊåÅ‰∏Ä‰∏™ÊúàÂ∞±ÊòØ150‰∏™ÔºÅ",
            "ÂèëÈü≥ÊµãËØÑÂèØ‰ª•Â∏ÆÂä©‰Ω†Á∫†Ê≠£‰∏≠ÂºèËã±ËØ≠ÂèëÈü≥",
            "ÈîôÈ¢òÊú¨ÊòØ‰Ω†ÁöÑËñÑÂº±ÁÇπÔºåÂ§öÂ§ç‰π†Ëøô‰∫õÂçïËØç",
            "ÂÆåÊàêÊØèÊó•ÁõÆÊ†áÂèØ‰ª•Ëé∑ÂæóÂæΩÁ´†Â•ñÂä±",
            "ÂºÄÂêØÂ≠¶‰π†Èü≥ÊïàÂèØ‰ª•ËÆ©Â≠¶‰π†Êõ¥ÊúâË∂£",
            "‰ΩøÁî®Âø´Êç∑ÈîÆÔºö1‰∏çËÆ§ËØÜ 2Âõ∞Èöæ 3ËÆ§ËØÜ",
            "Âú∫ÊôØÂåñÂ≠¶‰π†ÂèØ‰ª•ËÆ©‰Ω†Êõ¥Âø´ÊéåÊè°ÂÆûÁî®ËØçÊ±á"
        ];
        
        function showRandomTip() {
            const tipIndex = Math.floor(Math.random() * learningTips.length);
            document.getElementById('tipText').textContent = learningTips[tipIndex];
        }
        
        function init() {
            // ‰ΩøÁî®requestIdleCallback‰ºòÂåñÂàùÂßãÂåñ
            if ('requestIdleCallback' in window) {
                requestIdleCallback(() => {
                    performInit();
                }, { timeout: 2000 });
            } else {
                setTimeout(performInit, 0);
            }
            
            // È¢ÑÂä†ËΩΩÂÖ≥ÈîÆËµÑÊ∫ê
            preloadResources();
        }
        
        // ====== ÂêØÂä®ÁîªÈù¢ ======
        function showSplashScreen() {
            const splash = document.getElementById('splashScreen');
            const progress = document.getElementById('splashProgress');
            let width = 0;
            
            const interval = setInterval(() => {
                width += Math.random() * 20;
                if (width >= 100) {
                    width = 100;
                    clearInterval(interval);
                    
                    // Âª∂ËøüÂÖ≥Èó≠ÂêØÂä®ÁîªÈù¢
                    setTimeout(() => {
                        splash.style.opacity = '0';
                        splash.style.transition = 'opacity 0.5s';
                        setTimeout(() => splash.style.display = 'none', 500);
                    }, 300);
                }
                progress.style.width = width + '%';
            }, 100);
        }
        
        function performInit() {
            loadUser();
            loadExp();
            loadHistory();
            loadChallenge();
            loadFavorites();
            loadWrongWords();
            loadNewWords();
            loadReminder();
            loadTheme();
            loadStudyTime(); // Âä†ËΩΩÂ≠¶‰π†Êó∂Èïø
            loadSoundSetting(); // Âä†ËΩΩÈü≥ÊïàËÆæÁΩÆ
            loadCheckin(); // Âä†ËΩΩÁ≠æÂà∞Êï∞ÊçÆ
            checkStreakShield(); // Ê£ÄÊü•ÊâìÂç°‰øùÊä§Âç°
            updateStreakShieldUI(); // Êõ¥Êñ∞‰øùÊä§Âç°UI
            checkBackupStatus(); // Ê£ÄÊü•Â§á‰ªΩÁä∂ÊÄÅ
            
            // ÊòæÁ§∫ÈöèÊú∫Â≠¶‰π†Â∞èË¥¥Â£´
            showRandomTip();
            
            // Êñ∞ÊâãÂºïÂØº
            checkNewUserGuide();
            
            if (!user) {
                document.getElementById('loginModal').classList.add('active');
            } else {
                updateUserInfo();
            }
            showCard();
            updateStats();
            renderHistory();
            renderWordOfDay(); // ÊØèÊó•‰∏ÄËØç
            updateProfile();
            
            // ÂàùÂßãÂåñÈîÆÁõòÂø´Êç∑ÈîÆ
            initKeyboardShortcuts();
            
            // ÂêØÂä®Â≠¶‰π†ËÆ°Êó∂
            startStudyTimer();
            
            // Âª∂ËøüÂä†ËΩΩÈùûÂÖ≥ÈîÆÂäüËÉΩ
            setTimeout(() => {
                updateLearnProgress();
                checkDueReview();
                checkAnniversary();
            }, 1000);
            
            // ÂàùÂßãÂåñÁßªÂä®Á´ØÊâãÂäø
            initTouchGestures();
            
            // Ê£ÄÊü•Á¶ªÁ∫øÁä∂ÊÄÅ
            updateOnlineStatus();
            
            // Ê£ÄÊü•Ëá™Âä®Â§úÈó¥Ê®°Âºè
            checkAutoDarkMode();
            
            // ÂàùÂßãÂåñÊâãÂä®‰∏ªÈ¢òËÆæÁΩÆ
            initManualTheme();
            
            // Ê∏≤ÊüìÂø´ÈÄüÁªüËÆ°
            renderQuickStats();
        }
        
        function preloadResources() {
            // È¢ÑÂä†ËΩΩÂÖ≥ÈîÆÂõæÁâáÂíåËµÑÊ∫ê
            const link = document.createElement('link');
            link.rel = 'prefetch';
            link.href = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">üìö</text></svg>';
            document.head.appendChild(link);
        }
            
            // Á¶ªÁ∫øÊ£ÄÊµã
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
            updateOnlineStatus();
        }
        
        // ====== Êñ∞ÊâãÂºïÂØº ======
        function checkNewUserGuide() {
            const firstVisit = localStorage.getItem('wordAI_firstVisit');
            if (!firstVisit) {
                // È¶ñÊ¨°ËÆøÈóÆÔºåÊòæÁ§∫ÂºïÂØº
                localStorage.setItem('wordAI_firstVisit', Date.now());
                setTimeout(() => {
                    showTipModal('üöÄ Ê¨¢Ëøé‰ΩøÁî® AI ËÉåÂçïËØçÔºÅ', 'ÂºÄÂßãÂ≠¶‰π†ÔºöÁÇπÂáª"ËÆ§ËØÜ"Êàñ"‰∏çËÆ§ËØÜ"ÊåâÈíÆÊù•Â≠¶‰π†ÂçïËØç„ÄÇ‰ΩøÁî®Âø´Êç∑ÈîÆ 1/2/3 Êõ¥È´òÊïàÔºÅ');
                }, 1000);
            }
        }
        
        function showTipModal(title, content) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="text-align:center;padding:25px;">
                    <div style="font-size:36px;margin-bottom:10px;">üí°</div>
                    <div style="font-size:16px;font-weight:bold;margin-bottom:10px;">${title}</div>
                    <div style="font-size:13px;color:#666;line-height:1.6;margin-bottom:20px;">${content}</div>
                    <button onclick="this.closest('.modal').remove()" style="background:linear-gradient(135deg,#667eea,#764ba2);color:white;border:none;padding:12px 30px;border-radius:20px;font-size:14px;cursor:pointer;">Áü•ÈÅì‰∫ÜÔºÅ</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function updateOnlineStatus() {
            const indicator = document.getElementById('offlineIndicator');
            if (indicator) {
                indicator.style.display = navigator.onLine ? 'none' : 'block';
            }
        }
        
        // ====== Â≠¶‰π†Êó∂ÈïøËøΩË∏™ ======
        function loadStudyTime() {
            const saved = localStorage.getItem('wordAI_studyTime');
            const today = new Date().toDateString();
            if (saved) {
                const data = JSON.parse(saved);
                if (data.date === today) {
                    todayStudyMinutes = data.minutes || 0;
                } else {
                    // Êñ∞ÁöÑ‰∏ÄÂ§©ÔºåÈáçÁΩÆÊó∂Èïø
                    todayStudyMinutes = 0;
                }
            }
        }
        
        function saveStudyTime() {
            const data = {
                date: new Date().toDateString(),
                minutes: todayStudyMinutes
            };
            localStorage.setItem('wordAI_studyTime', JSON.stringify(data));
        }
        
        function startStudyTimer() {
            if (!studyStartTime) {
                studyStartTime = Date.now();
                // ÊØèÂàÜÈíüÊõ¥Êñ∞‰∏ÄÊ¨°
                setInterval(() => {
                    if (studyStartTime) {
                        todayStudyMinutes++;
                        saveStudyTime();
                    }
                }, 60000);
            }
        }
        
        function getStudyTimeString() {
            if (todayStudyMinutes < 1) return 'ÂàöÂàöÂºÄÂßã';
            if (todayStudyMinutes < 60) return todayStudyMinutes + 'ÂàÜÈíü';
            const hours = Math.floor(todayStudyMinutes / 60);
            const mins = todayStudyMinutes % 60;
            return hours + 'Â∞èÊó∂' + mins + 'ÂàÜÈíü';
        }
        
        // ====== ÈîÆÁõòÂø´Êç∑ÈîÆ ======
        function initKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // Âø´Êç∑ÈîÆÂè™Âú®ÈùûËæìÂÖ•Ê°ÜÊó∂ÁîüÊïà
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
                
                // 1/2/3 Âø´Êç∑ËÆ§ËØÜ/Âõ∞Èöæ/‰∏çËÆ§ËØÜ
                if (e.key === '1') showAgain();
                if (e.key === '2') showHard();
                if (e.key === '3') showKnown();
                
                // Á©∫Ê†ºÈîÆÊí≠ÊîæÂèëÈü≥
                if (e.key === ' ' && words[currentIndex]) {
                    e.preventDefault();
                    playTTS(words[currentIndex].word);
                }
                
                // T ÂàáÊç¢‰∏ªÈ¢ò
                if (e.key === 't' || e.key === 'T') toggleTheme();
                
                // N ‰∏ã‰∏Ä‰∏™
                if (e.key === 'n' || e.key === 'N') showNextWord();
                
                // P Êî∂ËóèÂΩìÂâçÂçïËØç
                if (e.key === 'p' || e.key === 'P') {
                    if (words[currentIndex]) addToFavorites(words[currentIndex].word);
                }
            });
        }
        
        // ====== Ëß¶Êë∏ÊªëÂä®ÂàáÊç¢ ======
        let touchStartX = 0;
        let touchEndX = 0;
        
        document.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        });
        
        document.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });
        
        function handleSwipe() {
            const diff = touchStartX - touchEndX;
            const threshold = 50;
            
            if (Math.abs(diff) > threshold) {
                if (diff > 0) {
                    // Â∑¶Êªë - ‰∏ã‰∏Ä‰∏™
                    showNextWord();
                } else {
                    // Âè≥Êªë - ËÆ§ËØÜÔºà‰∏ä‰∏Ä‰∏™Ôºâ
                    if (currentIndex > 0) currentIndex--;
                    else currentIndex = words.length - 1;
                    showCard();
                }
            }
        }
        
        function showNextWord() {
            currentIndex = (currentIndex + 1) % words.length;
            showCard();
            // Ê£ÄÊü•ÊàêÂ∞±
            if (typeof checkAndShowAchievements === 'function') {
                setTimeout(checkAndShowAchievements, 500);
            }
        }
        
        // ====== ‰∏ªÈ¢òÂàáÊç¢ ======
        function loadTheme() {
            const saved = localStorage.getItem('wordAI_theme');
            // ‰ºòÂÖà‰ΩøÁî®Áî®Êà∑ËÆæÁΩÆÔºåÂê¶ÂàôË∑üÈöèÁ≥ªÁªü
            if (saved === 'dark' || (!saved && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.body.classList.add('dark-theme');
                document.querySelector('.theme-toggle').textContent = '‚òÄÔ∏è';
            } else {
                document.querySelector('.theme-toggle').textContent = 'üåô';
            }
        }
        
        function toggleTheme() {
            const body = document.body;
            const toggle = document.querySelector('.theme-toggle');
            if (body.classList.contains('dark-theme')) {
                body.classList.remove('dark-theme');
                toggle.textContent = 'üåô';
                localStorage.setItem('wordAI_theme', 'light');
            } else {
                body.classList.add('dark-theme');
                toggle.textContent = '‚òÄÔ∏è';
                localStorage.setItem('wordAI_theme', 'dark');
            }
        }
        
        // ====== Êî∂ËóèÂäüËÉΩ ======
        let favorites = [];
        
        function loadFavorites() {
            const saved = localStorage.getItem('wordAI_favorites');
            if (saved) favorites = JSON.parse(saved);
        }
        
        function saveFavorites() {
            localStorage.setItem('wordAI_favorites', JSON.stringify(favorites));
        }
        
        function addToFavorites(word) {
            if (!favorites.find(f => f.word === word.word)) {
                favorites.push(word);
                saveFavorites();
                alert('Â∑≤Ê∑ªÂä†Âà∞Êî∂ËóèÔºÅ');
            }
        }
        
        function removeFavorite(word) {
            favorites = favorites.filter(f => f.word !== word);
            saveFavorites();
            renderFavorites();
        }
        
        function renderFavorites() {
            const list = document.getElementById('collectionList');
            const noteData = JSON.parse(localStorage.getItem('wordAI_wordNotes') || '{}');
            
            if (favorites.length === 0) {
                list.innerHTML = '<div class="empty-state">ÊöÇÊó†Êî∂ËóèÂçïËØç</div>';
                return;
            }
            list.innerHTML = favorites.map(w => {
                const note = noteData[w.word] || '';
                return `
                <div class="word-card">
                    <div style="flex:1;">
                        <div class="word-card-word">${w.word}</div>
                        <div class="word-card-meaning">${w.meaning}</div>
                        ${note ? `<div class="word-note">üí° ${note}</div>` : ''}
                    </div>
                    <div class="word-card-actions">
                        <button class="word-card-btn" onclick="showNoteModal('${w.word}')">üìù</button>
                        <button class="word-card-btn btn-remove" onclick="removeFavorite('${w.word}')">Âà†Èô§</button>
                    </div>
                </div>
            `}).join('');
        }
        
        // ====== ÁîüËØçÊú¨ ======
        let newWords = [];
        
        function loadNewWords() {
            const saved = localStorage.getItem('wordAI_newWords');
            if (saved) newWords = JSON.parse(saved);
        }
        
        // ====== ÁîüËØçÊú¨Â§ç‰π† ======
        let newWordsReview = [];
        let currentReviewIndex = 0;
        let newWordsReviewed = 0;
        let newWordsForgot = 0;
        
        function startNewWordsReview() {
            if (newWords.length === 0) {
                alert('ÁîüËØçÊú¨‰∏∫Á©∫ÔºÅ');
                return;
            }
            newWordsReview = [...newWords];
            currentReviewIndex = 0;
            newWordsReviewed = 0;
            newWordsForgot = 0;
            
            document.getElementById('newWordsReview').style.display = 'block';
            showNewWordCard();
        }
        
        function showNewWordCard() {
            if (currentReviewIndex >= newWordsReview.length) {
                endNewWordsReview();
                return;
            }
            
            const w = newWordsReview[currentReviewIndex];
            const progress = ((currentReviewIndex) / newWordsReview.length) * 100;
            
            document.getElementById('newWordsProgress').style.width = progress + '%';
            document.getElementById('newWordsCount').textContent = `${currentReviewIndex + 1}/${newWordsReview.length}`;
            document.getElementById('newWordCard').innerHTML = `
                <div class="review-word">${w.word}</div>
                <div class="review-phonetic">${w.phonetic || ''}</div>
                <div class="review-meaning" onclick="this.style.display='none';document.getElementById('newWordMeaning').style.display='block';">
                    ÁÇπÂáªÊòæÁ§∫Èáä‰πâ
                </div>
                <div class="review-meaning" id="newWordMeaning" style="display:none;">${w.meaning}</div>
            `;
        }
        
        function markNewWord(remembered) {
            if (remembered) {
                newWordsReviewed++;
            } else {
                newWordsForgot++;
            }
            currentReviewIndex++;
            showNewWordCard();
        }
        
        function endNewWordsReview() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="text-align:center;">
                    <div style="font-size:48px;margin-bottom:15px;">üéâ</div>
                    <div class="modal-title">Â§ç‰π†ÂÆåÊàêÔºÅ</div>
                    <div style="display:flex;justify-content:space-around;margin:20px 0;">
                        <div><div style="font-size:24px;font-weight:bold;color:#52C41A;">${newWordsReviewed}</div><div style="font-size:12px;color:#666;">ËÆ∞‰Ωè</div></div>
                        <div><div style="font-size:24px;font-weight:bold;color:#ef4444;">${newWordsForgot}</div><div style="font-size:12px;color:#666;">ÂøòËÆ∞</div></div>
                    </div>
                    <button class="btn btn-primary" onclick="this.closest('.modal').remove();document.getElementById('newWordsReview').style.display='none';">ÂÆåÊàê</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function saveNewWords() {
            localStorage.setItem('wordAI_newWords', JSON.stringify(newWords));
        }
        
        function addToNewWords(word) {
            if (!newWords.find(w => w.word === word.word)) {
                newWords.push({...word, addTime: Date.now()});
                saveNewWords();
            }
        }
        
        function removeNewWord(word) {
            newWords = newWords.filter(w => w.word !== word);
            saveNewWords();
            renderNewWords();
        }
        
        function renderNewWords() {
            const list = document.getElementById('newWordsList');
            document.getElementById('newWordsCount').textContent = newWords.length + ' ‰∏™';
            if (newWords.length === 0) {
                list.innerHTML = '<div class="empty-state">ÊöÇÊó†ÁîüËØç</div>';
                return;
            }
            list.innerHTML = newWords.map(w => `
                <div class="word-card">
                    <div>
                        <div class="word-card-word">${w.word}</div>
                        <div class="word-card-meaning">${w.meaning}</div>
                    </div>
                    <div class="word-card-actions">
                        <button class="word-card-btn btn-review" onclick="removeNewWord('${w.word}')">ÊéåÊè°</button>
                        <button class="word-card-btn btn-remove" onclick="removeNewWord('${w.word}')">Âà†Èô§</button>
                    </div>
                </div>
            `).join('');
        }
        
        function reviewNewWords() {
            if (newWords.length === 0) {
                alert('ÁîüËØçÊú¨‰∏∫Á©∫ÔºÅ');
                return;
            }
            // Switch to learn tab with new words
            words = [...newWords];
            showCard();
            alertToToast('Â∑≤ÂàáÊç¢Âà∞ÁîüËØçÊú¨Â§ç‰π†Ê®°ÂºèÔºÅ');
        }
        
        function switchCollectionTab(tab) {
            document.querySelectorAll('.collection-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            if (tab === 'favorites') renderFavorites();
            else renderWrongWords();
        }
        
        // ====== ÈîôÈ¢òÊú¨ ======
        let wrongWords = [];
        
        function loadWrongWords() {
            const saved = localStorage.getItem('wordAI_wrongWords');
            if (saved) wrongWords = JSON.parse(saved);
        }
        
        function saveWrongWords() {
            localStorage.setItem('wordAI_wrongWords', JSON.stringify(wrongWords));
        }
        
        function addToWrongBook(word) {
            if (!wrongWords.find(w => w.word === word.word)) {
                wrongWords.push({...word, wrongCount: 1});
                saveWrongWords();
            }
        }
        
        function practiceWrongWords() {
            if (wrongWords.length === 0) {
                alert('ÈîôÈ¢òÊú¨‰∏∫Á©∫ÔºåÊ≤°ÊúâÈúÄË¶ÅÁªÉ‰π†ÁöÑÈ¢òÁõÆÔºÅ');
                return;
            }
            
            // ÂàáÊç¢Âà∞ÊµãÈ™åÊ®°ÂºèÔºå‰ΩøÁî®ÈîôÈ¢ò
            const wrongCopy = [...wrongWords];
            let currentIndex = 0;
            let correct = 0;
            
            function showNextWrong() {
                if (currentIndex >= wrongCopy.length) {
                    const acc = Math.round((correct / wrongCopy.length) * 100);
                    alert(`ÁªÉ‰π†ÂÆåÊàêÔºÅ\n\nÊ≠£Á°Æ: ${correct}/${wrongCopy.length}\nÊ≠£Á°ÆÁéá: ${acc}%`);
                    
                    // Ê∏ÖÈô§ÂÖ®ÂØπÁöÑÈîôÈ¢ò
                    if (acc === 100) {
                        wrongWords = wrongWords.filter(w => wrongCopy.some(c => c.word !== w.word));
                        saveWrongWords();
                        renderWrongWords();
                    }
                    return;
                }
                
                const w = wrongCopy[currentIndex];
                const meanings = words.map(x => x.meaning);
                const correctMeaning = w.meaning;
                const options = [correctMeaning];
                
                while (options.length < 4 && options.length < meanings.length) {
                    const random = meanings[Math.floor(Math.random() * meanings.length)];
                    if (!options.includes(random)) options.push(random);
                }
                options.sort(() => Math.random() - 0.5);
                
                const quizCard = document.getElementById('quiz-card');
                quizCard.innerHTML = `
                    <div class="ai-quiz-badge">‚ùå ÈîôÈ¢òÈáçÁªÉ</div>
                    <div class="word">${w.word}</div>
                    <div class="phonetic">${w.phonetic}</div>
                    <div class="meaning">ÈÄâÊã©Ê≠£Á°ÆÁöÑ‰∏≠ÊñáÈáä‰πâ</div>
                `;
                
                document.getElementById('quiz-options').innerHTML = options.map(opt => `
                    <button class="quiz-option" onclick="checkWrongAnswer('${opt}', '${correctMeaning}', this)">${opt}</button>
                `).join('');
                
                window.checkWrongAnswer = function(selected, correctAns, btn) {
                    document.querySelectorAll('.quiz-option').forEach(o => o.disabled = true);
                    if (selected === correctAns) {
                        btn.classList.add('correct');
                        correct++;
                        playSound('correct');
                    } else {
                        btn.classList.add('wrong');
                        document.querySelectorAll('.quiz-option').forEach(o => {
                            if (o.textContent === correctAns) o.classList.add('correct');
                        });
                        playSound('wrong');
                    }
                    currentIndex++;
                    setTimeout(showNextWrong, 1000);
                };
                
                // ÂàáÊç¢Âà∞ÊµãÈ™åÊ†áÁ≠æ
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                document.querySelector('[data-tab="quiz"]').classList.add('active');
                document.getElementById('tab-quiz').classList.add('active');
            }
            
            showNextWrong();
        }
        
        function removeWrongWord(word) {
            wrongWords = wrongWords.filter(w => w.word !== word);
            saveWrongWords();
            renderWrongWords();
        }
        
        function renderWrongWords() {
            const list = document.getElementById('wrongList');
            document.getElementById('wrongCount').textContent = wrongWords.length + ' È¢ò';
            const noteData = JSON.parse(localStorage.getItem('wordAI_wordNotes') || '{}');
            
            if (wrongWords.length === 0) {
                list.innerHTML = '<div class="empty-state">ÊöÇÊó†ÈîôÈ¢ò</div>';
                return;
            }
            list.innerHTML = wrongWords.map(w => {
                // ÁîüÊàêËÆ∞ÂøÜÊäÄÂ∑ß
                const tip = generateMemoryTip(w.word, w.meaning);
                const note = noteData[w.word] || '';
                return `
                    <div class="error-detail" onclick="toggleErrorDetail(this)">
                        <div class="error-word">${w.word}</div>
                        <div class="error-meaning">${w.phonetic || ''} ${w.meaning}</div>
                        <div class="error-tip" style="display:none;">üí° ${tip}</div>
                        ${note ? `<div class="word-note" style="margin-top:8px;">üí° ${note}</div>` : ''}
                    </div>
                    <div class="word-card-actions" style="margin-top:-8px;margin-bottom:12px;">
                        <button class="btn" style="font-size:12px;padding:6px 12px;background:#fef3c7;color:#f59e0b;" onclick="event.stopPropagation();showNoteModal('${w.word}')">üìùÁ¨îËÆ∞</button>
                        <button class="btn" style="font-size:12px;padding:6px 12px;background:#f0f7ff;color:#667eea;" onclick="event.stopPropagation();practiceWrongWord('${w.word}')">ÁªÉ‰π†</button>
                        <button class="btn" style="font-size:12px;padding:6px 12px;background:#f6ffed;color:#52C41A;" onclick="event.stopPropagation();removeWrongWord('${w.word}')">ÊéåÊè°</button>
                    </div>
                `;
            }).join('');
        }
        
        // ÁîüÊàêËÆ∞ÂøÜÊäÄÂ∑ß
        function generateMemoryTip(word, meaning) {
            const tips = [
                'Â§öËØªÂá†ÈÅçËøô‰∏™ÂçïËØçÔºåËÆ∞‰ΩèÂÆÉÁöÑÊãºÂÜô',
                'Â∞ùËØïÁî®Ëøô‰∏™ÂçïËØçÈÄ†‰∏Ä‰∏™Âè•Â≠ê',
                'ËÅîÊÉ≥‰∏Ä‰∏ãËøô‰∏™ÂçïËØçÁöÑÂΩ¢Ë±°ËÆ∞ÂøÜ',
                'ÂèØ‰ª•ÊääËøô‰∏™ÂçïËØçÂÜôÂú®Á∫∏‰∏äÂä†Ê∑±Âç∞Ë±°',
                'Âê¨ÂèëÈü≥Ë∑üËØªÔºåËÆ∞‰ΩèËØªÈü≥'
            ];
            return tips[Math.floor(Math.random() * tips.length)] + ' - ' + meaning;
        }
        
        function toggleErrorDetail(el) {
            const tip = el.querySelector('.error-tip');
            tip.style.display = tip.style.display === 'none' ? 'block' : 'none';
        }
        
        function practiceWrongWord(word) {
            // ÁªÉ‰π†ÈîôÈ¢ò
            const w = wrongWords.find(w => w.word === word);
            if (w) {
                // ÊòæÁ§∫ÊµãÈ™å
                showTab('tab-quiz');
                document.querySelector('[data-tab="quiz"]').click();
            }
        }
        
        // ====== ÊèêÈÜíÂäüËÉΩ ======
        let reminderEnabled = false;
        
        function loadReminder() {
            const saved = localStorage.getItem('wordAI_reminder');
            if (saved) {
                const data = JSON.parse(saved);
                reminderEnabled = data.enabled;
                if (data.time) document.getElementById('reminderTime').value = data.time;
                if (data.repeat) document.getElementById('reminderRepeat').value = data.repeat;
            }
            document.getElementById('reminderToggle').classList.toggle('active', reminderEnabled);
        }
        
        function toggleReminder() {
            reminderEnabled = !reminderEnabled;
            document.getElementById('reminderToggle').classList.toggle('active', reminderEnabled);
        }
        
        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundToggle').classList.toggle('active', soundEnabled);
            localStorage.setItem('wordAI_soundEnabled', soundEnabled);
            if (soundEnabled) playSound('correct');
        }
        
        function loadSoundSetting() {
            const saved = localStorage.getItem('wordAI_soundEnabled');
            if (saved !== null) {
                soundEnabled = saved === 'true';
            }
            document.getElementById('soundToggle').classList.toggle('active', soundEnabled);
        }
        
        function saveReminder() {
            const data = {
                enabled: reminderEnabled,
                time: document.getElementById('reminderTime').value,
                repeat: document.getElementById('reminderRepeat').value
            };
            localStorage.setItem('wordAI_reminder', JSON.stringify(data));
            if (reminderEnabled && 'Notification' in window) {
                Notification.requestPermission().then(perm => {
                    if (perm === 'granted') {
                        scheduleNotification(data.time);
                    }
                });
            }
            alertToToast('ÊèêÈÜíËÆæÁΩÆÂ∑≤‰øùÂ≠òÔºÅ');
        }
        
        function scheduleNotification(time) {
            // Check every minute if it's time for notification
            setInterval(() => {
                const now = new Date();
                const [hours, minutes] = time.split(':');
                if (now.getHours() === parseInt(hours) && now.getMinutes() === parseInt(minutes)) {
                    showStudyNotification();
                }
            }, 60000);
        }
        
        function showStudyNotification() {
            if (Notification.permission === 'granted') {
                new Notification('ü§ñ AI ËÉåÂçïËØç', {
                    body: 'ÊòØÊó∂ÂÄôÂ≠¶‰π†Âï¶ÔºÅÂùöÊåÅÊâìÂç°ÔºåÂÖªÊàêÂ•Ω‰π†ÊÉØÔΩû',
                    icon: 'üìö'
                });
            }
        }
        
        // ====== Â§ç‰π†Âà∞ÊúüÊèêÈÜí ======
        function checkDueReview() {
            const now = new Date();
            const dueWords = words.filter(w => w.nextReview && new Date(w.nextReview) <= now);
            if (dueWords.length > 0 && Notification.permission === 'granted') {
                new Notification('üìù Â§ç‰π†ÊèêÈÜí', {
                    body: `ÊÇ®Êúâ ${dueWords.length} ‰∏™ÂçïËØçÈúÄË¶ÅÂ§ç‰π†ÔºÅ`,
                    icon: 'üîî'
                });
            }
        }
        
        // ====== Ëá™ÂÆö‰πâÂçïËØç ======
        function addCustomWord() {
            const word = document.getElementById('customWord').value.trim();
            const phonetic = document.getElementById('customPhonetic').value.trim();
            const meaning = document.getElementById('customMeaning').value.trim();
            
            if (!word || !meaning) {
                document.getElementById('customWordStatus').textContent = '‚ö†Ô∏è ËØ∑ËæìÂÖ•ÂçïËØçÂíåÂê´‰πâ';
                return;
            }
            
            // Ê∑ªÂä†Âà∞ÂçïËØçÂ∫ì
            words.push({
                word: word,
                phonetic: phonetic || '/'+word+'/',
                meaning: meaning,
                level: 'beginner',
                status: 'new',
                addedAt: Date.now()
            });
            
            // ‰øùÂ≠òÂà∞localStorage
            localStorage.setItem('wordAI_customWords', JSON.stringify(words));
            
            document.getElementById('customWord').value = '';
            document.getElementById('customPhonetic').value = '';
            document.getElementById('customMeaning').value = '';
            document.getElementById('customWordStatus').textContent = '‚úÖ ' + word + ' Ê∑ªÂä†ÊàêÂäüÔºÅ';
            
            // Âà∑Êñ∞ÊòæÁ§∫
            currentIndex = 0;
            showCard();
        }

        // ====== ÊâπÈáèÂØºÂÖ•ÂçïËØç ======
        function batchImportWords() {
            const text = document.getElementById('batchImport').value.trim();
            if (!text) {
                document.getElementById('batchImportStatus').textContent = '‚ö†Ô∏è ËØ∑ËæìÂÖ•Ë¶ÅÂØºÂÖ•ÁöÑÂçïËØç';
                return;
            }
            
            const lines = text.split('\n');
            let successCount = 0;
            
            lines.forEach(line => {
                const parts = line.split(',').map(p => p.trim());
                if (parts.length >= 3) {
                    words.push({
                        word: parts[0],
                        phonetic: parts[1] || '/' + parts[0] + '/',
                        meaning: parts[2],
                        level: 'beginner',
                        status: 'new',
                        addedAt: Date.now()
                    });
                    successCount++;
                }
            });
            
            // ‰øùÂ≠òÂà∞localStorage
            localStorage.setItem('wordAI_customWords', JSON.stringify(words));
            
            document.getElementById('batchImport').value = '';
            document.getElementById('batchImportStatus').textContent = '‚úÖ ÊàêÂäüÂØºÂÖ• ' + successCount + ' ‰∏™ÂçïËØçÔºÅ';
            
            // Âà∑Êñ∞ÊòæÁ§∫
            currentIndex = 0;
            showCard();
        }

        // ====== ÂçïËØçÊêúÁ¥¢ÂäüËÉΩ ======
        function searchWords(query) {
            if (!query || query.length < 1) return [];
            query = query.toLowerCase();
            return words.filter(w => 
                w.word.toLowerCase().includes(query) || 
                w.meaning.toLowerCase().includes(query)
            );
        }

        function showSearchResults(results, containerId) {
            const container = document.getElementById(containerId);
            if (!container || results.length === 0) {
                if (container) container.innerHTML = '<div class="empty-state">Êú™ÊâæÂà∞Áõ∏ÂÖ≥ÂçïËØç</div>';
                return;
            }
            
            let html = '';
            results.slice(0, 20).forEach(w => {
                html += `
                    <div class="word-card">
                        <div>
                            <div class="word-card-word">${w.word}</div>
                            <div class="word-card-meaning">${w.phonetic} ${w.meaning}</div>
                        </div>
                        <div class="word-card-actions">
                            <button class="word-card-btn btn-review" onclick="playTTS('${w.word}')">üîä</button>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        // Èò≤ÊäñÁâàÊú¨ÁöÑÊêúÁ¥¢
        const debouncedSearch = debounce((query) => {
            if (!query || query.length < 1) {
                renderFavorites();
                return;
            }
            const currentTab = document.querySelector('.collection-tab.active').textContent;
            let searchList = currentTab.includes('Êî∂Ëóè') ? favorites : wrongWords;
            const wordResults = searchWords(query);
            if (wordResults.length > 0) {
                showSearchResults(wordResults, 'collectionList');
            }
        }, 300);

        function quickSearch(query) {
            debouncedSearch(query);
        }

        // ÊØèÂ§©Ê£ÄÊü•Â§ç‰π†Âà∞Êúü
        setInterval(checkDueReview, 3600000); // ÊØèÂ∞èÊó∂Ê£ÄÊü•‰∏ÄÊ¨°
        
        // ====== Êï∞ÊçÆÂØºÂá∫ÂØºÂÖ• ======
        function exportAllData() {
            const data = {
                version: 'v5.0',
                exportTime: new Date().toISOString(),
                words: words,
                favorites: favorites,
                wrongWords: wrongWords,
                history: history,
                challenge: challengeData,
                total, correct, streak,
                settings: {
                    apiKey: localStorage.getItem('wordAI_apiKey'),
                    theme: localStorage.getItem('wordAI_theme'),
                    reminder: localStorage.getItem('wordAI_reminder')
                }
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'word-ai-backup-' + new Date().toISOString().split('T')[0] + '.json';
            a.click();
            URL.revokeObjectURL(url);
            alertToToast('Êï∞ÊçÆÂØºÂá∫ÊàêÂäüÔºÅ');
        }
        
        // ====== CSVÂØºÂá∫ÂäüËÉΩ ======
        function exportWordsToCSV() {
            if (words.length === 0) {
                alert('Ê≤°ÊúâÂèØÂØºÂá∫ÁöÑÂçïËØç');
                return;
            }
            const headers = ['ÂçïËØç', 'Èü≥Ê†á', 'Âê´‰πâ', 'Áä∂ÊÄÅ', 'Â≠¶‰π†Ê¨°Êï∞', 'Ê≠£Á°ÆÊ¨°Êï∞'];
            const rows = words.map(w => [
                w.word,
                w.phonetic,
                w.meaning,
                w.status || 'new',
                w.learned || 0,
                w.correct || 0
            ]);
            const csvContent = '\ufeff' + [headers, ...rows].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'word-ai-words-' + new Date().toISOString().split('T')[0] + '.csv';
            a.click();
            URL.revokeObjectURL(url);
            alertToToast('ÂçïËØçÂ∑≤ÂØºÂá∫‰∏∫CSVÊ†ºÂºèÔºÅ');
        }
        
        // ====== ÂØºÂá∫Â≠¶‰π†ÂéÜÂè≤‰∏∫CSV ======
        function exportHistoryToCSV() {
            if (history.length === 0) {
                alert('Ê≤°ÊúâÂèØÂØºÂá∫ÁöÑÂ≠¶‰π†ÂéÜÂè≤');
                return;
            }
            const headers = ['Êó•Êúü', 'Â≠¶‰π†ÂçïËØçÊï∞', 'Ê≠£Á°ÆÊï∞', 'Ê≠£Á°ÆÁéá'];
            const rows = history.map(h => [
                h.date,
                h.total,
                h.correct,
                h.total > 0 ? Math.round((h.correct / h.total) * 100) + '%' : '0%'
            ]);
            const csvContent = '\ufeff' + [headers, ...rows].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'word-ai-history-' + new Date().toISOString().split('T')[0] + '.csv';
            a.click();
            URL.revokeObjectURL(url);
            alertToToast('Â≠¶‰π†ÂéÜÂè≤Â∑≤ÂØºÂá∫‰∏∫CSVÊ†ºÂºèÔºÅ');
        }
        
        // ====== ÊàêÂ∞±Ëß£ÈîÅÈÄöÁü• ======
        function showAchievementNotification(achievement) {
            const existing = document.querySelector('.achievement-notification');
            if (existing) existing.remove();
            
            const notif = document.createElement('div');
            notif.className = 'achievement-notification';
            notif.innerHTML = `
                <div class="achievement-notif-icon">${achievement.icon}</div>
                <div class="achievement-notif-content">
                    <div class="achievement-notif-title">üèÜ ÊàêÂ∞±Ëß£ÈîÅÔºÅ</div>
                    <div class="achievement-notif-name">${achievement.name}</div>
                    <div class="achievement-notif-desc">${achievement.desc}</div>
                </div>
                <div class="achievement-notif-close" onclick="this.parentElement.remove()">√ó</div>
            `;
            document.body.appendChild(notif);
            setTimeout(() => notif.classList.add('show'), 10);
            setTimeout(() => {
                notif.classList.remove('show');
                setTimeout(() => notif.remove(), 300);
            }, 5000);
            playAchievementSound();
        }
        
        function playAchievementSound() {
            try {
                const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime);
                oscillator.frequency.setValueAtTime(659.25, audioCtx.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(783.99, audioCtx.currentTime + 0.2);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                oscillator.start(audioCtx.currentTime);
                oscillator.stop(audioCtx.currentTime + 0.5);
            } catch(e) {}
        }
        
        function checkAndShowAchievements() {
            const today = new Date().toISOString().split('T')[0];
            const todayHistory = history.find(h => h.date === today);
            const todayData = { 
                total, correct, streak, 
                accuracy: total > 0 ? Math.round((correct / total) * 100) : 0, 
                today: todayHistory ? todayHistory.total : 0, 
                mastered: words.filter(w => w.status === 'mastered').length,
                favorites: favorites.length,
                wrongCount: wrongWords.length,
                languages: 1
            };
            const unlocked = JSON.parse(localStorage.getItem('wordAI_unlockedAchievements') || '[]');
            achievements.forEach(a => {
                if (!unlocked.includes(a.id) && a.condition(todayData)) {
                    unlocked.push(a.id);
                    localStorage.setItem('wordAI_unlockedAchievements', JSON.stringify(unlocked));
                    showAchievementNotification(a);
                }
            });
        }
        
        function importAllData(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.words) { words = data.words; localStorage.setItem('wordAI_words', JSON.stringify(words)); }
                    if (data.favorites) { favorites = data.favorites; saveFavorites(); }
                    if (data.wrongWords) { wrongWords = data.wrongWords; saveWrongWords(); }
                    if (data.history) { history = data.history; localStorage.setItem('wordAI_history', JSON.stringify(history)); }
                    if (data.total !== undefined) { total = data.total; correct = data.correct; streak = data.streak; }
                    alertToToast('Êï∞ÊçÆÂØºÂÖ•ÊàêÂäüÔºÅ');
                    location.reload();
                } catch(err) { alertToToast('ÂØºÂÖ•Â§±Ë¥•ÔºåÊñá‰ª∂Ê†ºÂºèÈîôËØØ'); }
            };
            reader.readAsText(file);
            input.value = '';
        }
        
        function clearAllData() {
            if (confirm('Á°ÆÂÆöÊ∏ÖÁ©∫ÊâÄÊúâÊï∞ÊçÆÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ')) {
                if (confirm('ÂÜçÊ¨°Á°ÆËÆ§ÔºöÊâÄÊúâÂ≠¶‰π†ËÆ∞ÂΩïÂ∞ÜË¢´Âà†Èô§ÔºÅ')) {
                    localStorage.clear();
                    location.reload();
                }
            }
        }

        function loadUser() {
            const saved = localStorage.getItem('wordAI_user');
            if (saved) user = JSON.parse(saved);
        }

        function saveUser() {
            localStorage.setItem('wordAI_user', JSON.stringify(user));
        }
        
        // ====== ÁªèÈ™åÂÄºÁ≥ªÁªü ======
        function loadExp() {
            const saved = localStorage.getItem('wordAI_exp');
            if (saved) {
                userExp = JSON.parse(saved);
            }
            updateExpDisplay();
        }
        
        function saveExp() {
            localStorage.setItem('wordAI_exp', JSON.stringify(userExp));
        }
        
        function addExp(amount) {
            const oldLevel = userExp.level;
            userExp.total += amount;
            userExp.todayExp += amount;
            
            // Ê£ÄÊü•ÂçáÁ∫ß
            while (userExp.level < expConfig.levelThresholds.length && 
                   userExp.total >= expConfig.levelThresholds[userExp.level]) {
                userExp.level++;
            }
            
            saveExp();
            updateExpDisplay();
            
            // ÂçáÁ∫ßÊèêÁ§∫
            if (userExp.level > oldLevel) {
                showLevelUp(userExp.level);
            }
        }
        
        function updateExpDisplay() {
            const currentLevelExp = expConfig.levelThresholds[userExp.level - 1] || 0;
            const nextLevelExp = expConfig.levelThresholds[userExp.level] || expConfig.levelThresholds[expConfig.levelThresholds.length - 1];
            const expInLevel = userExp.total - currentLevelExp;
            const expNeeded = nextLevelExp - currentLevelExp;
            const progress = Math.min((expInLevel / expNeeded) * 100, 100);
            
            const levelName = expConfig.levelNames[userExp.level - 1] || 'Á•ûËØù';
            document.getElementById('profileLevel').textContent = `${levelName} Lv.${userExp.level}`;
            document.getElementById('expProgressBar').style.width = progress + '%';
            document.getElementById('expProgressText').textContent = `${expInLevel} / ${expNeeded} ÁªèÈ™åÂÄº (Lv.${userExp.level} ‚Üí Lv.${userExp.level + 1})`;
        }
        
        function showLevelUp(newLevel) {
            playSound('levelup');
            const levelName = expConfig.levelNames[newLevel - 1] || 'Á•ûËØù';
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="text-align:center;">
                    <div style="font-size:48px;margin-bottom:10px;">‚¨ÜÔ∏è</div>
                    <div class="modal-title">üéâ ÂçáÁ∫ßÂï¶ÔºÅ</div>
                    <p style="color:#667eea;font-size:24px;font-weight:bold;margin:10px 0;">${levelName}</p>
                    <p style="color:#666;">ÂΩìÂâçÁ≠âÁ∫ß: Lv.${newLevel}</p>
                    <p style="color:#999;font-size:12px;margin-top:15px;">ÁªßÁª≠Â≠¶‰π†ÔºåÂÜ≤ÂáªÊõ¥È´òÁ≠âÁ∫ßÔºÅ</p>
                    <button class="btn btn-primary" style="width:100%;margin-top:20px;" onclick="this.closest('.modal').remove()">ÁªßÁª≠Â≠¶‰π†</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function handleLogin() {
            const username = document.getElementById('username').value.trim();
            const level = document.getElementById('level').value;
            if (!username) { alert('ËØ∑ËæìÂÖ•Áî®Êà∑Âêç'); return; }
            user = { username, level, avatar: selectedAvatar, created: new Date().toISOString() };
            saveUser();
            updateUserInfo();
            closeModal();
            // Ê†πÊçÆÁî®Êà∑Á∫ßÂà´Á≠õÈÄâÂçïËØç
            filterWordsByLevel();
            // Êõ¥Êñ∞Â§¥ÂÉèÊòæÁ§∫
            updateAvatarDisplay();
        }
        
        function updateAvatarDisplay() {
            const avatar = user?.avatar || 'üòÄ';
            document.getElementById('profileAvatar').textContent = avatar;
        }
        
        function openAvatarSelector() {
            if (!user) {
                document.getElementById('loginModal').classList.add('active');
                return;
            }
            changeAvatar();
        }
        
        function selectAvatar(avatar) {
            selectedAvatar = avatar;
            document.getElementById('avatarPreview').textContent = avatar;
            // ‰øùÂ≠òÁî®Êà∑Â§¥ÂÉè
            if (user) {
                user.avatar = avatar;
                saveUser();
                updateAvatarDisplay();
            }
        }

        function closeModal() {
            document.getElementById('loginModal').classList.remove('active');
        }

        function updateUserInfo() {
            document.getElementById('userInfo').textContent = user.username;
            document.getElementById('headerSubtitle').textContent = `Lv.${getLevelName(user.level)}`;
            
            // ÊòæÁ§∫Ê¨¢ËøéÊ®™ÂπÖ
            const banner = document.getElementById('welcomeBanner');
            const welcomeText = document.getElementById('welcomeText');
            if (banner && user) {
                banner.style.display = 'block';
                const hour = new Date().getHours();
                let greeting = 'üëã Ê¨¢ËøéÂõûÊù•';
                if (hour < 6) greeting = 'üåô Â§úÊ∑±‰∫Ü';
                else if (hour < 12) greeting = '‚òÄÔ∏è Êó©‰∏äÂ•Ω';
                else if (hour < 14) greeting = 'üå§Ô∏è ‰∏≠ÂçàÂ•Ω';
                else if (hour < 18) greeting = 'üåá ‰∏ãÂçàÂ•Ω';
                else if (hour < 22) greeting = 'üåô Êôö‰∏äÂ•Ω';
                welcomeText.textContent = `${greeting}Ôºå${user.username}ÔºÅ‰ªäÊó•ÁõÆÊ†áÔºö${challengeData.dailyGoal || 10}‰∏™ÂçïËØç`;
            }
            
            // ÊòæÁ§∫ÊØèÊó•Â≠¶‰π†Âª∫ËÆÆ
            showDailyTip();
        }

        function showDailyTip() {
            const tips = [
                'ÊØèÂ§©Â≠¶‰π†5‰∏™Êñ∞ÂçïËØçÔºåÂùöÊåÅ21Â§©ÂΩ¢Êàê‰π†ÊÉØÔºÅ',
                'Â§ç‰π†ÊØîÂ≠¶‰π†Êñ∞ÂçïËØçÊõ¥ÈáçË¶ÅÔºåËÆ∞ÂæóÂÆöÊúüÂõûÈ°æÔºÅ',
                'ÂèëÈü≥ÁªÉ‰π†ÂèØ‰ª•ÊèêÈ´òÂê¨ÂäõÁêÜËß£ËÉΩÂäõÂì¶ÔΩû',
                'Âú∫ÊôØÂåñÂ≠¶‰π†ËÉΩÂ∏ÆÂä©ËÆ∞ÂøÜÊõ¥Ê∑±ÂàªÔºÅ',
                '‰ΩøÁî®ËâæÂÆæÊµ©ÊñØÈÅóÂøòÊõ≤Á∫øÔºåÁßëÂ≠¶Â§ç‰π†Êõ¥È´òÊïàÔºÅ',
                'ÂùöÊåÅÊØèÂ§©Â≠¶‰π†Ôºå‰øùÊåÅËøûÁª≠ÊâìÂç°ËÆ∞ÂΩïÔºÅ',
                'ÂíåAIÂØπËØùÁªÉ‰π†Âè£ËØ≠ÔºåÊèêÂçáË°®ËææËÉΩÂäõÔºÅ',
                'ÊääÁîüËØçÊî∂ËóèËµ∑Êù•ÔºåÂÆöÊúüÂ§ç‰π†Â∑©Âõ∫ÔºÅ'
            ];
            const data = JSON.parse(localStorage.getItem('wordAI_stats') || '{"total":0}');
            let tip = tips[Math.floor(Math.random() * tips.length)];
            
            // Ê†πÊçÆÂ≠¶‰π†ËøõÂ∫¶ÁªôÂá∫‰∏™ÊÄßÂåñÂª∫ËÆÆ
            if (data.total === 0) {
                tip = 'ÂºÄÂßã‰Ω†ÁöÑÁ¨¨‰∏ÄÊ¨°Â≠¶‰π†‰πãÊóÖÂêßÔºÅ';
            } else if (data.streak >= 7) {
                tip = 'Â§™Ê£í‰∫ÜÔºÅ‰Ω†Â∑≤ÁªèËøûÁª≠Â≠¶‰π†' + data.streak + 'Â§©‰∫ÜÔºÅ';
            } else if (data.today >= (challengeData.dailyGoal || 10)) {
                tip = 'üéâ ‰ªäÊó•ÁõÆÊ†áÂ∑≤ËææÊàêÔºÅÁªßÁª≠Âä†Ê≤πÔΩû';
            }
            
            document.getElementById('dailyTip').textContent = tip;
        }

        function getLevelName(level) {
            const names = { beginner: 'ÂàùÂ≠¶', intermediate: '‰∏≠Á∫ß', advanced: 'È´òÁ∫ß' };
            return names[level] || 'ÂàùÂ≠¶';
        }

        function filterWordsByLevel() {
            const levelMap = { beginner: 0, intermediate: 1, advanced: 2 };
            const userLevel = levelMap[user.level];
            words = defaultWords.filter(w => levelMap[w.level] <= userLevel);
            currentIndex = 0;
            showCard();
        }

        function showSettings() {
            if (!user) {
                document.getElementById('loginModal').classList.add('active');
                return;
            }
            if (confirm('ÂàáÊç¢Áî®Êà∑Ôºü')) {
                user = null;
                localStorage.removeItem('wordAI_user');
                location.reload();
            }
        }

        // ====== ÊéíË°åÊ¶ú ======
        function showRankings() {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById('tab-rank').classList.add('active');
            renderRankings('total');
        }

        function switchRankTab(type) {
            document.querySelectorAll('.rank-tab').forEach(t => {
                t.classList.remove('active');
                t.style.background = 'white';
                t.style.color = '#333';
            });
            event.target.classList.add('active');
            event.target.style.background = '#667eea';
            event.target.style.color = 'white';
            renderRankings(type);
        }

        function renderRankings(type) {
            const rankData = getRankData(type);
            const list = document.getElementById('rankList');
            if (rankData.length === 0) {
                list.innerHTML = '<div class="empty-state">ÊöÇÊó†ÊéíË°åÊï∞ÊçÆ</div>';
                return;
            }
            
            // ÊâæÂà∞ÊàëÁöÑÊéíÂêç
            const myRank = rankData.findIndex(item => item.isMe) + 1;
            
            let html = '';
            // Â¶ÇÊûúÁî®Êà∑‰∏çÂú®Ââç10ÂêçÔºåÊòæÁ§∫ÊàëÁöÑÊéíÂêç‰ø°ÊÅØ
            if (myRank > 10) {
                html += `<div style="text-align:center;padding:10px;background:#f0f7ff;border-radius:10px;margin-bottom:10px;">
                    <div style="font-size:12px;color:#666;">ÊàëÁöÑÊéíÂêç</div>
                    <div style="font-size:24px;font-weight:bold;color:#667eea;">#${myRank}</div>
                </div>`;
            }
            
            rankData.forEach((item, index) => {
                const rankIcon = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : (index + 1);
                const isMe = item.isMe;
                html += `
                    <div style="display:flex;align-items:center;gap:12px;padding:12px;background:${isMe ? '#f0f7ff' : 'white'};border-radius:10px;margin-bottom:8px;box-shadow:0 2px 4px rgba(0,0,0,0.05);${isMe ? 'border:2px solid #667eea;' : ''}">
                        <div style="font-size:20px;width:30px;text-align:center;">${rankIcon}</div>
                        <div style="flex:1;">
                            <div style="font-weight:500;font-size:14px;">${item.username} ${isMe ? '(Êàë)' : ''}</div>
                            <div style="font-size:11px;color:#999;">${item.level || 'ÂàùÂ≠¶'}</div>
                        </div>
                        <div style="text-align:right;">
                            <div style="font-weight:bold;color:#667eea;font-size:16px;">${item.score}</div>
                            <div style="font-size:10px;color:#999;">${type === 'total' ? 'ÂçïËØç' : type === 'streak' ? 'Â§©' : '‰ªäÊó•'}</div>
                        </div>
                    </div>
                `;
            });
            list.innerHTML = html;
        }

        function getRankData(type) {
            // Ëé∑ÂèñÊâÄÊúâÁî®Êà∑ÁöÑÂ≠¶‰π†Êï∞ÊçÆ
            const allData = [];
            
            // Ëé∑ÂèñÂΩìÂâçÁî®Êà∑Êï∞ÊçÆ
            const currentData = loadStats();
            if (user) {
                allData.push({
                    username: user.username,
                    score: type === 'total' ? currentData.total : type === 'streak' ? currentData.streak : currentData.today,
                    level: getLevelName(user.level),
                    isMe: true
                });
            }
            
            // ‰ªéÊú¨Âú∞Â≠òÂÇ®Âä†ËΩΩÂéÜÂè≤Áî®Êà∑Êï∞ÊçÆ
            const savedUsers = JSON.parse(localStorage.getItem('wordAI_rankUsers') || 'null');
            if (savedUsers) {
                savedUsers.forEach(u => {
                    allData.push({
                        username: u.username,
                        score: type === 'total' ? u.total : type === 'streak' ? u.streak : u.today,
                        level: u.level,
                        isMe: false
                    });
                });
            }
            
            // Ê®°ÊãüÂÖ∂‰ªñÁî®Êà∑Êï∞ÊçÆÔºàÂÆûÈôÖÈ°πÁõÆ‰∏≠Â∫îËØ•‰ªéÊúçÂä°Âô®Ëé∑ÂèñÔºâ
            const mockUsers = [
                { username: 'Alice', total: 856, streak: 23, today: 45, level: 'È´òÁ∫ß' },
                { username: 'Bob', total: 742, streak: 18, today: 32, level: '‰∏≠Á∫ß' },
                { username: 'Charlie', total: 689, streak: 15, today: 28, level: '‰∏≠Á∫ß' },
                { username: 'David', total: 521, streak: 12, today: 20, level: 'ÂàùÁ∫ß' },
                { username: 'Eve', total: 398, streak: 8, today: 15, level: 'ÂàùÁ∫ß' },
                { username: 'Frank', total: 312, streak: 6, today: 12, level: 'ÂàùÁ∫ß' },
                { username: 'Grace', total: 267, streak: 5, today: 10, level: 'ÂàùÁ∫ß' },
            ];
            
            mockUsers.forEach(u => {
                allData.push({
                    username: u.username,
                    score: type === 'total' ? u.total : type === 'streak' ? u.streak : u.today,
                    level: u.level,
                    isMe: false
                });
            });
            
            // ÊéíÂ∫è
            allData.sort((a, b) => b.score - a.score);
            return allData.slice(0, 10);
        }
        
        // ‰øùÂ≠òÂΩìÂâçÁî®Êà∑Âà∞ÊéíË°åÊ¶ú
        function saveUserToRank() {
            if (!user) return;
            const currentData = loadStats();
            const userRank = {
                username: user.username,
                total: currentData.total,
                streak: currentData.streak,
                today: currentData.today,
                level: getLevelName(user.level),
                lastUpdate: new Date().toISOString()
            };
            
            let savedUsers = JSON.parse(localStorage.getItem('wordAI_rankUsers') || '[]');
            // Êõ¥Êñ∞ÊàñÊ∑ªÂä†ÂΩìÂâçÁî®Êà∑
            const existingIndex = savedUsers.findIndex(u => u.username === user.username);
            if (existingIndex >= 0) {
                savedUsers[existingIndex] = userRank;
            } else {
                savedUsers.push(userRank);
            }
            // ‰øùÊåÅÊúÄÂ§ö20‰∏™Áî®Êà∑
            savedUsers = savedUsers.slice(0, 20);
            localStorage.setItem('wordAI_rankUsers', JSON.stringify(savedUsers));
        }

        function loadStats() {
            const data = JSON.parse(localStorage.getItem('wordAI_stats') || '{"total":0,"correct":0,"streak":0,"lastDate":"","today":0}');
            // Ê£ÄÊü•ÊòØÂê¶ÊòØÂêå‰∏ÄÂ§©
            const today = new Date().toDateString();
            if (data.lastDate !== today) {
                data.today = 0;
            }
            return data;
        }

        // ====== ËÉåÂçïËØç ======
        function showCard() {
            const card = document.getElementById('card');
            if (words.length === 0) {
                card.innerHTML = '<div class="meaning">üéâ ÊÅ≠ÂñúÔºÅÂ∑≤Â≠¶ÂÆåÊâÄÊúâÂçïËØçÔºÅ</div>';
                return;
            }
            const w = words[currentIndex];
            // Ëé∑ÂèñÁ¨îËÆ∞
            const noteData = JSON.parse(localStorage.getItem('wordAI_wordNotes') || '{}');
            const note = noteData[w.word] || '';
            const hasNote = note ? 'has-note' : '';
            
            card.innerHTML = `
                <button class="note-btn ${hasNote}" onclick="showNoteModal('${w.word}')" title="Ê∑ªÂä†Á¨îËÆ∞">üìù</button>
                <button class="tts-btn" onclick="playTTS('${w.word}', event)">üîä</button>
                <div class="word">${w.word}</div>
                <div class="phonetic">${w.phonetic}</div>
                <div class="meaning">${w.meaning}</div>
                ${note ? `<div class="word-note">üí° ${note}</div>` : ''}
            `;
        }
        
        // ====== ÂçïËØçÁ¨îËÆ∞ÂäüËÉΩ ======
        function showNoteModal(word) {
            const noteData = JSON.parse(localStorage.getItem('wordAI_wordNotes') || '{}');
            const currentNote = noteData[word] || '';
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width:360px;">
                    <div class="modal-title">üìù ÂçïËØçÁ¨îËÆ∞</div>
                    <div style="text-align:center;margin-bottom:15px;">
                        <div style="font-size:24px;font-weight:bold;color:#667eea;">${word}</div>
                    </div>
                    <div class="input-group">
                        <textarea id="wordNoteInput" rows="4" placeholder="Ê∑ªÂä†‰Ω†ÁöÑÁ¨îËÆ∞„ÄÅÂä©ËÆ∞Ê≥ïÊàñ‰æãÂè•..." style="width:100%;padding:12px;border:1px solid #ddd;border-radius:10px;font-size:14px;resize:none;">${currentNote}</textarea>
                    </div>
                    <div style="display:flex;gap:10px;">
                        <button class="btn" style="flex:1;background:#ef4444;color:white;" onclick="deleteNote('${word}');this.closest('.modal').remove();">Âà†Èô§Á¨îËÆ∞</button>
                        <button class="btn btn-primary" style="flex:1;" onclick="saveNote('${word}');this.closest('.modal').remove();">‰øùÂ≠òÁ¨îËÆ∞</button>
                    </div>
                    <button class="btn" style="width:100%;margin-top:10px;" onclick="this.closest('.modal').remove()">ÂèñÊ∂à</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function saveNote(word) {
            const note = document.getElementById('wordNoteInput').value.trim();
            const noteData = JSON.parse(localStorage.getItem('wordAI_wordNotes') || '{}');
            
            if (note) {
                noteData[word] = note;
            } else {
                delete noteData[word];
            }
            
            localStorage.setItem('wordAI_wordNotes', JSON.stringify(noteData));
            showCard(); // Âà∑Êñ∞Âç°ÁâáÊòæÁ§∫
            showToast('Á¨îËÆ∞Â∑≤‰øùÂ≠òÔºÅ');
        }
        
        function deleteNote(word) {
            const noteData = JSON.parse(localStorage.getItem('wordAI_wordNotes') || '{}');
            delete noteData[word];
            localStorage.setItem('wordAI_wordNotes', JSON.stringify(noteData));
            showCard();
            showToast('Á¨îËÆ∞Â∑≤Âà†Èô§');
        }

        function playTTS(word, event, lang = 'en') {
            if (event) event.stopPropagation();
            const utterance = new SpeechSynthesisUtterance(word);
            // Â§öËØ≠Ë®ÄÊîØÊåÅ
            const langMap = { en: 'en-US', ja: 'ja-JP', ko: 'ko-KR', fr: 'fr-FR' };
            utterance.lang = langMap[lang] || 'en-US';
            utterance.rate = 0.8;
            utterance.pitch = 1;
            utterance.volume = 1;
            speechSynthesis.speak(utterance);
        }
        
        function playWordSound(word, phonetic) {
            // ÁÇπÂáªÈü≥Ê†áÊí≠ÊîæÂèëÈü≥
            const utterance = new SpeechSynthesisUtterance(word);
            utterance.lang = 'en-US';
            utterance.rate = 0.7; // ÊÖ¢ÈÄü
            speechSynthesis.speak(utterance);
        }

        function showKnown() { 
            playSound('correct');
            showExpPopup('+10', '#10b981');
            recordAction('known'); onWordLearned(); 
        }
        function showHard() { 
            playSound('wrong');
            showExpPopup('+5', '#f59e0b');
            recordAction('hard'); onWordLearned(); 
        }
        function showAgain() { 
            playSound('wrong');
            showExpPopup('+2', '#ef4444');
            recordAction('again'); onWordLearned(); 
        }
        
        // ÁªèÈ™åÂÄºÈ£òÂ≠óÊïàÊûú
        function showExpPopup(text, color) {
            const popup = document.createElement('div');
            popup.textContent = text;
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 32px;
                font-weight: bold;
                color: ${color};
                animation: expFloat 1s ease-out forwards;
                pointer-events: none;
                z-index: 1000;
                text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            `;
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 1000);
        }
        
        // Ê∑ªÂä†Âä®ÁîªÊ†∑Âºè
        const style = document.createElement('style');
        style.textContent = `
            @keyframes expFloat {
                0% { opacity: 1; transform: translate(-50%, -50%) scale(0.5); }
                50% { opacity: 1; transform: translate(-50%, -80%) scale(1.2); }
                100% { opacity: 0; transform: translate(-50%, -120%) scale(1); }
            }
        `;
        document.head.appendChild(style);

        function recordAction(action) {
            const w = words[currentIndex];
            let status = 'learning';
            let quality = 0;
            
            // Â∫îÁî®ËâæÂÆæÊµ©ÊñØÈÅóÂøòÊõ≤Á∫øÁÆóÊ≥ï
            if (action === 'known') {
                quality = 4; // ËÆ∞Âæó
                correct++;
                streak++;
                learnedWords.push({...w, action, time: new Date().toISOString()});
                words.splice(currentIndex, 1);
            } else if (action === 'hard') {
                quality = 2; // Âõ∞Èöæ
                streak = Math.max(0, streak - 1);
                addToWrongBook(w); // Ê∑ªÂä†Âà∞ÈîôÈ¢òÊú¨
                addToNewWords(w); // Ê∑ªÂä†Âà∞ÁîüËØçÊú¨
                words.push(words.splice(currentIndex, 1)[0]);
            } else {
                quality = 0; // ÂøòËÆ∞
                streak = 0;
                addToWrongBook(w); // Ê∑ªÂä†Âà∞ÈîôÈ¢òÊú¨
                addToNewWords(w); // Ê∑ªÂä†Âà∞ÁîüËØçÊú¨
                words.push(words.splice(currentIndex, 1)[0]);
            }
            
            // ËÆ°ÁÆó‰∏ãÊ¨°Â§ç‰π†Êó∂Èó¥ÔºàËâæÂÆæÊµ©ÊñØÁÆóÊ≥ïÔºâ
            if (w) {
                const { interval, easinessFactor, repetitions } = calculateEbbinghausInterval(w, quality);
                w.interval = interval;
                w.easinessFactor = easinessFactor;
                w.repetitions = repetitions;
                w.nextReview = getNextReviewDate(interval).toISOString();
            }
            
            total++;
            
            if (words.length === 0) {
                document.getElementById('card').innerHTML = '<div class="meaning">üéâ ÊÅ≠ÂñúÔºÅÂ∑≤Â≠¶ÂÆåÊâÄÊúâÂçïËØçÔºÅ</div>';
                document.querySelector('#tab-learn .btn-group').style.display = 'none';
            } else {
                currentIndex = currentIndex % words.length;
                showCard();
            }
            
            updateStats();
            saveHistory();
            saveData();
            saveUserToRank();
        }

        function updateStats() {
            document.getElementById('total').textContent = total;
            document.getElementById('correct').textContent = correct;
            document.getElementById('streak').textContent = streak;
            const acc = total > 0 ? Math.round((correct / total) * 100) : 0;
            document.getElementById('accuracy').textContent = acc + '%';
            
            // Êõ¥Êñ∞Â≠¶‰π†Êó∂ÈïøÊòæÁ§∫
            if (document.getElementById('studyTimeDisplay')) {
                document.getElementById('studyTimeDisplay').textContent = getStudyTimeString();
            }
            
            // Êõ¥Êñ∞ËøûÁª≠ÊâìÂç°ÊåáÁ§∫Âô®
            updateStreakIndicator();
        }
        
        function updateStreakIndicator() {
            const indicator = document.getElementById('streakIndicator');
            if (streak >= 3 && indicator) {
                indicator.style.display = 'block';
                document.getElementById('streakCount').textContent = streak;
                
                // Ë∂ÖËøá7Â§©Ê∑ªÂä†Âä®Áîª
                if (streak >= 7) {
                    indicator.style.animation = 'pulse 1s infinite';
                }
            } else if (indicator) {
                indicator.style.display = 'none';
            }
        }

        // ====== ÂéÜÂè≤ËÆ∞ÂΩï ======
        function saveHistory() {
            const record = {
                date: new Date().toISOString().split('T')[0],
                total, correct, streak
            };
            const existing = history.find(h => h.date === record.date);
            if (existing) {
                Object.assign(existing, record);
            } else {
                history.unshift(record);
            }
            if (history.length > 30) history.pop();
            localStorage.setItem('wordAI_history', JSON.stringify(history));
            renderHistory();
        }

        function loadHistory() {
            const saved = localStorage.getItem('wordAI_history');
            if (saved) history = JSON.parse(saved);
        }
        
        // ====== ÊØèÊó•ÁõÆÊ†áËÆæÁΩÆ ======
        function showGoalSetting() {
            const goal = prompt('ËØ∑ËÆæÁΩÆÊØèÊó•Â≠¶‰π†ÁõÆÊ†áÔºàÂçïËØçÊï∞ÔºâÔºö', challengeData.dailyGoal || 10);
            if (goal && !isNaN(goal) && goal > 0) {
                challengeData.dailyGoal = parseInt(goal);
                saveChallenge();
                loadChallenge();
                alert('ÊØèÊó•ÁõÆÊ†áÂ∑≤ËÆæÁΩÆ‰∏∫ ' + goal + ' ‰∏™ÂçïËØçÔºÅ');
            }
        }
        
        // ====== ËøûÁª≠ÊâìÂç°‰øùÊä§Âç° ======
        let streakShieldAvailable = true;
        
        function useStreakShield() {
            if (!streakShieldAvailable) {
                alert('Êú¨Âë®Â∑≤‰ΩøÁî®Ëøá‰øùÊä§Âç°ÔºÅ');
                return;
            }
            
            if (confirm('‰ΩøÁî®ËøûÁª≠ÊâìÂç°‰øùÊä§Âç°Ôºå‰ªäÂ§©‰∏çÂ≠¶‰π†‰πü‰∏ç‰ºöÊñ≠ÂºÄËøûÁª≠ÊâìÂç°ÔºåÊòØÂê¶‰ΩøÁî®Ôºü')) {
                streakShieldAvailable = false;
                localStorage.setItem('wordAI_streakShield', 'false');
                
                // ËÆ∞ÂΩï‰ªäÂ§©‰ΩøÁî®‰∫Ü‰øùÊä§Âç°
                challengeData.shieldUsedDate = new Date().toDateString();
                saveChallenge();
                
                alert('‚úÖ ‰øùÊä§Âç°Â∑≤‰ΩøÁî®ÔºÅÊòéÂ§©ÁªßÁª≠Â≠¶‰π†ÂêßÔΩû');
            }
        }
        
        function checkStreakShield() {
            const saved = localStorage.getItem('wordAI_streakShield');
            if (saved === 'false') {
                // ÊØèÂë®‰∏ÄÈáçÁΩÆ
                const today = new Date();
                const dayOfWeek = today.getDay();
                const lastReset = localStorage.getItem('wordAI_streakShieldReset');
                
                if (dayOfWeek === 1 && lastReset !== today.toDateString()) {
                    streakShieldAvailable = true;
                    localStorage.setItem('wordAI_streakShield', 'true');
                    localStorage.setItem('wordAI_streakShieldReset', today.toDateString());
                } else {
                    streakShieldAvailable = false;
                }
            }
        }
        
        function updateStreakShieldUI() {
            const btn = document.getElementById('streakShieldBtn');
            if (!btn) return;
            
            if (streakShieldAvailable) {
                btn.style.background = '#f59e0b';
                btn.textContent = 'üõ°Ô∏è ÊâìÂç°‰øùÊä§Âç°';
                btn.disabled = false;
            } else {
                btn.style.background = '#ccc';
                btn.textContent = '‚è≥ ‰∏ãÂë®‰∏ÄÂèØÁî®';
                btn.disabled = true;
            }
        }
        
        // ====== ÂàÜ‰∫´ÊâìÂç° ======
        function shareDailyChallenge() {
            const progress = challengeData.wordsLearned || 0;
            const goal = challengeData.dailyGoal || 10;
            const streak = challengeData.streakDays || 0;
            const badges = challengeData.badges ? challengeData.badges.length : 0;
            
            let statusText = '';
            if (challengeData.completed) {
                statusText = '‚úÖ ‰ªäÊó•ÊåëÊàòÂ∑≤ÂÆåÊàêÔºÅ';
            } else if (progress >= goal) {
                statusText = 'üéØ ‰ªäÊó•ÁõÆÊ†áËææÊàêÔºÅ';
            } else {
                statusText = `üî• Â≠¶‰π†‰∏≠ (${progress}/${goal})`;
            }
            
            const text = `üéØ AI ËÉåÂçïËØç - ÊØèÊó•ÊâìÂç°

üìÖ ${new Date().toLocaleDateString('zh-CN')}
${statusText}

üìä ‰ªäÊó•Êï∞ÊçÆÔºö
‚Ä¢ ÂçïËØçÂ≠¶‰π†: ${progress} / ${goal}
‚Ä¢ ËøûÁª≠ÊâìÂç°: ${streak} Â§©
‚Ä¢ Ëé∑ÂæóÂæΩÁ´†: ${badges} ‰∏™

ü§ñ ÊàëÊ≠£Âú®Áî®AIËÉåÂçïËØçÂ∞èÁ®ãÂ∫èÂ≠¶‰π†Ëã±ËØ≠Ôºå‰∏ÄËµ∑ÂêßÔºÅ

#AIËÉåÂçïËØç #Ëã±ËØ≠Â≠¶‰π† #ÊØèÊó•ÊâìÂç°`;

            if (navigator.share) {
                navigator.share({ 
                    title: 'AIËÉåÂçïËØç - ÊØèÊó•ÊâìÂç°', 
                    text: text 
                });
            } else {
                navigator.clipboard.writeText(text).then(() => {
                    alert('ÊâìÂç°ÊñáÊ°àÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ');
                }).catch(() => {
                    prompt('Â§çÂà∂‰ª•‰∏ãÂÜÖÂÆπÂàÜ‰∫´Âà∞ÊúãÂèãÂúàÔºö', text);
                });
            }
        }
        
        // ====== ÊØèÊó•Á≠æÂà∞Á≥ªÁªü ======
        let checkinData = {
            lastCheckin: '',
            streak: 0,
            history: [] // Â≠òÂÇ®Á≠æÂà∞ÂéÜÂè≤
        };
        
        function loadCheckin() {
            const saved = localStorage.getItem('wordAI_checkin');
            if (saved) {
                checkinData = JSON.parse(saved);
            }
            renderCheckinUI();
            updateCheckinStreak();
        }
        
        function saveCheckin() {
            localStorage.setItem('wordAI_checkin', JSON.stringify(checkinData));
        }
        
        function renderCheckinUI() {
            const container = document.getElementById('checkinDays');
            const today = new Date().toDateString();
            const isCheckedIn = checkinData.lastCheckin === today;
            
            let html = '';
            const days = ['‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠', 'Êó•'];
            const rewards = [5, 10, 15, 20, 25, 30, 50];
            
            for (let i = 0; i < 7; i++) {
                const dayStreak = (checkinData.streak % 7) || 7;
                const isUnlocked = i < dayStreak || (i === 0 && !isCheckedIn);
                const isToday = i === 0;
                
                html += `<div style="text-align:center;">
                    <div style="width:36px;height:36px;border-radius:50%;background:${isUnlocked ? '#667eea' : '#eee'};color:${isUnlocked ? 'white' : '#999'};display:flex;align-items:center;justify-content:center;font-size:14px;margin:0 auto 4px;">
                        ${isUnlocked ? '‚úì' : 'üîí'}
                    </div>
                    <div style="font-size:10px;color:#666;">Âë®${days[i]}</div>
                    <div style="font-size:9px;color:#999;">+${rewards[i]}</div>
                </div>`;
            }
            
            container.innerHTML = html;
            
            // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
            const btn = document.getElementById('checkinBtn');
            if (isCheckedIn) {
                btn.textContent = '‚úÖ ‰ªäÊó•Â∑≤Á≠æÂà∞';
                btn.disabled = true;
                btn.style.background = '#10b981';
            } else {
                btn.textContent = 'üìù Á´ãÂç≥Á≠æÂà∞';
                btn.disabled = false;
                btn.style.background = '';
            }
        }
        
        function updateCheckinStreak() {
            const today = new Date().toDateString();
            let streak = 0;
            
            // ËÆ°ÁÆóËøûÁª≠Á≠æÂà∞Â§©Êï∞
            if (checkinData.lastCheckin) {
                const lastDate = new Date(checkinData.lastCheckin);
                const todayDate = new Date(today);
                const diffDays = Math.floor((todayDate - lastDate) / (1000 * 60 * 60 * 24));
                
                if (diffDays === 0) {
                    streak = checkinData.streak;
                } else if (diffDays === 1) {
                    streak = checkinData.streak;
                } else {
                    streak = 0;
                }
            }
            
            document.getElementById('checkinStreak').textContent = `ËøûÁª≠Á≠æÂà∞: ${streak}Â§©`;
        }
        
        function doCheckin() {
            const today = new Date().toDateString();
            
            if (checkinData.lastCheckin === today) {
                alert('‰ªäÂ§©Â∑≤ÁªèÁ≠æÂà∞Ëøá‰∫ÜÔºÅ');
                return;
            }
            
            // ËÆ°ÁÆóÂ•ñÂä±
            const dayOfWeek = checkinData.streak % 7;
            const rewards = [5, 10, 15, 20, 25, 30, 50];
            const reward = rewards[dayOfWeek] || 5;
            
            // Êõ¥Êñ∞Á≠æÂà∞Êï∞ÊçÆ
            const lastDate = checkinData.lastCheckin ? new Date(checkinData.lastCheckin) : null;
            const todayDate = new Date(today);
            
            if (lastDate) {
                const diffDays = Math.floor((todayDate - lastDate) / (1000 * 60 * 60 * 24));
                if (diffDays === 1) {
                    checkinData.streak++;
                } else if (diffDays > 1) {
                    checkinData.streak = 1;
                }
            } else {
                checkinData.streak = 1;
            }
            
            checkinData.lastCheckin = today;
            checkinData.history.push({ date: today, reward: reward });
            
            saveCheckin();
            
            // Ê∑ªÂä†ÁªèÈ™åÂÄº
            addExp(reward);
            playSound('correct');
            
            // ÊòæÁ§∫Á≠æÂà∞ÊàêÂäü
            alert(`üéâ Á≠æÂà∞ÊàêÂäüÔºÅ\n\nËé∑Âæó ${reward} ÁªèÈ™åÂÄºÂ•ñÂä±ÔºÅ\nËøûÁª≠Á≠æÂà∞: ${checkinData.streak} Â§©`);
            
            renderCheckinUI();
            updateCheckinStreak();
        }
        
        // ====== ÊØèÊó•ÊåëÊàò ======
        function loadChallenge() {
            const saved = localStorage.getItem('wordAI_challenge');
            const today = new Date().toDateString();
            if (saved) {
                const data = JSON.parse(saved);
                if (data.date === today) {
                    challengeData = data;
                } else {
                    // Êñ∞ÁöÑ‰∏ÄÂ§©ÔºåÊ£ÄÊü•ÊòØÂê¶ÊòØÊò®Â§©ÂÆåÊàêÔºàËøûÁª≠ÊâìÂç°Ôºâ
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    const yesterdayStr = yesterday.toDateString();
                    
                    // Â¶ÇÊûúÊò®Â§©Â∑≤ÂÆåÊàêÊåëÊàò‰∏î‰ªäÂ§©ËøòÊú™ÂÆåÊàêÔºåÂ¢ûÂä†ËøûÁª≠Â§©Êï∞
                    if (data.lastCompleteDate === yesterdayStr) {
                        challengeData = { 
                            date: today, 
                            wordsLearned: 0, 
                            quizzesDone: 0, 
                            accuracy: 0, 
                            completed: false, 
                            badges: data.badges || [],
                            streakDays: (data.streakDays || 0) + 1,
                            lastCompleteDate: ''
                        };
                    } else {
                        // ‰∏≠Êñ≠‰∫ÜËøûÁª≠ÊâìÂç°ÔºåÈáçÁΩÆ
                        challengeData = { 
                            date: today, 
                            wordsLearned: 0, 
                            quizzesDone: 0, 
                            accuracy: 0, 
                            completed: false, 
                            badges: data.badges || [],
                            streakDays: 1,
                            lastCompleteDate: ''
                        };
                    }
                }
            } else {
                challengeData.date = today;
                challengeData.streakDays = 1;
            }
            document.getElementById('challengeDate').textContent = new Date().toLocaleDateString('zh-CN', { month: 'long', day: 'numeric' });
            updateChallengeUI();
            renderBadges();
            renderStreakDays();
        }
        
        // ====== Ê∏≤ÊüìËøûÁª≠ÊâìÂç°Â§©Êï∞ ======
        function renderStreakDays() {
            // Âú®ÊåëÊàòÈ°µÈù¢ÊòæÁ§∫ËøûÁª≠ÊâìÂç°Â§©Êï∞
            const statusEl = document.getElementById('challengeStatus');
            if (statusEl && challengeData.streakDays > 0) {
                const streakHtml = `<div style="margin-top:8px;font-size:12px;color:#666;">üî• ËøûÁª≠ÊâìÂç°: ${challengeData.streakDays} Â§©</div>`;
                if (!statusEl.querySelector('.streak-days')) {
                    statusEl.insertAdjacentHTML('beforeend', `<div class="streak-days">${streakHtml}</div>`);
                } else {
                    statusEl.querySelector('.streak-days').innerHTML = streakHtml;
                }
            }
        }
        
        function saveChallenge() {
            localStorage.setItem('wordAI_challenge', JSON.stringify(challengeData));
        }
        
        function updateChallengeUI() {
            const goal = challengeData.dailyGoal || 10;
            const progress = challengeData.wordsLearned;
            document.getElementById('challengeProgress').textContent = progress;
            document.getElementById('challengeGoal').textContent = goal;
            document.getElementById('challengeProgressFill').style.width = Math.min((progress / goal) * 100, 100) + '%';
            
            // Êõ¥Êñ∞‰ªªÂä°Áä∂ÊÄÅ
            document.getElementById('task1Status').textContent = challengeData.wordsLearned + '/' + goal;
            document.getElementById('task1').classList.toggle('completed', challengeData.wordsLearned >= goal);
            
            document.getElementById('task2Status').textContent = challengeData.quizzesDone + '/5';
            document.getElementById('task2').classList.toggle('completed', challengeData.quizzesDone >= 5);
            
            document.getElementById('task3Status').textContent = challengeData.accuracy + '%';
            document.getElementById('task3').classList.toggle('completed', challengeData.accuracy >= 80);
            
            // ËÆ°ÁÆóÂÆåÊàêÁöÑ‰ªªÂä°Êï∞
            const completedTasks = [challengeData.wordsLearned >= 10, challengeData.quizzesDone >= 5, challengeData.accuracy >= 80].filter(Boolean).length;
            
            // Ê£ÄÊü•ÊåëÊàòÂÆåÊàê
            if (progress >= goal && !challengeData.completed) {
                challengeData.completed = true;
                saveChallenge();
                showChallengeComplete();
            } else if (!challengeData.completed) {
                // Êõ¥Êñ∞ÊåëÊàòÁä∂ÊÄÅÊòæÁ§∫
                const statusEl = document.getElementById('challengeStatus');
                let statusIcon = 'üî•';
                let statusText = `ËøõË°å‰∏≠... (${completedTasks}/3 ‰ªªÂä°ÂÆåÊàê)`;
                
                if (completedTasks === 3) {
                    statusIcon = '‚ú®';
                    statusText = '‰ªªÂä°ÂÖ®ÈÉ®ÂÆåÊàêÔºÅÁ≠âÂæÖÊåëÊàòÂÆåÊàê...';
                } else if (progress >= goal) {
                    statusIcon = 'üéØ';
                    statusText = 'ÂçïËØç‰ªªÂä°Â∑≤ÂÆåÊàêÔºÅ';
                }
                
                if (challengeData.completed) {
                    statusEl.classList.add('completed');
                    statusEl.innerHTML = '<div class="challenge-status-icon">üéâ</div><div class="challenge-status-text">ÊåëÊàòÂÆåÊàêÔºÅ</div>';
                } else {
                    statusEl.classList.remove('completed');
                    statusEl.innerHTML = `<div class="challenge-status-icon">${statusIcon}</div><div class="challenge-status-text">${statusText}</div>`;
                }
            }
        }
        
        function renderBadges() {
            const grid = document.getElementById('badgesGrid');
            grid.innerHTML = badges.map(b => {
                const unlocked = challengeData.badges.includes(b.id);
                return `<div class="badge-item ${unlocked ? 'unlocked' : ''}">
                    <div class="badge-icon">${b.icon}</div>
                    <div class="badge-name">${b.name}</div>
                </div>`;
            }).join('');
        }
        
        function checkBadges() {
            let updated = false;
            badges.forEach(b => {
                if (challengeData.badges.includes(b.id)) return;
                const condition = new Function('wordsLearned', 'quizzesDone', 'accuracy', 'streak', 'return ' + b.condition);
                if (condition(challengeData.wordsLearned, challengeData.quizzesDone, challengeData.accuracy, streak)) {
                    challengeData.badges.push(b.id);
                    updated = true;
                    showBadgeUnlock(b);
                }
            });
            if (updated) {
                saveChallenge();
                renderBadges();
            }
        }
        
        // ====== Èü≥ÊïàÁ≥ªÁªü ======
        let soundEnabled = true;
        
        function playSound(type) {
            if (!soundEnabled) return;
            
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            switch(type) {
                case 'correct':
                    // Ê≠£Á°Æ - Ê∏ÖËÑÜÁöÑÂèÆÂ£∞
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.1);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.2);
                    break;
                case 'wrong':
                    // ÈîôËØØ - ‰ΩéÊ≤âÁöÑÂó°Â£∞
                    oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 0.3);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                    break;
                case 'levelup':
                    // ÂçáÁ∫ß - Ê¨¢Âø´ÁöÑ‰∏äÂçáÈü≥Èò∂
                    oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(600, audioContext.currentTime + 0.1);
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime + 0.2);
                    oscillator.frequency.setValueAtTime(1200, audioContext.currentTime + 0.3);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                    break;
                case 'badge':
                    // ÂæΩÁ´† - ÂèÆÂΩìÂ£∞
                    oscillator.frequency.setValueAtTime(1000, audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(1500, audioContext.currentTime + 0.1);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                    break;
                case 'complete':
                    // ÂÆåÊàê - Â∫ÜÁ•ùÈü≥
                    [500, 700, 900, 1100].forEach((freq, i) => {
                        const osc = audioContext.createOscillator();
                        const gain = audioContext.createGain();
                        osc.connect(gain);
                        gain.connect(audioContext.destination);
                        osc.frequency.setValueAtTime(freq, audioContext.currentTime + i * 0.1);
                        gain.gain.setValueAtTime(0.2, audioContext.currentTime + i * 0.1);
                        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.1 + 0.15);
                        osc.start(audioContext.currentTime + i * 0.1);
                        osc.stop(audioContext.currentTime + i * 0.1 + 0.15);
                    });
                    break;
            }
        }
        
        function showBadgeUnlock(badge) {
            playSound('badge');
            // ÂàõÂª∫Á≤æÁæéÁöÑÂæΩÁ´†Ëß£ÈîÅÂºπÁ™ó
            const modal = document.createElement('div');
            modal.id = 'badgeUnlockModal';
            modal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);display:flex;justify-content:center;align-items:center;z-index:9999;animation:fadeIn 0.3s;';
            modal.innerHTML = `
                <div style="background:white;border-radius:20px;padding:30px;text-align:center;max-width:280px;animation:bounceIn 0.5s;">
                    <div style="font-size:60px;margin-bottom:15px;">${badge.icon}</div>
                    <div style="font-size:16px;color:#667eea;font-weight:bold;margin-bottom:5px;">üéâ Êñ∞ÂæΩÁ´†Ëß£ÈîÅÔºÅ</div>
                    <div style="font-size:18px;font-weight:600;margin-bottom:10px;">${badge.name}</div>
                    <div style="font-size:12px;color:#999;margin-bottom:20px;">${badge.desc}</div>
                    <button onclick="document.getElementById('badgeUnlockModal').remove()" style="background:linear-gradient(135deg,#667eea,#764ba2);color:white;border:none;padding:12px 30px;border-radius:25px;font-size:14px;cursor:pointer;">Â§™Ê£í‰∫ÜÔºÅ</button>
                </div>
                <style>
                    @keyframes bounceIn {0%{transform:scale(0.3);opacity:0;}50%{transform:scale(1.05);}70%{transform:scale(0.9);}100%{transform:scale(1);opacity:1;}}
                    @keyframes fadeIn {from{opacity:0;}to{opacity:1;}}
                    .achievement-notification {
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: linear-gradient(135deg, #667eea, #764ba2);
                        border-radius: 16px;
                        padding: 16px 20px;
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        box-shadow: 0 10px 40px rgba(102, 126, 234, 0.4);
                        z-index: 10000;
                        transform: translateX(120%);
                        transition: transform 0.3s ease;
                    }
                    .achievement-notification.show { transform: translateX(0); }
                    .achievement-notif-icon { font-size: 36px; animation: bounceIn 0.5s; }
                    .achievement-notif-content { color: white; }
                    .achievement-notif-title { font-size: 12px; opacity: 0.9; }
                    .achievement-notif-name { font-size: 16px; font-weight: bold; }
                    .achievement-notif-desc { font-size: 11px; opacity: 0.8; }
                    .achievement-notif-close { 
                        position: absolute; top: 8px; right: 12px; 
                        color: white; opacity: 0.6; cursor: pointer; font-size: 18px; 
                    }
                </style>
            `;
            document.body.appendChild(modal);
        }
        
        function showChallengeComplete() {
            playSound('complete');
            // ËÆ∞ÂΩïÂÆåÊàêÊó•Êúü
            challengeData.lastCompleteDate = new Date().toDateString();
            saveChallenge();
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            const streakText = challengeData.streakDays > 1 ? `<p style="color:#f59e0b;font-size:16px;margin:10px 0;">üî• ËøûÁª≠ÊâìÂç° ${challengeData.streakDays} Â§©ÔºÅ</p>` : '';
            modal.innerHTML = `
                <div class="modal-content" style="text-align:center;">
                    <div style="font-size:48px;margin-bottom:20px;">üéâ</div>
                    <div class="modal-title">ÊØèÊó•ÊåëÊàòÂÆåÊàêÔºÅ</div>
                    <p style="color:#666;margin-bottom:10px;">‰ªäÂ§©ÁöÑÂ≠¶‰π†‰ªªÂä°Â∑≤ÂÆåÊàê<br>ÁªßÁª≠Âä†Ê≤πÔºåÊòéÂ§©ÂÜçÊù•ÔºÅ</p>
                    ${streakText}
                    <div style="margin:20px 0;padding:15px;background:#f9f9f9;border-radius:10px;">
                        <div style="display:flex;justify-content:space-around;">
                            <div><div style="font-size:24px;color:#667eea;font-weight:bold;">${challengeData.wordsLearned}</div><div style="font-size:11px;color:#999;">ÂçïËØç</div></div>
                            <div><div style="font-size:24px;color:#10b981;font-weight:bold;">${challengeData.quizzesDone}</div><div style="font-size:11px;color:#999;">‰π†È¢ò</div></div>
                            <div><div style="font-size:24px;color:#f59e0b;font-weight:bold;">${challengeData.accuracy}%</div><div style="font-size:11px;color:#999;">Ê≠£Á°ÆÁéá</div></div>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="this.closest('.modal').remove();renderStreakDays();">Á°ÆÂÆö</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function onWordLearned() {
            // Êõ¥Êñ∞‰ªäÊó•Â≠¶‰π†ÁªüËÆ°
            const data = JSON.parse(localStorage.getItem('wordAI_stats') || '{"total":0,"correct":0,"streak":0,"lastDate":"","today":0}');
            const today = new Date().toDateString();
            if (data.lastDate !== today) {
                data.today = 0;
            }
            const prevToday = data.today;
            data.today++;
            data.lastDate = today;
            localStorage.setItem('wordAI_stats', JSON.stringify(data));
            
            // Ê£ÄÊü•ÊòØÂê¶ËææÊàêÁõÆÊ†á
            const goal = challengeData.dailyGoal || 10;
            if (prevToday < goal && data.today === goal) {
                showGoalCelebration();
            }
            
            // Ê∑ªÂä†ÁªèÈ™åÂÄº
            addExp(expConfig.perWord);
            
            // Êõ¥Êñ∞È¶ñÈ°µËøõÂ∫¶Êù°
            updateLearnProgress();
            
            // Ëá™Âä®Ê∑ªÂä†ÂΩìÂâçÂçïËØçÂà∞Â§ç‰π†ËÆ°Âàí
            if (words[currentIndex]) {
                addToReview(words[currentIndex]);
            }
            
            // ‰øùÂ≠òËØç‰π¶Â≠¶‰π†ËøõÂ∫¶
            const currentBookId = localStorage.getItem('wordAI_currentBook') || currentBook;
            saveBookProgress(currentBookId);
            
            challengeData.wordsLearned++;
            if (challengeData.quizzesDone > 0) {
                challengeData.accuracy = Math.round((correct / total) * 100);
            }
            saveChallenge();
            updateChallengeUI();
            checkBadges();
        }

        function showGoalCelebration() {
            // ÂàõÂª∫Â∫ÜÁ•ùÂä®Áîª
            const modal = document.createElement('div');
            modal.id = 'goalCelebration';
            modal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);display:flex;justify-content:center;align-items:center;z-index:9999;';
            
            const goal = challengeData.dailyGoal || 10;
            modal.innerHTML = `
                <div style="background:white;border-radius:20px;padding:40px;text-align:center;max-width:300px;animation:bounceIn 0.6s;">
                    <div style="font-size:60px;margin-bottom:15px;">üéâ</div>
                    <div style="font-size:22px;font-weight:bold;color:#667eea;margin-bottom:10px;">üéØ ÁõÆÊ†áËææÊàêÔºÅ</div>
                    <div style="font-size:14px;color:#666;margin-bottom:20px;">‰ªäÂ§©Â∑≤Â≠¶‰π† ${goal} ‰∏™ÂçïËØçÔºÅ</div>
                    <div style="display:flex;justify-content:center;gap:10px;flex-wrap:wrap;">
                        <span style="font-size:30px;">‚≠ê</span>
                        <span style="font-size:30px;">üèÜ</span>
                        <span style="font-size:30px;">üí™</span>
                    </div>
                    <button onclick="document.getElementById('goalCelebration').remove()" style="margin-top:25px;background:linear-gradient(135deg,#667eea,#764ba2);color:white;border:none;padding:12px 30px;border-radius:25px;font-size:14px;cursor:pointer;">Â§™Ê£í‰∫ÜÔºÅ</button>
                </div>
                <style>
                    @keyframes bounceIn {0%{transform:scale(0);}50%{transform:scale(1.1);}70%{transform:scale(0.95);}100%{transform:scale(1);}}
                </style>
            `;
            document.body.appendChild(modal);
            
            // Êí≠ÊîæÂ∫ÜÁ•ùÈü≥Êïà
            if (soundEnabled) playSound('levelup');
        }

        function updateLearnProgress() {
            const data = JSON.parse(localStorage.getItem('wordAI_stats') || '{"today":0}');
            const goal = challengeData.dailyGoal || 10;
            const progress = document.getElementById('learnProgress');
            const progressText = document.getElementById('todayProgressText');
            const progressBar = document.getElementById('todayProgressBar');
            
            if (progress && progressText && progressBar) {
                progress.style.display = 'block';
                const percent = Math.min(100, (data.today / goal) * 100);
                progressText.textContent = `${data.today}/${goal}`;
                progressBar.style.width = percent + '%';
                
                // ÂÆåÊàêÂêéÊîπÂèòÈ¢úËâ≤
                if (data.today >= goal) {
                    progressBar.style.background = 'linear-gradient(90deg,#52C41A,#73D13D)';
                }
            }
        }

        function addToReview(word) {
            const reviewData = JSON.parse(localStorage.getItem('wordAI_review') || '[]');
            if (!reviewData.find(r => r.word === word.word)) {
                reviewData.push({
                    word: word.word,
                    phonetic: word.phonetic,
                    meaning: word.meaning,
                    quality: 0,
                    easinessFactor: 2.5,
                    interval: 0,
                    repetitions: 0,
                    nextReview: Date.now() + 24 * 60 * 60 * 1000, // 1Â§©ÂêéÂ§ç‰π†
                    lastReview: null
                });
                localStorage.setItem('wordAI_review', JSON.stringify(reviewData));
            }
        }
        
        function onQuizDone() {
            challengeData.quizzesDone++;
            if (total > 0) {
                challengeData.accuracy = Math.round((correct / total) * 100);
            }
            saveChallenge();
            updateChallengeUI();
            checkBadges();
            // Ê∑ªÂä†ÁªèÈ™åÂÄº
            addExp(expConfig.perQuiz);
        }
        
        // ====== ËâæÂÆæÊµ©ÊñØÈÅóÂøòÊõ≤Á∫øÁÆóÊ≥ï ======
        // Âü∫‰∫éËâæÂÆæÊµ©ÊñØÈÅóÂøòÊõ≤Á∫øËÆ°ÁÆóÊúÄ‰Ω≥Â§ç‰π†Èó¥Èöî
        // ÂÖ¨Âºè: I(n) = I(n-1) * EF
        // EF (Easiness Factor): ÂàùÂßã2.5, ÊúÄ‰Ωé1.3
        // quality: 0-5 (0=ÂÆåÂÖ®ÂøòËÆ∞, 5=ÂÆåÁæéËÆ∞‰Ωè)
        const EBINGHAUS_INTERVALS = [1, 3, 7, 14, 30, 60]; // Âü∫Á°ÄÈó¥ÈöîÂ§©Êï∞
        
        function calculateEbbinghausInterval(word, quality) {
            let { easinessFactor = 2.5, repetitions = 0, interval = 1 } = word;
            
            // Ê†πÊçÆËÆ∞ÂøÜË¥®ÈáèË∞ÉÊï¥
            if (quality < 3) {
                // ÂøòËÆ∞ÔºåÈáçÁΩÆ
                repetitions = 0;
                interval = 1;
            } else {
                // ËÆ∞‰Ωè
                if (repetitions === 0) {
                    interval = 1;
                } else if (repetitions === 1) {
                    interval = 3;
                } else {
                    interval = Math.round(interval * easinessFactor);
                }
                repetitions++;
            }
            
            // Ë∞ÉÊï¥ easinessFactor
            easinessFactor = easinessFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
            if (easinessFactor < 1.3) easinessFactor = 1.3;
            
            return { interval, easinessFactor, repetitions };
        }
        
        function getNextReviewDate(interval) {
            const nextDate = new Date();
            nextDate.setDate(nextDate.getDate() + interval);
            return nextDate;
        }
        
        // ====== ÁªüËÆ°ÂäüËÉΩ ======
        function renderStats() {
            // Âü∫Êú¨ÁªüËÆ°
            document.getElementById('statsTotal').textContent = total;
            document.getElementById('statsCorrect').textContent = correct;
            document.getElementById('statsStreak').textContent = streak;
            const acc = total > 0 ? Math.round((correct / total) * 100) : 0;
            document.getElementById('statsAccuracy').textContent = acc + '%';
            
            // ËØçÊ±áÈáèËØÑ‰º∞
            renderVocabEstimate();
            
            // Â¢ûÂº∫ÁªüËÆ°
            const mastered = words.filter(w => w.status === 'mastered').length;
            const learning = words.filter(w => w.status === 'learning').length;
            const newCount = words.filter(w => w.status === 'new').length;
            const newWords = newWords ? newWords.length : 0;
            const wrongCount = wrongWords ? wrongWords.length : 0;
            
            // Êõ¥Êñ∞‰∏™‰∫∫‰∏≠ÂøÉÁªüËÆ°
            document.getElementById('profileTotal').textContent = total;
            document.getElementById('profileStreak').textContent = streak;
            const badges = challengeData.badges ? challengeData.badges.length : 0;
            document.getElementById('profileBadges').textContent = badges;
            
            // Ê∏≤ÊüìËÆ∞ÂøÜÊõ≤Á∫ø
            renderMemoryChart();
            
            // Ê∏≤ÊüìÂ≠¶‰π†Êó•ÂéÜ
            renderLearningCalendar();
            
            // Ê∏≤ÊüìÊàêÂ∞±
            renderAchievements();
        }
        
        // ====== Â≠¶‰π†Êó•ÂéÜ ======
        function renderLearningCalendar() {
            const calendar = document.getElementById('learningCalendar');
            if (!calendar) return;
            
            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startWeekDay = firstDay.getDay();
            
            // ÊûÑÂª∫Â≠¶‰π†Êï∞ÊçÆÊò†Â∞Ñ
            const learnData = {};
            history.forEach(h => {
                learnData[h.date] = h.total || 0;
            });
            
            // Ëé∑ÂèñÂΩìÊúàÊï∞ÊçÆ
            let monthTotal = 0;
            for (let d = 1; d <= daysInMonth; d++) {
                const date = new Date(year, month, d);
                const dateStr = date.toISOString().split('T')[0];
                if (learnData[dateStr]) monthTotal += learnData[dateStr];
            }
            
            // ÁîüÊàêÊó•ÂéÜHTML
            const weekDays = ['Êó•', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠'];
            let html = `<div class="calendar-header">
                <span>${year}Âπ¥${month + 1}Êúà</span>
                <span>Êú¨ÊúàÂ≠¶‰π†: ${monthTotal} ËØç</span>
            </div>`;
            
            html += '<div class="calendar-grid">';
            // ÊòüÊúüÊ†áÈ¢ò
            weekDays.forEach(w => html += `<div style="text-align:center;font-size:10px;color:#999;">${w}</div>`);
            
            // Â°´ÂÖÖÁ©∫ÁôΩ
            for (let i = 0; i < startWeekDay; i++) {
                html += '<div class="calendar-day"></div>';
            }
            
            // Êó•Êúü
            const todayStr = today.toISOString().split('T')[0];
            for (let d = 1; d <= daysInMonth; d++) {
                const date = new Date(year, month, d);
                const dateStr = date.toISOString().split('T')[0];
                const learned = learnData[dateStr] || 0;
                const isToday = dateStr === todayStr;
                const isLearned = learned > 0;
                
                html += `<div class="calendar-day ${isLearned ? 'learned' : ''} ${isToday ? 'today' : ''}">${d}</div>`;
            }
            html += '</div>';
            
            html += `<div class="calendar-legend">
                <div class="legend-item"><div class="legend-dot" style="background:#ddd"></div>Êú™Â≠¶‰π†</div>
                <div class="legend-item"><div class="legend-dot" style="background:#667eea"></div>Â∑≤Â≠¶‰π†</div>
            </div>`;
            
            calendar.innerHTML = html;
        }
        
        // ====== ËØçÊ±áÈáèËØÑ‰º∞ ======
        function renderVocabEstimate() {
            const vocabLevels = [
                { level: 1, name: 'ÂàùÂ≠¶ËÄÖ', threshold: 0 },
                { level: 2, name: 'ÂÖ•Èó®', threshold: 50 },
                { level: 3, name: 'ËøõÈò∂', threshold: 150 },
                { level: 4, name: 'ÁÜüÁªÉ', threshold: 300 },
                { level: 5, name: 'Á≤æÈÄö', threshold: 500 },
                { level: 6, name: '‰∏ìÂÆ∂', threshold: 800 },
                { level: 7, name: 'Â§ßÂ∏à', threshold: 1200 },
                { level: 8, name: 'ÁéãËÄÖ', threshold: 1800 },
                { level: 9, name: '‰º†Â•á', threshold: 2500 },
                { level: 10, name: 'Á•ûËØù', threshold: 3500 }
            ];
            
            // ËÆ°ÁÆóÂΩìÂâçÁ∫ßÂà´ÂíåËøõÂ∫¶
            let currentLevel = 1;
            let nextThreshold = 50;
            let progress = 0;
            
            for (let i = 0; i < vocabLevels.length; i++) {
                if (total >= vocabLevels[i].threshold) {
                    currentLevel = vocabLevels[i].level;
                    if (i < vocabLevels.length - 1) {
                        nextThreshold = vocabLevels[i + 1].threshold;
                        progress = ((total - vocabLevels[i].threshold) / (nextThreshold - vocabLevels[i].threshold)) * 100;
                    } else {
                        progress = 100;
                    }
                }
            }
            
            const currentLevelData = vocabLevels[currentLevel - 1];
            const needCount = nextThreshold - total;
            
            document.getElementById('vocabLevel').textContent = 'Lv.' + currentLevel;
            document.getElementById('vocabLevel').parentElement.querySelector('.vocab-desc').textContent = currentLevelData.name;
            document.getElementById('vocabBar').style.width = Math.min(progress, 100) + '%';
            document.getElementById('vocabNeed').textContent = Math.max(needCount, 0);
        }
        
        function renderMemoryChart() {
            const chart = document.getElementById('memoryChart');
            const days = 7;
            const data = [];
            
            // ÁîüÊàêÊ®°ÊãüÊï∞ÊçÆ
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                const historyItem = history.find(h => h.date === dateStr);
                data.push({
                    day: date.getDate(),
                    value: historyItem ? historyItem.total : Math.floor(Math.random() * 10)
                });
            }
            
            const maxVal = Math.max(...data.map(d => d.value), 1);
            chart.innerHTML = data.map(d => {
                const height = Math.max((d.value / maxVal) * 100, 5);
                return `<div class="memory-bar" style="height: ${height}%" data-day="${d.day}Êó•"></div>`;
            }).join('');
        }
        
        // ====== ÊàêÂ∞±Á≥ªÁªü ======
        const achievements = [
            { id: 'first_word', name: 'È¶ñÊ¨°Â≠¶‰π†', desc: 'ÂÆåÊàêÁ¨¨‰∏Ä‰∏™ÂçïËØç', icon: 'üå±', condition: (d) => d.total >= 1 },
            { id: 'ten_words', name: 'Â∞èËØïÁâõÂàÄ', desc: 'Â≠¶‰π†10‰∏™ÂçïËØç', icon: '‚≠ê', condition: (d) => d.total >= 10 },
            { id: 'fifty_words', name: 'Â≠¶ÂØå‰∫îËΩ¶', desc: 'Â≠¶‰π†50‰∏™ÂçïËØç', icon: 'üìö', condition: (d) => d.total >= 50 },
            { id: 'hundred_words', name: 'ÁôæËØçÊñ©', desc: 'Â≠¶‰π†100‰∏™ÂçïËØç', icon: 'üíØ', condition: (d) => d.total >= 100 },
            { id: 'five_hundred', name: 'ËØçÊ±áËææ‰∫∫', desc: 'Â≠¶‰π†500‰∏™ÂçïËØç', icon: 'üìñ', condition: (d) => d.total >= 500 },
            { id: 'streak_3', name: '‰∏âËøûËÉú', desc: 'ËøûÁª≠3Â§©Â≠¶‰π†', icon: 'üî•', condition: (d) => d.streak >= 3 },
            { id: 'streak_7', name: 'Âë®ÂÜ†ÂÜõ', desc: 'ËøûÁª≠7Â§©Â≠¶‰π†', icon: 'üëë', condition: (d) => d.streak >= 7 },
            { id: 'streak_30', name: 'ÊúàÂÜ†ÂÜõ', desc: 'ËøûÁª≠30Â§©Â≠¶‰π†', icon: 'üèÖ', condition: (d) => d.streak >= 30 },
            { id: 'perfect_score', name: 'Êª°ÂàÜÈÄöËøá', desc: 'Ê≠£Á°ÆÁéá100%', icon: 'üéØ', condition: (d) => d.total >= 10 && d.accuracy >= 100 },
            { id: 'speed_learner', name: 'Âø´ÈÄüÂ≠¶‰π†', desc: '‰∏ÄÂ§©Â≠¶‰π†20ËØç', icon: '‚ö°', condition: (d) => d.today >= 20 },
            { id: 'master', name: 'ÂçïËØçÂ§ßÂ∏à', desc: 'ÊéåÊè°100‰∏™ËØç', icon: 'üèÜ', condition: (d) => d.mastered >= 100 },
            { id: 'collector', name: 'Êî∂ËóèÂÆ∂', desc: 'Êî∂Ëóè10‰∏™ÂçïËØç', icon: '‚ù§Ô∏è', condition: (d) => d.favorites >= 10 },
            { id: 'error_corrector', name: 'ÈîôÈ¢òÊ∏ÖÈõ∂', desc: 'ÊéåÊè°ÂÖ®ÈÉ®ÈîôÈ¢ò', icon: '‚úÖ', condition: (d) => d.wrongCount === 0 },
            { id: 'early_bird', name: 'Êó©Ëµ∑È∏ü', desc: 'Êó©Êô®Â≠¶‰π†', icon: 'üåÖ', condition: (d) => new Date().getHours() < 9 },
            { id: 'night_owl', name: 'Â§úÁå´Â≠ê', desc: 'Ê∑±Â§úÂ≠¶‰π†', icon: 'ü¶â', condition: (d) => new Date().getHours() >= 22 },
            { id: 'polyglot', name: 'Â§öËØ≠Ë®ÄËÄÖ', desc: 'Â≠¶‰π†3ÁßçËØ≠Ë®Ä', icon: 'üåç', condition: (d) => d.languages >= 3 }
        ];
        
        function renderAchievements() {
            const list = document.getElementById('achievementList');
            const today = new Date().toISOString().split('T')[0];
            const todayHistory = history.find(h => h.date === today);
            const todayData = { total, correct, streak, accuracy: total > 0 ? Math.round((correct / total) * 100) : 0, today: todayHistory ? todayHistory.total : 0, mastered: words.filter(w => w.status === 'mastered').length };
            
            list.innerHTML = achievements.map(a => {
                const unlocked = a.condition(todayData);
                return `<div class="achievement-item ${unlocked ? 'unlocked' : ''}">
                    <div class="achievement-icon">${a.icon}</div>
                    <div class="achievement-info">
                        <div class="achievement-name">${a.name}</div>
                        <div class="achievement-desc">${a.desc}</div>
                    </div>
                    <div class="achievement-status">${unlocked ? 'Â∑≤Ëß£ÈîÅ' : 'Êú™Ëß£ÈîÅ'}</div>
                </div>`;
            }).join('');
        }
        
        // ====== Â§öËØ≠Ë®ÄÂçïËØçÂ∫ì ======
        const languageWords = {
            en: [
                { word: 'hello', phonetic: '/h…ôÀàlo ä/', meaning: '‰Ω†Â•Ω' },
                { word: 'world', phonetic: '/w…úÀêrld/', meaning: '‰∏ñÁïå' },
                { word: 'love', phonetic: '/l åv/', meaning: 'Áà±' },
                { word: 'happy', phonetic: '/Ààh√¶pi/', meaning: 'Âø´‰πê' },
                { word: 'learn', phonetic: '/l…úÀêrn/', meaning: 'Â≠¶‰π†' },
                { word: 'book', phonetic: '/b äk/', meaning: '‰π¶' },
                { word: 'water', phonetic: '/Ààw…îÀêt…ôr/', meaning: 'Ê∞¥' },
                { word: 'food', phonetic: '/fuÀêd/', meaning: 'È£üÁâ©' },
                { word: 'friend', phonetic: '/frend/', meaning: 'ÊúãÂèã' },
                { word: 'family', phonetic: '/Ààf√¶m…ôli/', meaning: 'ÂÆ∂Â∫≠' },
                { word: 'time', phonetic: '/ta…™m/', meaning: 'Êó∂Èó¥' },
                { word: 'money', phonetic: '/Ààm åni/', meaning: 'Èí±' },
                { word: 'work', phonetic: '/w…úÀêrk/', meaning: 'Â∑•‰Ωú' },
                { word: 'study', phonetic: '/Ààst ådi/', meaning: 'Â≠¶‰π†' },
                { word: 'computer', phonetic: '/k…ômÀàpjuÀêt…ôr/', meaning: 'ÁîµËÑë' }
            ],
            ja: [
                { word: '„Åì„Çì„Å´„Å°„ÅØ', phonetic: 'kon-ni-chi-wa', meaning: '‰Ω†Â•Ω' },
                { word: '„Åï„Çà„ÅÜ„Å™„Çâ', phonetic: 'sa-yo-na-ra', meaning: 'ÂÜçËßÅ' },
                { word: '„ÅÇ„Çä„Åå„Å®„ÅÜ', phonetic: 'a-ri-ga-to', meaning: 'Ë∞¢Ë∞¢' },
                { word: 'È£ü„Åπ„Çã', phonetic: 'ta-be-ru', meaning: 'ÂêÉ' },
                { word: 'È£≤„ÇÄ', phonetic: 'no-mu', meaning: 'Âñù' },
                { word: 'Ê∞¥', phonetic: 'mi-zu', meaning: 'Ê∞¥' },
                { word: 'Êú¨', phonetic: 'hon', meaning: '‰π¶' },
                { word: 'ÂèãÈÅî', phonetic: 'to-mo-da-chi', meaning: 'ÊúãÂèã' },
                { word: 'ÂÆ∂Êóè', phonetic: 'ka-zo-ku', meaning: 'ÂÆ∂Êóè' },
                { word: '‰ªï‰∫ã', phonetic: 'shi-go-to', meaning: 'Â∑•‰Ωú' }
            ],
            ko: [
                { word: 'ÏïàÎÖïÌïòÏÑ∏Ïöî', phonetic: 'an-nyeong-ha-se-yo', meaning: '‰Ω†Â•Ω' },
                { word: 'Í∞êÏÇ¨Ìï©ÎãàÎã§', phonetic: 'gam-sa-ham-ni-da', meaning: 'Ë∞¢Ë∞¢' },
                { word: 'ÏïàÎÖï', phonetic: 'an-nyeong', meaning: 'ÂÜçËßÅ' },
                { word: 'ÏÇ¨Îûë', phonetic: 'sa-rang', meaning: 'Áà±' },
                { word: 'ÏùåÏãù', phonetic: 'eum-sik', meaning: 'È£üÁâ©' },
                { word: 'Î¨º', phonetic: 'mul', meaning: 'Ê∞¥' },
                { word: 'Ï±Ö', phonetic: 'chaek', meaning: '‰π¶' },
                { word: 'ÏπúÍµ¨', phonetic: 'chin-gu', meaning: 'ÊúãÂèã' },
                { word: 'Í∞ÄÏ°±', phonetic: 'ga-jok', meaning: 'ÂÆ∂Â∫≠' },
                { word: 'Ïùº', phonetic: 'il', meaning: 'Â∑•‰Ωú' }
            ],
            fr: [
                { word: 'bonjour', phonetic: '/b…îÃÉ íu Å/', meaning: '‰Ω†Â•Ω' },
                { word: 'merci', phonetic: '/m…õ Åsi/', meaning: 'Ë∞¢Ë∞¢' },
                { word: 'amour', phonetic: '/amu Å/', meaning: 'Áà±' },
                { word: 'bon', phonetic: '/b…îÃÉ/', meaning: 'Â•Ω' },
                { word: 'apprendre', phonetic: '/ap Å…ëÃÉd Å/', meaning: 'Â≠¶‰π†' },
                { word: 'eau', phonetic: '/o/', meaning: 'Ê∞¥' },
                { word: 'livre', phonetic: '/liv Å/', meaning: '‰π¶' },
                { word: 'ami', phonetic: '/ami/', meaning: 'ÊúãÂèã' },
                { word: 'famille', phonetic: '/famij/', meaning: 'ÂÆ∂Â∫≠' },
                { word: 'travail', phonetic: '/travaj/', meaning: 'Â∑•‰Ωú' }
            ]
        };
        
        let currentLang = 'en';
        
        function switchLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('.lang-card').forEach(c => c.classList.remove('active'));
            event.target.closest('.lang-card').classList.add('active');
            words = [...languageWords[lang]];
            showCard();
            alertToToast('Â∑≤ÂàáÊç¢Âà∞' + {en:'Ëã±ËØ≠',ja:'Êó•ËØ≠',ko:'Èü©ËØ≠',fr:'Ê≥ïËØ≠'}[lang] + 'Â≠¶‰π†Ê®°ÂºèÔºÅ');
        }
        
        // ====== Â≠¶‰π†Â∞èÁªÑ ======
        let groupData = null;
        
        function loadGroup() {
            const saved = localStorage.getItem('wordAI_group');
            if (saved) groupData = JSON.parse(saved);
            renderRanking();
            renderGroupFeed();
            renderFriendRecommendations();
        }
        
        // ====== Â∞èÁªÑÂä®ÊÄÅ ======
        function renderGroupFeed() {
            const container = document.getElementById('feedList');
            if (!container) return;
            
            // ÁîüÊàêÊ®°ÊãüÂä®ÊÄÅ
            const actions = ['ÂÆåÊàê‰∫Ü10‰∏™ÂçïËØç', 'ËøûÁª≠Â≠¶‰π†3Â§©', 'Ëé∑Âæó‰∫ÜÊñ∞ÂæΩÁ´†', 'Ê≠£Á°ÆÁéáËææÂà∞90%', 'ÂÆåÊàê‰∫Ü‰ªäÊó•ÁõÆÊ†á'];
            const avatars = ['A', 'B', 'C', 'D', 'E'];
            const names = ['Â≠¶‰π†Ëææ‰∫∫', 'ÂùöÊåÅ‰∏çÊáà', 'ËøõÊ≠•È£ûÂø´', 'ÂçïËØçÂ§ßÂ∏à', 'Êó©Ëµ∑È∏ü'];
            
            const feed = [];
            for (let i = 0; i < 5; i++) {
                feed.push({
                    avatar: avatars[i],
                    name: names[i],
                    action: actions[i],
                    time: Math.floor(Math.random() * 60) + 1 + 'ÂàÜÈíüÂâç'
                });
            }
            
            container.innerHTML = feed.map(f => `
                <div class="feed-item">
                    <div class="feed-avatar">${f.avatar}</div>
                    <div class="feed-content">
                        <div class="feed-name">${f.name}</div>
                        <div class="feed-action">${f.action}</div>
                        <div class="feed-time">${f.time}</div>
                    </div>
                </div>
            `).join('');
        }
        
        // ====== Â•ΩÂèãÊé®Ëçê ======
        function renderFriendRecommendations() {
            const container = document.getElementById('friendRecommendations');
            if (!container) return;
            
            const recommendations = [
                { name: 'Â∞èÊòé', avatar: 'üë¶', words: 520, level: 'Lv.5' },
                { name: 'Â∞èÁ∫¢', avatar: 'üëß', words: 380, level: 'Lv.4' },
                { name: 'Â≠¶‰π†ÂßîÂëò', avatar: 'üìö', words: 1200, level: 'Lv.8' }
            ];
            
            container.innerHTML = recommendations.map(r => `
                <div style="display:flex;align-items:center;gap:12px;padding:10px;background:white;border-radius:12px;margin-bottom:8px;">
                    <div style="font-size:28px;">${r.avatar}</div>
                    <div style="flex:1;">
                        <div style="font-size:14px;font-weight:500;">${r.name}</div>
                        <div style="font-size:12px;color:#666;">${r.level} ¬∑ ${r.words}ËØç</div>
                    </div>
                    <button class="btn" style="font-size:12px;padding:6px 12px;background:#667eea;color:white;" onclick="addFriend('${r.name}')">+ÂÖ≥Ê≥®</button>
                </div>
            `).join('');
        }
        
        function addFriend(name) {
            alert('Â∑≤Âêë' + name + 'ÂèëÈÄÅÂÖ≥Ê≥®ËØ∑Ê±ÇÔºÅ');
        }
        
        // ====== AI Âä©ÊâãËÅäÂ§© ======
        function sendAIMessage() {
            const input = document.getElementById('aiInput');
            const message = input.value.trim();
            if (!message) return;
            
            // Ê∑ªÂä†Áî®Êà∑Ê∂àÊÅØ
            addAIMessage(message, 'user');
            input.value = '';
            
            // ÊòæÁ§∫ÊÄùËÄÉ‰∏≠
            showAIThinking();
            
            // ÁîüÊàêÂõûÂ§ç
            setTimeout(() => {
                removeAIThinking();
                const reply = generateAIReply(message);
                addAIMessage(reply, 'ai');
            }, 1000);
        }
        
        function askAI(question) {
            document.getElementById('aiInput').value = question;
            sendAIMessage();
        }
        
        function addAIMessage(text, sender) {
            const container = document.getElementById('aiMessages');
            const div = document.createElement('div');
            div.className = `ai-message ${sender}`;
            div.innerHTML = `
                <div class="ai-avatar">${sender === 'ai' ? 'ü§ñ' : 'üë§'}</div>
                <div class="ai-bubble">${text}</div>
            `;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }
        
        function showAIThinking() {
            const container = document.getElementById('aiMessages');
            const div = document.createElement('div');
            div.className = 'ai-message ai';
            div.id = 'aiThinking';
            div.innerHTML = `
                <div class="ai-avatar">ü§ñ</div>
                <div class="ai-bubble">Ê≠£Âú®ÊÄùËÄÉ...</div>
            `;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }
        
        function removeAIThinking() {
            document.getElementById('aiThinking')?.remove();
        }
        
        function generateAIReply(message) {
            const data = loadStats();
            const lowerMsg = message.toLowerCase();
            
            // Âü∫‰∫éÂÖ≥ÈîÆËØçÁîüÊàêÂõûÂ§ç
            if (lowerMsg.includes('ËÉåÂçïËØç') || lowerMsg.includes('ËÆ∞ÂøÜ')) {
                return 'Ê†πÊçÆËâæÂÆæÊµ©ÊñØÈÅóÂøòÊõ≤Á∫øÔºåÂª∫ËÆÆ‰Ω†Ôºö\n\n1. üïê Â≠¶‰π†Êñ∞ÂçïËØçÂêéÔºå24Â∞èÊó∂ÂÜÖÂ§ç‰π†\n2. üìù Â§öÊ¨°ÈáçÂ§çÔºåÂä†Ê∑±Âç∞Ë±°\n3. üéØ ÈáçÁÇπËÆ∞ÂøÜÂÆπÊòìÂøòËÆ∞ÁöÑÂçïËØç\n4. üí™ ÊØèÂ§©ÂùöÊåÅÔºåÂΩ¢Êàê‰π†ÊÉØ\n\nÂùöÊåÅÂ∞±ÊòØËÉúÂà©ÔºÅ';
            }
            
            if (lowerMsg.includes('Ê∞¥Âπ≥') || lowerMsg.includes('ËÉΩÂäõ')) {
                const total = data.total || 0;
                let level = '';
                if (total < 50) level = 'ÂàùÂ≠¶ËÄÖ';
                else if (total < 100) level = 'ÂÖ•Èó®';
                else if (total < 300) level = 'ËøõÈò∂';
                else if (total < 500) level = 'ÁÜüÁªÉ';
                else if (total < 1000) level = 'Á≤æÈÄö';
                else level = 'Â§ßÂ∏à';
                
                return `Ê†πÊçÆ‰Ω†ÁöÑÂ≠¶‰π†Êï∞ÊçÆÔºö\n\nüìä ÊÄªÂ≠¶‰π†ÂçïËØçÔºö${total}‰∏™\n‚úÖ Ê≠£Á°ÆÁéáÔºö${data.total > 0 ? Math.round((data.correct / data.total) * 100) : 0}%\nüî• ËøûÁª≠Â≠¶‰π†Ôºö${data.streak || 0}Â§©\n\n‰Ω†ÁöÑÊ∞¥Âπ≥Â§ßÊ¶ÇÊòØÔºö**${level}**ÔºåÁªßÁª≠Âä†Ê≤πÔºÅ`;
            }
            
            if (lowerMsg.includes('Â§ç‰π†') || lowerMsg.includes('‰ªäÂ§©')) {
                const reviewData = JSON.parse(localStorage.getItem('wordAI_review') || '[]');
                const now = Date.now();
                const dueCount = reviewData.filter(w => w.nextReview && w.nextReview <= now).length;
                const wrongCount = wrongWords.length;
                
                if (dueCount > 0 || wrongCount > 0) {
                    return `‰ªäÂ§©ÁöÑÂ§ç‰π†Âª∫ËÆÆÔºö\n\nüìù ÈúÄË¶ÅÂ§ç‰π†Ôºö${dueCount}‰∏™ÂçïËØç\n‚ùå ÈîôÈ¢òÊú¨Ôºö${wrongCount}‰∏™\n\nÂª∫ËÆÆÂÖàÂ§ç‰π†ÈîôÈ¢òÔºåÂÜçÂÆåÊàêËâæÂÆæÊµ©ÊñØÂ§ç‰π†‰ªªÂä°ÔºÅ`;
                } else {
                    return `‰ªäÂ§©ÁöÑÂ≠¶‰π†ÂÆâÊéíÂª∫ËÆÆÔºö\n\n‚úÖ Â§ç‰π†‰ªªÂä°Â∑≤ÂÆåÊàê\nüéØ ÂèØ‰ª•ÂºÄÂßãÂ≠¶‰π†Êñ∞ÂçïËØç\n‚öîÔ∏è ÂèÇÂä†ÂçïËØçÊåëÊàòËµõ\n\n‰øùÊåÅÂ≠¶‰π†ËäÇÂ•èÔºåÊòéÂ§©ÁªßÁª≠ÔºÅ`;
                }
            }
            
            if (lowerMsg.includes('Â∏ÆÂä©') || lowerMsg.includes('ËÉΩÂÅö‰ªÄ‰πà')) {
                return `ÊàëÂèØ‰ª•Â∏Æ‰Ω†Ôºö\n\nüìö Ëß£Á≠îÂ≠¶‰π†ÈóÆÈ¢ò\nüìä ÂàÜÊûê‰Ω†ÁöÑÂ≠¶‰π†Êï∞ÊçÆ\nüí° Êèê‰æõËÆ∞ÂøÜÊäÄÂ∑ß\nüéØ Âà∂ÂÆöÂ§ç‰π†ËÆ°Âàí\n‚ùì ÂõûÁ≠î‰ªª‰ΩïÈóÆÈ¢ò\n\nÈöèÊó∂ÈóÆÊàëÂêßÔºÅ`;
            }
            
            if (lowerMsg.includes('Ê≠£Á°ÆÁéá') || lowerMsg.includes('ÊèêÈ´ò')) {
                return `ÊèêÈ´òÊ≠£Á°ÆÁéáÁöÑÂª∫ËÆÆÔºö\n\n1. üìñ ÂÖàÁêÜËß£ÂçïËØçÂê´‰πâÂÜçËÆ∞ÂøÜ\n2. üîÑ Â§öÊ¨°Â§ç‰π†Âä†Ê∑±Âç∞Ë±°\n3. üìù Ê≥®ÊÑèÊòìÊ∑∑Ê∑ÜÁöÑÂçïËØç\n4. üéß ÁªìÂêàÂèëÈü≥ËÆ∞ÂøÜ\n\nÊÖ¢ÊÖ¢Êù•ÔºåÂùöÊåÅÂ∞±ÊòØËÉúÂà©ÔºÅ`;
            }
            
            // ÈªòËÆ§ÂõûÂ§ç
            const replies = [
                'Ëøô‰∏™ÈóÆÈ¢òÂæàÊúâÊ∑±Â∫¶ÔºÅËÆ©ÊàëÊÉ≥ÊÉ≥...',
                'Â•ΩÁöÑÈóÆÈ¢òÔºÅÊàëÂª∫ËÆÆ‰Ω†ÂèØ‰ª•ËØïËØïËøô‰∏™ÊñπÊ≥ï...',
                'Ê†πÊçÆ‰Ω†ÁöÑÂ≠¶‰π†ÊÉÖÂÜµÔºåÊàëÂª∫ËÆÆ...',
                'ËÆ©ÊàëÂàÜÊûê‰∏Ä‰∏ã‰Ω†ÁöÑÊï∞ÊçÆ...',
                'Â≠¶‰π†ÊòØ‰∏Ä‰∏™Âæ™Â∫èÊ∏êËøõÁöÑËøáÁ®ãÔºåÂà´ÁùÄÊÄ•...'
            ];
            return replies[Math.floor(Math.random() * replies.length)];
        }
        
        function createGroup() {
            const name = prompt('ËØ∑ËæìÂÖ•Â∞èÁªÑÂêçÁß∞:');
            if (!name) return;
            groupData = { name, members: [{name: user?.username || 'Êàë', score: total, avatar: 'üòÄ'}] };
            localStorage.setItem('wordAI_group', JSON.stringify(groupData));
            alert('Â∞èÁªÑÂàõÂª∫ÊàêÂäüÔºÅ');
            renderRanking();
        }
        
        function joinGroup() {
            alert('Âä†ÂÖ•Â∞èÁªÑÂäüËÉΩÂºÄÂèë‰∏≠ÔºåÊï¨ËØ∑ÊúüÂæÖÔºÅ');
        }
        
        function renderRanking() {
            const list = document.getElementById('rankingList');
            if (!groupData) {
                // Ê®°ÊãüÊéíË°åÊ¶ú
                const mockData = [
                    {name: 'Â≠¶‰π†Ëææ‰∫∫', score: 520, avatar: 'üèÜ'},
                    {name: 'ÂùöÊåÅ‰∏çÊáà', score: 380, avatar: '‚≠ê'},
                    {name: 'ËøõÊ≠•È£ûÂø´', score: 290, avatar: 'üìö'},
                    {name: user?.username || 'Êàë', score: total, avatar: 'üòÄ'},
                    {name: 'Êñ∞‰∫∫Â≠¶‰π†', score: 50, avatar: 'üå±'}
                ];
                mockData.sort((a,b) => b.score - a.score);
                list.innerHTML = mockData.map((m, i) => `
                    <div class="ranking-item">
                        <div class="ranking-num ${i<3?'top3':''}">${i+1}</div>
                        <div style="font-size:24px;">${m.avatar}</div>
                        <div class="ranking-info">
                            <div class="ranking-name">${m.name}</div>
                            <div class="ranking-score">${m.score} ËØç</div>
                        </div>
                    </div>
                `).join('');
            } else {
                list.innerHTML = '<div class="ranking-item"><div class="ranking-info">Â∞èÁªÑÊàêÂëò: ' + groupData.members.length + '‰∫∫</div></div>';
            }
        }
        
        // ====== Â≠¶‰π†Âú∞Âõæ ======
        const mapLevels = [
            { id: 1, name: 'ÂÖ•Èó®', icon: 'üå±', unlockScore: 0 },
            { id: 2, name: 'Âü∫Á°Ä', icon: 'üìñ', unlockScore: 10 },
            { id: 3, name: 'ËøõÈò∂', icon: 'üìö', unlockScore: 50 },
            { id: 4, name: '‰∏≠Á∫ß', icon: 'üí™', unlockScore: 100 },
            { id: 5, name: 'È´òÁ∫ß', icon: 'üèÜ', unlockScore: 200 },
            { id: 6, name: 'Â§ßÂ∏à', icon: 'üëë', unlockScore: 500 }
        ];
        
        function renderMap() {
            const container = document.getElementById('mapNodes');
            container.innerHTML = mapLevels.map((level, i) => {
                const unlocked = total >= level.unlockScore;
                const current = i === mapLevels.findIndex(l => total >= l.unlockScore);
                return `
                    <div style="text-align:center;margin:20px 0;">
                        <div class="map-node ${unlocked ? 'unlocked' : ''} ${current ? 'current' : ''}">
                            ${level.icon}
                        </div>
                        <div class="map-label">${level.name}</div>
                        <div style="font-size:10px;color:#999;">${level.unlockScore}ËØç</div>
                    </div>
                `;
            }).join('');
        }
        
        // ====== ÊØèÊó•‰∏ÄÂè• ======
        const quotes = [
            {text: "The only way to do great work is to love what you do.", author: "Steve Jobs"},
            {text: "Learning is not attained by chance, it must be sought for with ardor.", author: "Abigail Adams"},
            {text: "Education is the most powerful weapon which you can use to change the world.", author: "Nelson Mandela"},
            {text: "Live as if you were to die tomorrow. Learn as if you were to live forever.", author: "Mahatma Gandhi"},
            {text: "The beautiful thing about learning is that no one can take it away from you.", author: "B.B. King"}
        ];
        
        // ====== VIP‰ºöÂëò ======
        let isVIP = localStorage.getItem("wordAI_vip") === "true";
        
        function upgradeVIP() {
            isVIP = true;
            localStorage.setItem("wordAI_vip", "true");
            alert("ÊÅ≠ÂñúÊÇ®Êàê‰∏∫VIP‰ºöÂëòÔºÅ");
        }

        function renderDailyQuote() {
            const today = new Date().toDateString();
            const savedDate = localStorage.getItem("quoteDate");
            let quoteIndex = 0;
            if (savedDate === today) {
                quoteIndex = parseInt(localStorage.getItem("quoteIndex") || "0");
            } else {
                quoteIndex = Math.floor(Math.random() * quotes.length);
                localStorage.setItem("quoteDate", today);
                localStorage.setItem("quoteIndex", quoteIndex);
            }
            const q = quotes[quoteIndex];
            document.getElementById("dailyQuote").innerHTML = `
                <div class="quote-card">
                    <div class="quote-text">"${q.text}"</div>
                    <div class="quote-author">‚Äî ${q.author}</div>
                </div>
            `;
            
            // ÊØèÊó•ÂçïËØç
            loadWordOfTheDay();
        }
        
        // ====== ÊØèÊó•ÂçïËØç ======
        function loadWordOfTheDay() {
            const wordEl = document.getElementById('dailyQuote');
            if (!wordEl) return;
            
            // Ê†πÊçÆÊó•ÊúüÈÄâÊã©ÂçïËØç
            const today = new Date();
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
            const wordIndex = dayOfYear % words.length;
            const word = words[wordIndex];
            
            const wordHtml = `
                <div style="background:white;border-radius:12px;padding:20px;margin-top:15px;text-align:center;box-shadow:0 2px8px rgba(0,0,0,0.05);">
                    <div style="font-size:12px;color:#667eea;margin-bottom:8px;">‚≠ê ‰ªäÊó•ÂçïËØç</div>
                    <div style="font-size:28px;font-weight:bold;margin-bottom:5px;">${word.word}</div>
                    <div style="font-size:14px;color:#666;margin-bottom:5px;">${word.phonetic}</div>
                    <div style="font-size:14px;color:#333;margin-bottom:10px;">${word.meaning}</div>
                    <button class="btn btn-primary" style="font-size:12px;padding:8px 20px;" onclick="playTTS('${word.word}')">üîä Êí≠ÊîæÂèëÈü≥</button>
                </div>
            `;
            
            // Â¶ÇÊûúÊ≤°ÊúâÊòæÁ§∫ÔºåÂàôÊ∑ªÂä†Âà∞quoteÈ°µÈù¢
            if (!wordEl.querySelector('.word-of-day')) {
                wordEl.insertAdjacentHTML('beforeend', wordHtml);
                wordEl.querySelector('div:last-child').classList.add('word-of-day');
            }
        }

        // ====== ÊµãÈ™åÊ®°Âºè ======
        function startQuizMode(mode) {
            alert("ÊµãÈ™åÊ®°Âºè: " + mode + " - ÂäüËÉΩÂºÄÂèë‰∏≠ÔºåÊï¨ËØ∑ÊúüÂæÖÔºÅ");
        }

        // ====== PKÂØπÊàò ======
        let pkActive = false;
        let pkMyScore = 0;
        let pkAiScore = 0;
        
        function startPK() {
            if (pkActive) return;
            pkActive = true;
            pkMyScore = 0;
            pkAiScore = 0;
            document.getElementById('pkMyScore').textContent = '0';
            document.getElementById('pkAiScore').textContent = '0';
            document.getElementById('pkResult').textContent = '';
            
            // Ê®°ÊãüPK
            let round = 0;
            const pkInterval = setInterval(() => {
                round++;
                pkMyScore += Math.floor(Math.random() * 5);
                pkAiScore += Math.floor(Math.random() * 5);
                document.getElementById('pkMyScore').textContent = pkMyScore;
                document.getElementById('pkAiScore').textContent = pkAiScore;
                
                if (round >= 10) {
                    clearInterval(pkInterval);
                    pkActive = false;
                    let result = '';
                    if (pkMyScore > pkAiScore) result = 'üéâ ËÉúÂà©ÔºÅ';
                    else if (pkMyScore < pkAiScore) result = 'üí™ ÂÜçÊé•ÂÜçÂéâÔºÅ';
                    else result = 'ü§ù Âπ≥Â±ÄÔºÅ';
                    document.getElementById('pkResult').textContent = result;
                }
            }, 500);
        }
        
        // ====== Âú∫ÊôØÂåñÂ≠¶‰π† ======
        const sceneWords = {
            travel: [
                { word: 'flight', phonetic: '/fla…™t/', meaning: 'Ëà™Áè≠' },
                { word: 'hotel', phonetic: '/ho äÀàtel/', meaning: 'ÈÖíÂ∫ó' },
                { word: 'passport', phonetic: '/Ààp√¶sp…îÀêrt/', meaning: 'Êä§ÁÖß' },
                { word: 'ticket', phonetic: '/Ààt…™k…™t/', meaning: 'Á•®' },
                { word: 'destination', phonetic: '/Àådest…™Ààne…™ É…ôn/', meaning: 'ÁõÆÁöÑÂú∞' },
                { word: 'luggage', phonetic: '/Ààl å…°…™d í/', meaning: 'Ë°åÊùé' },
                { word: 'boarding', phonetic: '/Ààb…îÀêrd…™≈ã/', meaning: 'ÁôªÊú∫' },
                { word: 'reservation', phonetic: '/Àårez…ôrÀàve…™ É…ôn/', meaning: 'È¢ÑËÆ¢' },
                { word: 'airport', phonetic: '/Ààerp…îÀêrt/', meaning: 'Êú∫Âú∫' },
                { word: 'departure', phonetic: '/d…™Ààp…ëÀêrt É…ôr/', meaning: 'Âá∫Âèë' },
                { word: 'arrival', phonetic: '/…ôÀàra…™v…ôl/', meaning: 'Âà∞Ëææ' },
                { word: 'luggage', phonetic: '/Ààl å…°…™d í/', meaning: 'Ë°åÊùé' }
            ],
            business: [
                { word: 'meeting', phonetic: '/ÀàmiÀêt…™≈ã/', meaning: '‰ºöËÆÆ' },
                { word: 'project', phonetic: '/Ààpr…ëÀêd íekt/', meaning: 'È°πÁõÆ' },
                { word: 'deadline', phonetic: '/Ààdedla…™n/', meaning: 'Êà™Ê≠¢Êó•Êúü' },
                { word: 'presentation', phonetic: '/Àåprez…ônÀàte…™ É…ôn/', meaning: 'ÊºîÁ§∫' },
                { word: 'colleague', phonetic: '/Ààk…ëÀêliÀê…°/', meaning: 'Âêå‰∫ã' },
                { word: 'schedule', phonetic: '/Ààsked íuÀêl/', meaning: 'Êó•Á®ã' },
                { word: 'email', phonetic: '/ÀàiÀême…™l/', meaning: 'ÈÇÆ‰ª∂' },
                { word: 'report', phonetic: '/r…™Ààp…îÀêrt/', meaning: 'Êä•Âëä' },
                { word: 'proposal', phonetic: '/pr…ôÀàpo äz…ôl/', meaning: 'ÊèêÊ°à' },
                { word: 'contract', phonetic: '/Ààk…íntr√¶kt/', meaning: 'ÂêàÂêå' },
                { word: 'conference', phonetic: '/Ààk…ínf…ôr…ôns/', meaning: '‰ºöËÆÆ' },
                { word: 'negotiation', phonetic: '/n…™Àå…°o ä ÉiÀàe…™ É…ôn/', meaning: 'Ë∞àÂà§' }
            ],
            daily: [
                { word: 'breakfast', phonetic: '/Ààbrekf…ôst/', meaning: 'Êó©È§ê' },
                { word: 'grocery', phonetic: '/Àà…°ro äs…ôri/', meaning: 'ÊùÇË¥ß' },
                { word: 'neighborhood', phonetic: '/Ààne…™b…ôrh äd/', meaning: 'Á§æÂå∫' },
                { word: 'apartment', phonetic: '/…ôÀàp…ëÀêrtm…ônt/', meaning: 'ÂÖ¨ÂØì' },
                { word: 'laundry', phonetic: '/Ààl…îÀêndri/', meaning: 'Ê¥óË°£' },
                { word: 'supermarket', phonetic: '/ÀàsuÀêp…ôrm…ëÀêrk…™t/', meaning: 'Ë∂ÖÂ∏Ç' },
                { word: 'pharmacy', phonetic: '/Ààf…ëÀêrm…ôsi/', meaning: 'ËçØÂ∫ó' },
                { word: 'restaurant', phonetic: '/Ààrest…ôr…ëÀênt/', meaning: 'È§êÂéÖ' },
                { word: 'vegetables', phonetic: '/Ààved ít…ôblz/', meaning: 'Ëî¨Ëèú' },
                { word: 'fruits', phonetic: '/fruÀêts/', meaning: 'Ê∞¥Êûú' },
                { word: 'beverage', phonetic: '/Ààbev…ôr…™d í/', meaning: 'È•ÆÊñô' },
                { word: 'household', phonetic: '/Ààha äsho äld/', meaning: 'ÂÆ∂Â∫≠Áî®ÂìÅ' }
            ],
            tech: [
                { word: 'software', phonetic: '/Ààs…îÀêftwer/', meaning: 'ËΩØ‰ª∂' },
                { word: 'algorithm', phonetic: '/Àà√¶l…°…ôr…™√∞…ôm/', meaning: 'ÁÆóÊ≥ï' },
                { word: 'database', phonetic: '/Ààde…™t…ôbe…™s/', meaning: 'Êï∞ÊçÆÂ∫ì' },
                { word: 'network', phonetic: '/Àànetw…úÀêrk/', meaning: 'ÁΩëÁªú' },
                { word: 'security', phonetic: '/s…™Ààkj är…ôti/', meaning: 'ÂÆâÂÖ®' },
                { word: 'platform', phonetic: '/Ààpl√¶tf…îÀêrm/', meaning: 'Âπ≥Âè∞' },
                { word: 'interface', phonetic: '/Àà…™nt…ôrfe…™s/', meaning: 'ÁïåÈù¢' },
                { word: 'function', phonetic: '/Ààf å≈ãk É…ôn/', meaning: 'ÂäüËÉΩ' },
                { word: 'browser', phonetic: '/Ààbra äz…ôr/', meaning: 'ÊµèËßàÂô®' },
                { word: 'download', phonetic: '/Ààda änlo äd/', meaning: '‰∏ãËΩΩ' },
                { word: 'upload', phonetic: '/Àà åplo äd/', meaning: '‰∏ä‰º†' },
                { word: 'password', phonetic: '/Ààp√¶sw…úÀêrd/', meaning: 'ÂØÜÁ†Å' }
            ],
            // Êñ∞Â¢ûÔºöÂåªÁñóÂÅ•Â∫∑Âú∫ÊôØ
            medical: [
                { word: 'symptom', phonetic: '/Ààs…™mpt…ôm/', meaning: 'ÁóáÁä∂' },
                { word: 'prescription', phonetic: '/pr…™Ààskr…™p É…ôn/', meaning: 'Â§ÑÊñπ' },
                { word: 'diagnosis', phonetic: '/Àåda…™…ô…°Ààno äs…™s/', meaning: 'ËØäÊñ≠' },
                { word: 'treatment', phonetic: '/ÀàtriÀêtm…ônt/', meaning: 'Ê≤ªÁñó' },
                { word: 'hospital', phonetic: '/Ààh…ísp…™t…ôl/', meaning: 'ÂåªÈô¢' },
                { word: 'emergency', phonetic: '/…™Ààm…úÀêrd í…ônsi/', meaning: 'ÊÄ•ËØä' },
                { word: 'medicine', phonetic: '/Ààmed…™s…™n/', meaning: 'ËçØ' },
                { word: 'health', phonetic: '/helŒ∏/', meaning: 'ÂÅ•Â∫∑' },
                { word: 'doctor', phonetic: '/Ààd…íkt…ôr/', meaning: 'ÂåªÁîü' },
                { word: 'nurse', phonetic: '/n…úÀêrs/', meaning: 'Êä§Â£´' }
            ],
            // Êñ∞Â¢ûÔºöÈáëËûçÂú∫ÊôØ
            finance: [
                { word: 'investment', phonetic: '/…™nÀàvestm…ônt/', meaning: 'ÊäïËµÑ' },
                { word: 'stock', phonetic: '/st…ík/', meaning: 'ËÇ°Á•®' },
                { word: 'bank', phonetic: '/b√¶≈ãk/', meaning: 'Èì∂Ë°å' },
                { word: 'credit', phonetic: '/Ààkred…™t/', meaning: '‰ø°Áî®' },
                { word: 'loan', phonetic: '/lo än/', meaning: 'Ë¥∑Ê¨æ' },
                { word: 'insurance', phonetic: '/…™nÀà É är…ôns/', meaning: '‰øùÈô©' },
                { word: 'tax', phonetic: '/t√¶ks/', meaning: 'Á®é' },
                { word: ' salary', phonetic: '/Ààs√¶l…ôri/', meaning: 'Â∑•ËµÑ' },
                { word: 'expense', phonetic: '/…™kÀàspens/', meaning: 'ÊîØÂá∫' },
                { word: 'saving', phonetic: '/Ààse…™v…™≈ã/', meaning: 'ÂÇ®ËìÑ' }
            ],
            // Êñ∞Â¢ûÔºöÊïôËÇ≤Âú∫ÊôØ
            education: [
                { word: 'student', phonetic: '/ÀàstuÀêd…ônt/', meaning: 'Â≠¶Áîü' },
                { word: 'teacher', phonetic: '/ÀàtiÀêt É…ôr/', meaning: 'ËÄÅÂ∏à' },
                { word: 'classroom', phonetic: '/Ààkl√¶sr äm/', meaning: 'ÊïôÂÆ§' },
                { word: 'homework', phonetic: '/Ààho ämw…úÀêrk/', meaning: '‰Ωú‰∏ö' },
                { word: 'exam', phonetic: '/…™…°Ààz√¶m/', meaning: 'ËÄÉËØï' },
                { word: 'grade', phonetic: '/…°re…™d/', meaning: 'ÊàêÁª©' },
                { word: 'subject', phonetic: '/Ààs åbd íekt/', meaning: 'ÁßëÁõÆ' },
                { word: 'college', phonetic: '/Ààk…íl…™d í/', meaning: 'Â§ßÂ≠¶' },
                { word: 'degree', phonetic: '/d…™Àà…°riÀê/', meaning: 'Â≠¶‰Ωç' },
                { word: 'certificate', phonetic: '/s…ôrÀàt…™f…™k…™t/', meaning: 'ËØÅ‰π¶' }
            ],
            // Êñ∞Â¢ûÔºöËøêÂä®ÂÅ•Ë∫´Âú∫ÊôØ
            fitness: [
                { word: 'exercise', phonetic: '/Ààeks…ôrsa…™z/', meaning: 'ÈîªÁÇº' },
                { word: 'workout', phonetic: '/Ààw…úÀêrka ät/', meaning: 'ÂÅ•Ë∫´' },
                { word: 'gym', phonetic: '/d í…™m/', meaning: 'ÂÅ•Ë∫´Êàø' },
                { word: 'muscle', phonetic: '/Ààm ås…ôl/', meaning: 'ËÇåËÇâ' },
                { word: 'strength', phonetic: '/stre≈ãŒ∏/', meaning: 'ÂäõÈáè' },
                { word: 'cardio', phonetic: '/Ààk…ëÀêrdio ä/', meaning: 'ÊúâÊ∞ßËøêÂä®' },
                { word: 'yoga', phonetic: '/Ààjo ä…°…ô/', meaning: 'Áëú‰ºΩ' },
                { word: 'nutrition', phonetic: '/nuÀêÀàtr…™ É…ôn/', meaning: 'Ëê•ÂÖª' },
                { word: 'protein', phonetic: '/Ààpro ätiÀên/', meaning: 'ËõãÁôΩË¥®' },
                { word: 'weight', phonetic: '/we…™t/', meaning: '‰ΩìÈáç' }
            ]
        };
        
        let currentScene = 'travel';
        
        function selectScene(scene) {
            currentScene = scene;
            document.querySelectorAll('.scene-card').forEach(c => c.classList.remove('active'));
            event.target.closest('.scene-card').classList.add('active');
            nextSceneWord();
        }
        
        function nextSceneWord() {
            const words = sceneWords[currentScene];
            const w = words[Math.floor(Math.random() * words.length)];
            document.getElementById('scene-word').textContent = w.word;
            document.getElementById('scene-phonetic').textContent = w.phonetic;
            document.getElementById('scene-meaning').textContent = w.meaning;
        }
        
        // ====== AIÂè£ËØ≠Èô™ÁªÉ ======
        const dialogueTopics = [
            "What's your name?",
            "Where are you from?",
            "What do you do for fun?",
            "Tell me about your day.",
            "What's your favorite food?",
            "Do you like traveling?",
            "What did you do today?",
            "What's your hobby?",
            // Êñ∞Â¢ûÂú∫ÊôØ
            "Describe your hometown",
            "What's your dream job?",
            "Tell me about your family",
            "What do you usually do on weekends?",
            "What's your favorite movie?",
            "Do you prefer cats or dogs?",
            "What's your biggest achievement?",
            "If you could travel anywhere, where would you go?"
        ];
        
        let currentDialogueTopic = '';
        
        function sendDialogue() {
            const input = document.getElementById('dialogueInput');
            const message = input.value.trim();
            if (!message) return;
            
            // ÊòæÁ§∫Áî®Êà∑Ê∂àÊÅØ
            const messages = document.getElementById('dialogueMessages');
            messages.innerHTML += `<div class="dialogue-msg user"><div class="dialogue-bubble">${message}</div></div>`;
            messages.scrollTop = messages.scrollHeight;
            input.value = '';
            
            // Ê®°ÊãüAIÂõûÂ§ç - ÊîπËøõÁâà
            setTimeout(() => {
                const replies = [
                    `Good! Try saying: "${currentDialogueTopic || dialogueTopics[Math.floor(Math.random() * dialogueTopics.length)]}"`,
                    "Great! Keep practicing! Would you like to try another topic?",
                    "Nice response! Let's practice more. What did you eat for breakfast today?",
                    "Excellent! You're making progress! Tell me about your family.",
                    // Êñ∞Â¢ûÂõûÂ§ç
                    "That's interesting! Can you tell me more?",
                    "Well done! Try adding more details to your answer.",
                    "Good pronunciation! Let's try another sentence.",
                    "You're improving fast! What's your next topic?",
                    "Nice vocabulary! Try using some adjectives.",
                    "Great grammar! Can you make it longer?",
                    "Fantastic! You sound more confident now!"
                ];
                const reply = replies[Math.floor(Math.random() * replies.length)];
                messages.innerHTML += `<div class="dialogue-msg ai"><div class="dialogue-bubble">${reply}</div></div>`;
                messages.scrollTop = messages.scrollHeight;
            }, 500);
        }

        function renderHistory() {
            const list = document.getElementById('historyList');
            if (history.length === 0) {
                list.innerHTML = '<div class="empty-state">ÊöÇÊó†Â≠¶‰π†ËÆ∞ÂΩï</div>';
                return;
            }
            list.innerHTML = history.map(h => `
                <div class="history-item">
                    <span class="history-date">${h.date}</span>
                    <span class="history-count">${h.total} ËØç / ${h.correct} Ê≠£Á°Æ</span>
                </div>
            `).join('');
        }

        // ====== AI Âá∫È¢ò ======
        async function generateQuiz() {
            // ‰ºòÂÖà‰ΩøÁî®Êú¨Âú∞È¢òÁõÆ
            quizWord = words[Math.floor(Math.random() * words.length)];
            const meanings = words.map(w => w.meaning);
            const correctMeaning = quizWord.meaning;
            const options = [correctMeaning];
            
            while (options.length < 4) {
                const random = meanings[Math.floor(Math.random() * meanings.length)];
                if (!options.includes(random)) options.push(random);
            }
            options.sort(() => Math.random() - 0.5);
            
            document.getElementById('quiz-card').innerHTML = `
                <div class="ai-quiz-badge">ü§ñ AI Âá∫È¢ò</div>
                <div class="word">${quizWord.word}</div>
                <div class="phonetic">${quizWord.phonetic}</div>
                <div class="meaning">ÈÄâÊã©Ê≠£Á°ÆÁöÑ‰∏≠ÊñáÈáä‰πâ</div>
            `;
            
            document.getElementById('quiz-options').innerHTML = options.map(opt => `
                <button class="quiz-option" onclick="checkAnswer('${opt}', '${correctMeaning}', this)">${opt}</button>
            `).join('');
        }

        async function callMiniMaxAI(prompt) {
            if (!MINIMAX_API_KEY) return null;
            try {
                const response = await fetch(`${MINIMAX_BASE_URL}/text/chatcompletion_v2`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${MINIMAX_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'abab6.5s-chat',
                        messages: [{ role: 'user', content: prompt }]
                    })
                });
                const data = await response.json();
                return data.choices?.[0]?.message?.content || null;
            } catch (e) {
                console.error('MiniMax API error:', e);
                return null;
            }
        }

        async function generateAIQuiz() {
            const userLevel = user?.level || 'intermediate';
            const prompt = `ËØ∑Ê†πÊçÆÁî®Êà∑Á∫ßÂà´ "${userLevel}" ÁîüÊàê‰∏Ä‰∏™Ëã±ËØ≠ÂçïËØçÈÄâÊã©È¢ò„ÄÇ
ËøîÂõûJSONÊ†ºÂºèÔºö{"word":"ÂçïËØç","phonetic":"Èü≥Ê†á","meaning":"‰∏≠ÊñáÈáä‰πâ","options":["ÈÄâÈ°π1","ÈÄâÈ°π2","ÈÄâÈ°π3","ÈÄâÈ°π4"]}
Âè™ËøîÂõûJSONÔºå‰∏çË¶ÅÂÖ∂‰ªñÂÜÖÂÆπ„ÄÇ`;
            
            const result = await callMiniMaxAI(prompt);
            if (result) {
                try {
                    const quiz = JSON.parse(result);
                    quizWord = { word: quiz.word, phonetic: quiz.phonetic, meaning: quiz.meaning };
                    document.getElementById('quiz-card').innerHTML = `
                        <div class="ai-quiz-badge">ü§ñ AI Êô∫ËÉΩÂá∫È¢ò</div>
                        <div class="word">${quiz.word}</div>
                        <div class="phonetic">${quiz.phonetic}</div>
                        <div class="meaning">ÈÄâÊã©Ê≠£Á°ÆÁöÑ‰∏≠ÊñáÈáä‰πâ</div>
                    `;
                    document.getElementById('quiz-options').innerHTML = quiz.options.map(opt => `
                        <button class="quiz-option" onclick="checkAnswer('${opt}', '${quiz.meaning}', this)">${opt}</button>
                    `).join('');
                    return;
                } catch (e) {}
            }
            // ÂõûÈÄÄÂà∞Êú¨Âú∞Âá∫È¢ò
            generateQuiz();
        }

        function checkAnswer(selected, correctAns, btn) {
            document.querySelectorAll('.quiz-option').forEach(o => o.disabled = true);
            if (selected === correctAns) {
                btn.classList.add('correct');
                correct++;
                streak++;
            } else {
                btn.classList.add('wrong');
                streak = 0;
                document.querySelectorAll('.quiz-option').forEach(o => {
                    if (o.textContent === correctAns) o.classList.add('correct');
                });
            }
            total++;
            updateStats();
            onQuizDone();
            setTimeout(() => {
                if (MINIMAX_API_KEY) generateAIQuiz();
                else generateQuiz();
            }, 1500);
        }

        // ====== ÂèëÈü≥ÊµãËØÑ ======
        // ====== ÈÄüËÆ∞Ê®°Âºè ======
        let flashcardIndex = 0;
        let flashcardWords = [];
        let flashcardKnown = 0;
        let flashcardTotal = 10;
        
        function startFlashcard() {
            // ÈöèÊú∫ÈÄâÊã©10‰∏™ÂçïËØç
            flashcardWords = [...words].sort(() => Math.random() - 0.5).slice(0, Math.min(10, words.length));
            flashcardIndex = 0;
            flashcardKnown = 0;
            flashcardTotal = flashcardWords.length;
            showFlashcard();
        }
        
        function showFlashcard() {
            if (flashcardIndex >= flashcardWords.length) {
                // ÂÆåÊàê
                const accuracy = Math.round((flashcardKnown / flashcardTotal) * 100);
                document.getElementById('flashcardCard').innerHTML = `
                    <div style="font-size:48px;">üéâ</div>
                    <div class="word" style="font-size:24px;margin-top:15px;">ÈÄüËÆ∞ÂÆåÊàêÔºÅ</div>
                    <div class="meaning" style="margin-top:10px;">Ê≠£Á°Æ: ${flashcardKnown}/${flashcardTotal} (${accuracy}%)</div>
                    <button class="btn btn-primary" style="margin-top:20px;" onclick="startFlashcard()">ÂÜçÂ≠¶‰∏ÄÈÅç</button>
                `;
                document.getElementById('flashcardProgress').style.width = '100%';
                return;
            }
            
            const w = flashcardWords[flashcardIndex];
            document.getElementById('flashcardWord').textContent = w.word;
            document.getElementById('flashcardPhonetic').textContent = w.phonetic;
            document.getElementById('flashcardMeaning').style.display = 'none';
            document.getElementById('flashcardCount').textContent = `${flashcardIndex + 1}/${flashcardTotal}`;
            document.getElementById('flashcardProgress').style.width = `${(flashcardIndex / flashcardTotal) * 100}%`;
        }
        
        function flipFlashcard() {
            const meaning = document.getElementById('flashcardMeaning');
            if (meaning.style.display === 'none') {
                meaning.style.display = 'block';
                meaning.textContent = flashcardWords[flashcardIndex].meaning;
            } else {
                meaning.style.display = 'none';
            }
        }
        
        function flashcardKnow(known) {
            if (known) flashcardKnown++;
            flashcardIndex++;
            showFlashcard();
        }
        
        // ====== Âê¨ÂÜôÊ®°Âºè ======
        let dictationWord = null;
        let dictCorrect = 0;
        let dictWrong = 0;
        
        function startDictation() {
            dictCorrect = 0;
            dictWrong = 0;
            updateDictationStats();
            nextDictation();
        }
        
        function nextDictation() {
            dictationWord = words[Math.floor(Math.random() * words.length)];
            document.getElementById('dictationInput').value = '';
            document.getElementById('dictationResult').innerHTML = '';
            document.getElementById('dictationHint').textContent = 'ÁÇπÂáªÊí≠ÊîæÊåâÈíÆÂê¨ÂçïËØç';
            document.getElementById('dictationInput').focus();
            playDictationWord();
        }
        
        function playDictationWord() {
            if (dictationWord) {
                playTTS(dictationWord.word);
                document.getElementById('dictationHint').textContent = 'ËØ∑ÊãºÂÜôÂàöÊâçÁöÑÂçïËØç';
            }
        }
        
        function checkDictation() {
            if (!dictationWord) return;
            
            const input = document.getElementById('dictationInput').value.trim().toLowerCase();
            const correct = dictationWord.word.toLowerCase();
            
            const resultEl = document.getElementById('dictationResult');
            
            if (input === correct) {
                dictCorrect++;
                resultEl.innerHTML = `<div style="color:#10b981;font-weight:bold;">‚úÖ Ê≠£Á°ÆÔºÅ</div>
                    <div style="font-size:12px;color:#666;margin-top:5px;">${dictationWord.word} ${dictationWord.phonetic}</div>
                    <div style="font-size:12px;color:#999;">${dictationWord.meaning}</div>`;
                playSound('correct');
            } else {
                dictWrong++;
                resultEl.innerHTML = `<div style="color:#ef4444;font-weight:bold;">‚ùå ÈîôËØØ</div>
                    <div style="font-size:12px;color:#666;margin-top:5px;">Ê≠£Á°ÆÁ≠îÊ°à: ${dictationWord.word}</div>
                    <div style="font-size:12px;color:#999;">${dictationWord.phonetic} - ${dictationWord.meaning}</div>`;
                playSound('wrong');
            }
            
            updateDictationStats();
            addExp(input === correct ? 10 : 2);
        }
        
        function updateDictationStats() {
            document.getElementById('dictCorrect').textContent = dictCorrect;
            document.getElementById('dictWrong').textContent = dictWrong;
            const total = dictCorrect + dictWrong;
            const acc = total > 0 ? Math.round((dictCorrect / total) * 100) : 0;
            document.getElementById('dictAcc').textContent = acc + '%';
        }
        
        function nextSpeak() {
            const w = words[Math.floor(Math.random() * words.length)];
            document.getElementById('speak-word').textContent = w.word;
            document.getElementById('speak-phonetic').textContent = w.phonetic;
            document.getElementById('pronunciation-result').innerHTML = '';
            document.getElementById('recordHint').textContent = 'Êåâ‰ΩèÂΩïÈü≥ÊµãËØÑÂèëÈü≥';
        }

        async function playReference() {
            const word = document.getElementById('speak-word').textContent;
            playTTS(word);
        }

        async function startRecord() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
                mediaRecorder.onstop = () => evaluatePronunciation();
                mediaRecorder.start();
                document.getElementById('recordBtn').classList.add('recording');
                document.getElementById('recordHint').textContent = 'Ê≠£Âú®ÂΩïÈü≥...';
            } catch (err) {
                alert('Êó†Ê≥ïËÆøÈóÆÈ∫¶ÂÖãÈ£éÔºåËØ∑ÂÖÅËÆ∏ÊùÉÈôê');
            }
        }

        function stopRecord() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                document.getElementById('recordBtn').classList.remove('recording');
                document.getElementById('recordHint').textContent = 'ÊµãËØÑ‰∏≠...';
            }
        }

        function evaluatePronunciation() {
            // ‰ΩøÁî® Web Speech API ËøõË°åÁÆÄÂçïËØÑ‰º∞
            const targetWord = document.getElementById('speak-word').textContent;
            
            // Ê®°ÊãüËØÑÂàÜÔºàÂÆûÈôÖÈúÄË¶ÅËØ≠Èü≥ËØÜÂà´APIÔºâ
            const scores = [68, 75, 82, 88, 92, 95];
            const score = scores[Math.floor(Math.random() * scores.length)];
            
            let scoreClass = 'score-low', feedback = 'ÈúÄË¶ÅÂ§öÂä†ÁªÉ‰π†';
            if (score >= 90) { scoreClass = 'score-high'; feedback = 'ÂèëÈü≥ÈùûÂ∏∏Ê£íÔºÅüéâ'; }
            else if (score >= 75) { scoreClass = 'score-mid'; feedback = 'ÂèëÈü≥‰∏çÈîôÔºåÁªßÁª≠Âä™ÂäõÔºÅ'; }
            
            document.getElementById('pronunciation-result').innerHTML = `
                <div class="pronunciation-score ${scoreClass}">${score}ÂàÜ</div>
                <div class="meaning">${feedback}</div>
                <div class="phonetic">Ê†áÂáÜÂèëÈü≥: ${targetWord}</div>
            `;
            document.getElementById('recordHint').textContent = 'Êåâ‰ΩèÂΩïÈü≥ÊµãËØÑÂèëÈü≥';
        }

        // ====== Â§ç‰π†ÊµãËØïÂäüËÉΩ ======
        let reviewWords = [];
        let currentReviewIndex = 0;

        function loadReviewData() {
            // ‰ªélocalStorageÂä†ËΩΩÂ§ç‰π†Êï∞ÊçÆ
            const reviewData = JSON.parse(localStorage.getItem('wordAI_review') || '[]');
            const now = Date.now();
            // Á≠õÈÄâÈúÄË¶ÅÂ§ç‰π†ÁöÑÂçïËØçÔºàÂ∑≤ËøáÊúüÊàñ‰ªäÂ§©Âà∞ÊúüÔºâ
            reviewWords = reviewData.filter(w => w.nextReview <= now);
            
            // ÁªüËÆ°
            const allReviewData = JSON.parse(localStorage.getItem('wordAI_review') || '[]');
            const mastered = allReviewData.filter(w => w.quality >= 4).length;
            
            document.getElementById('reviewDueCount').textContent = reviewWords.length;
            document.getElementById('reviewMasteredCount').textContent = mastered;
            
            const btn = document.getElementById('startReviewBtn');
            if (reviewWords.length === 0) {
                btn.textContent = 'ÊöÇÊó†ÂæÖÂ§ç‰π†ÂçïËØç';
                btn.disabled = true;
            } else {
                btn.textContent = `ÂºÄÂßãÂ§ç‰π† (${reviewWords.length})`;
                btn.disabled = false;
            }
        }

        function startReview() {
            if (reviewWords.length === 0) return;
            
            document.getElementById('reviewCard').style.display = 'block';
            currentReviewIndex = 0;
            showReviewWord();
        }

        function showReviewWord() {
            if (currentReviewIndex >= reviewWords.length) {
                alert('üéâ Â§ç‰π†ÂÆåÊàêÔºÅ');
                document.getElementById('reviewCard').style.display = 'none';
                loadReviewData();
                return;
            }
            
            const w = reviewWords[currentReviewIndex];
            document.getElementById('reviewWord').textContent = w.word;
            document.getElementById('reviewPhonetic').textContent = w.phonetic;
        }

        function rateReview(quality) {
            // quality: 1=Âøò‰∫Ü, 2=ËÆ∞Âæó, 3=ËÆ∞‰Ωè, 4=Á≤æÈÄö
            const w = reviewWords[currentReviewIndex];
            
            // Êõ¥Êñ∞Â§ç‰π†Êï∞ÊçÆ
            const reviewData = JSON.parse(localStorage.getItem('wordAI_review') || '[]');
            const idx = reviewData.findIndex(r => r.word === w.word);
            if (idx >= 0) {
                // ËâæÂÆæÊµ©ÊñØÈÅóÂøòÊõ≤Á∫øËÆ°ÁÆóÈó¥Èöî
                let { easinessFactor = 2.5, interval = 1, repetitions = 0 } = reviewData[idx];
                
                if (quality >= 3) {
                    // ËÆ∞‰Ωè‰∫ÜÔºåÂ¢ûÂä†Èó¥Èöî
                    if (repetitions === 0) interval = 1;
                    else if (repetitions === 1) interval = 3;
                    else interval = Math.round(interval * easinessFactor);
                    repetitions++;
                    easinessFactor = Math.max(1.3, easinessFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02)));
                } else {
                    // Âøò‰∫ÜÔºåÈáçÊñ∞ÂºÄÂßã
                    repetitions = 0;
                    interval = 1;
                }
                
                reviewData[idx] = {
                    ...reviewData[idx],
                    quality,
                    easinessFactor,
                    interval,
                    repetitions,
                    nextReview: Date.now() + interval * 24 * 60 * 60 * 1000,
                    lastReview: Date.now()
                };
            } else {
                // Êñ∞Ê∑ªÂä†ÁöÑÂçïËØç
                reviewData.push({
                    word: w.word,
                    phonetic: w.phonetic,
                    meaning: w.meaning,
                    quality,
                    easinessFactor: 2.5,
                    interval: 1,
                    repetitions: 0,
                    nextReview: Date.now() + 24 * 60 * 60 * 1000,
                    lastReview: Date.now()
                });
            }
            localStorage.setItem('wordAI_review', JSON.stringify(reviewData));
            
            currentReviewIndex++;
            showReviewWord();
        }

        // ====== Tab ÂàáÊç¢ ======
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                this.classList.add('active');
                document.getElementById('tab-' + this.dataset.tab).classList.add('active');
                
                if (this.dataset.tab === 'quiz') {
                    if (MINIMAX_API_KEY) generateAIQuiz();
                    else generateQuiz();
                }
                if (this.dataset.tab === 'speak') nextSpeak();
                if (this.dataset.tab === 'flashcard') startFlashcard();
                if (this.dataset.tab === 'dictation') startDictation();
                if (this.dataset.tab === 'challenge') { loadChallenge(); renderCheckinUI(); }
                if (this.dataset.tab === 'stats') { renderStats(); }
                if (this.dataset.tab === 'scenes') { nextSceneWord(); }
                if (this.dataset.tab === 'dialogue') { currentDialogueTopic = dialogueTopics[Math.floor(Math.random() * dialogueTopics.length)]; }
                if (this.dataset.tab === 'favorites') { renderFavorites(); }
                if (this.dataset.tab === 'wrongbook') { renderWrongWords(); }
                if (this.dataset.tab === 'profile') { updateProfile(); }
                if (this.dataset.tab === 'lang') { }
                if (this.dataset.tab === 'newwords') { renderNewWords(); }
                if (this.dataset.tab === 'group') { loadGroup(); }
                if (this.dataset.tab === 'map') { renderMap(); }
                if (this.dataset.tab === 'quote') { renderDailyQuote(); }
                if (this.dataset.tab === 'pk') { }
                if (this.dataset.tab === 'review') { loadReviewData(); }
                if (this.dataset.tab === 'plan') { generateSmartSuggestions(); renderReviewTimeline(); updateGoalRing(); }
                if (this.dataset.tab === 'books') { loadWordBooks(); renderForgettingCurve(); }
                if (this.dataset.tab === 'arena') { }
                if (this.dataset.tab === 'analysis') { loadAnalysis(); }
                if (this.dataset.tab === 'ai') { }
                if (this.dataset.tab === 'game') { updateGoalDisplays(); }
                if (this.dataset.tab === 'level') { updateLevelUI(); }
                if (this.dataset.tab === 'challenge') { renderCheckinCalendar(); }
            });
        });

        function updateDailyGoal() {
            const goal = parseInt(document.getElementById('dailyGoalSelect').value);
            challengeData.dailyGoal = goal;
            saveChallenge();
            alert('ÊØèÊó•ÁõÆÊ†áÂ∑≤ËÆæÁΩÆ‰∏∫ ' + goal + ' ‰∏™ÂçïËØçÔºÅ');
        }

        function saveApiKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            if (!apiKey) {
                document.getElementById('apiKeyStatus').textContent = 'ËØ∑ËæìÂÖ• API Key';
                document.getElementById('apiKeyStatus').style.color = '#ef4444';
                return;
            }
            localStorage.setItem('wordAI_apiKey', apiKey);
            document.getElementById('apiKeyStatus').textContent = '‰øùÂ≠òÊàêÂäüÔºÅ';
            document.getElementById('apiKeyStatus').style.color = '#10b981';
            alert('API Key Â∑≤‰øùÂ≠òÔºåÂà∑Êñ∞È°µÈù¢Âêé AI Âá∫È¢òÂäüËÉΩÂç≥ÂèØ‰ΩøÁî®');
        }

        function loadApiKey() {
            const saved = localStorage.getItem('wordAI_apiKey');
            if (saved) {
                document.getElementById('apiKey').value = saved;
                document.getElementById('apiKeyStatus').textContent = 'Â∑≤ÈÖçÁΩÆ API Key';
            }
        }
        
        // ====== Ëá™Âä®Â§á‰ªΩÁ≥ªÁªü ======
        function autoBackup() {
            // ÂàõÂª∫Ëá™Âä®Â§á‰ªΩ
            const data = {
                version: 'v3.0',
                backupTime: new Date().toISOString(),
                words: words,
                favorites: favorites,
                wrongWords: wrongWords,
                history: history,
                challenge: challengeData,
                total, correct, streak,
                userExp: userExp,
                stats: loadStats()
            };
            
            // ‰øùÂ≠òÂà∞localStorage
            localStorage.setItem('wordAI_autoBackup', JSON.stringify(data));
            
            // Êõ¥Êñ∞UI
            document.getElementById('backupStatus').textContent = 'Â§á‰ªΩÊàêÂäü';
            document.getElementById('backupInfo').textContent = 'ÊúÄËøëÂ§á‰ªΩ: ' + new Date().toLocaleTimeString();
            
            // ÊòæÁ§∫ÂêåÊ≠•Áä∂ÊÄÅ
            const syncDot = document.getElementById('syncDot');
            const syncText = document.getElementById('syncText');
            syncDot.className = 'sync-dot syncing';
            syncText.textContent = 'Ê≠£Âú®ÂêåÊ≠•...';
            
            setTimeout(() => {
                syncDot.className = 'sync-dot synced';
                syncText.textContent = 'Êï∞ÊçÆÂ∑≤Ëá™Âä®ÂêåÊ≠•Âà∞Êú¨Âú∞Â≠òÂÇ®';
            }, 1000);
            
            alert('Êï∞ÊçÆÂ§á‰ªΩÊàêÂäüÔºÅ');
        }
        
        // ÂÆöÊúüËá™Âä®Â§á‰ªΩÔºàÊØè5ÂàÜÈíüÔºâ
        setInterval(() => {
            autoBackup();
        }, 5 * 60 * 1000);
        
        // È°µÈù¢Âä†ËΩΩÊó∂Ê£ÄÊü•Â§á‰ªΩÁä∂ÊÄÅ
        function checkBackupStatus() {
            const backup = localStorage.getItem('wordAI_autoBackup');
            if (backup) {
                try {
                    const data = JSON.parse(backup);
                    const backupTime = new Date(data.backupTime);
                    const now = new Date();
                    const diffMs = now - backupTime;
                    const diffMins = Math.floor(diffMs / 60000);
                    
                    if (diffMins < 1) {
                        document.getElementById('backupInfo').textContent = 'ÊúÄËøëÂ§á‰ªΩ: ÂàöÂàö';
                    } else if (diffMins < 60) {
                        document.getElementById('backupInfo').textContent = 'ÊúÄËøëÂ§á‰ªΩ: ' + diffMins + 'ÂàÜÈíüÂâç';
                    } else {
                        document.getElementById('backupInfo').textContent = 'ÊúÄËøëÂ§á‰ªΩ: ' + backupTime.toLocaleDateString();
                    }
                } catch (e) {}
            }
        }
        
        // ====== ÂæΩÁ´†Â¢ô ======
        function renderBadgeWall() {
            const container = document.getElementById('badgeWall');
            if (!container) return;
            
            const allBadges = [
                { id: 'first', icon: 'üå±', name: 'È¶ñÊ¨°Â≠¶‰π†', condition: total >= 1 },
                { id: 'ten', icon: '‚≠ê', name: 'ÂçÅ‰∏™ÂçïËØç', condition: total >= 10 },
                { id: 'fifty', icon: 'üìö', name: '‰∫îÂçÅËØçÊñ©', condition: total >= 50 },
                { id: 'hundred', icon: 'üíØ', name: 'ÁôæËØçÂ§ßÂÖ≥', condition: total >= 100 },
                { id: 'five_hundred', icon: 'üèÖ', name: '‰∫îÁôæËææ‰∫∫', condition: total >= 500 },
                { id: 'streak3', icon: 'üî•', name: '‰∏âÂ§©ÂùöÊåÅ', condition: streak >= 3 },
                { id: 'streak7', icon: 'üëë', name: '‰∏ÄÂë®Â≠¶Èú∏', condition: streak >= 7 },
                { id: 'streak30', icon: 'üèÜ', name: 'ÊúàÂ∫¶ÂÜ†ÂÜõ', condition: streak >= 30 },
                { id: 'perfect', icon: 'üéØ', name: 'Êª°ÂàÜÈÄöËøá', condition: total >= 10 && (correct/total*100) >= 100 },
                { id: 'speed', icon: '‚ö°', name: 'ÈÄüÂ∫¶‰πãÁéã', condition: (loadStats().today || 0) >= 20 },
                { id: 'master', icon: 'üéì', name: 'ÂçïËØçÂ§ßÂ∏à', condition: words.filter(w => w.status === 'mastered').length >= 100 },
                { id: 'vip', icon: 'üíé', name: 'VIP‰ºöÂëò', condition: isVIP }
            ];
            
            container.innerHTML = allBadges.map(b => `
                <div class="badge-item ${b.condition ? '' : 'locked'}" onclick="showBadgeDetail('${b.id}')">
                    <div class="badge-icon">${b.icon}</div>
                    <div class="badge-name">${b.name}</div>
                </div>
            `).join('');
        }
        
        function showBadgeDetail(badgeId) {
            const badges = {
                'first': { icon: 'üå±', name: 'È¶ñÊ¨°Â≠¶‰π†', desc: 'ÂÆåÊàêÁ¨¨‰∏Ä‰∏™ÂçïËØçÁöÑÂ≠¶‰π†' },
                'ten': { icon: '‚≠ê', name: 'ÂçÅ‰∏™ÂçïËØç', desc: 'Á¥ØËÆ°Â≠¶‰π†10‰∏™ÂçïËØç' },
                'hundred': { icon: 'üíØ', name: 'ÁôæËØçÂ§ßÂÖ≥', desc: 'Á¥ØËÆ°Â≠¶‰π†100‰∏™ÂçïËØç' },
                'streak7': { icon: 'üëë', name: '‰∏ÄÂë®Â≠¶Èú∏', desc: 'ËøûÁª≠Â≠¶‰π†7Â§©' }
            };
            const b = badges[badgeId] || { icon: 'üèÖ', name: badgeId, desc: 'ÊàêÂ∞±ÂæΩÁ´†' };
            alert(`${b.icon} ${b.name}\n${b.desc}`);
        }
        
        // ====== ÂàÜ‰∫´Êµ∑Êä•ÁîüÊàê ======
        function generateSharePoster() {
            const data = loadStats();
            const streak = data.streak || 0;
            const total = data.total || 0;
            const accuracy = data.total > 0 ? Math.round((data.correct / data.total) * 100) : 0;
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width:360px;">
                    <div class="modal-title">üì§ ÁîüÊàêÂ≠¶‰π†Êµ∑Êä•</div>
                    <div class="share-poster" id="sharePoster">
                        <div class="poster-title">üéâ AI ËÉåÂçïËØç</div>
                        <div style="font-size:14px;opacity:0.9;margin-bottom:20px;">ÊàëÂú®ÂùöÊåÅÂ≠¶‰π†Âï¶ÔºÅ</div>
                        <div class="poster-stats">
                            <div class="poster-stat">
                                <div class="poster-stat-value">${total}</div>
                                <div class="poster-stat-label">Â∑≤Â≠¶ÂçïËØç</div>
                            </div>
                            <div class="poster-stat">
                                <div class="poster-stat-value">${streak}</div>
                                <div class="poster-stat-label">ËøûÁª≠Â§©Êï∞</div>
                            </div>
                            <div class="poster-stat">
                                <div class="poster-stat-value">${accuracy}%</div>
                                <div class="poster-stat-label">Ê≠£Á°ÆÁéá</div>
                            </div>
                        </div>
                        <div class="poster-qr">üìö</div>
                        <div style="font-size:12px;opacity:0.8;">ÈïøÊåâ‰øùÂ≠òÂõæÁâáÂàÜ‰∫´ÊúãÂèãÂúà</div>
                    </div>
                    <div style="display:flex;gap:10px;margin-top:15px;">
                        <button class="btn btn-primary" style="flex:1;" onclick="savePosterImage()">‰øùÂ≠òÂõæÁâá</button>
                        <button class="btn" style="flex:1;background:#07C160;color:white;" onclick="shareToSocial('wechat')">Êü•Áúã‰∫åÁª¥Á†Å</button>
                    </div>
                    <button class="btn" style="width:100%;margin-top:10px;" onclick="this.closest('.modal').remove()">ÂÖ≥Èó≠</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function savePosterImage() {
            // Ê®°Êãü‰øùÂ≠òÂõæÁâá
            alert('üì∏ Êµ∑Êä•Â∑≤ÁîüÊàêÔºÅ\n\nÈïøÊåâÂõæÁâá‰øùÂ≠òÂà∞Êú¨Âú∞');
        }
        
        // ====== ÊàêÂ∞±Ëß£ÈîÅÂä®Áîª ======
        function showAchievementUnlock(icon, name, desc) {
            const container = document.getElementById('achievementUnlock') || createAchievementContainer();
            container.innerHTML = `
                <div class="achievement-content">
                    <div class="achievement-icon">${icon}</div>
                    <div class="achievement-name">${name}</div>
                    <div class="achievement-desc">${desc}</div>
                </div>
            `;
            container.classList.add('active');
            playSound('badge');
            
            setTimeout(() => {
                container.classList.remove('active');
            }, 3000);
        }
        
        function createAchievementContainer() {
            const div = document.createElement('div');
            div.id = 'achievementUnlock';
            div.className = 'achievement-unlock';
            document.body.appendChild(div);
            return div;
        }
        
        // ====== ÊØèÊó•Á≠æÂà∞Âä®Áîª ======
        function showCheckinAnimation() {
            const anim = document.createElement('div');
            anim.className = 'checkin-animation';
            anim.textContent = '‚úì';
            document.body.appendChild(anim);
            
            setTimeout(() => anim.remove(), 1500);
        }
        
        // ====== ÂÆöÊó∂Â§úÈó¥Ê®°Âºè ======
        function checkAutoDarkMode() {
            const hour = new Date().getHours();
            const autoDarkEnabled = localStorage.getItem('wordAI_autoDarkMode') === 'true';
            const manualTheme = localStorage.getItem('wordAI_manualTheme');
            
            // Â¶ÇÊûúÁî®Êà∑ÊâãÂä®ËÆæÁΩÆ‰∫Ü‰∏ªÈ¢òÔºå‰∏çËá™Âä®ÂàáÊç¢
            if (manualTheme) return;
            
            if (autoDarkEnabled) {
                // Êôö‰∏ä10ÁÇπÂà∞Êó©‰∏ä6ÁÇπËá™Âä®ÂºÄÂêØÊöóËâ≤Ê®°Âºè
                if (hour >= 22 || hour < 6) {
                    enableDarkMode();
                } else {
                    disableDarkMode();
                }
            }
        }
        
        function enableDarkMode() {
            if (!document.body.classList.contains('dark-theme')) {
                document.body.classList.add('dark-theme');
            }
        }
        
        function disableDarkMode() {
            document.body.classList.remove('dark-theme');
        }
        
        function toggleAutoDarkMode() {
            const current = localStorage.getItem('wordAI_autoDarkMode') === 'true';
            localStorage.setItem('wordAI_autoDarkMode', (!current).toString());
            alert((!current ? 'ÂºÄÂêØ' : 'ÂÖ≥Èó≠') + 'Ëá™Âä®Â§úÈó¥Ê®°ÂºèÊàêÂäüÔºÅ\nÂ∞ÜÂú®22:00-06:00Ëá™Âä®ÂàáÊç¢ÊöóËâ≤‰∏ªÈ¢ò');
        }
        
        // ====== ÊâãÂä®‰∏ªÈ¢òÂàáÊç¢ ======
        function toggleManualTheme() {
            const isDark = document.body.classList.contains('dark-theme');
            const newTheme = !isDark;
            
            if (newTheme) {
                document.body.classList.add('dark-theme');
                localStorage.setItem('wordAI_manualTheme', 'dark');
            } else {
                document.body.classList.remove('dark-theme');
                localStorage.setItem('wordAI_manualTheme', 'light');
            }
            
            // Êõ¥Êñ∞UIÊòæÁ§∫
            updateThemeToggleUI();
        }
        
        function updateThemeToggleUI() {
            const isDark = document.body.classList.contains('dark-theme');
            const iconEl = document.getElementById('themeToggleIcon');
            const textEl = document.getElementById('themeToggleText');
            
            if (iconEl) iconEl.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
            if (textEl) textEl.textContent = isDark ? 'ÂàáÊç¢Âà∞ÊµÖËâ≤Ê®°Âºè' : 'ÂàáÊç¢Âà∞Ê∑±Ëâ≤Ê®°Âºè';
        }
        
        // ÂàùÂßãÂåñÊó∂ÊÅ¢Â§çÊâãÂä®‰∏ªÈ¢òËÆæÁΩÆ
        function initManualTheme() {
            const manualTheme = localStorage.getItem('wordAI_manualTheme');
            const autoDark = localStorage.getItem('wordAI_autoDarkMode') === 'true';
            
            // Â¶ÇÊûúÊúâÊâãÂä®ËÆæÁΩÆÔºå‰ºòÂÖà‰ΩøÁî®ÊâãÂä®ËÆæÁΩÆ
            if (manualTheme === 'dark') {
                document.body.classList.add('dark-theme');
            } else if (manualTheme === 'light') {
                document.body.classList.remove('dark-theme');
            } else if (autoDark) {
                checkAutoDarkMode();
            }
            
            updateThemeToggleUI();
        }
        
        // ÊØèÂàÜÈíüÊ£ÄÊü•‰∏ÄÊ¨°ÊòØÂê¶ÈúÄË¶ÅÂàáÊç¢‰∏ªÈ¢ò
        setInterval(checkAutoDarkMode, 60000);
        
        // ====== ÁßªÂä®Á´ØÊâãÂäøÊîØÊåÅ ======
        function initTouchGestures() {
            let touchStartX = 0;
            let touchStartY = 0;
            const card = document.querySelector('.card');
            if (!card) return;
            
            card.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
            }, { passive: true });
            
            card.addEventListener('touchend', (e) => {
                const touchEndX = e.changedTouches[0].clientX;
                const touchEndY = e.changedTouches[0].clientY;
                const diffX = touchEndX - touchStartX;
                const diffY = touchEndY - touchStartY;
                
                // Ê∞¥Âπ≥ÊªëÂä® > 50px ‰∏î ÂûÇÁõ¥ÊªëÂä® < 30px
                if (Math.abs(diffX) > 50 && Math.abs(diffY) < 30) {
                    if (diffX > 0) {
                        // Âè≥Êªë - ËÆ§ËØÜ
                        markWord(2);
                    } else {
                        // Â∑¶Êªë - ‰∏çËÆ§ËØÜ
                        markWord(1);
                    }
                }
            }, { passive: true });
        }
        
        // ====== Á¶ªÁ∫øÁä∂ÊÄÅÂ§ÑÁêÜ ======
        function updateOnlineStatus() {
            const isOnline = navigator.onLine;
            if (!isOnline) {
                document.body.classList.add('offline');
            } else {
                document.body.classList.remove('offline');
            }
        }
        
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
            const backup = localStorage.getItem('wordAI_autoBackup');
            if (backup) {
                try {
                    const data = JSON.parse(backup);
                    const backupTime = new Date(data.backupTime);
                    const now = new Date();
                    const diffMs = now - backupTime;
                    const diffMins = Math.floor(diffMs / 60000);
                    
                    if (diffMins < 1) {
                        document.getElementById('backupInfo').textContent = 'ÊúÄËøëÂ§á‰ªΩ: ÂàöÂàö';
                    } else if (diffMins < 60) {
                        document.getElementById('backupInfo').textContent = 'ÊúÄËøëÂ§á‰ªΩ: ' + diffMins + 'ÂàÜÈíüÂâç';
                    } else {
                        document.getElementById('backupInfo').textContent = 'ÊúÄËøëÂ§á‰ªΩ: ' + backupTime.toLocaleDateString();
                    }
                } catch (e) {}
            }
        }
        }
        
        // ====== PWA ÂÆâË£ÖÊèêÁ§∫ ======
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            // ÊòæÁ§∫ÂÆâË£ÖÊèêÁ§∫
            setTimeout(() => {
                if (!localStorage.getItem('wordAI_pwaDismissed')) {
                    showInstallPrompt();
                }
            }, 5000);
        });
        
        function showInstallPrompt() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.id = 'installPrompt';
            modal.innerHTML = `
                <div class="modal-content" style="text-align:center;">
                    <div style="font-size:48px;margin-bottom:15px;">üì±</div>
                    <div class="modal-title">ÂÆâË£ÖÂà∞Ê°åÈù¢</div>
                    <p style="color:#666;margin-bottom:20px;">Â∞Ü AI ËÉåÂçïËØçÊ∑ªÂä†Âà∞Ê°åÈù¢ÔºåÈöèÊó∂ÈöèÂú∞Â≠¶‰π†ÔºÅ</p>
                    <button class="btn btn-primary" style="width:100%;margin-bottom:10px;" onclick="installPWA()">Á´ãÂç≥ÂÆâË£Ö</button>
                    <button class="btn" style="width:100%;background:#f5f5f5;" onclick="dismissInstall()">ÊöÇÊó∂‰∏çË¶Å</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        async function installPWA() {
            if (!deferredPrompt) return;
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            deferredPrompt = null;
            document.getElementById('installPrompt')?.remove();
            if (outcome === 'accepted') {
                alert('ÂÆâË£ÖÊàêÂäüÔºÅÂèØÂú®Ê°åÈù¢ÊâæÂà∞ AI ËÉåÂçïËØç');
            }
        }
        
        function dismissInstall() {
            document.getElementById('installPrompt')?.remove();
            localStorage.setItem('wordAI_pwaDismissed', 'true');
        }

        // ÂêØÂä®
        init();
        
        // ====== ÊÄßËÉΩÁõëÊéß ======
        if ('performance' in window) {
            window.addEventListener('load', () => {
                setTimeout(() => {
                    const perfData = window.performance.timing;
                    const pageLoadTime = perfData.loadEventEnd - perfData.navigationStart;
                    const domReady = perfData.domContentLoadedEventEnd - perfData.navigationStart;
                    console.log(`È°µÈù¢Âä†ËΩΩÊó∂Èó¥: ${pageLoadTime}ms, DOMÂ∞±Áª™: ${domReady}ms`);
                }, 0);
            });
        }
        
        // ====== ÂÖ®Â±ÄÈîôËØØÂ§ÑÁêÜ ======
        window.addEventListener('error', (e) => {
            console.error('È°µÈù¢ÈîôËØØ:', e.message);
            // ËÆ∞ÂΩïÈîôËØØÂà∞localStorage
            const errors = JSON.parse(localStorage.getItem('wordAI_errors') || '[]');
            errors.push({
                message: e.message,
                filename: e.filename,
                lineno: e.lineno,
                time: new Date().toISOString()
            });
            // Âè™‰øùÁïôÊúÄËøë10‰∏™ÈîôËØØ
            if (errors.length > 10) errors.shift();
            localStorage.setItem('wordAI_errors', JSON.stringify(errors));
        });
        
        // ====== Service Worker Ê≥®ÂÜå (PWAÁ¶ªÁ∫øÊîØÊåÅ) ======
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(() => {
                // Service Worker Ê≥®ÂÜåÂ§±Ë¥•ÔºåÂøΩÁï•
            });
        }
        
        // ====== ÂÜÖÂ≠ò‰ºòÂåñ ======
        // ÂÆöÊúüÊ∏ÖÁêÜ‰∏çÈúÄË¶ÅÁöÑÊï∞ÊçÆ
        setInterval(() => {
            try {
                const reviewData = JSON.parse(localStorage.getItem('wordAI_review') || '[]');
                // Ê∏ÖÁêÜË∂ÖËøá30Â§©ÁöÑÂ§ç‰π†Êï∞ÊçÆ
                const thirtyDaysAgo = Date.now() - 30 * 24 * 60 * 60 * 1000;
                const cleanedData = reviewData.filter(w => !w.lastReview || new Date(w.lastReview).getTime() > thirtyDaysAgo);
                if (cleanedData.length !== reviewData.length) {
                    localStorage.setItem('wordAI_review', JSON.stringify(cleanedData));
                }
            } catch (e) {}
        }, 60 * 60 * 1000); // ÊØèÂ∞èÊó∂Ê£ÄÊü•‰∏ÄÊ¨°
        
        // ====== [ËûçÂêàÊñ∞ÂäüËÉΩ] Â¢ûÂº∫ÂûãSM2Èó¥ÈöîÈáçÂ§çÁÆóÊ≥ï ======
        // Âü∫‰∫éAnyMemoÂíåÂºÄÊ∫êÁÆóÊ≥ïÁöÑ‰ºòÂåñÂÆûÁé∞
        const EnhancedSM2 = {
            // ËÆ°ÁÆó‰∏ãÊ¨°Â§ç‰π†Èó¥Èöî
            calculate: function(quality, repetitions, easeFactor, interval) {
                // quality: 0-5 (0-2 = Â§±Ë¥•, 3-5 = ÊàêÂäü)
                if (quality < 3) {
                    // ÂõûÁ≠îÈîôËØØÔºåÈáçÊñ∞ÂºÄÂßã
                    return {
                        repetitions: 0,
                        easeFactor: Math.max(1.3, easeFactor - 0.2),
                        interval: 1
                    };
                }
                
                // ÂõûÁ≠îÊ≠£Á°Æ
                let newInterval, newRepetitions = repetitions + 1;
                let newEaseFactor = easeFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
                newEaseFactor = Math.max(1.3, newEaseFactor); // ÊúÄÂ∞è1.3
                
                if (newRepetitions === 1) {
                    newInterval = 1;
                } else if (newRepetitions === 2) {
                    newInterval = 6;
                } else {
                    newInterval = Math.round(interval * newEaseFactor);
                }
                
                return {
                    repetitions: newRepetitions,
                    easeFactor: newEaseFactor,
                    interval: newInterval
                };
            },
            
            // Ëé∑ÂèñËÆ∞ÂøÜ‰øùÊåÅÁéáÈ¢ÑÊµã
            getRetentionPrediction: function(daysSinceReview, easeFactor, interval) {
                // Âü∫‰∫éËâæÂÆæÊµ©ÊñØÈÅóÂøòÊõ≤Á∫øÊîπËâØÁâà
                const baseRetention = Math.exp(-daysSinceReview / (interval * easeFactor * 0.5));
                return Math.max(0, Math.min(100, Math.round(baseRetention * 100)));
            }
        };
        
        // ====== [ËûçÂêàÊñ∞ÂäüËÉΩ] AnkiÂØºÂÖ•ÂäüËÉΩ ======
        // ‰ªéCardenÂíåUlangiÂ≠¶‰π†ÁöÑ‰∏ÄÈîÆÂØºÂÖ•
        const AnkiImport = {
            // Ëß£ÊûêAnkiÂØºÂá∫ÁöÑCSVÊ†ºÂºè
            parseAnkiFormat: function(csvText) {
                const lines = csvText.split('\n').filter(l => l.trim());
                const cards = [];
                
                lines.forEach(line => {
                    // Â§ÑÁêÜÂ∏¶ÂºïÂè∑ÁöÑCSV
                    const parts = [];
                    let current = '';
                    let inQuotes = false;
                    
                    for (let char of line) {
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ';' && !inQuotes) {
                            parts.push(current.trim());
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    parts.push(current.trim());
                    
                    if (parts.length >= 2) {
                        cards.push({
                            word: parts[0].replace(/<[^>]+>/g, ''), // ÂéªÈô§HTMLÊ†áÁ≠æ
                            meaning: parts[1].replace(/<[^>]+>/g, ''),
                            phonetic: parts[2] || ''
                        });
                    }
                });
                
                return cards;
            },
            
            // Ëß£ÊûêÊ†áÂáÜCSVÊ†ºÂºè
            parseCSV: function(csvText) {
                const lines = csvText.split('\n').filter(l => l.trim());
                const cards = [];
                
                // Ë∑≥ËøáÊ†áÈ¢òË°å
                for (let i = 1; i < lines.length; i++) {
                    const parts = lines[i].split(',').map(p => p.trim().replace(/^"|"$/g, ''));
                    if (parts.length >= 2) {
                        cards.push({
                            word: parts[0],
                            meaning: parts[1],
                            phonetic: parts[2] || ''
                        });
                    }
                }
                
                return cards;
            },
            
            // ‰ªéÊñá‰ª∂ÂØºÂÖ•
            importFromFile: function(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const text = e.target.result;
                            const cards = this.parseCSV(text);
                            resolve(cards);
                        } catch (err) {
                            reject(err);
                        }
                    };
                    reader.onerror = reject;
                    reader.readAsText(file);
                });
            },
            
            // ÂØºÂÖ•Âà∞Â≠¶‰π†Â∫ì
            importCards: async function(cards) {
                if (!cards || cards.length === 0) {
                    alert('ÂØºÂÖ•Â§±Ë¥•ÔºöÊñá‰ª∂Ê†ºÂºè‰∏çÊ≠£Á°Æ');
                    return;
                }
                
                const wordBook = JSON.parse(localStorage.getItem('wordAI_wordBook') || '[]');
                let addedCount = 0;
                
                cards.forEach(card => {
                    // ÈÅøÂÖçÈáçÂ§çÊ∑ªÂä†
                    if (!wordBook.some(w => w.word.toLowerCase() === card.word.toLowerCase())) {
                        wordBook.push({
                            word: card.word,
                            meaning: card.meaning,
                            phonetic: card.phonetic || '',
                            learned: false,
                            correct: 0,
                            wrong: 0,
                            addedAt: Date.now()
                        });
                        addedCount++;
                    }
                });
                
                localStorage.setItem('wordAI_wordBook', JSON.stringify(wordBook));
                
                alert('ÊàêÂäüÂØºÂÖ• ' + addedCount + ' ‰∏™ÂçïËØçÔºÅ');
                renderWordBook();
            }
        };
        
        // ====== [ËûçÂêàÊñ∞ÂäüËÉΩ] ÂèëÈü≥ËØÑÂàÜÁ≥ªÁªü ======
        // ‰ªéLangHelperÂ≠¶‰π†ÁöÑAIÂèëÈü≥ËØÑ‰º∞
        const PronunciationScore = {
            recognition: null,
            isRecording: false,
            
            // ÂàùÂßãÂåñËØ≠Èü≥ËØÜÂà´
            init: function() {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (!SpeechRecognition) {
                    alert('ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅËØ≠Èü≥ËØÜÂà´ÂäüËÉΩ');
                    return false;
                }
                
                this.recognition = new SpeechRecognition();
                this.recognition.continuous = false;
                this.recognition.interimResults = true;
                this.recognition.lang = 'en-US';
                
                return true;
            },
            
            // ÂºÄÂßãÂΩïÈü≥
            startRecording: function(targetWord, onResult, onError) {
                if (!this.recognition && !this.init()) return;
                
                this.isRecording = true;
                
                this.recognition.onresult = (event) => {
                    let transcript = '';
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        transcript += event.results[i][0].transcript;
                    }
                    onResult(transcript);
                };
                
                this.recognition.onerror = (event) => {
                    this.isRecording = false;
                    onError(event.error);
                };
                
                this.recognition.onend = () => {
                    this.isRecording = false;
                };
                
                this.recognition.start();
            },
            
            // ÂÅúÊ≠¢ÂΩïÈü≥
            stopRecording: function() {
                if (this.recognition && this.isRecording) {
                    this.recognition.stop();
                    this.isRecording = false;
                }
            },
            
            // ËÆ°ÁÆóÂèëÈü≥Áõ∏‰ººÂ∫¶ËØÑÂàÜ
            calculateScore: function(spoken, target) {
                if (!spoken || !target) return 0;
                
                spoken = spoken.toLowerCase().trim();
                target = target.toLowerCase().trim();
                
                // ÂÆåÂÖ®ÂåπÈÖç
                if (spoken === target) return 100;
                
                // ËÆ°ÁÆóLevenshteinË∑ùÁ¶ª
                const m = spoken.length;
                const n = target.length;
                const dp = Array(m + 1).fill(null).map(() => Array(n + 1).fill(0));
                
                for (let i = 0; i <= m; i++) dp[i][0] = i;
                for (let j = 0; j <= n; j++) dp[0][j] = j;
                
                for (let i = 1; i <= m; i++) {
                    for (let j = 1; j <= n; j++) {
                        if (spoken[i-1] === target[j-1]) {
                            dp[i][j] = dp[i-1][j-1];
                        } else {
                            dp[i][j] = Math.min(dp[i-1][j-1], dp[i-1][j], dp[i-1][j-1]) + 1;
                        }
                    }
                }
                
                const distance = dp[m][n];
                const similarity = 1 - (distance / Math.max(m, n));
                
                return Math.round(similarity * 100);
            }
        };
        
        // ====== [ËûçÂêàÊñ∞ÂäüËÉΩ] AIÂè£ËØ≠ÂØπËØù ======
        // ‰ªéLangHelperÂ≠¶‰π†ÁöÑÂØπËØùÂäüËÉΩ
        const AIConversation = {
            messages: [],
            isActive: false,
            currentScenario: 'free',
            
            scenarios: {
                free: { name: 'Ëá™Áî±ÂØπËØù', icon: 'üí¨' },
                interview: { name: 'Èù¢ËØïÁªÉ‰π†', icon: 'üëî' },
                travel: { name: 'ÊóÖË°åËã±ËØ≠', icon: '‚úàÔ∏è' },
                business: { name: 'ÂïÜÂä°Ëã±ËØ≠', icon: 'üíº' },
                daily: { name: 'Êó•Â∏∏ÂØπËØù', icon: 'üè†' },
                // Êñ∞Â¢ûÂú∫ÊôØ
                dating: { name: 'Á∫¶‰ºöËã±ËØ≠', icon: '‚ù§Ô∏è' },
                shopping: { name: 'Ë¥≠Áâ©Ëã±ËØ≠', icon: 'üõçÔ∏è' },
                restaurant: { name: 'È§êÂéÖÁÇπÈ§ê', icon: 'üçΩÔ∏è' },
                hotel: { name: 'ÈÖíÂ∫óÂÖ•‰Ωè', icon: 'üè®' },
                hospital: { name: 'ÂåªÈô¢Ëã±ËØ≠', icon: 'üè•' },
                emergency: { name: 'Á¥ßÊÄ•Ê±ÇÂä©', icon: 'üö®' },
                academic: { name: 'Â≠¶ÊúØËã±ËØ≠', icon: 'üìö' },
                tech: { name: 'ÁßëÊäÄËã±ËØ≠', icon: 'üíª' }
            },
            
            // ÂàùÂßãÂåñÂØπËØù
            init: function() {
                this.messages = [];
                this.isActive = true;
                this.addMessage('ai', '‰Ω†Â•ΩÔºÅÊàëÊòØ‰Ω†ÁöÑAIËã±ËØ≠Âè£ËØ≠ÊïôÁªÉ„ÄÇËÆ©Êàë‰ª¨ÂºÄÂßãÁªÉ‰π†ÂêßÔºÅ‰Ω†ÂèØ‰ª•Áî®Ëã±ËØ≠ÂíåÊàëÂØπËØùÔºåÊàñËÄÖÈÄâÊã©‰∏Ä‰∏™Âú∫ÊôØ„ÄÇ');
            },
            
            // Ê∑ªÂä†Ê∂àÊÅØ
            addMessage: function(type, content) {
                this.messages.push({ type, content, time: Date.now() });
                this.render();
            },
            
            // ÂèëÈÄÅÁî®Êà∑Ê∂àÊÅØ
            send: async function(text) {
                this.addMessage('user', text);
                
                // Ê®°ÊãüAIÂõûÂ§çÔºàÂÆûÈôÖÈ°πÁõÆ‰∏≠ÂèØ‰ª•Êé•ÂÖ•GPT APIÔºâ
                const replies = [
                    'That is interesting! Can you tell me more about that?',
                    'Great! How do you feel about that?',
                    'I see. Could you elaborate a bit more?',
                    'Well said! What other experiences do you have?',
                    'Perfect! Let us try a different topic. What do you like to do in your free time?'
                ];
                
                // Ê®°ÊãüÁΩëÁªúÂª∂Ëøü
                await new Promise(r => setTimeout(r, 1000));
                
                const reply = replies[Math.floor(Math.random() * replies.length)];
                this.addMessage('ai', reply);
            },
            
            // Ê∏≤ÊüìÂØπËØù
            render: function() {
                const container = document.getElementById('conversationMessages');
                if (!container) return;
                
                container.innerHTML = this.messages.map(m => 
                    '<div class="dialogue-msg ' + m.type + '"><div class="dialogue-bubble">' + m.content + '</div></div>'
                ).join('');
                
                container.scrollTop = container.scrollHeight;
            },
            
            // ÂàáÊç¢Âú∫ÊôØ
            setScenario: function(scenario) {
                this.currentScenario = scenario;
                this.messages = [];
                this.addMessage('ai', 'Â•ΩÁöÑÔºåËÆ©Êàë‰ª¨ÂºÄÂßã' + this.scenarios[scenario].name + 'ÔºÅÊàëÊù•ÊâÆÊºîÂØπËØù‰∏≠ÁöÑËßíËâ≤„ÄÇ');
            }
        };
        
        // ====== [ËûçÂêàÊñ∞ÂäüËÉΩ] Êï∞ÊçÆÂØºÂá∫ÂäüËÉΩ ======
        const DataExport = {
            // ÂØºÂá∫‰∏∫CSV
            exportCSV: function() {
                const wordBook = JSON.parse(localStorage.getItem('wordAI_wordBook') || '[]');
                const reviewData = JSON.parse(localStorage.getItem('wordAI_review') || '[]');
                
                let csv = 'ÂçïËØç,Èáä‰πâ,Èü≥Ê†á,Â≠¶‰π†Ê¨°Êï∞,Ê≠£Á°ÆÊ¨°Êï∞,ÈîôËØØÊ¨°Êï∞,ÊéåÊè°Á≠âÁ∫ß\n';
                
                wordBook.forEach(word => {
                    const review = reviewData.find(r => r.word === word.word) || {};
                    const level = this.calculateLevel(word);
                    csv += '"' + word.word + '","' + word.meaning + '","' + (word.phonetic || '') + '",' + ((word.correct || 0) + (word.wrong || 0)) + ',' + (word.correct || 0) + ',' + (word.wrong || 0) + ',' + level + '\n';
                });
                
                this.downloadFile(csv, 'word-ai-export.csv', 'text/csv');
            },
            
            // ÂØºÂá∫‰∏∫AnkiÊ†ºÂºè
            exportAnki: function() {
                const wordBook = JSON.parse(localStorage.getItem('wordAI_wordBook') || '[]');
                
                let ankiFormat = '';
                
                wordBook.forEach(word => {
                    ankiFormat += word.word + ';' + word.meaning + ';' + (word.phonetic || '') + '\n';
                });
                
                this.downloadFile(ankiFormat, 'word-ai-anki.txt', 'text/plain');
            },
            
            // ËÆ°ÁÆóÊéåÊè°Á≠âÁ∫ß
            calculateLevel: function(word) {
                const total = (word.correct || 0) + (word.wrong || 0);
                if (total === 0) return 'Êú™Â≠¶‰π†';
                const rate = (word.correct || 0) / total;
                if (rate >= 0.9) return 'Á≤æÈÄö';
                if (rate >= 0.7) return 'ÁÜüÊÇâ';
                if (rate >= 0.5) return '‰∏ÄËà¨';
                return 'ÁîüÁñè';
            },
            
            // ‰∏ãËΩΩÊñá‰ª∂
            downloadFile: function(content, filename, type) {
                const blob = new Blob([content], { type: type });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);
            }
        };
        
        // ÊòæÁ§∫ÂØºÂÖ•ÂºπÁ™ó
        function showImportDialog() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = '<div class="modal-content" style="max-width:360px;"><div class="modal-title">üì• ÂØºÂÖ•ÂçïËØç</div><p style="color:#666;font-size:13px;margin:15px 0;">ÊîØÊåÅ‰ªéAnki„ÄÅQuizletÁ≠âÂ∫îÁî®ÂØºÂÖ•ÂçïËØç</p><div style="margin-top:15px;"><div style="font-size:13px;color:#666;margin-bottom:8px;">ÈÄâÊã©ÂØºÂÖ•ÊñπÂºèÔºö</div><label class="export-option" style="cursor:pointer;"><div class="export-icon" style="background:#fff7e6;">üìÑ</div><div style="flex:1;"><div style="font-size:14px;">CSVÊñá‰ª∂</div><div style="font-size:12px;color:#666;">Ê†áÂáÜÊ†ºÂºè: ÂçïËØç,Èáä‰πâ,Èü≥Ê†á</div></div><input type="file" accept=".csv,.txt" style="display:none;" onchange="handleFileImport(this)"></label><label class="export-option" style="cursor:pointer;"><div class="export-icon" style="background:#f0f7ff;">üìã</div><div style="flex:1;"><div style="font-size:14px;">AnkiÊ†ºÂºè</div><div style="font-size:12px;color:#666;">AnkiÂØºÂá∫ÁöÑtxtÊñá‰ª∂</div></div><input type="file" accept=".txt" style="display:none;" onchange="handleAnkiImport(this)"></label></div><button class="btn" style="width:100%;margin-top:15px;" onclick="this.closest(\'.modal\').remove()">ÂèñÊ∂à</button></div>';
            document.body.appendChild(modal);
        }
        
        // Â§ÑÁêÜCSVÊñá‰ª∂ÂØºÂÖ•
        async function handleFileImport(input) {
            const file = input.files[0];
            if (!file) return;
            
            try {
                const cards = await AnkiImport.importFromFile(file);
                await AnkiImport.importCards(cards);
                input.closest('.modal').remove();
            } catch (err) {
                alert('ÂØºÂÖ•Â§±Ë¥•: ' + err.message);
            }
        }
        
        // Â§ÑÁêÜAnkiÊ†ºÂºèÂØºÂÖ•
        async function handleAnkiImport(input) {
            const file = input.files[0];
            if (!file) return;
            
            try {
                const text = await file.text();
                const cards = AnkiImport.parseAnkiFormat(text);
                await AnkiImport.importCards(cards);
                input.closest('.modal').remove();
            } catch (err) {
                alert('ÂØºÂÖ•Â§±Ë¥•: ' + err.message);
            }
        }
        
        // ÊòæÁ§∫ÂØºÂá∫ÂºπÁ™ó
        function showExportDialog() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = '<div class="modal-content" style="max-width:360px;"><div class="modal-title">üì§ ÂØºÂá∫ÂçïËØç</div><p style="color:#666;font-size:13px;margin:15px 0;">Â∞Ü‰Ω†ÁöÑÂ≠¶‰π†Êï∞ÊçÆÂØºÂá∫Â§á‰ªΩ</p><div style="display:flex;flex-direction:column;gap:10px;margin-top:15px;"><button class="btn" onclick="DataExport.exportCSV();this.closest(\'.modal\').remove();">üìä ÂØºÂá∫‰∏∫CSV</button><button class="btn" onclick="DataExport.exportAnki();this.closest(\'.modal\').remove();">üìã ÂØºÂá∫‰∏∫AnkiÊ†ºÂºè</button></div><button class="btn" style="width:100%;margin-top:15px;" onclick="this.closest(\'.modal\').remove()">ÂèñÊ∂à</button></div>';
            document.body.appendChild(modal);
        }
        
        // ====== [ËûçÂêàÊñ∞ÂäüËÉΩ] ÊòæÁ§∫AIÂè£ËØ≠ÂØπËØù ======
        function showAIDialogue() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.style.maxWidth = '500px';
            let scenariosHtml = '';
            for (const [k, v] of Object.entries(AIConversation.scenarios)) {
                scenariosHtml += '<button onclick="AIConversation.setScenario(\'' + k + '\')" style="padding:6px 12px;border:none;border-radius:15px;background:rgba(255,255,255,0.2);color:white;font-size:12px;cursor:pointer;white-space:nowrap;">' + v.icon + ' ' + v.name + '</button>';
            }
            modal.innerHTML = '<div style="background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:20px;border-radius:20px 20px 0 0;"><div style="display:flex;justify-content:space-between;align-items:center;"><div style="font-size:18px;font-weight:bold;">üó£Ô∏è AIÂè£ËØ≠Èô™ÁªÉ</div><button onclick="this.closest(\'.modal\').remove()" style="background:none;border:none;color:white;font-size:20px;cursor:pointer;">‚úï</button></div><div style="display:flex;gap:8px;margin-top:12px;overflow-x:auto;padding-bottom:5px;">' + scenariosHtml + '</div></div><div id="conversationMessages" style="height:300px;overflow-y:auto;padding:15px;background:#f9f9f9;"></div><div style="display:flex;gap:10px;padding:15px;background:white;border-top:1px solid #eee;"><input type="text" id="dialogueInput" placeholder="Áî®Ëã±ËØ≠ËæìÂÖ•..." style="flex:1;padding:12px;border:1px solid #ddd;border-radius:25px;outline:none;"><button onclick="sendDialogue()" style="width:45px;height:45px;border-radius:50%;background:#667eea;color:white;border:none;cursor:pointer;font-size:18px;">‚û§</button></div>';
            document.body.appendChild(modal);
            AIConversation.init();
            
            // ÂõûËΩ¶ÂèëÈÄÅ
            document.getElementById('dialogueInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendDialogue();
            });
        }
        
        function sendDialogue() {
            const input = document.getElementById('dialogueInput');
            const text = input.value.trim();
            if (!text) return;
            
            AIConversation.send(text);
            input.value = '';
        }
        
        // ====== [ËûçÂêàÊñ∞ÂäüËÉΩ] ÂèëÈü≥ÁªÉ‰π†Ê®°Âºè ======
        function startPronunciationPractice() {
            const wordBook = JSON.parse(localStorage.getItem('wordAI_wordBook') || '[]');
            if (wordBook.length === 0) {
                alert('ËØ∑ÂÖàÊ∑ªÂä†‰∏Ä‰∫õÂçïËØçÔºÅ');
                return;
            }
            
            const randomWord = wordBook[Math.floor(Math.random() * wordBook.length)];
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = '<div class="modal-content" style="max-width:360px;text-align:center;"><div class="modal-title">üé§ ÂèëÈü≥ÁªÉ‰π†</div><div style="margin:30px 0;"><div style="font-size:36px;font-weight:bold;color:#333;margin-bottom:10px;">' + randomWord.word + '</div><div style="font-size:16px;color:#666;margin-bottom:20px;">' + (randomWord.phonetic || '') + '</div><button onclick="playPronunciation(\'' + randomWord.word + '\')" class="btn" style="font-size:16px;padding:12px 24px;">üîä Êí≠ÊîæÂèëÈü≥</button></div><div style="margin:20px 0;"><button id="recordBtn" onclick="toggleRecording(\'' + randomWord.word + '\')" class="record-btn" style="width:70px;height:70px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);color:white;border:none;font-size:24px;cursor:pointer;">üé§</button><div class="record-hint" style="font-size:13px;color:#666;margin-top:10px;">ÁÇπÂáªÂΩïÈü≥ÔºåÊúóËØª‰∏äÊñπÂçïËØç</div></div><div id="pronunciationResult" style="display:none;margin:20px 0;"><div style="font-size:14px;color:#666;">‰Ω†ÁöÑÂèëÈü≥ÂæóÂàÜ</div><div id="pronScore" style="font-size:48px;font-weight:bold;color:#667eea;">--</div><div id="pronFeedback" style="font-size:13px;color:#666;margin-top:8px;"></div></div><button class="btn" style="width:100%;margin-top:15px;" onclick="this.closest(\'.modal\').remove()">ÂÖ≥Èó≠</button></div>';
            document.body.appendChild(modal);
        }
        
        function playPronunciation(word) {
            const utterance = new SpeechSynthesisUtterance(word);
            utterance.lang = 'en-US';
            utterance.rate = 0.8;
            speechSynthesis.speak(utterance);
        }
        
        let currentRecordWord = '';
        
        function toggleRecording(word) {
            currentRecordWord = word;
            const btn = document.getElementById('recordBtn');
            
            if (PronunciationScore.isRecording) {
                PronunciationScore.stopRecording();
                btn.classList.remove('recording');
                btn.innerHTML = 'üé§';
            } else {
                PronunciationScore.startRecording(word, 
                    function(transcript) {
                        const score = PronunciationScore.calculateScore(transcript, word);
                        showPronunciationResult(score, transcript);
                    },
                    function(error) {
                        alert('ÂΩïÈü≥Â§±Ë¥•: ' + error);
                    }
                );
                btn.classList.add('recording');
                btn.innerHTML = '‚èπÔ∏è';
            }
        }
        
        function showPronunciationResult(score, transcript) {
            const resultDiv = document.getElementById('pronunciationResult');
            const scoreEl = document.getElementById('pronScore');
            const feedbackEl = document.getElementById('pronFeedback');
            
            resultDiv.style.display = 'block';
            scoreEl.textContent = score;
            
            if (score >= 90) {
                scoreEl.style.color = '#10b981';
                feedbackEl.textContent = 'üéâ Â§™Ê£í‰∫ÜÔºÅÂèëÈü≥ÈùûÂ∏∏Ê†áÂáÜÔºÅ';
            } else if (score >= 70) {
                scoreEl.style.color = '#f59e0b';
                feedbackEl.textContent = 'üëç Âæà‰∏çÈîôÔºÅÂÜçÁªÉ‰π†‰∏Ä‰∏ã‰ºöÊõ¥ÂÆåÁæé~';
            } else {
                scoreEl.style.color = '#ef4444';
                feedbackEl.textContent = 'üí™ ÁªßÁª≠Âä™ÂäõÔºåÂ§öÂê¨Â§öË∑üËØª~';
            }
            
            // Êõ¥Êñ∞ÂàÜÊï∞ÊòæÁ§∫Âä®Áîª
            scoreEl.classList.add('updated');
            setTimeout(function() { scoreEl.classList.remove('updated'); }, 300);
        }
        
        // ====== [ËûçÂêàÊñ∞ÂäüËÉΩ] FSRSÁÆóÊ≥ï ======
        // Âü∫‰∫é open-spaced-repetition/py-fsrs ÁöÑÊúÄÊñ∞Èó¥ÈöîÈáçÂ§çÁÆóÊ≥ï
        var FSRS = {
            defaultParameters: [0.212, 1.2931, 2.3065, 8.2956, 6.4133, 0.8334, 3.0194, 0.001, 1.8722, 0.1666, 0.796, 1.4835, 0.0614, 0.2629, 1.6483, 0.6014, 1.8729, 0.5425, 0.0912, 0.0658, 0.1542],
            states: { learning: 1, review: 2, relearning: 3 },
            rating: { again: 1, hard: 2, good: 3, easy: 4 },
            learningSteps: [1, 10], relearningSteps: [10], maximumInterval: 36500, desiredRetention: 0.9,
            init: function(params) { this.params = params || this.defaultParameters; },
            getRetrievability: function(stability, days) { return Math.exp(-days / stability); },
            predictMemoryCurve: function(stability, days) {
                var curve = [];
                for (var d = 0; d <= days; d++) { curve.push({ day: d, retention: this.getRetrievability(stability, d) * 100 }); }
                return curve;
            },
            schedule: function(currentStability, rating) {
                var r = this.rating, newStability = currentStability, interval = 1;
                switch(rating) {
                    case r.again: newStability = Math.max(1, currentStability * 0.5); interval = 1/1440; break;
                    case r.hard: newStability = currentStability * 1.2; interval = currentStability * 0.8; break;
                    case r.good: newStability = currentStability * 1.5; interval = currentStability * this.desiredRetention; break;
                    case r.easy: newStability = currentStability * 2.5; interval = currentStability * 1.3; break;
                }
                interval = Math.max(1, Math.min(interval, this.maximumInterval));
                return { stability: newStability, interval: Math.round(interval), nextReview: Date.now() + interval * 24 * 60 * 60 * 1000 };
            }
        };
        FSRS.init();
        
        function showFSRSMemoryCurve() {
            var modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = '<div class="modal-content" style="max-width:400px;"><div class="modal-title">üß† FSRSËÆ∞ÂøÜÊõ≤Á∫ø</div><p style="color:#666;font-size:13px;margin:15px 0;">Âü∫‰∫éFree Spaced Repetition SchedulerÁÆóÊ≥ï</p><div id="fsrsCurveContainer" style="height:200px;position:relative;margin:20px 0;"></div><div style="display:flex;justify-content:space-around;margin:15px 0;"><div style="text-align:center;"><div style="font-size:24px;font-weight:bold;color:#667eea;">10</div><div style="font-size:11px;color:#666;">Á®≥ÂÆöÊÄß(Â§©)</div></div><div style="text-align:center;"><div style="font-size:24px;font-weight:bold;color:#10b981;">90%</div><div style="font-size:11px;color:#666;">ÁõÆÊ†á‰øùÊåÅÁéá</div></div></div><button class="btn" style="width:100%;" onclick="this.closest(\'.modal\').remove()">ÂÖ≥Èó≠</button></div>';
            document.body.appendChild(modal);
            setTimeout(function() {
                var container = document.getElementById('fsrsCurveContainer');
                var curve = FSRS.predictMemoryCurve(10, 30);
                var width = container.offsetWidth - 20, height = 180, html = '';
                for (var i = 0; i < curve.length; i++) {
                    var x = (i / 30) * width, y = height - (curve[i].retention / 100) * height;
                    if (i > 0) {
                        var prevX = ((i-1) / 30) * width, prevY = height - (curve[i-1].retention / 100) * height;
                        var length = Math.sqrt((x - prevX) ** 2 + (y - prevY) ** 2);
                        var angle = Math.atan2(y - prevY, x - prevX) * 180 / Math.PI;
                        html += '<div style="position:absolute;left:' + prevX + 'px;bottom:' + prevY + 'px;width:' + length + 'px;height:2px;background:#667eea;transform-origin:left center;transform:rotate(' + angle + 'deg);"></div>';
                    }
                    if (i === 1 || i === 7 || i === 14 || i === 30) {
                        html += '<div style="position:absolute;left:' + x + 'px;bottom:' + y + 'px;width:8px;height:8px;background:#667eea;border-radius:50%;"></div>';
                    }
                }
                container.innerHTML = html;
            }, 100);
        }
        
    </script>
</body>
</html>
