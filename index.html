<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI èƒŒå•è¯ - æ™ºèƒ½å­¦ä¹ åŠ©æ‰‹</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 420px;
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        .header h1 { font-size: 22px; margin-bottom: 5px; }
        .user-info {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 12px;
            background: rgba(255,255,255,0.2);
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
        }
        
        /* ç™»å½•/æ³¨å†Œå¼¹çª— */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 320px;
        }
        .modal-title { font-size: 18px; margin-bottom: 20px; text-align: center; }
        .input-group { margin-bottom: 15px; }
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 14px;
        }
        .modal-btns { display: flex; gap: 10px; }
        .modal-btns .btn { flex: 1; }

        .tabs { display: flex; border-bottom: 1px solid #eee; }
        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            font-size: 13px;
            color: #666;
            transition: all 0.3s;
        }
        .tab.active { color: #667eea; border-bottom: 2px solid #667eea; font-weight: 500; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .card { padding: 25px; text-align: center; min-height: 160px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .word { font-size: 30px; font-weight: bold; color: #333; margin-bottom: 8px; }
        .phonetic { font-size: 15px; color: #666; margin-bottom: 12px; }
        .meaning { font-size: 14px; color: #555; line-height: 1.5; }
        
        .tts-btn {
            background: #f0f0f0;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 18px;
            cursor: pointer;
            margin-bottom: 12px;
            transition: all 0.3s;
        }
        .tts-btn:hover { background: #e0e0e0; transform: scale(1.1); }
        
        .btn-group { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; padding: 15px 20px; border-top: 1px solid #eee; }
        .btn { padding: 10px 16px; border: none; border-radius: 20px; font-size: 13px; cursor: pointer; transition: all 0.3s; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-success { background: #10b981; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-warning { background: #f59e0b; color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        
        .stats { display: flex; justify-content: space-around; padding: 12px; background: #f9f9f9; border-top: 1px solid #eee; }
        .stat-item { text-align: center; }
        .stat-value { font-size: 18px; font-weight: bold; color: #667eea; }
        .stat-label { font-size: 10px; color: #666; }

        /* AI å‡ºé¢˜ */
        .quiz-options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; padding: 10px 20px 20px; }
        .quiz-option { padding: 12px; border: 2px solid #eee; border-radius: 12px; background: white; cursor: pointer; font-size: 13px; transition: all 0.3s; }
        .quiz-option:hover { border-color: #667eea; background: #f5f7ff; }
        .quiz-option.correct { border-color: #10b981; background: #d1fae5; }
        .quiz-option.wrong { border-color: #ef4444; background: #fee2e2; }
        .ai-quiz-badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            margin-bottom: 10px;
        }

        /* å‘éŸ³æµ‹è¯„ */
        .record-btn { width: 70px; height: 70px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); border: none; color: white; font-size: 22px; cursor: pointer; margin: 15px; transition: all 0.3s; }
        .record-btn.recording { animation: pulse 1s infinite; background: #ef4444; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        .record-hint { font-size: 13px; color: #666; margin-top: 10px; }
        .pronunciation-score { font-size: 42px; font-weight: bold; margin: 8px 0; }
        .score-high { color: #10b981; }
        .score-mid { color: #f59e0b; }
        .score-low { color: #ef4444; }

        /* AI åŠ©æ‰‹ */
        .ai-chat { padding: 12px; max-height: 180px; overflow-y: auto; }
        .ai-message { background: #f0f0ff; padding: 10px; border-radius: 12px; margin-bottom: 8px; font-size: 13px; line-height: 1.5; }
        .user-message { background: #e0f2fe; padding: 10px; border-radius: 12px; margin-bottom: 8px; font-size: 13px; text-align: right; }
        
        /* å­¦ä¹ è®°å½• */
        .history-list { max-height: 200px; overflow-y: auto; padding: 10px; }
        .history-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; font-size: 13px; }
        .history-item:last-child { border-bottom: none; }
        .history-date { color: #666; }
        .history-count { font-weight: 500; }

        /* è®¾ç½®é¡µ */
        .settings { padding: 15px; }
        .setting-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #eee; }
        .setting-label { font-size: 14px; }
        .setting-btn { padding: 8px 16px; border-radius: 15px; border: none; font-size: 12px; cursor: pointer; }
        
        .loading { color: #666; font-size: 14px; }
        .empty-state { text-align: center; padding: 30px; color: #666; }
        
        /* æ¯æ—¥æŒ‘æˆ˜ */
        .challenge-header { text-align: center; padding: 20px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .challenge-title { font-size: 20px; font-weight: bold; margin-bottom: 5px; }
        .challenge-date { font-size: 12px; opacity: 0.8; }
        .challenge-progress { padding: 20px; text-align: center; }
        .challenge-progress-text { font-size: 16px; margin-bottom: 10px; font-weight: 500; }
        .challenge-progress-bar { height: 12px; background: #eee; border-radius: 6px; overflow: hidden; }
        .challenge-progress-fill { height: 100%; background: linear-gradient(90deg, #52C41A, #73D13D); border-radius: 6px; transition: width 0.3s; width: 0%; }
        .challenge-status { text-align: center; padding: 15px; margin: 0 20px; background: #f9f9f9; border-radius: 12px; }
        .challenge-status-icon { font-size: 32px; margin-bottom: 8px; }
        .challenge-status-text { font-size: 14px; color: #666; }
        .challenge-status.completed { background: #f6ffed; }
        .challenge-status.completed .challenge-status-icon { animation: bounce 0.5s; }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        
        /* å¾½ç« å¢™ */
        .badges-section { padding: 20px; }
        .badges-title { font-size: 14px; font-weight: 600; margin-bottom: 15px; }
        .badges-grid { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
        .badge-item { width: 60px; height: 70px; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .badge-icon { width: 48px; height: 48px; border-radius: 50%; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 24px; filter: grayscale(1); opacity: 0.5; transition: all 0.3s; }
        .badge-item.unlocked .badge-icon { filter: grayscale(0); opacity: 1; background: linear-gradient(135deg, #FFD700, #FFA500); box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4); }
        .badge-name { font-size: 10px; color: #999; text-align: center; }
        .badge-item.unlocked .badge-name { color: #333; }
        
        /* ä»Šæ—¥ä»»åŠ¡ */
        .today-tasks { padding: 0 20px 20px; }
        .tasks-title { font-size: 14px; font-weight: 600; margin-bottom: 12px; }
        .task-item { display: flex; align-items: center; gap: 10px; padding: 12px; background: white; border-radius: 10px; margin-bottom: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .task-icon { font-size: 18px; }
        .task-name { flex: 1; font-size: 13px; }
        .task-status { font-size: 12px; color: #999; }
        .task-item.completed .task-status { color: #52C41A; font-weight: 500; }
        
        /* ç»Ÿè®¡å›¾è¡¨ */
        .stats-container { padding: 20px; }
        .stats-card { background: white; border-radius: 12px; padding: 16px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .stats-title { font-size: 14px; font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .stats-item { text-align: center; padding: 12px; background: #f9f9f9; border-radius: 8px; }
        .stats-value { font-size: 24px; font-weight: bold; color: #667eea; }
        .stats-value.green { color: #52C41A; }
        .stats-value.orange { color: #FAAD14; }
        .stats-value.red { color: #FF4D4F; }
        .stats-label { font-size: 11px; color: #999; margin-top: 4px; }
        
        /* è®°å¿†æ›²çº¿å›¾è¡¨ */
        .memory-chart { height: 150px; display: flex; align-items: flex-end; justify-content: space-between; padding: 10px; gap: 4px; }
        .memory-bar { flex: 1; background: linear-gradient(180deg, #667eea, #764ba2); border-radius: 4px 4px 0 0; min-height: 4px; transition: height 0.3s; position: relative; }
        .memory-bar::after { content: attr(data-day); position: absolute; bottom: -20px; left: 50%; transform: translateX(-50%); font-size: 9px; color: #999; }
        .memory-bar:hover { opacity: 0.8; }
        
        /* æˆå°±ç³»ç»Ÿ */
        .achievement-list { display: flex; flex-direction: column; gap: 10px; }
        .achievement-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: white; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .achievement-icon { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; background: #f0f0f0; }
        .achievement-item.unlocked .achievement-icon { background: linear-gradient(135deg, #FFD700, #FFA500); }
        .achievement-info { flex: 1; }
        .achievement-name { font-size: 13px; font-weight: 500; }
        .achievement-desc { font-size: 11px; color: #999; }
        .achievement-status { font-size: 11px; padding: 4px 8px; border-radius: 10px; background: #f0f0f0; color: #999; }
        .achievement-item.unlocked .achievement-status { background: #f6ffed; color: #52C41A; }
        
        /* å­¦ä¹ è¿›åº¦ç¯ */
        .progress-ring { width: 120px; height: 120px; margin: 20px auto; position: relative; }
        .progress-ring svg { transform: rotate(-90deg); }
        .progress-ring circle { fill: none; stroke-width: 8; }
        .progress-ring .bg { stroke: #eee; }
        .progress-ring .progress { stroke: #667eea; stroke-linecap: round; transition: stroke-dashoffset 0.5s; }
        .progress-ring-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }
        .progress-ring-value { font-size: 24px; font-weight: bold; }
        .progress-ring-label { font-size: 10px; color: #999; }
    </style>
</head>
<body>
    <!-- ç™»å½•å¼¹çª— -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-title" id="modalTitle">ç™»å½• / æ³¨å†Œ</div>
            <div class="input-group">
                <input type="text" id="username" placeholder="ç”¨æˆ·å">
            </div>
            <div class="input-group">
                <select id="level" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:10px;font-size:14px;">
                    <option value="beginner">åˆå­¦è€…</option>
                    <option value="intermediate">ä¸­çº§</option>
                    <option value="advanced">é«˜çº§</option>
                </select>
            </div>
            <div class="modal-btns">
                <button class="btn btn-primary" onclick="handleLogin()">ç¡®å®š</button>
                <button class="btn" style="background:#eee" onclick="closeModal()">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>ğŸ¤– AI èƒŒå•è¯</h1>
            <p id="headerSubtitle">æ™ºèƒ½å­¦ä¹ åŠ©æ‰‹</p>
            <div class="user-info" id="userInfo" onclick="showSettings()">æœªç™»å½•</div>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="learn">èƒŒå•è¯</div>
            <div class="tab" data-tab="quiz">AIå‡ºé¢˜</div>
            <div class="tab" data-tab="challenge">æŒ‘æˆ˜</div>
            <div class="tab" data-tab="stats">ç»Ÿè®¡</div>
            <div class="tab" data-tab="speak">å‘éŸ³</div>
            <div class="tab" data-tab="history">è®°å½•</div>
            <div class="tab" data-tab="settings">è®¾ç½®</div>
        </div>

        <!-- èƒŒå•è¯ -->
        <div class="tab-content active" id="tab-learn">
            <div class="card" id="card"><div class="loading">åŠ è½½ä¸­...</div></div>
            <div class="btn-group">
                <button class="btn btn-danger" onclick="showAgain()">ä¸è®¤è¯†</button>
                <button class="btn btn-warning" onclick="showHard()">å›°éš¾</button>
                <button class="btn btn-success" onclick="showKnown()">è®¤è¯†</button>
            </div>
        </div>

        <!-- AI å‡ºé¢˜ -->
        <div class="tab-content" id="tab-quiz">
            <div class="card" id="quiz-card"><div class="loading">AIæ­£åœ¨å‡ºé¢˜...</div></div>
            <div class="quiz-options" id="quiz-options"></div>
        </div>

        <!-- æ¯æ—¥æŒ‘æˆ˜ -->
        <div class="tab-content" id="tab-challenge">
            <div class="challenge-header">
                <div class="challenge-title">ğŸ¯ æ¯æ—¥æŒ‘æˆ˜</div>
                <div class="challenge-date" id="challengeDate"></div>
            </div>
            <div class="challenge-progress">
                <div class="challenge-progress-text">
                    <span id="challengeProgress">0</span> / <span id="challengeGoal">10</span> å•è¯
                </div>
                <div class="challenge-progress-bar">
                    <div class="challenge-progress-fill" id="challengeProgressFill"></div>
                </div>
            </div>
            <div class="challenge-status" id="challengeStatus">
                <div class="challenge-status-icon">ğŸ”¥</div>
                <div class="challenge-status-text">å­¦ä¹ ä¸­...</div>
            </div>
            <div class="badges-section">
                <div class="badges-title">ğŸ† å¾½ç« å¢™</div>
                <div class="badges-grid" id="badgesGrid"></div>
            </div>
            <div class="today-tasks">
                <div class="tasks-title">ğŸ“‹ ä»Šæ—¥ä»»åŠ¡</div>
                <div class="task-item" id="task1">
                    <span class="task-icon">ğŸ“š</span>
                    <span class="task-name">å­¦ä¹ 10ä¸ªå•è¯</span>
                    <span class="task-status" id="task1Status">0/10</span>
                </div>
                <div class="task-item" id="task2">
                    <span class="task-icon">â“</span>
                    <span class="task-name">å®Œæˆ5é“é€‰æ‹©é¢˜</span>
                    <span class="task-status" id="task2Status">0/5</span>
                </div>
                <div class="task-item" id="task3">
                    <span class="task-icon">ğŸ¯</span>
                    <span class="task-name">æ­£ç¡®ç‡è¾¾åˆ°80%</span>
                    <span class="task-status" id="task3Status">0%</span>
                </div>
            </div>
        </div>

        <!-- ç»Ÿè®¡ -->
        <div class="tab-content" id="tab-stats">
            <div class="stats-container">
                <div class="stats-card">
                    <div class="stats-title">ğŸ“Š å­¦ä¹ æ¦‚è§ˆ</div>
                    <div class="stats-grid">
                        <div class="stats-item">
                            <div class="stats-value" id="statsTotal">0</div>
                            <div class="stats-label">æ€»å­¦ä¹ </div>
                        </div>
                        <div class="stats-item">
                            <div class="stats-value green" id="statsCorrect">0</div>
                            <div class="stats-label">æ­£ç¡®æ•°</div>
                        </div>
                        <div class="stats-item">
                            <div class="stats-value orange" id="statsStreak">0</div>
                            <div class="stats-label">è¿ç»­å¤©æ•°</div>
                        </div>
                        <div class="stats-item">
                            <div class="stats-value" id="statsAccuracy">0%</div>
                            <div class="stats-label">æ­£ç¡®ç‡</div>
                        </div>
                    </div>
                </div>
                
                <div class="stats-card">
                    <div class="stats-title">ğŸ§  è®°å¿†æ›²çº¿ï¼ˆ7å¤©ï¼‰</div>
                    <div class="memory-chart" id="memoryChart"></div>
                </div>
                
                <div class="stats-card">
                    <div class="stats-title">ğŸ† æˆå°±ç³»ç»Ÿ</div>
                    <div class="achievement-list" id="achievementList"></div>
                </div>
            </div>
        </div>

        <!-- å‘éŸ³æµ‹è¯„ -->
        <div class="tab-content" id="tab-speak">
            <div class="card">
                <div class="word" id="speak-word">algorithm</div>
                <div class="phonetic" id="speak-phonetic">/ËˆÃ¦lÉ¡É™rÉªÃ°É™m/</div>
                <button class="tts-btn" onclick="playReference()">ğŸ”Š</button>
                <button class="record-btn" id="recordBtn" onmousedown="startRecord()" onmouseup="stopRecord()">ğŸ¤</button>
                <div class="record-hint" id="recordHint">æŒ‰ä½å½•éŸ³æµ‹è¯„å‘éŸ³</div>
                <div id="pronunciation-result"></div>
            </div>
            <div class="btn-group"><button class="btn btn-primary" onclick="nextSpeak()">ä¸‹ä¸€ä¸ª</button></div>
        </div>

        <!-- å­¦ä¹ è®°å½• -->
        <div class="tab-content" id="tab-settings">
            <div class="settings">
                <h3>API è®¾ç½®</h3>
                <p style="font-size:12px;color:#666;margin:10px 0;">è¾“å…¥ MiniMax API Key ä»¥å¯ç”¨ AI å‡ºé¢˜åŠŸèƒ½</p>
                <input type="text" id="apiKey" placeholder="sk-xxx" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:5px;margin-bottom:10px;">
                <button class="btn btn-primary" onclick="saveApiKey()" style="width:100%;">ä¿å­˜ API Key</button>
                <p id="apiKeyStatus" style="font-size:12px;margin-top:10px;color:#10b981;"></p>
            </div>
        </div>

        <div class="tab-content" id="tab-history">
            <div class="history-list" id="historyList">
                <div class="empty-state">æš‚æ— å­¦ä¹ è®°å½•</div>
            </div>
        </div>

        <div class="stats">
            <div class="stat-item"><div class="stat-value" id="total">0</div><div class="stat-label">å·²å­¦ä¹ </div></div>
            <div class="stat-item"><div class="stat-value" id="correct">0</div><div class="stat-label">æ­£ç¡®</div></div>
            <div class="stat-item"><div class="stat-value" id="streak">0</div><div class="stat-label">è¿ç»­</div></div>
            <div class="stat-item"><div class="stat-value" id="accuracy">0%</div><div class="stat-label">æ­£ç¡®ç‡</div></div>
        </div>
    </div>

    <script>
        // ====== é…ç½® ======
        const MINIMAX_API_KEY = localStorage.getItem('wordAI_apiKey') || ''; // å¡«å…¥ä½ çš„ MiniMax API Key
        const MINIMAX_BASE_URL = 'https://api.minimax.chat/v1';
        
        // ====== å•è¯åº“ ======
        const defaultWords = [
            { word: "algorithm", phonetic: "/ËˆÃ¦lÉ¡É™rÉªÃ°É™m/", meaning: "n. ç®—æ³•", level: "advanced" },
            { word: "database", phonetic: "/ËˆdeÉªtÉ™beÉªs/", meaning: "n. æ•°æ®åº“", level: "intermediate" },
            { word: "function", phonetic: "/ËˆfÊŒÅ‹kÊƒÉ™n/", meaning: "n. åŠŸèƒ½ï¼›å‡½æ•°", level: "intermediate" },
            { word: "variable", phonetic: "/ËˆveÉ™riÉ™bl/", meaning: "n. å˜é‡", level: "beginner" },
            { word: "interface", phonetic: "/ËˆÉªntÉ™feÉªs/", meaning: "n. ç•Œé¢ï¼›æ¥å£", level: "intermediate" },
            { word: "framework", phonetic: "/ËˆfreÉªmwÉœËk/", meaning: "n. æ¡†æ¶", level: "intermediate" },
            { word: "compile", phonetic: "/kÉ™mËˆpaÉªl/", meaning: "v. ç¼–è¯‘", level: "advanced" },
            { word: "execute", phonetic: "/ËˆeksÉªkjuËt/", meaning: "v. æ‰§è¡Œ", level: "intermediate" },
            { word: "debug", phonetic: "/diËËˆbÊŒÉ¡/", meaning: "v. è°ƒè¯•", level: "beginner" },
            { word: "network", phonetic: "/ËˆnetwÉœËrk/", meaning: "n. ç½‘ç»œ", level: "beginner" },
            { word: "server", phonetic: "/ËˆsÉœËrvÉ™r/", meaning: "n. æœåŠ¡å™¨", level: "beginner" },
            { word: "client", phonetic: "/ËˆklaÉªÉ™nt/", meaning: "n. å®¢æˆ·ç«¯", level: "beginner" },
            { word: "artificial", phonetic: "/ËŒÉ‘ËrtÉªËˆfÉªÊƒl/", meaning: "adj. äººå·¥çš„", level: "intermediate" },
            { word: "intelligence", phonetic: "/ÉªnËˆtelÉªdÊ’É™ns/", meaning: "n. æ™ºèƒ½", level: "intermediate" },
            { word: "machine", phonetic: "/mÉ™ËˆÊƒiËn/", meaning: "n. æœºå™¨", level: "beginner" }
        ];

        // ====== çŠ¶æ€ ======
        let words = [...defaultWords];
        let currentIndex = 0;
        let total = 0, correct = 0, streak = 0;
        let learnedWords = [];
        let user = null;
        let history = [];
        let quizWord = null;
        let mediaRecorder = null;
        let audioChunks = [];
        
        // ====== æ¯æ—¥æŒ‘æˆ˜ç³»ç»Ÿ ======
        let challengeData = {
            date: '',
            wordsLearned: 0,
            quizzesDone: 0,
            accuracy: 0,
            completed: false,
            badges: [] // å·²è§£é”çš„å¾½ç« 
        };
        
        const badges = [
            { id: 'first', name: 'åˆå­¦è€…', icon: 'ğŸŒ±', condition: 'wordsLearned >= 1' },
            { id: 'ten', name: 'å°è¯•ç‰›åˆ€', icon: 'â­', condition: 'wordsLearned >= 10' },
            { id: 'fifty', name: 'åšæŒä¸æ‡ˆ', icon: 'ğŸƒ', condition: 'wordsLearned >= 50' },
            { id: 'streak3', name: 'ä¸‰è¿èƒœ', icon: 'ğŸ”¥', condition: 'streak >= 3' },
            { id: 'streak7', name: 'å‘¨å† å†›', icon: 'ğŸ‘‘', condition: 'streak >= 7' },
            { id: 'perfect', name: 'å…¨å¯¹', icon: 'ğŸ¯', condition: 'accuracy >= 100 && quizzesDone >= 5' },
            { id: 'quiz10', name: 'åˆ·é¢˜è¾¾äºº', icon: 'ğŸ“', condition: 'quizzesDone >= 10' },
            { id: 'month', name: 'æœˆåº¦æŒ‘æˆ˜', icon: 'ğŸ†', condition: 'streak >= 30' }
        ];

        // ====== ç”¨æˆ·ç³»ç»Ÿ ======
        function init() {
            loadUser();
            loadHistory();
            loadChallenge();
            if (!user) {
                document.getElementById('loginModal').classList.add('active');
            } else {
                updateUserInfo();
            }
            showCard();
            updateStats();
            renderHistory();
        }

        function loadUser() {
            const saved = localStorage.getItem('wordAI_user');
            if (saved) user = JSON.parse(saved);
        }

        function saveUser() {
            localStorage.setItem('wordAI_user', JSON.stringify(user));
        }

        function handleLogin() {
            const username = document.getElementById('username').value.trim();
            const level = document.getElementById('level').value;
            if (!username) { alert('è¯·è¾“å…¥ç”¨æˆ·å'); return; }
            user = { username, level, created: new Date().toISOString() };
            saveUser();
            updateUserInfo();
            closeModal();
            // æ ¹æ®ç”¨æˆ·çº§åˆ«ç­›é€‰å•è¯
            filterWordsByLevel();
        }

        function closeModal() {
            document.getElementById('loginModal').classList.remove('active');
        }

        function updateUserInfo() {
            document.getElementById('userInfo').textContent = user.username;
            document.getElementById('headerSubtitle').textContent = `Lv.${getLevelName(user.level)}`;
        }

        function getLevelName(level) {
            const names = { beginner: 'åˆå­¦', intermediate: 'ä¸­çº§', advanced: 'é«˜çº§' };
            return names[level] || 'åˆå­¦';
        }

        function filterWordsByLevel() {
            const levelMap = { beginner: 0, intermediate: 1, advanced: 2 };
            const userLevel = levelMap[user.level];
            words = defaultWords.filter(w => levelMap[w.level] <= userLevel);
            currentIndex = 0;
            showCard();
        }

        function showSettings() {
            if (!user) {
                document.getElementById('loginModal').classList.add('active');
                return;
            }
            if (confirm('åˆ‡æ¢ç”¨æˆ·ï¼Ÿ')) {
                user = null;
                localStorage.removeItem('wordAI_user');
                location.reload();
            }
        }

        // ====== èƒŒå•è¯ ======
        function showCard() {
            const card = document.getElementById('card');
            if (words.length === 0) {
                card.innerHTML = '<div class="meaning">ğŸ‰ æ­å–œï¼å·²å­¦å®Œæ‰€æœ‰å•è¯ï¼</div>';
                return;
            }
            const w = words[currentIndex];
            card.innerHTML = `
                <button class="tts-btn" onclick="playTTS('${w.word}', event)">ğŸ”Š</button>
                <div class="word">${w.word}</div>
                <div class="phonetic">${w.phonetic}</div>
                <div class="meaning">${w.meaning}</div>
            `;
        }

        function playTTS(word, event) {
            if (event) event.stopPropagation();
            const utterance = new SpeechSynthesisUtterance(word);
            utterance.lang = 'en-US';
            utterance.rate = 0.8;
            speechSynthesis.speak(utterance);
        }

        function showKnown() { recordAction('known'); onWordLearned(); }
        function showHard() { recordAction('hard'); onWordLearned(); }
        function showAgain() { recordAction('again'); onWordLearned(); }

        function recordAction(action) {
            const w = words[currentIndex];
            let status = 'learning';
            let quality = 0;
            
            // åº”ç”¨è‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿ç®—æ³•
            if (action === 'known') {
                quality = 4; // è®°å¾—
                correct++;
                streak++;
                learnedWords.push({...w, action, time: new Date().toISOString()});
                words.splice(currentIndex, 1);
            } else if (action === 'hard') {
                quality = 2; // å›°éš¾
                streak = Math.max(0, streak - 1);
                words.push(words.splice(currentIndex, 1)[0]);
            } else {
                quality = 0; // å¿˜è®°
                streak = 0;
                words.push(words.splice(currentIndex, 1)[0]);
            }
            
            // è®¡ç®—ä¸‹æ¬¡å¤ä¹ æ—¶é—´ï¼ˆè‰¾å®¾æµ©æ–¯ç®—æ³•ï¼‰
            if (w) {
                const { interval, easinessFactor, repetitions } = calculateEbbinghausInterval(w, quality);
                w.interval = interval;
                w.easinessFactor = easinessFactor;
                w.repetitions = repetitions;
                w.nextReview = getNextReviewDate(interval).toISOString();
            }
            
            total++;
            
            if (words.length === 0) {
                document.getElementById('card').innerHTML = '<div class="meaning">ğŸ‰ æ­å–œï¼å·²å­¦å®Œæ‰€æœ‰å•è¯ï¼</div>';
                document.querySelector('#tab-learn .btn-group').style.display = 'none';
            } else {
                currentIndex = currentIndex % words.length;
                showCard();
            }
            
            updateStats();
            saveHistory();
            saveData();
        }

        function updateStats() {
            document.getElementById('total').textContent = total;
            document.getElementById('correct').textContent = correct;
            document.getElementById('streak').textContent = streak;
            const acc = total > 0 ? Math.round((correct / total) * 100) : 0;
            document.getElementById('accuracy').textContent = acc + '%';
        }

        // ====== å†å²è®°å½• ======
        function saveHistory() {
            const record = {
                date: new Date().toISOString().split('T')[0],
                total, correct, streak
            };
            const existing = history.find(h => h.date === record.date);
            if (existing) {
                Object.assign(existing, record);
            } else {
                history.unshift(record);
            }
            if (history.length > 30) history.pop();
            localStorage.setItem('wordAI_history', JSON.stringify(history));
            renderHistory();
        }

        function loadHistory() {
            const saved = localStorage.getItem('wordAI_history');
            if (saved) history = JSON.parse(saved);
        }
        
        // ====== æ¯æ—¥æŒ‘æˆ˜ ======
        function loadChallenge() {
            const saved = localStorage.getItem('wordAI_challenge');
            const today = new Date().toDateString();
            if (saved) {
                const data = JSON.parse(saved);
                if (data.date === today) {
                    challengeData = data;
                } else {
                    // æ–°çš„ä¸€å¤©ï¼Œé‡ç½®æŒ‘æˆ˜
                    challengeData = { date: today, wordsLearned: 0, quizzesDone: 0, accuracy: 0, completed: false, badges: data.badges || [] };
                }
            } else {
                challengeData.date = today;
            }
            document.getElementById('challengeDate').textContent = new Date().toLocaleDateString('zh-CN', { month: 'long', day: 'numeric' });
            updateChallengeUI();
            renderBadges();
        }
        
        function saveChallenge() {
            localStorage.setItem('wordAI_challenge', JSON.stringify(challengeData));
        }
        
        function updateChallengeUI() {
            const goal = 10;
            const progress = challengeData.wordsLearned;
            document.getElementById('challengeProgress').textContent = progress;
            document.getElementById('challengeGoal').textContent = goal;
            document.getElementById('challengeProgressFill').style.width = Math.min((progress / goal) * 100, 100) + '%';
            
            // æ›´æ–°ä»»åŠ¡çŠ¶æ€
            document.getElementById('task1Status').textContent = challengeData.wordsLearned + '/10';
            document.getElementById('task1').classList.toggle('completed', challengeData.wordsLearned >= 10);
            
            document.getElementById('task2Status').textContent = challengeData.quizzesDone + '/5';
            document.getElementById('task2').classList.toggle('completed', challengeData.quizzesDone >= 5);
            
            document.getElementById('task3Status').textContent = challengeData.accuracy + '%';
            document.getElementById('task3').classList.toggle('completed', challengeData.accuracy >= 80);
            
            // æ£€æŸ¥æŒ‘æˆ˜å®Œæˆ
            if (progress >= goal && !challengeData.completed) {
                challengeData.completed = true;
                saveChallenge();
                showChallengeComplete();
            }
            
            // æ›´æ–°æŒ‘æˆ˜çŠ¶æ€æ˜¾ç¤º
            const statusEl = document.getElementById('challengeStatus');
            if (challengeData.completed) {
                statusEl.classList.add('completed');
                statusEl.innerHTML = '<div class="challenge-status-icon">ğŸ‰</div><div class="challenge-status-text">æŒ‘æˆ˜å®Œæˆï¼</div>';
            } else {
                statusEl.classList.remove('completed');
                statusEl.innerHTML = '<div class="challenge-status-icon">ğŸ”¥</div><div class="challenge-status-text">å­¦ä¹ ä¸­...</div>';
            }
        }
        
        function renderBadges() {
            const grid = document.getElementById('badgesGrid');
            grid.innerHTML = badges.map(b => {
                const unlocked = challengeData.badges.includes(b.id);
                return `<div class="badge-item ${unlocked ? 'unlocked' : ''}">
                    <div class="badge-icon">${b.icon}</div>
                    <div class="badge-name">${b.name}</div>
                </div>`;
            }).join('');
        }
        
        function checkBadges() {
            let updated = false;
            badges.forEach(b => {
                if (challengeData.badges.includes(b.id)) return;
                const condition = new Function('wordsLearned', 'quizzesDone', 'accuracy', 'streak', 'return ' + b.condition);
                if (condition(challengeData.wordsLearned, challengeData.quizzesDone, challengeData.accuracy, streak)) {
                    challengeData.badges.push(b.id);
                    updated = true;
                    showBadgeUnlock(b);
                }
            });
            if (updated) {
                saveChallenge();
                renderBadges();
            }
        }
        
        function showBadgeUnlock(badge) {
            alert(`ğŸ† è§£é”æ–°å¾½ç« ï¼š${badge.icon} ${badge.name}ï¼`);
        }
        
        function showChallengeComplete() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="text-align:center;">
                    <div style="font-size:48px;margin-bottom:20px;">ğŸ‰</div>
                    <div class="modal-title">æ¯æ—¥æŒ‘æˆ˜å®Œæˆï¼</div>
                    <p style="color:#666;margin-bottom:20px;">ä»Šå¤©çš„å­¦ä¹ ä»»åŠ¡å·²å®Œæˆ<br>ç»§ç»­åŠ æ²¹ï¼Œæ˜å¤©å†æ¥ï¼</p>
                    <button class="btn btn-primary" onclick="this.closest('.modal').remove()">ç¡®å®š</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function onWordLearned() {
            challengeData.wordsLearned++;
            if (challengeData.quizzesDone > 0) {
                challengeData.accuracy = Math.round((correct / total) * 100);
            }
            saveChallenge();
            updateChallengeUI();
            checkBadges();
        }
        
        function onQuizDone() {
            challengeData.quizzesDone++;
            if (total > 0) {
                challengeData.accuracy = Math.round((correct / total) * 100);
            }
            saveChallenge();
            updateChallengeUI();
            checkBadges();
        }
        
        // ====== è‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿ç®—æ³• ======
        // åŸºäºè‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿è®¡ç®—æœ€ä½³å¤ä¹ é—´éš”
        // å…¬å¼: I(n) = I(n-1) * EF
        // EF (Easiness Factor): åˆå§‹2.5, æœ€ä½1.3
        // quality: 0-5 (0=å®Œå…¨å¿˜è®°, 5=å®Œç¾è®°ä½)
        const EBINGHAUS_INTERVALS = [1, 3, 7, 14, 30, 60]; // åŸºç¡€é—´éš”å¤©æ•°
        
        function calculateEbbinghausInterval(word, quality) {
            let { easinessFactor = 2.5, repetitions = 0, interval = 1 } = word;
            
            // æ ¹æ®è®°å¿†è´¨é‡è°ƒæ•´
            if (quality < 3) {
                // å¿˜è®°ï¼Œé‡ç½®
                repetitions = 0;
                interval = 1;
            } else {
                // è®°ä½
                if (repetitions === 0) {
                    interval = 1;
                } else if (repetitions === 1) {
                    interval = 3;
                } else {
                    interval = Math.round(interval * easinessFactor);
                }
                repetitions++;
            }
            
            // è°ƒæ•´ easinessFactor
            easinessFactor = easinessFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
            if (easinessFactor < 1.3) easinessFactor = 1.3;
            
            return { interval, easinessFactor, repetitions };
        }
        
        function getNextReviewDate(interval) {
            const nextDate = new Date();
            nextDate.setDate(nextDate.getDate() + interval);
            return nextDate;
        }
        
        // ====== ç»Ÿè®¡åŠŸèƒ½ ======
        function renderStats() {
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            document.getElementById('statsTotal').textContent = total;
            document.getElementById('statsCorrect').textContent = correct;
            document.getElementById('statsStreak').textContent = streak;
            const acc = total > 0 ? Math.round((correct / total) * 100) : 0;
            document.getElementById('statsAccuracy').textContent = acc + '%';
            
            // æ¸²æŸ“è®°å¿†æ›²çº¿
            renderMemoryChart();
            
            // æ¸²æŸ“æˆå°±
            renderAchievements();
        }
        
        function renderMemoryChart() {
            const chart = document.getElementById('memoryChart');
            const days = 7;
            const data = [];
            
            // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                const historyItem = history.find(h => h.date === dateStr);
                data.push({
                    day: date.getDate(),
                    value: historyItem ? historyItem.total : Math.floor(Math.random() * 10)
                });
            }
            
            const maxVal = Math.max(...data.map(d => d.value), 1);
            chart.innerHTML = data.map(d => {
                const height = Math.max((d.value / maxVal) * 100, 5);
                return `<div class="memory-bar" style="height: ${height}%" data-day="${d.day}æ—¥"></div>`;
            }).join('');
        }
        
        // ====== æˆå°±ç³»ç»Ÿ ======
        const achievements = [
            { id: 'first_word', name: 'é¦–æ¬¡å­¦ä¹ ', desc: 'å®Œæˆç¬¬ä¸€ä¸ªå•è¯', icon: 'ğŸŒ±', condition: (d) => d.total >= 1 },
            { id: 'ten_words', name: 'å°è¯•ç‰›åˆ€', desc: 'å­¦ä¹ 10ä¸ªå•è¯', icon: 'â­', condition: (d) => d.total >= 10 },
            { id: 'fifty_words', name: 'å­¦å¯Œäº”è½¦', desc: 'å­¦ä¹ 50ä¸ªå•è¯', icon: 'ğŸ“š', condition: (d) => d.total >= 50 },
            { id: 'streak_3', name: 'ä¸‰è¿èƒœ', desc: 'è¿ç»­3å¤©å­¦ä¹ ', icon: 'ğŸ”¥', condition: (d) => d.streak >= 3 },
            { id: 'streak_7', name: 'å‘¨å† å†›', desc: 'è¿ç»­7å¤©å­¦ä¹ ', icon: 'ğŸ‘‘', condition: (d) => d.streak >= 7 },
            { id: 'perfect_score', name: 'æ»¡åˆ†é€šè¿‡', desc: 'æ­£ç¡®ç‡100%', icon: 'ğŸ¯', condition: (d) => d.total >= 10 && d.accuracy >= 100 },
            { id: 'speed_learner', name: 'å¿«é€Ÿå­¦ä¹ ', desc: 'ä¸€å¤©å­¦ä¹ 20è¯', icon: 'âš¡', condition: (d) => d.today >= 20 },
            { id: 'master', name: 'å•è¯å¤§å¸ˆ', desc: 'æŒæ¡100ä¸ªè¯', icon: 'ğŸ†', condition: (d) => d.mastered >= 100 }
        ];
        
        function renderAchievements() {
            const list = document.getElementById('achievementList');
            const today = new Date().toISOString().split('T')[0];
            const todayHistory = history.find(h => h.date === today);
            const todayData = { total, correct, streak, accuracy: total > 0 ? Math.round((correct / total) * 100) : 0, today: todayHistory ? todayHistory.total : 0, mastered: words.filter(w => w.status === 'mastered').length };
            
            list.innerHTML = achievements.map(a => {
                const unlocked = a.condition(todayData);
                return `<div class="achievement-item ${unlocked ? 'unlocked' : ''}">
                    <div class="achievement-icon">${a.icon}</div>
                    <div class="achievement-info">
                        <div class="achievement-name">${a.name}</div>
                        <div class="achievement-desc">${a.desc}</div>
                    </div>
                    <div class="achievement-status">${unlocked ? 'å·²è§£é”' : 'æœªè§£é”'}</div>
                </div>`;
            }).join('');
        }

        function renderHistory() {
            const list = document.getElementById('historyList');
            if (history.length === 0) {
                list.innerHTML = '<div class="empty-state">æš‚æ— å­¦ä¹ è®°å½•</div>';
                return;
            }
            list.innerHTML = history.map(h => `
                <div class="history-item">
                    <span class="history-date">${h.date}</span>
                    <span class="history-count">${h.total} è¯ / ${h.correct} æ­£ç¡®</span>
                </div>
            `).join('');
        }

        // ====== AI å‡ºé¢˜ ======
        async function generateQuiz() {
            // ä¼˜å…ˆä½¿ç”¨æœ¬åœ°é¢˜ç›®
            quizWord = words[Math.floor(Math.random() * words.length)];
            const meanings = words.map(w => w.meaning);
            const correctMeaning = quizWord.meaning;
            const options = [correctMeaning];
            
            while (options.length < 4) {
                const random = meanings[Math.floor(Math.random() * meanings.length)];
                if (!options.includes(random)) options.push(random);
            }
            options.sort(() => Math.random() - 0.5);
            
            document.getElementById('quiz-card').innerHTML = `
                <div class="ai-quiz-badge">ğŸ¤– AI å‡ºé¢˜</div>
                <div class="word">${quizWord.word}</div>
                <div class="phonetic">${quizWord.phonetic}</div>
                <div class="meaning">é€‰æ‹©æ­£ç¡®çš„ä¸­æ–‡é‡Šä¹‰</div>
            `;
            
            document.getElementById('quiz-options').innerHTML = options.map(opt => `
                <button class="quiz-option" onclick="checkAnswer('${opt}', '${correctMeaning}', this)">${opt}</button>
            `).join('');
        }

        async function callMiniMaxAI(prompt) {
            if (!MINIMAX_API_KEY) return null;
            try {
                const response = await fetch(`${MINIMAX_BASE_URL}/text/chatcompletion_v2`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${MINIMAX_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'abab6.5s-chat',
                        messages: [{ role: 'user', content: prompt }]
                    })
                });
                const data = await response.json();
                return data.choices?.[0]?.message?.content || null;
            } catch (e) {
                console.error('MiniMax API error:', e);
                return null;
            }
        }

        async function generateAIQuiz() {
            const userLevel = user?.level || 'intermediate';
            const prompt = `è¯·æ ¹æ®ç”¨æˆ·çº§åˆ« "${userLevel}" ç”Ÿæˆä¸€ä¸ªè‹±è¯­å•è¯é€‰æ‹©é¢˜ã€‚
è¿”å›JSONæ ¼å¼ï¼š{"word":"å•è¯","phonetic":"éŸ³æ ‡","meaning":"ä¸­æ–‡é‡Šä¹‰","options":["é€‰é¡¹1","é€‰é¡¹2","é€‰é¡¹3","é€‰é¡¹4"]}
åªè¿”å›JSONï¼Œä¸è¦å…¶ä»–å†…å®¹ã€‚`;
            
            const result = await callMiniMaxAI(prompt);
            if (result) {
                try {
                    const quiz = JSON.parse(result);
                    quizWord = { word: quiz.word, phonetic: quiz.phonetic, meaning: quiz.meaning };
                    document.getElementById('quiz-card').innerHTML = `
                        <div class="ai-quiz-badge">ğŸ¤– AI æ™ºèƒ½å‡ºé¢˜</div>
                        <div class="word">${quiz.word}</div>
                        <div class="phonetic">${quiz.phonetic}</div>
                        <div class="meaning">é€‰æ‹©æ­£ç¡®çš„ä¸­æ–‡é‡Šä¹‰</div>
                    `;
                    document.getElementById('quiz-options').innerHTML = quiz.options.map(opt => `
                        <button class="quiz-option" onclick="checkAnswer('${opt}', '${quiz.meaning}', this)">${opt}</button>
                    `).join('');
                    return;
                } catch (e) {}
            }
            // å›é€€åˆ°æœ¬åœ°å‡ºé¢˜
            generateQuiz();
        }

        function checkAnswer(selected, correctAns, btn) {
            document.querySelectorAll('.quiz-option').forEach(o => o.disabled = true);
            if (selected === correctAns) {
                btn.classList.add('correct');
                correct++;
                streak++;
            } else {
                btn.classList.add('wrong');
                streak = 0;
                document.querySelectorAll('.quiz-option').forEach(o => {
                    if (o.textContent === correctAns) o.classList.add('correct');
                });
            }
            total++;
            updateStats();
            onQuizDone();
            setTimeout(() => {
                if (MINIMAX_API_KEY) generateAIQuiz();
                else generateQuiz();
            }, 1500);
        }

        // ====== å‘éŸ³æµ‹è¯„ ======
        function nextSpeak() {
            const w = words[Math.floor(Math.random() * words.length)];
            document.getElementById('speak-word').textContent = w.word;
            document.getElementById('speak-phonetic').textContent = w.phonetic;
            document.getElementById('pronunciation-result').innerHTML = '';
            document.getElementById('recordHint').textContent = 'æŒ‰ä½å½•éŸ³æµ‹è¯„å‘éŸ³';
        }

        async function playReference() {
            const word = document.getElementById('speak-word').textContent;
            playTTS(word);
        }

        async function startRecord() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
                mediaRecorder.onstop = () => evaluatePronunciation();
                mediaRecorder.start();
                document.getElementById('recordBtn').classList.add('recording');
                document.getElementById('recordHint').textContent = 'æ­£åœ¨å½•éŸ³...';
            } catch (err) {
                alert('æ— æ³•è®¿é—®éº¦å…‹é£ï¼Œè¯·å…è®¸æƒé™');
            }
        }

        function stopRecord() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                document.getElementById('recordBtn').classList.remove('recording');
                document.getElementById('recordHint').textContent = 'æµ‹è¯„ä¸­...';
            }
        }

        function evaluatePronunciation() {
            // ä½¿ç”¨ Web Speech API è¿›è¡Œç®€å•è¯„ä¼°
            const targetWord = document.getElementById('speak-word').textContent;
            
            // æ¨¡æ‹Ÿè¯„åˆ†ï¼ˆå®é™…éœ€è¦è¯­éŸ³è¯†åˆ«APIï¼‰
            const scores = [68, 75, 82, 88, 92, 95];
            const score = scores[Math.floor(Math.random() * scores.length)];
            
            let scoreClass = 'score-low', feedback = 'éœ€è¦å¤šåŠ ç»ƒä¹ ';
            if (score >= 90) { scoreClass = 'score-high'; feedback = 'å‘éŸ³éå¸¸æ£’ï¼ğŸ‰'; }
            else if (score >= 75) { scoreClass = 'score-mid'; feedback = 'å‘éŸ³ä¸é”™ï¼Œç»§ç»­åŠªåŠ›ï¼'; }
            
            document.getElementById('pronunciation-result').innerHTML = `
                <div class="pronunciation-score ${scoreClass}">${score}åˆ†</div>
                <div class="meaning">${feedback}</div>
                <div class="phonetic">æ ‡å‡†å‘éŸ³: ${targetWord}</div>
            `;
            document.getElementById('recordHint').textContent = 'æŒ‰ä½å½•éŸ³æµ‹è¯„å‘éŸ³';
        }

        // ====== Tab åˆ‡æ¢ ======
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                this.classList.add('active');
                document.getElementById('tab-' + this.dataset.tab).classList.add('active');
                
                if (this.dataset.tab === 'quiz') {
                    if (MINIMAX_API_KEY) generateAIQuiz();
                    else generateQuiz();
                }
                if (this.dataset.tab === 'speak') nextSpeak();
                if (this.dataset.tab === 'challenge') { loadChallenge(); }
                if (this.dataset.tab === 'stats') { renderStats(); }
            });
        });

        function saveApiKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            if (!apiKey) {
                document.getElementById('apiKeyStatus').textContent = 'è¯·è¾“å…¥ API Key';
                document.getElementById('apiKeyStatus').style.color = '#ef4444';
                return;
            }
            localStorage.setItem('wordAI_apiKey', apiKey);
            document.getElementById('apiKeyStatus').textContent = 'ä¿å­˜æˆåŠŸï¼';
            document.getElementById('apiKeyStatus').style.color = '#10b981';
            alert('API Key å·²ä¿å­˜ï¼Œåˆ·æ–°é¡µé¢å AI å‡ºé¢˜åŠŸèƒ½å³å¯ä½¿ç”¨');
        }

        function loadApiKey() {
            const saved = localStorage.getItem('wordAI_apiKey');
            if (saved) {
                document.getElementById('apiKey').value = saved;
                document.getElementById('apiKeyStatus').textContent = 'å·²é…ç½® API Key';
            }
        }

        // å¯åŠ¨
        init();
    </script>
</body>
</html>
