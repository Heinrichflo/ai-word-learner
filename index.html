<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#667eea">
    <meta name="description" content="AIèƒŒå•è¯ - æ™ºèƒ½å­¦ä¹ åŠ©æ‰‹ï¼Œè®©èƒŒå•è¯å˜å¾—æœ‰è¶£é«˜æ•ˆ">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="AIèƒŒå•è¯">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“š</text></svg>">
    <title>AI èƒŒå•è¯ - æ™ºèƒ½å­¦ä¹ åŠ©æ‰‹</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 420px;
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        .header h1 { font-size: 22px; margin-bottom: 5px; }
        .user-info {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 12px;
            background: rgba(255,255,255,0.2);
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
        }
        
        /* ç™»å½•/æ³¨å†Œå¼¹çª— */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 320px;
        }
        .modal-title { font-size: 18px; margin-bottom: 20px; text-align: center; }
        .input-group { margin-bottom: 15px; }
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 14px;
        }
        .modal-btns { display: flex; gap: 10px; }
        .modal-btns .btn { flex: 1; }

        .tabs { display: flex; border-bottom: 1px solid #eee; }
        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            font-size: 13px;
            color: #666;
            transition: all 0.3s;
        }
        .tab.active { color: #667eea; border-bottom: 2px solid #667eea; font-weight: 500; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .card { padding: 25px; text-align: center; min-height: 160px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .word { font-size: 30px; font-weight: bold; color: #333; margin-bottom: 8px; }
        .phonetic { font-size: 15px; color: #666; margin-bottom: 12px; }
        .meaning { font-size: 14px; color: #555; line-height: 1.5; }
        
        .tts-btn {
            background: #f0f0f0;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 18px;
            cursor: pointer;
            margin-bottom: 12px;
            transition: all 0.3s;
        }
        .tts-btn:hover { background: #e0e0e0; transform: scale(1.1); }
        
        .btn-group { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; padding: 15px 20px; border-top: 1px solid #eee; }
        .btn { padding: 10px 16px; border: none; border-radius: 20px; font-size: 13px; cursor: pointer; transition: all 0.3s; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-success { background: #10b981; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-warning { background: #f59e0b; color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        
        .stats { display: flex; justify-content: space-around; padding: 12px; background: #f9f9f9; border-top: 1px solid #eee; }
        .stat-item { text-align: center; }
        .stat-value { font-size: 18px; font-weight: bold; color: #667eea; }
        .stat-label { font-size: 10px; color: #666; }

        /* AI å‡ºé¢˜ */
        .quiz-options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; padding: 10px 20px 20px; }
        .quiz-option { padding: 12px; border: 2px solid #eee; border-radius: 12px; background: white; cursor: pointer; font-size: 13px; transition: all 0.3s; }
        .quiz-option:hover { border-color: #667eea; background: #f5f7ff; }
        .quiz-option.correct { border-color: #10b981; background: #d1fae5; }
        .quiz-option.wrong { border-color: #ef4444; background: #fee2e2; }
        .ai-quiz-badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            margin-bottom: 10px;
        }

        /* å‘éŸ³æµ‹è¯„ */
        .record-btn { width: 70px; height: 70px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); border: none; color: white; font-size: 22px; cursor: pointer; margin: 15px; transition: all 0.3s; }
        .record-btn.recording { animation: pulse 1s infinite; background: #ef4444; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        .record-hint { font-size: 13px; color: #666; margin-top: 10px; }
        .pronunciation-score { font-size: 42px; font-weight: bold; margin: 8px 0; }
        .score-high { color: #10b981; }
        .score-mid { color: #f59e0b; }
        .score-low { color: #ef4444; }

        /* AI åŠ©æ‰‹ */
        .ai-chat { padding: 12px; max-height: 180px; overflow-y: auto; }
        .ai-message { background: #f0f0ff; padding: 10px; border-radius: 12px; margin-bottom: 8px; font-size: 13px; line-height: 1.5; }
        .user-message { background: #e0f2fe; padding: 10px; border-radius: 12px; margin-bottom: 8px; font-size: 13px; text-align: right; }
        
        /* å­¦ä¹ è®°å½• */
        .history-list { max-height: 200px; overflow-y: auto; padding: 10px; }
        .history-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; font-size: 13px; }
        .history-item:last-child { border-bottom: none; }
        .history-date { color: #666; }
        .history-count { font-weight: 500; }

        /* è®¾ç½®é¡µ */
        .settings { padding: 15px; }
        .setting-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #eee; }
        .setting-label { font-size: 14px; }
        .setting-btn { padding: 8px 16px; border-radius: 15px; border: none; font-size: 12px; cursor: pointer; }
        
        .loading { color: #666; font-size: 14px; }
        .empty-state { text-align: center; padding: 30px; color: #666; }
        
        /* æ¯æ—¥æŒ‘æˆ˜ */
        .challenge-header { text-align: center; padding: 20px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .challenge-title { font-size: 20px; font-weight: bold; margin-bottom: 5px; }
        .challenge-date { font-size: 12px; opacity: 0.8; }
        .challenge-progress { padding: 20px; text-align: center; }
        .challenge-progress-text { font-size: 16px; margin-bottom: 10px; font-weight: 500; }
        .challenge-progress-bar { height: 12px; background: #eee; border-radius: 6px; overflow: hidden; }
        .challenge-progress-fill { height: 100%; background: linear-gradient(90deg, #52C41A, #73D13D); border-radius: 6px; transition: width 0.3s; width: 0%; }
        .challenge-status { text-align: center; padding: 15px; margin: 0 20px; background: #f9f9f9; border-radius: 12px; }
        .challenge-status-icon { font-size: 32px; margin-bottom: 8px; }
        .challenge-status-text { font-size: 14px; color: #666; }
        .challenge-status.completed { background: #f6ffed; }
        .challenge-status.completed .challenge-status-icon { animation: bounce 0.5s; }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        
        /* å¾½ç« å¢™ */
        .badges-section { padding: 20px; }
        .badges-title { font-size: 14px; font-weight: 600; margin-bottom: 15px; }
        .badges-grid { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
        .badge-item { width: 60px; height: 70px; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .badge-icon { width: 48px; height: 48px; border-radius: 50%; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 24px; filter: grayscale(1); opacity: 0.5; transition: all 0.3s; }
        .badge-item.unlocked .badge-icon { filter: grayscale(0); opacity: 1; background: linear-gradient(135deg, #FFD700, #FFA500); box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4); }
        .badge-name { font-size: 10px; color: #999; text-align: center; }
        .badge-item.unlocked .badge-name { color: #333; }
        
        /* ä»Šæ—¥ä»»åŠ¡ */
        .today-tasks { padding: 0 20px 20px; }
        .tasks-title { font-size: 14px; font-weight: 600; margin-bottom: 12px; }
        .task-item { display: flex; align-items: center; gap: 10px; padding: 12px; background: white; border-radius: 10px; margin-bottom: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .task-icon { font-size: 18px; }
        .task-name { flex: 1; font-size: 13px; }
        .task-status { font-size: 12px; color: #999; }
        .task-item.completed .task-status { color: #52C41A; font-weight: 500; }
        
        /* ä¸»é¢˜åˆ‡æ¢ */
        :root { --bg: #F5F7FA; --card-bg: #FFFFFF; --text: #333; --text-secondary: #666; --border: #eee; }
        body.dark-theme { background: #1a1a2e; }
        body.dark-theme .container { background: #16213e; }
        body.dark-theme :root { --bg: #1a1a2e; --card-bg: #16213e; --text: #eee; --text-secondary: #aaa; --border: #333; }
        body.dark-theme .card, body.dark-theme .stats-card, body.dark-theme .scene-card { background: #1f2937; }
        body.dark-theme .word, body.dark-theme .meaning { color: #eee; }
        body.dark-theme .tab, body.dark-theme .collection-tabs { background: #1f2937; border-color: #333; }
        body.dark-theme .tab-item { color: #aaa; }
        body.dark-theme .header { background: linear-gradient(135deg, #1f2937, #374151); }
        .theme-toggle { position: absolute; top: 15px; left: 15px; cursor: pointer; font-size: 18px; }
        
        /* ä¸ªäººä¸­å¿ƒ */
        .profile-header { text-align: center; padding: 30px 20px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .profile-avatar { width: 80px; height: 80px; border-radius: 50%; background: white; margin: 0 auto 12px; display: flex; align-items: center; justify-content: center; font-size: 36px; }
        .profile-name { font-size: 18px; font-weight: 600; margin-bottom: 4px; }
        .profile-level { font-size: 12px; opacity: 0.8; }
        .profile-stats { display: flex; justify-content: space-around; padding: 20px; background: white; }
        .profile-stat { text-align: center; }
        .profile-stat-value { font-size: 20px; font-weight: bold; color: #667eea; }
        .profile-stat-label { font-size: 11px; color: #999; }
        
        /* å­¦ä¹ æŠ¥å‘Š */
        .report-card { background: white; border-radius: 12px; padding: 16px; margin-bottom: 12px; }
        .report-title { font-size: 14px; font-weight: 600; margin-bottom: 12px; }
        
        /* åˆ†äº« */
        .share-buttons { display: flex; gap: 12px; justify-content: center; padding: 20px; }
        .share-btn { padding: 12px 20px; border: none; border-radius: 20px; font-size: 14px; cursor: pointer; }
        .share-wechat { background: #07C160; color: white; }
        
        /* è¯­è¨€åˆ‡æ¢ */
        .lang-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 16px; }
        .lang-card { background: white; border-radius: 12px; padding: 16px; text-align: center; cursor: pointer; border: 2px solid transparent; }
        .lang-card.active { border-color: #667eea; background: #f0f7ff; }
        .lang-flag { font-size: 32px; margin-bottom: 8px; }
        
        /* é¦–é¡µä¼˜åŒ– */
        .home-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; padding: 12px; }
        .home-card { background: white; border-radius: 12px; padding: 12px; text-align: center; cursor: pointer; }
        
        /* å­¦ä¹ å°ç»„ */
        .group-header { text-align: center; padding: 20px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .ranking-list { padding: 16px; }
        .ranking-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: white; border-radius: 10px; margin-bottom: 8px; }
        .ranking-num { font-size: 18px; font-weight: bold; width: 30px; color: #667eea; }
        
        /* å­¦ä¹ åœ°å›¾ */
        .map-container { padding: 16px; }
        .map-node { width: 50px; height: 50px; border-radius: 50%; background: #ddd; display: flex; align-items: center; justify-content: center; font-size: 24px; margin: 10px auto; }
        .map-node.unlocked { background: linear-gradient(135deg, #52C41A, #73D13D); }
        .map-node.current { background: linear-gradient(135deg, #667eea, #764ba2); animation: pulse 1s infinite; }
        
        /* PKå¯¹æˆ˜ */
        .pk-arena { text-align: center; padding: 20px; }
        .pk-vs { font-size: 32px; font-weight: bold; margin: 20px 0; }
        .pk-player { display: flex; align-items: center; justify-content: center; gap: 20px; }
        .pk-avatar { width: 60px; height: 60px; border-radius: 50%; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 28px; }
        .pk-score { font-size: 36px; font-weight: bold; }
        
        /* ç»Ÿè®¡å›¾è¡¨å¢å¼º */
        .chart-wrapper { background: white; border-radius: 12px; padding: 16px; margin-bottom: 12px; }
        .chart-bar { display: flex; align-items: flex-end; height: 100px; gap: 4px; }
        .chart-bar-item { flex: 1; background: linear-gradient(180deg, #667eea, #764ba2); border-radius: 4px 4px 0 0; min-height: 4px; }
        
        /* æ”¶è—å’Œé”™é¢˜æœ¬ */
        .collection-header { display: flex; justify-content: space-between; padding: 12px 16px; background: white; border-bottom: 1px solid #eee; }
        .collection-tabs { display: flex; gap: 8px; padding: 12px; background: white; }
        .collection-tab { flex: 1; padding: 8px; text-align: center; border-radius: 8px; font-size: 13px; cursor: pointer; background: #f5f5f5; }
        .collection-tab.active { background: #667eea; color: white; }
        .word-card { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: white; border-bottom: 1px solid #f0f0f0; }
        .word-card-word { font-weight: 500; font-size: 14px; }
        .word-card-meaning { font-size: 12px; color: #999; }
        .word-card-actions { display: flex; gap: 8px; }
        .word-card-btn { padding: 4px 8px; border: none; border-radius: 4px; font-size: 12px; cursor: pointer; }
        .btn-remove { background: #fff1f0; color: #ff4d4f; }
        .btn-review { background: #e6f7ff; color: #1890ff; }
        
        /* æé†’è®¾ç½® */
        .reminder-settings { padding: 16px; }
        .reminder-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f0f0f0; }
        .reminder-label { font-size: 14px; }
        .reminder-toggle { width: 44px; height: 24px; border-radius: 12px; background: #ccc; position: relative; cursor: pointer; }
        .reminder-toggle.active { background: #667eea; }
        .reminder-toggle::after { content: ''; position: absolute; width: 20px; height: 20px; background: white; border-radius: 50%; top: 2px; left: 2px; transition: 0.3s; }
        .reminder-toggle.active::after { left: 22px; }
        
        /* ç»Ÿè®¡å›¾è¡¨ */
        .stats-container { padding: 20px; }
        .stats-card { background: white; border-radius: 12px; padding: 16px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .stats-title { font-size: 14px; font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .stats-item { text-align: center; padding: 12px; background: #f9f9f9; border-radius: 8px; }
        .stats-value { font-size: 24px; font-weight: bold; color: #667eea; }
        .stats-value.green { color: #52C41A; }
        .stats-value.orange { color: #FAAD14; }
        .stats-value.red { color: #FF4D4F; }
        .stats-label { font-size: 11px; color: #999; margin-top: 4px; }
        
        /* è®°å¿†æ›²çº¿å›¾è¡¨ */
        .memory-chart { height: 150px; display: flex; align-items: flex-end; justify-content: space-between; padding: 10px; gap: 4px; }
        .learning-calendar { padding: 10px; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; margin-top: 10px; }
        .calendar-day { aspect-ratio: 1; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 10px; color: #999; }
        .calendar-day.learned { background: #667eea; color: white; }
        .calendar-day.today { border: 2px solid #667eea; }
        .calendar-header { display: flex; justify-content: space-between; font-size: 12px; color: #666; margin-bottom: 5px; }
        .calendar-legend { display: flex; gap: 10px; font-size: 10px; margin-top: 8px; }
        .legend-item { display: flex; align-items: center; gap: 4px; }
        .legend-dot { width: 10px; height: 10px; border-radius: 2px; }
        .memory-bar { flex: 1; background: linear-gradient(180deg, #667eea, #764ba2); border-radius: 4px 4px 0 0; min-height: 4px; transition: height 0.3s; position: relative; }
        .memory-bar::after { content: attr(data-day); position: absolute; bottom: -20px; left: 50%; transform: translateX(-50%); font-size: 9px; color: #999; }
        .memory-bar:hover { opacity: 0.8; }
        
        /* æˆå°±ç³»ç»Ÿ */
        .achievement-list { display: flex; flex-direction: column; gap: 10px; }
        .achievement-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: white; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .achievement-icon { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; background: #f0f0f0; }
        .achievement-item.unlocked .achievement-icon { background: linear-gradient(135deg, #FFD700, #FFA500); }
        .achievement-info { flex: 1; }
        .achievement-name { font-size: 13px; font-weight: 500; }
        .achievement-desc { font-size: 11px; color: #999; }
        .achievement-status { font-size: 11px; padding: 4px 8px; border-radius: 10px; background: #f0f0f0; color: #999; }
        .achievement-item.unlocked .achievement-status { background: #f6ffed; color: #52C41A; }
        
        /* å­¦ä¹ è¿›åº¦ç¯ */
        .progress-ring { width: 120px; height: 120px; margin: 20px auto; position: relative; }
        .progress-ring svg { transform: rotate(-90deg); }
        .progress-ring circle { fill: none; stroke-width: 8; }
        .progress-ring .bg { stroke: #eee; }
        .progress-ring .progress { stroke: #667eea; stroke-linecap: round; transition: stroke-dashoffset 0.5s; }
        .progress-ring-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }
        .progress-ring-value { font-size: 24px; font-weight: bold; }
        .progress-ring-label { font-size: 10px; color: #999; }
        
        /* åœºæ™¯å­¦ä¹  */
        .scene-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 16px; }
        .scene-card { background: white; border-radius: 12px; padding: 16px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); cursor: pointer; transition: all 0.3s; }
        .scene-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .scene-card.active { border: 2px solid #667eea; }
        .scene-icon { font-size: 32px; margin-bottom: 8px; }
        .scene-name { font-size: 14px; font-weight: 500; }
        .scene-count { font-size: 11px; color: #999; margin-top: 4px; }
        
        /* AIå£è¯­é™ªç»ƒ */
        .dialogue-container { display: flex; flex-direction: column; height: 350px; }
        .dialogue-messages { flex: 1; overflow-y: auto; padding: 16px; }
        .dialogue-msg { margin-bottom: 12px; max-width: 80%; }
        .dialogue-msg.ai { align-self: flex-start; }
        .dialogue-msg.user { align-self: flex-end; text-align: right; }
        .dialogue-bubble { padding: 10px 14px; border-radius: 16px; font-size: 13px; line-height: 1.5; }
        .dialogue-msg.ai .dialogue-bubble { background: #f0f0ff; border-bottom-left-radius: 4px; }
        .dialogue-msg.user .dialogue-bubble { background: #667eea; color: white; border-bottom-right-radius: 4px; }
        .dialogue-input { display: flex; gap: 8px; padding: 12px; border-top: 1px solid #eee; }
        .dialogue-input input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 20px; outline: none; }
        .dialogue-input input:focus { border-color: #667eea; }
        .dialogue-input button { padding: 10px 16px; background: #667eea; color: white; border: none; border-radius: 20px; cursor: pointer; }
        
        /* å‘éŸ³è¯„åˆ† */
        .pronunciation-score-display { text-align: center; padding: 20px; }
        .score-circle { width: 100px; height: 100px; border-radius: 50%; margin: 0 auto 16px; display: flex; align-items: center; justify-content: center; font-size: 36px; font-weight: bold; }
        .score-high { background: linear-gradient(135deg, #52C41A, #73D13D); color: white; }
        .score-mid { background: linear-gradient(135deg, #FAAD14, #FFC53D); color: white; }
        .score-low { background: linear-gradient(135deg, #FF4D4F, #FF7875); color: white; }
        .score-label { font-size: 14px; color: #666; }
        .score-details { margin-top: 16px; font-size: 12px; color: #999; }
    </style>
</head>
<body>
    <!-- ç™»å½•å¼¹çª— -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-title" id="modalTitle">ç™»å½• / æ³¨å†Œ</div>
            <div style="text-align:center;margin-bottom:15px;">
                <div id="avatarPreview" style="font-size:48px;cursor:pointer;display:inline-block;" onclick="changeAvatar()">ğŸ˜€</div>
                <div style="font-size:11px;color:#999;margin-top:5px;">ç‚¹å‡»æ›´æ¢å¤´åƒ</div>
            </div>
            <div class="input-group">
                <input type="text" id="username" placeholder="ç”¨æˆ·å">
            </div>
            <div class="input-group">
                <select id="level" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:10px;font-size:14px;">
                    <option value="beginner">åˆå­¦è€…</option>
                    <option value="intermediate">ä¸­çº§</option>
                    <option value="advanced">é«˜çº§</option>
                </select>
            </div>
            <div class="modal-btns">
                <button class="btn btn-primary" onclick="handleLogin()">ç¡®å®š</button>
                <button class="btn" style="background:#eee" onclick="closeModal()">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</div>
            <h1>ğŸ¤– AI èƒŒå•è¯</h1>
            <p id="headerSubtitle">æ™ºèƒ½å­¦ä¹ åŠ©æ‰‹</p>
            <div class="user-info" id="userInfo" onclick="showSettings()">æœªç™»å½•</div>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="learn">èƒŒå•è¯</div>
            <div class="tab" data-tab="profile">æˆ‘çš„</div>
            <div class="tab" data-tab="map">åœ°å›¾</div>
            <div class="tab" data-tab="pk">PK</div>
            <div class="tab" data-tab="quiz">AIå‡ºé¢˜</div>
            <div class="tab" data-tab="newwords">ç”Ÿè¯</div>
            <div class="tab" data-tab="challenge">æŒ‘æˆ˜</div>
            <div class="tab" data-tab="scenes">åœºæ™¯</div>
            <div class="tab" data-tab="dialogue">å£è¯­</div>
            <div class="tab" data-tab="stats">ç»Ÿè®¡</div>
            <div class="tab" data-tab="speak">å‘éŸ³</div>
            <div class="tab" data-tab="review">å¤ä¹ </div>
            <div class="tab" data-tab="favorites">æ”¶è—</div>
            <div class="tab" data-tab="wrongbook">é”™é¢˜</div>
            <div class="tab" data-tab="reminder">æé†’</div>
            <div class="tab" data-tab="history">è®°å½•</div>
            <div class="tab" data-tab="settings">è®¾ç½®</div>
        </div>

        <!-- èƒŒå•è¯ -->
        <div class="tab-content active" id="tab-learn">
            <div id="welcomeBanner" style="background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:12px 15px;text-align:center;font-size:13px;display:none;">
                <span id="welcomeText">ğŸ‘‹ æ¬¢è¿å›æ¥ï¼</span>
            </div>
            <div id="learnProgress" style="padding:10px 15px;background:#f5f5f5;display:none;">
                <div style="display:flex;justify-content:space-between;font-size:11px;color:#666;margin-bottom:5px;">
                    <span>ğŸ“Š ä»Šæ—¥è¿›åº¦</span>
                    <span id="todayProgressText">0/10</span>
                </div>
                <div style="height:6px;background:#ddd;border-radius:3px;overflow:hidden;">
                    <div id="todayProgressBar" style="height:100%;background:linear-gradient(90deg,#667eea,#764ba2);width:0%;transition:width 0.3s;"></div>
                </div>
            </div>
            <div class="card" id="card"><div class="loading">åŠ è½½ä¸­...</div></div>
            <div class="btn-group">
                <button class="btn btn-danger" onclick="showAgain()">ä¸è®¤è¯† <span style="font-size:10px;opacity:0.7;">[1]</span></button>
                <button class="btn btn-warning" onclick="showHard()">å›°éš¾ <span style="font-size:10px;opacity:0.7;">[2]</span></button>
                <button class="btn btn-success" onclick="showKnown()">è®¤è¯† <span style="font-size:10px;opacity:0.7;">[3]</span></button>
            </div>
            <div style="padding:8px 15px;background:#f0f0f0;text-align:center;font-size:11px;color:#888;">
                âŒ¨ï¸ å¿«æ·é”®: 1ä¸è®¤è¯† 2å›°éš¾ 3è®¤è¯† ç©ºæ ¼å‘éŸ³ Tæ¢è‚¤ Nä¸‹ä¸€ä¸ª Pæ”¶è—
            </div>
            <div style="padding:10px 15px;background:#f9f9f9;border-top:1px solid #eee;">
                <div style="font-size:12px;color:#666;margin-bottom:8px;">ğŸ’¡ ä»Šæ—¥å­¦ä¹ å»ºè®®</div>
                <div id="dailyTip" style="font-size:12px;color:#999;">æ¯å¤©å­¦ä¹ 5ä¸ªæ–°å•è¯ï¼ŒåšæŒ21å¤©å½¢æˆä¹ æƒ¯ï¼</div>
            </div>
        </div>

        <!-- ä¸ªäººä¸­å¿ƒ -->
        <div class="tab-content" id="tab-profile">
            <div class="profile-header">
                <div class="profile-avatar" id="profileAvatar" onclick="openAvatarSelector()" style="cursor:pointer;">ğŸ˜€</div>
                <div class="profile-name" id="profileName">å­¦ä¹ è€…</div>
                <div class="profile-level" id="profileLevel">åˆå­¦è€… Lv.1</div>
                <div style="margin-top:8px;">
                    <div style="height:8px;background:rgba(255,255,255,0.3);border-radius:4px;overflow:hidden;width:200px;margin:0 auto;">
                        <div id="expProgressBar" style="height:100%;background:#FFD700;width:0%;border-radius:4px;transition:width 0.3s;"></div>
                    </div>
                    <div style="font-size:10px;margin-top:4px;" id="expProgressText">0 / 100 ç»éªŒå€¼</div>
                </div>
            </div>
            <div class="profile-stats">
                <div class="profile-stat">
                    <div class="profile-stat-value" id="profileTotal">0</div>
                    <div class="profile-stat-label">æ€»å­¦ä¹ </div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-value" id="profileStreak">0</div>
                    <div class="profile-stat-label">è¿ç»­å¤©æ•°</div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-value" id="profileBadges">0</div>
                    <div class="profile-stat-label">å¾½ç« </div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-value" id="profileChallengeStreak">0</div>
                    <div class="profile-stat-label">æŒ‘æˆ˜æ‰“å¡</div>
                </div>
            </div>
            <div style="padding:16px;">
                <button class="btn btn-primary" style="width:100%;" onclick="showReport()">ğŸ“Š å­¦ä¹ æŠ¥å‘Š</button>
                <button class="btn" style="width:100%;margin-top:12px;background:#07C160;color:white;" onclick="shareAchievement()">ğŸ† åˆ†äº«æˆå°±</button>
            </div>
        </div>

        <!-- å­¦ä¹ æŠ¥å‘Šå¼¹çª— -->
        <div class="modal" id="reportModal">
            <div class="modal-content" style="max-width:360px;">
                <div class="modal-title">ğŸ“Š å­¦ä¹ æŠ¥å‘Š</div>
                <div id="reportContent"></div>
                <button class="btn btn-primary" style="width:100%;margin-top:16px;" onclick="document.getElementById('reportModal').classList.remove('active')">å…³é—­</button>
            </div>
        </div>

        <!-- è¯­è¨€åˆ‡æ¢ -->
        <div class="tab-content" id="tab-lang">
            <div class="lang-grid">
                <div class="lang-card active" onclick="switchLanguage('en')">
                    <div class="lang-flag">ğŸ‡ºğŸ‡¸</div>
                    <div class="lang-name">è‹±è¯­</div>
                </div>
                <div class="lang-card" onclick="switchLanguage('ja')">
                    <div class="lang-flag">ğŸ‡¯ğŸ‡µ</div>
                    <div class="lang-name">æ—¥è¯­</div>
                </div>
                <div class="lang-card" onclick="switchLanguage('ko')">
                    <div class="lang-flag">ğŸ‡°ğŸ‡·</div>
                    <div class="lang-name">éŸ©è¯­</div>
                </div>
                <div class="lang-card" onclick="switchLanguage('fr')">
                    <div class="lang-flag">ğŸ‡«ğŸ‡·</div>
                    <div class="lang-name">æ³•è¯­</div>
                </div>
            </div>
        </div>

        <!-- å­¦ä¹ å°ç»„ -->
        <div class="tab-content" id="tab-group">
            <div class="group-header">
                <div class="group-avatar">ğŸ‘¥</div>
                <div style="font-size:16px;font-weight:600;">å­¦ä¹ å°ç»„</div>
                <div style="font-size:12px;opacity:0.8;margin-top:4px;">å’Œå¥½å‹ä¸€èµ·å­¦ä¹ </div>
            </div>
            <div style="padding:16px;">
                <button class="group-btn" style="width:100%;background:#667eea;" onclick="createGroup()">åˆ›å»ºå°ç»„</button>
                <button class="group-btn" style="width:100%;background:#fff;border:1px solid #667eea;color:#667eea;" onclick="joinGroup()">åŠ å…¥å°ç»„</button>
            </div>
            <div class="ranking-list">
                <div style="font-size:14px;font-weight:600;margin-bottom:12px;">ğŸ† å°ç»„æ’è¡Œæ¦œ</div>
                <div id="rankingList"></div>
            </div>
        </div>

        <!-- å­¦ä¹ åœ°å›¾ -->
        <div class="tab-content" id="tab-map">
            <div class="map-container">
                <div style="text-align:center;font-size:16px;font-weight:600;margin-bottom:20px;">ğŸ—ºï¸ å­¦ä¹ åœ°å›¾</div>
                <div id="mapNodes"></div>
            </div>
        </div>

        <!-- PKå¯¹æˆ˜ -->
        <div class="tab-content" id="tab-pk">
            <div class="pk-arena">
                <div style="font-size:16px;font-weight:600;">âš”ï¸ å­¦ä¹ PK</div>
                <div class="pk-player">
                    <div>
                        <div class="pk-avatar">ğŸ˜€</div>
                        <div>æˆ‘</div>
                        <div class="pk-score" id="pkMyScore">0</div>
                    </div>
                    <div class="pk-vs">VS</div>
                    <div>
                        <div class="pk-avatar">ğŸ¤–</div>
                        <div>AIå¯¹æ‰‹</div>
                        <div class="pk-score" id="pkAiScore">0</div>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="startPK()">å¼€å§‹PK</button>
                <div class="pk-result" id="pkResult"></div>
            </div>
        </div>

        <!-- ç”Ÿè¯æœ¬ -->
        <div class="tab-content" id="tab-newwords">
            <div class="collection-header">
                <span>ğŸ“ ç”Ÿè¯æœ¬</span>
                <span id="newWordsCount" style="font-size:12px;color:#999;">0 ä¸ª</span>
            </div>
            <div id="newWordsList"></div>
            <div style="padding:16px;">
                <button class="btn btn-primary" style="width:100%;" onclick="reviewNewWords()">å¤ä¹ ç”Ÿè¯</button>
            </div>
        </div>

        <!-- AI å‡ºé¢˜ -->
        <div class="tab-content" id="tab-quiz">
            <div class="card" id="quiz-card"><div class="loading">AIæ­£åœ¨å‡ºé¢˜...</div></div>
            <div class="quiz-options" id="quiz-options"></div>
        </div>

        <!-- æ¯æ—¥æŒ‘æˆ˜ -->
        <div class="tab-content" id="tab-challenge">
            <div class="challenge-header">
                <div class="challenge-title">ğŸ¯ æ¯æ—¥æŒ‘æˆ˜</div>
                <div class="challenge-date" id="challengeDate"></div>
            </div>
            <div class="challenge-progress">
                <div class="challenge-progress-text">
                    <span id="challengeProgress">0</span> / <span id="challengeGoal">10</span> å•è¯
                </div>
                <div class="challenge-progress-bar">
                    <div class="challenge-progress-fill" id="challengeProgressFill"></div>
                </div>
            </div>
            <div style="display:flex;gap:10px;padding:10px 20px;">
                <button class="btn" style="flex:1;font-size:12px;padding:8px;" onclick="showGoalSetting()">âš™ï¸ è®¾ç½®ç›®æ ‡</button>
                <button class="btn btn-primary" style="flex:1;font-size:12px;padding:8px;" onclick="shareDailyChallenge()">ğŸ“¤ åˆ†äº«æ‰“å¡</button>
            </div>
            <div style="text-align:center;padding:0 20px 10px;">
                <button class="btn" id="streakShieldBtn" style="font-size:11px;padding:6px 12px;background:#f59e0b;color:white;" onclick="useStreakShield()">ğŸ›¡ï¸ æ‰“å¡ä¿æŠ¤å¡</button>
            </div>
            <div class="challenge-status" id="challengeStatus">
                <div class="challenge-status-icon">ğŸ”¥</div>
                <div class="challenge-status-text">å­¦ä¹ ä¸­...</div>
            </div>
            <div class="badges-section">
                <div class="badges-title">ğŸ† å¾½ç« å¢™</div>
                <div class="badges-grid" id="badgesGrid"></div>
            </div>
            <div class="today-tasks">
                <div class="tasks-title">ğŸ“‹ ä»Šæ—¥ä»»åŠ¡</div>
                <div class="task-item" id="task1">
                    <span class="task-icon">ğŸ“š</span>
                    <span class="task-name">å­¦ä¹ 10ä¸ªå•è¯</span>
                    <span class="task-status" id="task1Status">0/10</span>
                </div>
                <div class="task-item" id="task2">
                    <span class="task-icon">â“</span>
                    <span class="task-name">å®Œæˆ5é“é€‰æ‹©é¢˜</span>
                    <span class="task-status" id="task2Status">0/5</span>
                </div>
                <div class="task-item" id="task3">
                    <span class="task-icon">ğŸ¯</span>
                    <span class="task-name">æ­£ç¡®ç‡è¾¾åˆ°80%</span>
                    <span class="task-status" id="task3Status">0%</span>
                </div>
            </div>
        </div>

        <!-- åœºæ™¯å­¦ä¹  -->
        <div class="tab-content" id="tab-scenes">
            <div class="scene-grid">
                <div class="scene-card active" onclick="selectScene('travel')">
                    <div class="scene-icon">âœˆï¸</div>
                    <div class="scene-name">æ—…è¡Œ</div>
                    <div class="scene-count">120 å•è¯</div>
                </div>
                <div class="scene-card" onclick="selectScene('business')">
                    <div class="scene-icon">ğŸ’¼</div>
                    <div class="scene-name">èŒåœº</div>
                    <div class="scene-count">200 å•è¯</div>
                </div>
                <div class="scene-card" onclick="selectScene('daily')">
                    <div class="scene-icon">ğŸ </div>
                    <div class="scene-name">æ—¥å¸¸</div>
                    <div class="scene-count">150 å•è¯</div>
                </div>
                <div class="scene-card" onclick="selectScene('tech')">
                    <div class="scene-icon">ğŸ’»</div>
                    <div class="scene-name">ç§‘æŠ€</div>
                    <div class="scene-count">180 å•è¯</div>
                </div>
            </div>
            <div class="card" id="scene-card">
                <div class="word" id="scene-word">travel</div>
                <div class="phonetic" id="scene-phonetic">/ËˆtrÃ¦vÉ™l/</div>
                <div class="meaning" id="scene-meaning">v. æ—…è¡Œ</div>
                <button class="btn btn-primary" style="margin-top:16px;" onclick="nextSceneWord()">ä¸‹ä¸€ä¸ª</button>
            </div>
        </div>

        <!-- AIå£è¯­é™ªç»ƒ -->
        <div class="tab-content" id="tab-dialogue">
            <div class="dialogue-container">
                <div class="dialogue-messages" id="dialogueMessages">
                    <div class="dialogue-msg ai">
                        <div class="dialogue-bubble">ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„AIå£è¯­é™ªç»ƒã€‚è®©æˆ‘ç”¨è‹±è¯­å’Œä½ å¯¹è¯å§ï¼Try to respond in English. ğŸŒŸ</div>
                    </div>
                </div>
                <div class="dialogue-input">
                    <input type="text" id="dialogueInput" placeholder="ç”¨è‹±è¯­å›å¤..." onkeypress="if(event.key==='Enter')sendDialogue()">
                    <button onclick="sendDialogue()">å‘é€</button>
                </div>
            </div>
        </div>

        <!-- ç»Ÿè®¡ -->
        <div class="tab-content" id="tab-stats">
            <div class="stats-container">
                <div class="stats-card">
                    <div class="stats-title">ğŸ“Š å­¦ä¹ æ¦‚è§ˆ</div>
                    <div class="stats-grid">
                        <div class="stats-item">
                            <div class="stats-value" id="statsTotal">0</div>
                            <div class="stats-label">æ€»å­¦ä¹ </div>
                        </div>
                        <div class="stats-item">
                            <div class="stats-value green" id="statsCorrect">0</div>
                            <div class="stats-label">æ­£ç¡®æ•°</div>
                        </div>
                        <div class="stats-item">
                            <div class="stats-value orange" id="statsStreak">0</div>
                            <div class="stats-label">è¿ç»­å¤©æ•°</div>
                        </div>
                        <div class="stats-item">
                            <div class="stats-value" id="statsAccuracy">0%</div>
                            <div class="stats-label">æ­£ç¡®ç‡</div>
                        </div>
                    </div>
                </div>
                
                <div class="stats-card">
                    <div class="stats-title">ğŸ“ˆ è¯æ±‡é‡è¯„ä¼°</div>
                    <div class="vocab-estimate" id="vocabEstimate">
                        <div class="vocab-level" id="vocabLevel">Lv.1</div>
                        <div class="vocab-desc">åˆå­¦è€…</div>
                        <div class="vocab-bar" style="height:8px;background:#eee;border-radius:4px;margin:10px 0;">
                            <div id="vocabBar" style="height:100%;background:linear-gradient(90deg,#667eea,#764ba2);width:5%;border-radius:4px;transition:width 0.3s;"></div>
                        </div>
                        <div class="vocab-next" style="font-size:11px;color:#999;">è·ç¦»ä¸‹ä¸€çº§è¿˜éœ€å­¦ä¹  <span id="vocabNeed">95</span> è¯</div>
                    </div>
                </div>
                
                <div class="stats-card">
                    <div class="stats-title">ğŸ§  è®°å¿†æ›²çº¿ï¼ˆ7å¤©ï¼‰</div>
                    <div class="memory-chart" id="memoryChart"></div>
                </div>
                
                <div class="stats-card">
                    <div class="stats-title">ğŸ“… å­¦ä¹ æ—¥å†</div>
                    <div class="learning-calendar" id="learningCalendar"></div>
                </div>
                
                <div class="stats-card">
                    <div class="stats-title">ğŸ† æˆå°±ç³»ç»Ÿ</div>
                    <div class="achievement-list" id="achievementList"></div>
                </div>
            </div>
        </div>

        <!-- å‘éŸ³æµ‹è¯„ -->
        <div class="tab-content" id="tab-speak">
            <div class="card">
                <div class="word" id="speak-word">algorithm</div>
                <div class="phonetic" id="speak-phonetic">/ËˆÃ¦lÉ¡É™rÉªÃ°É™m/</div>
                <button class="tts-btn" onclick="playReference()">ğŸ”Š</button>
                <button class="record-btn" id="recordBtn" onmousedown="startRecord()" onmouseup="stopRecord()">ğŸ¤</button>
                <div class="record-hint" id="recordHint">æŒ‰ä½å½•éŸ³æµ‹è¯„å‘éŸ³</div>
                <div id="pronunciation-result"></div>
            </div>
            <div class="btn-group"><button class="btn btn-primary" onclick="nextSpeak()">ä¸‹ä¸€ä¸ª</button></div>
        </div>

        <!-- å¤ä¹ æµ‹è¯• -->
        <div class="tab-content" id="tab-review">
            <div style="padding:20px;text-align:center;">
                <h3 style="margin-bottom:15px;">ğŸ“ å¤ä¹ æµ‹è¯•</h3>
                <p style="font-size:13px;color:#666;margin-bottom:20px;">åŸºäºè‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿ï¼Œæ™ºèƒ½å®‰æ’å¤ä¹ </p>
                <div class="stats-grid" style="margin-bottom:20px;">
                    <div class="stats-item" style="background:white;padding:15px;border-radius:12px;">
                        <div class="stats-value" id="reviewDueCount" style="font-size:28px;">0</div>
                        <div class="stats-label">å¾…å¤ä¹ </div>
                    </div>
                    <div class="stats-item" style="background:white;padding:15px;border-radius:12px;">
                        <div class="stats-value" id="reviewMasteredCount" style="font-size:28px;color:#10b981;">0</div>
                        <div class="stats-label">å·²æŒæ¡</div>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="startReview()" style="width:100%;margin-bottom:10px;" id="startReviewBtn">å¼€å§‹å¤ä¹ </button>
                <button class="btn" style="width:100%;background:#f5f5f5;" onclick="showTab('tab-newwords')">æŸ¥çœ‹ç”Ÿè¯æœ¬</button>
            </div>
            <div id="reviewCard" style="display:none;padding:20px;">
                <div class="card" id="reviewWordCard">
                    <div class="word" id="reviewWord">-</div>
                    <div class="phonetic" id="reviewPhonetic">-</div>
                </div>
                <div style="padding:20px;">
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
                        <button class="btn" style="background:#fee2e2;color:#ef4444;" onclick="rateReview(1)">ğŸ˜« å¿˜äº†</button>
                        <button class="btn" style="background:#fef3c7;color:#f59e0b;" onclick="rateReview(2)">ğŸ¤” è®°å¾—</button>
                        <button class="btn" style="background:#d1fae5;color:#10b981;" onclick="rateReview(3)">ğŸ˜Š è®°ä½</button>
                        <button class="btn" style="background:#dbeafe;color:#3b82f6;" onclick="rateReview(4)">ğŸ¯ ç²¾é€š</button>
                    </div>
                    <button class="btn" style="width:100%;margin-top:10px;background:#f5f5f5;" onclick="showTab('tab-review')">é€€å‡ºå¤ä¹ </button>
                </div>
            </div>
        </div>

        <!-- å­¦ä¹ è®°å½• -->
        <div class="tab-content" id="tab-settings">
            <div class="settings">
                <h3>API è®¾ç½®</h3>
                <p style="font-size:12px;color:#666;margin:10px 0;">è¾“å…¥ MiniMax API Key ä»¥å¯ç”¨ AI å‡ºé¢˜åŠŸèƒ½</p>
                <input type="text" id="apiKey" placeholder="sk-xxx" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:5px;margin-bottom:10px;">
                <button class="btn btn-primary" onclick="saveApiKey()" style="width:100%;">ä¿å­˜ API Key</button>
                <p id="apiKeyStatus" style="font-size:12px;margin-top:10px;color:#10b981;"></p>
                
                <h3 style="margin-top:24px;">ğŸ† æ’è¡Œæ¦œ</h3>
                <button class="btn btn-primary" onclick="showRankings()" style="width:100%;margin-bottom:12px;">ğŸ“Š æŸ¥çœ‹æ’è¡Œæ¦œ</button>
                
                <h3 style="margin-top:24px;">â• æ·»åŠ è‡ªå®šä¹‰å•è¯</h3>
                <div style="margin-top:12px;">
                    <input type="text" id="customWord" placeholder="å•è¯" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:5px;margin-bottom:8px;">
                    <input type="text" id="customPhonetic" placeholder="éŸ³æ ‡ å¦‚: /test/" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:5px;margin-bottom:8px;">
                    <input type="text" id="customMeaning" placeholder="å«ä¹‰" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:5px;margin-bottom:8px;">
                    <button class="btn btn-primary" onclick="addCustomWord()" style="width:100%;">æ·»åŠ å•è¯</button>
                    <p id="customWordStatus" style="font-size:12px;margin-top:8px;color:#10b981;"></p>
                </div>
                
                <h3 style="margin-top:24px;">ğŸ“¦ æ•°æ®ç®¡ç†</h3>
                <div style="display:flex;flex-direction:column;gap:8px;margin-top:12px;">
                    <button class="btn btn-primary" onclick="exportAllData()">ğŸ“¤ å¯¼å‡ºå…¨éƒ¨æ•°æ®</button>
                    <button class="btn" style="background:#f5f5f5;" onclick="document.getElementById('importFile').click()">ğŸ“¥ å¯¼å…¥æ•°æ®</button>
                    <input type="file" id="importFile" style="display:none;" accept=".json" onchange="importAllData(this)">
                    <button class="btn" style="background:#fff1f0;color:#ff4d4f;" onclick="clearAllData()">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
                </div>
                
                <h3 style="margin-top:24px;">ğŸ“ˆ å­¦ä¹ ç»Ÿè®¡</h3>
                <div style="margin-top:12px;padding:15px;background:#f9f9f9;border-radius:12px;">
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;font-size:12px;">
                        <div style="text-align:center;"><div style="font-weight:bold;font-size:16px;color:#667eea;" id="statTotalWords">${words.length}</div><div style="color:#999;">å•è¯æ€»æ•°</div></div>
                        <div style="text-align:center;"><div style="font-weight:bold;font-size:16px;color:#10b981;" id="statFavorites">${favorites.length}</div><div style="color:#999;">æ”¶è—æ•°</div></div>
                        <div style="text-align:center;"><div style="font-weight:bold;font-size:16px;color:#f59e0b;" id="statWrong">${wrongWords.length}</div><div style="color:#999;">é”™é¢˜æ•°</div></div>
                        <div style="text-align:center;"><div style="font-weight:bold;font-size:16px;color:#667eea;" id="statStreak">${streak}</div><div style="color:#999;">è¿ç»­å¤©æ•°</div></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ”¶è—å•è¯ -->
        <div class="tab-content" id="tab-favorites">
            <div class="collection-tabs">
                <div class="collection-tab active" onclick="switchCollectionTab('favorites')">â¤ï¸ æ”¶è—æœ¬</div>
                <div class="collection-tab" onclick="switchCollectionTab('wrong')">âŒ é”™é¢˜æœ¬</div>
            </div>
            <div style="padding:10px;">
                <input type="text" id="wordSearchInput" placeholder="ğŸ” æœç´¢å•è¯..." onkeyup="quickSearch(this.value)" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;font-size:14px;">
            </div>
            <div id="collectionList"></div>
        </div>

        <!-- é”™é¢˜æœ¬ -->
        <div class="tab-content" id="tab-wrongbook">
            <div class="collection-header">
                <span>âŒ é”™é¢˜æœ¬</span>
                <span id="wrongCount" style="font-size:12px;color:#999;">0 é¢˜</span>
            </div>
            <div id="wrongList"></div>
        </div>

        <!-- æé†’è®¾ç½® -->
        <div class="tab-content" id="tab-reminder">
            <div class="reminder-settings">
                <div class="reminder-item">
                    <span class="reminder-label">ğŸ”” å­¦ä¹ æé†’</span>
                    <div class="reminder-toggle" id="reminderToggle" onclick="toggleReminder()"></div>
                </div>
                <div class="reminder-item">
                    <span class="reminder-label">â° æé†’æ—¶é—´</span>
                    <input type="time" id="reminderTime" value="09:00" style="padding:8px;border:1px solid #ddd;border-radius:8px;">
                </div>
                <div class="reminder-item">
                    <span class="reminder-label">ğŸ”„ é‡å¤</span>
                    <select id="reminderRepeat" style="padding:8px;border:1px solid #ddd;border-radius:8px;">
                        <option value="daily">æ¯å¤©</option>
                        <option value="weekday">å·¥ä½œæ—¥</option>
                    </select>
                </div>
                <button class="btn btn-primary" style="width:100%;margin-top:20px;" onclick="saveReminder()">ä¿å­˜è®¾ç½®</button>
            </div>
        </div>

        <div class="tab-content" id="tab-history">
            <div class="history-list" id="historyList">
                <div class="empty-state">æš‚æ— å­¦ä¹ è®°å½•</div>
            </div>
        </div>

        <!-- æ’è¡Œæ¦œ -->
        <div class="tab-content" id="tab-rank">
            <div class="profile-header">
                <div class="profile-avatar">ğŸ†</div>
                <div class="profile-name">æ’è¡Œæ¦œ</div>
                <div class="profile-level">ä¸å…¨å›½å­¦ä¹ è€…æ¯”æ‹¼</div>
            </div>
            <div class="rank-tabs" style="display:flex;background:white;padding:10px;border-bottom:1px solid #eee;">
                <div class="rank-tab active" onclick="switchRankTab('total')" style="flex:1;text-align:center;padding:8px;cursor:pointer;border-radius:8px;background:#667eea;color:white;">æ€»æ¦œ</div>
                <div class="rank-tab" onclick="switchRankTab('streak')" style="flex:1;text-align:center;padding:8px;cursor:pointer;border-radius:8px;">è¿èƒœæ¦œ</div>
                <div class="rank-tab" onclick="switchRankTab('today')" style="flex:1;text-align:center;padding:8px;cursor:pointer;border-radius:8px;">ä»Šæ—¥æ¦œ</div>
            </div>
            <div id="rankList" style="padding:10px;max-height:400px;overflow-y:auto;"></div>
            <div style="padding:20px;text-align:center;">
                <p style="font-size:12px;color:#999;">ğŸ“¢ æ’è¡Œæ¦œæ•°æ®åŸºäºæœ¬åœ°å­˜å‚¨ï¼Œå­¦ä¹ æ•°æ®è¶Šå¤šæ’åè¶Šå‡†ç¡®ï¼</p>
            </div>
        </div>

        <div class="stats">
            <div class="stat-item"><div class="stat-value" id="total">0</div><div class="stat-label">å·²å­¦ä¹ </div></div>
            <div class="stat-item"><div class="stat-value" id="correct">0</div><div class="stat-label">æ­£ç¡®</div></div>
            <div class="stat-item"><div class="stat-value" id="streak">0</div><div class="stat-label">è¿ç»­</div></div>
            <div class="stat-item"><div class="stat-value" id="accuracy">0%</div><div class="stat-label">æ­£ç¡®ç‡</div></div>
        </div>
    </div>

    <script>
        // ====== é…ç½® ======
        // ç»éªŒå€¼ç³»ç»Ÿé…ç½®
        const expConfig = {
            perWord: 10, // æ¯ä¸ªå•è¯10ç»éªŒå€¼
            perQuiz: 5, // æ¯é“é¢˜5ç»éªŒå€¼
            perStreak: 20, // è¿ç»­æ‰“å¡æ¯å¤©20ç»éªŒå€¼
            levelThresholds: [0, 100, 300, 600, 1000, 1500, 2200, 3000, 4000, 5500], // å„çº§åˆ«æ‰€éœ€ç»éªŒ
            levelNames: ['åˆå­¦è€…', 'å…¥é—¨', 'è¿›é˜¶', 'ç†Ÿç»ƒ', 'ç²¾é€š', 'ä¸“å®¶', 'å¤§å¸ˆ', 'ç‹è€…', 'ä¼ å¥‡', 'ç¥è¯']
        };
        
        // ç”¨æˆ·ç»éªŒå€¼æ•°æ®
        let userExp = {
            total: 0,
            level: 1,
            todayExp: 0
        };
        
        const MINIMAX_API_KEY = localStorage.getItem('wordAI_apiKey') || ''; // å¡«å…¥ä½ çš„ MiniMax API Key
        const MINIMAX_BASE_URL = 'https://api.minimax.chat/v1';
        
        // ====== å•è¯åº“ ======
        const defaultWords = [
            // åŸºç¡€çº§
            { word: "variable", phonetic: "/ËˆveÉ™riÉ™bl/", meaning: "n. å˜é‡", level: "beginner" },
            { word: "debug", phonetic: "/diËËˆbÊŒÉ¡/", meaning: "v. è°ƒè¯•", level: "beginner" },
            { word: "network", phonetic: "/ËˆnetwÉœËrk/", meaning: "n. ç½‘ç»œ", level: "beginner" },
            { word: "server", phonetic: "/ËˆsÉœËrvÉ™r/", meaning: "n. æœåŠ¡å™¨", level: "beginner" },
            { word: "client", phonetic: "/ËˆklaÉªÉ™nt/", meaning: "n. å®¢æˆ·ç«¯", level: "beginner" },
            { word: "machine", phonetic: "/mÉ™ËˆÊƒiËn/", meaning: "n. æœºå™¨", level: "beginner" },
            { word: "data", phonetic: "/ËˆdeÉªtÉ™/", meaning: "n. æ•°æ®", level: "beginner" },
            { word: "code", phonetic: "/koÊŠd/", meaning: "n. ä»£ç ", level: "beginner" },
            { word: "bug", phonetic: "/bÊŒÉ¡/", meaning: "n. ç¼ºé™·", level: "beginner" },
            { word: "web", phonetic: "/web/", meaning: "n. ç½‘é¡µ", level: "beginner" },
            // ä¸­çº§
            { word: "database", phonetic: "/ËˆdeÉªtÉ™beÉªs/", meaning: "n. æ•°æ®åº“", level: "intermediate" },
            { word: "function", phonetic: "/ËˆfÊŒÅ‹kÊƒÉ™n/", meaning: "n. åŠŸèƒ½ï¼›å‡½æ•°", level: "intermediate" },
            { word: "interface", phonetic: "/ËˆÉªntÉ™feÉªs/", meaning: "n. ç•Œé¢ï¼›æ¥å£", level: "intermediate" },
            { word: "framework", phonetic: "/ËˆfreÉªmwÉœËk/", meaning: "n. æ¡†æ¶", level: "intermediate" },
            { word: "execute", phonetic: "/ËˆeksÉªkjuËt/", meaning: "v. æ‰§è¡Œ", level: "intermediate" },
            { word: "artificial", phonetic: "/ËŒÉ‘ËrtÉªËˆfÉªÊƒl/", meaning: "adj. äººå·¥çš„", level: "intermediate" },
            { word: "intelligence", phonetic: "/ÉªnËˆtelÉªdÊ’É™ns/", meaning: "n. æ™ºèƒ½", level: "intermediate" },
            { word: "algorithm", phonetic: "/ËˆÃ¦lÉ¡É™rÉªÃ°É™m/", meaning: "n. ç®—æ³•", level: "intermediate" },
            { word: "cloud", phonetic: "/klaÊŠd/", meaning: "n. äº‘", level: "intermediate" },
            { word: "security", phonetic: "/sÉªËˆkjÊŠrÉ™ti/", meaning: "n. å®‰å…¨", level: "intermediate" },
            // é«˜çº§
            { word: "algorithm", phonetic: "/ËˆÃ¦lÉ¡É™rÉªÃ°É™m/", meaning: "n. ç®—æ³•", level: "advanced" },
            { word: "compile", phonetic: "/kÉ™mËˆpaÉªl/", meaning: "v. ç¼–è¯‘", level: "advanced" },
            { word: "paradigm", phonetic: "/ËˆpÃ¦rÉ™daÉªm/", meaning: "n. èŒƒå¼", level: "advanced" },
            { word: "optimize", phonetic: "/ËˆÉ‘ËptÉªmaÉªz/", meaning: "v. ä¼˜åŒ–", level: "advanced" },
            { word: "concurrent", phonetic: "/kÉ™nËˆkÉœËrÉ™nt/", meaning: "adj. å¹¶å‘çš„", level: "advanced" },
            { word: "architecture", phonetic: "/ËˆÉ‘ËrkÉªtektÊƒÉ™r/", meaning: "n. æ¶æ„", level: "advanced" },
            { word: "deployment", phonetic: "/dÉªËˆplÉ”ÉªmÉ™nt/", meaning: "n. éƒ¨ç½²", level: "advanced" },
            { word: "scalability", phonetic: "/ËŒskeÉªlÉ™ËˆbÉªlÉ™ti/", meaning: "n. å¯æ‰©å±•æ€§", level: "advanced" },
            { word: "microservice", phonetic: "/ËŒmaÉªkroÊŠËˆsÉœËrvÉªs/", meaning: "n. å¾®æœåŠ¡", level: "advanced" },
            { word: "container", phonetic: "/kÉ™nËˆteÉªnÉ™r/", meaning: "n. å®¹å™¨", level: "advanced" }
        ];

        // ====== çŠ¶æ€ ======
        let words = [...defaultWords];
        let currentIndex = 0;
        let total = 0, correct = 0, streak = 0;
        let learnedWords = [];
        let user = null;
        let history = [];
        let quizWord = null;
        let mediaRecorder = null;
        let audioChunks = [];
        let studyStartTime = null; // å­¦ä¹ å¼€å§‹æ—¶é—´
        let todayStudyMinutes = 0; // ä»Šæ—¥å­¦ä¹ åˆ†é’Ÿæ•°
        
        // ====== æ¯æ—¥æŒ‘æˆ˜ç³»ç»Ÿ ======
        let challengeData = {
            date: '',
            wordsLearned: 0,
            quizzesDone: 0,
            accuracy: 0,
            completed: false,
            badges: [], // å·²è§£é”çš„å¾½ç« 
            streakDays: 0, // è¿ç»­æ‰“å¡å¤©æ•°
            lastCompleteDate: '', // ä¸Šæ¬¡å®ŒæˆæŒ‘æˆ˜çš„æ—¥æœŸ
            dailyGoal: 10 // æ¯æ—¥å­¦ä¹ ç›®æ ‡ï¼ˆå•è¯æ•°ï¼‰
        };
        
        const badges = [
            { id: 'first', name: 'åˆå­¦è€…', icon: 'ğŸŒ±', condition: 'wordsLearned >= 1' },
            { id: 'ten', name: 'å°è¯•ç‰›åˆ€', icon: 'â­', condition: 'wordsLearned >= 10' },
            { id: 'fifty', name: 'åšæŒä¸æ‡ˆ', icon: 'ğŸƒ', condition: 'wordsLearned >= 50' },
            { id: 'streak3', name: 'ä¸‰è¿èƒœ', icon: 'ğŸ”¥', condition: 'streak >= 3' },
            { id: 'streak7', name: 'å‘¨å† å†›', icon: 'ğŸ‘‘', condition: 'streak >= 7' },
            { id: 'streak30', name: 'æœˆåº¦ç‹è€…', icon: 'ğŸ…', condition: 'challengeData.streakDays >= 30' },
            { id: 'perfect', name: 'å…¨å¯¹', icon: 'ğŸ¯', condition: 'accuracy >= 100 && quizzesDone >= 5' },
            { id: 'quiz10', name: 'åˆ·é¢˜è¾¾äºº', icon: 'ğŸ“', condition: 'quizzesDone >= 10' },
            { id: 'month', name: 'æœˆåº¦æŒ‘æˆ˜', icon: 'ğŸ†', condition: 'streak >= 30' },
            { id: 'first_challenge', name: 'é¦–æ¬¡æŒ‘æˆ˜', icon: 'ğŸ–ï¸', condition: 'challengeData.completed === true' },
            { id: 'streak_7days', name: 'ä¸€å‘¨æ‰“å¡', icon: 'ğŸ“…', condition: 'challengeData.streakDays >= 7' }
        ];

        // ====== ä¸ªäººä¸­å¿ƒ ======
        function updateProfile() {
            const name = user ? user.username : 'å­¦ä¹ è€…';
            // ä½¿ç”¨ç»éªŒå€¼ç­‰çº§
            const levelName = expConfig.levelNames[userExp.level - 1] || 'ç¥è¯';
            document.getElementById('profileName').textContent = name;
            document.getElementById('profileLevel').textContent = `${levelName} Lv.${userExp.level}`;
            document.getElementById('profileTotal').textContent = total;
            document.getElementById('profileStreak').textContent = streak;
            document.getElementById('profileBadges').textContent = challengeData.badges ? challengeData.badges.length : 0;
            document.getElementById('profileChallengeStreak').textContent = challengeData.streakDays || 0;
            
            // æ›´æ–°å¤´åƒ
            if (user && user.avatar) {
                document.getElementById('profileAvatar').textContent = user.avatar;
            }
        }
        
        // ====== å­¦ä¹ æŠ¥å‘Š ======
        function showReport() {
            const report = document.getElementById('reportContent');
            const weekTotal = history.slice(-7).reduce((s, h) => s + (h.total || 0), 0);
            const weekCorrect = history.slice(-7).reduce((s, h) => s + (h.correct || 0), 0);
            const monthTotal = history.slice(-30).reduce((s, h) => s + (h.total || 0), 0);
            const monthCorrect = history.slice(-30).reduce((s, h) => s + (h.correct || 0), 0);
            const mastered = words.filter(w => w.status === 'mastered').length;
            
            report.innerHTML = `
                <div class="report-card">
                    <div class="report-title">ğŸ“… æœ¬å‘¨æ•°æ®</div>
                    <div class="report-summary">
                        <div class="report-item"><div class="report-value">${weekTotal}</div><div class="report-label">å­¦ä¹ è¯æ•°</div></div>
                        <div class="report-item"><div class="report-value">${weekTotal > 0 ? Math.round((weekCorrect/weekTotal)*100) : 0}%</div><div class="report-label">æ­£ç¡®ç‡</div></div>
                    </div>
                </div>
                <div class="report-card">
                    <div class="report-title">ğŸ“† æœ¬æœˆæ•°æ®</div>
                    <div class="report-summary">
                        <div class="report-item"><div class="report-value">${monthTotal}</div><div class="report-label">å­¦ä¹ è¯æ•°</div></div>
                        <div class="report-item"><div class="report-value">${monthTotal > 0 ? Math.round((monthCorrect/monthTotal)*100) : 0}%</div><div class="report-label">æ­£ç¡®ç‡</div></div>
                    </div>
                </div>
                <div class="report-card">
                    <div class="report-title">ğŸ¯ ç´¯è®¡æˆå°±</div>
                    <div class="report-summary">
                        <div class="report-item"><div class="report-value">${total}</div><div class="report-label">æ€»å­¦ä¹ </div></div>
                        <div class="report-item"><div class="report-value">${mastered}</div><div class="report-label">å·²æŒæ¡</div></div>
                    </div>
                </div>
            `;
            document.getElementById('reportModal').classList.add('active');
        }
        
        // ====== åˆ†äº«åŠŸèƒ½ ======
        function shareAchievement() {
            const mastered = words.filter(w => w.status === 'mastered').length;
            const text = `ğŸ‰ æˆ‘æ­£åœ¨ä½¿ç”¨ AI èƒŒå•è¯å°ç¨‹åºå­¦ä¹ ï¼\n\nğŸ“Š å½“å‰è¿›åº¦ï¼š\n- å·²å­¦ä¹  ${total} ä¸ªå•è¯\n- è¿ç»­æ‰“å¡ ${streak} å¤©\n- æŒæ¡ ${mastered} ä¸ªå•è¯\n\nğŸ¤– ä¸€èµ·ç”¨ AI å­¦ä¹ è‹±è¯­å§ï¼`;
            
            if (navigator.share) {
                navigator.share({ title: 'AIèƒŒå•è¯', text: text });
            } else {
                // å¤åˆ¶åˆ°å‰ªè´´æ¿
                navigator.clipboard.writeText(text).then(() => {
                    alert('æˆå°±å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                });
            }
        }

        // ====== å¤´åƒç³»ç»Ÿ ======
        const avatars = ['ğŸ˜€', 'ğŸ˜', 'ğŸ¤“', 'ğŸ§‘â€ğŸ’»', 'ğŸ‘¨â€ğŸ“', 'ğŸ‘©â€ğŸ“', 'ğŸ¦Š', 'ğŸ¼', 'ğŸ¨', 'ğŸ¦', 'ğŸ¯', 'ğŸ±', 'ğŸ¶', 'ğŸµ', 'ğŸ¸', 'ğŸ™', 'ğŸ¦„', 'ğŸ²', 'ğŸŒŸ', 'ğŸ’', 'ğŸ¯', 'ğŸ†', 'ğŸ–ï¸', 'ğŸŒˆ', 'â˜€ï¸', 'ğŸŒ™', 'âš¡', 'ğŸ”¥', 'ğŸ’ª', 'ğŸ‰'];
        let selectedAvatar = 'ğŸ˜€';
        
        function changeAvatar() {
            const avatarHtml = avatars.map(a => 
                `<span style="font-size:28px;cursor:pointer;margin:5px;display:inline-block;" onclick="selectAvatar('${a}')">${a}</span>`
            ).join('');
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width:300px;">
                    <div class="modal-title">é€‰æ‹©å¤´åƒ</div>
                    <div style="text-align:center;padding:10px;">${avatarHtml}</div>
                    <button class="btn btn-primary" style="width:100%;" onclick="document.querySelectorAll('.modal')[document.querySelectorAll('.modal').length-1].remove()">ç¡®å®š</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function selectAvatar(avatar) {
            selectedAvatar = avatar;
            document.getElementById('avatarPreview').textContent = avatar;
        }

        // ====== ç”¨æˆ·ç³»ç»Ÿ ======
        function init() {
            loadUser();
            loadExp();
            loadHistory();
            loadChallenge();
            loadFavorites();
            loadWrongWords();
            loadNewWords();
            loadReminder();
            loadTheme();
            loadStudyTime(); // åŠ è½½å­¦ä¹ æ—¶é•¿
            checkStreakShield(); // æ£€æŸ¥æ‰“å¡ä¿æŠ¤å¡
            updateStreakShieldUI(); // æ›´æ–°ä¿æŠ¤å¡UI
            if (!user) {
                document.getElementById('loginModal').classList.add('active');
            } else {
                updateUserInfo();
            }
            showCard();
            updateStats();
            renderHistory();
            updateProfile();
            
            // åˆå§‹åŒ–é”®ç›˜å¿«æ·é”®
            initKeyboardShortcuts();
            
            // å¯åŠ¨å­¦ä¹ è®¡æ—¶
            startStudyTimer();
        }
        
        // ====== å­¦ä¹ æ—¶é•¿è¿½è¸ª ======
        function loadStudyTime() {
            const saved = localStorage.getItem('wordAI_studyTime');
            const today = new Date().toDateString();
            if (saved) {
                const data = JSON.parse(saved);
                if (data.date === today) {
                    todayStudyMinutes = data.minutes || 0;
                } else {
                    // æ–°çš„ä¸€å¤©ï¼Œé‡ç½®æ—¶é•¿
                    todayStudyMinutes = 0;
                }
            }
        }
        
        function saveStudyTime() {
            const data = {
                date: new Date().toDateString(),
                minutes: todayStudyMinutes
            };
            localStorage.setItem('wordAI_studyTime', JSON.stringify(data));
        }
        
        function startStudyTimer() {
            if (!studyStartTime) {
                studyStartTime = Date.now();
                // æ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡
                setInterval(() => {
                    if (studyStartTime) {
                        todayStudyMinutes++;
                        saveStudyTime();
                    }
                }, 60000);
            }
        }
        
        function getStudyTimeString() {
            if (todayStudyMinutes < 1) return 'åˆšåˆšå¼€å§‹';
            if (todayStudyMinutes < 60) return todayStudyMinutes + 'åˆ†é’Ÿ';
            const hours = Math.floor(todayStudyMinutes / 60);
            const mins = todayStudyMinutes % 60;
            return hours + 'å°æ—¶' + mins + 'åˆ†é’Ÿ';
        }
        
        // ====== é”®ç›˜å¿«æ·é”® ======
        function initKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // å¿«æ·é”®åªåœ¨éè¾“å…¥æ¡†æ—¶ç”Ÿæ•ˆ
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
                
                // 1/2/3 å¿«æ·è®¤è¯†/å›°éš¾/ä¸è®¤è¯†
                if (e.key === '1') showAgain();
                if (e.key === '2') showHard();
                if (e.key === '3') showKnown();
                
                // ç©ºæ ¼é”®æ’­æ”¾å‘éŸ³
                if (e.key === ' ' && words[currentIndex]) {
                    e.preventDefault();
                    playTTS(words[currentIndex].word);
                }
                
                // T åˆ‡æ¢ä¸»é¢˜
                if (e.key === 't' || e.key === 'T') toggleTheme();
                
                // N ä¸‹ä¸€ä¸ª
                if (e.key === 'n' || e.key === 'N') showNextWord();
                
                // P æ”¶è—å½“å‰å•è¯
                if (e.key === 'p' || e.key === 'P') {
                    if (words[currentIndex]) addToFavorites(words[currentIndex].word);
                }
            });
        }
        
        // ====== è§¦æ‘¸æ»‘åŠ¨åˆ‡æ¢ ======
        let touchStartX = 0;
        let touchEndX = 0;
        
        document.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        });
        
        document.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });
        
        function handleSwipe() {
            const diff = touchStartX - touchEndX;
            const threshold = 50;
            
            if (Math.abs(diff) > threshold) {
                if (diff > 0) {
                    // å·¦æ»‘ - ä¸‹ä¸€ä¸ª
                    showNextWord();
                } else {
                    // å³æ»‘ - è®¤è¯†ï¼ˆä¸Šä¸€ä¸ªï¼‰
                    if (currentIndex > 0) currentIndex--;
                    else currentIndex = words.length - 1;
                    showCard();
                }
            }
        }
        
        function showNextWord() {
            currentIndex = (currentIndex + 1) % words.length;
            showCard();
        }
        
        // ====== ä¸»é¢˜åˆ‡æ¢ ======
        function loadTheme() {
            const saved = localStorage.getItem('wordAI_theme');
            if (saved === 'dark') {
                document.body.classList.add('dark-theme');
                document.querySelector('.theme-toggle').textContent = 'â˜€ï¸';
            }
        }
        
        function toggleTheme() {
            const body = document.body;
            const toggle = document.querySelector('.theme-toggle');
            if (body.classList.contains('dark-theme')) {
                body.classList.remove('dark-theme');
                toggle.textContent = 'ğŸŒ™';
                localStorage.setItem('wordAI_theme', 'light');
            } else {
                body.classList.add('dark-theme');
                toggle.textContent = 'â˜€ï¸';
                localStorage.setItem('wordAI_theme', 'dark');
            }
        }
        
        // ====== æ”¶è—åŠŸèƒ½ ======
        let favorites = [];
        
        function loadFavorites() {
            const saved = localStorage.getItem('wordAI_favorites');
            if (saved) favorites = JSON.parse(saved);
        }
        
        function saveFavorites() {
            localStorage.setItem('wordAI_favorites', JSON.stringify(favorites));
        }
        
        function addToFavorites(word) {
            if (!favorites.find(f => f.word === word.word)) {
                favorites.push(word);
                saveFavorites();
                alert('å·²æ·»åŠ åˆ°æ”¶è—ï¼');
            }
        }
        
        function removeFavorite(word) {
            favorites = favorites.filter(f => f.word !== word);
            saveFavorites();
            renderFavorites();
        }
        
        function renderFavorites() {
            const list = document.getElementById('collectionList');
            if (favorites.length === 0) {
                list.innerHTML = '<div class="empty-state">æš‚æ— æ”¶è—å•è¯</div>';
                return;
            }
            list.innerHTML = favorites.map(w => `
                <div class="word-card">
                    <div>
                        <div class="word-card-word">${w.word}</div>
                        <div class="word-card-meaning">${w.meaning}</div>
                    </div>
                    <div class="word-card-actions">
                        <button class="word-card-btn btn-remove" onclick="removeFavorite('${w.word}')">åˆ é™¤</button>
                    </div>
                </div>
            `).join('');
        }
        
        // ====== ç”Ÿè¯æœ¬ ======
        let newWords = [];
        
        function loadNewWords() {
            const saved = localStorage.getItem('wordAI_newWords');
            if (saved) newWords = JSON.parse(saved);
        }
        
        function saveNewWords() {
            localStorage.setItem('wordAI_newWords', JSON.stringify(newWords));
        }
        
        function addToNewWords(word) {
            if (!newWords.find(w => w.word === word.word)) {
                newWords.push({...word, addTime: Date.now()});
                saveNewWords();
            }
        }
        
        function removeNewWord(word) {
            newWords = newWords.filter(w => w.word !== word);
            saveNewWords();
            renderNewWords();
        }
        
        function renderNewWords() {
            const list = document.getElementById('newWordsList');
            document.getElementById('newWordsCount').textContent = newWords.length + ' ä¸ª';
            if (newWords.length === 0) {
                list.innerHTML = '<div class="empty-state">æš‚æ— ç”Ÿè¯</div>';
                return;
            }
            list.innerHTML = newWords.map(w => `
                <div class="word-card">
                    <div>
                        <div class="word-card-word">${w.word}</div>
                        <div class="word-card-meaning">${w.meaning}</div>
                    </div>
                    <div class="word-card-actions">
                        <button class="word-card-btn btn-review" onclick="removeNewWord('${w.word}')">æŒæ¡</button>
                        <button class="word-card-btn btn-remove" onclick="removeNewWord('${w.word}')">åˆ é™¤</button>
                    </div>
                </div>
            `).join('');
        }
        
        function reviewNewWords() {
            if (newWords.length === 0) {
                alert('ç”Ÿè¯æœ¬ä¸ºç©ºï¼');
                return;
            }
            // Switch to learn tab with new words
            words = [...newWords];
            showCard();
            alert('å·²åˆ‡æ¢åˆ°ç”Ÿè¯æœ¬å¤ä¹ æ¨¡å¼ï¼');
        }
        
        function switchCollectionTab(tab) {
            document.querySelectorAll('.collection-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            if (tab === 'favorites') renderFavorites();
            else renderWrongWords();
        }
        
        // ====== é”™é¢˜æœ¬ ======
        let wrongWords = [];
        
        function loadWrongWords() {
            const saved = localStorage.getItem('wordAI_wrongWords');
            if (saved) wrongWords = JSON.parse(saved);
        }
        
        function saveWrongWords() {
            localStorage.setItem('wordAI_wrongWords', JSON.stringify(wrongWords));
        }
        
        function addToWrongBook(word) {
            if (!wrongWords.find(w => w.word === word.word)) {
                wrongWords.push({...word, wrongCount: 1});
                saveWrongWords();
            }
        }
        
        function removeWrongWord(word) {
            wrongWords = wrongWords.filter(w => w.word !== word);
            saveWrongWords();
            renderWrongWords();
        }
        
        function renderWrongWords() {
            const list = document.getElementById('wrongList');
            document.getElementById('wrongCount').textContent = wrongWords.length + ' é¢˜';
            if (wrongWords.length === 0) {
                list.innerHTML = '<div class="empty-state">æš‚æ— é”™é¢˜</div>';
                return;
            }
            list.innerHTML = wrongWords.map(w => `
                <div class="word-card">
                    <div>
                        <div class="word-card-word">${w.word}</div>
                        <div class="word-card-meaning">${w.meaning}</div>
                    </div>
                    <div class="word-card-actions">
                        <button class="word-card-btn btn-review" onclick="removeWrongWord('${w.word}')">æŒæ¡</button>
                        <button class="word-card-btn btn-remove" onclick="removeWrongWord('${w.word}')">åˆ é™¤</button>
                    </div>
                </div>
            `).join('');
        }
        
        // ====== æé†’åŠŸèƒ½ ======
        let reminderEnabled = false;
        
        function loadReminder() {
            const saved = localStorage.getItem('wordAI_reminder');
            if (saved) {
                const data = JSON.parse(saved);
                reminderEnabled = data.enabled;
                if (data.time) document.getElementById('reminderTime').value = data.time;
                if (data.repeat) document.getElementById('reminderRepeat').value = data.repeat;
            }
            document.getElementById('reminderToggle').classList.toggle('active', reminderEnabled);
        }
        
        function toggleReminder() {
            reminderEnabled = !reminderEnabled;
            document.getElementById('reminderToggle').classList.toggle('active', reminderEnabled);
        }
        
        function saveReminder() {
            const data = {
                enabled: reminderEnabled,
                time: document.getElementById('reminderTime').value,
                repeat: document.getElementById('reminderRepeat').value
            };
            localStorage.setItem('wordAI_reminder', JSON.stringify(data));
            if (reminderEnabled && 'Notification' in window) {
                Notification.requestPermission().then(perm => {
                    if (perm === 'granted') {
                        scheduleNotification(data.time);
                    }
                });
            }
            alert('æé†’è®¾ç½®å·²ä¿å­˜ï¼');
        }
        
        function scheduleNotification(time) {
            // Check every minute if it's time for notification
            setInterval(() => {
                const now = new Date();
                const [hours, minutes] = time.split(':');
                if (now.getHours() === parseInt(hours) && now.getMinutes() === parseInt(minutes)) {
                    showStudyNotification();
                }
            }, 60000);
        }
        
        function showStudyNotification() {
            if (Notification.permission === 'granted') {
                new Notification('ğŸ¤– AI èƒŒå•è¯', {
                    body: 'æ˜¯æ—¶å€™å­¦ä¹ å•¦ï¼åšæŒæ‰“å¡ï¼Œå…»æˆå¥½ä¹ æƒ¯ï½',
                    icon: 'ğŸ“š'
                });
            }
        }
        
        // ====== å¤ä¹ åˆ°æœŸæé†’ ======
        function checkDueReview() {
            const now = new Date();
            const dueWords = words.filter(w => w.nextReview && new Date(w.nextReview) <= now);
            if (dueWords.length > 0 && Notification.permission === 'granted') {
                new Notification('ğŸ“ å¤ä¹ æé†’', {
                    body: `æ‚¨æœ‰ ${dueWords.length} ä¸ªå•è¯éœ€è¦å¤ä¹ ï¼`,
                    icon: 'ğŸ””'
                });
            }
        }
        
        // ====== è‡ªå®šä¹‰å•è¯ ======
        function addCustomWord() {
            const word = document.getElementById('customWord').value.trim();
            const phonetic = document.getElementById('customPhonetic').value.trim();
            const meaning = document.getElementById('customMeaning').value.trim();
            
            if (!word || !meaning) {
                document.getElementById('customWordStatus').textContent = 'âš ï¸ è¯·è¾“å…¥å•è¯å’Œå«ä¹‰';
                return;
            }
            
            // æ·»åŠ åˆ°å•è¯åº“
            words.push({
                word: word,
                phonetic: phonetic || '/'+word+'/',
                meaning: meaning,
                level: 'beginner',
                status: 'new',
                addedAt: Date.now()
            });
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('wordAI_customWords', JSON.stringify(words));
            
            document.getElementById('customWord').value = '';
            document.getElementById('customPhonetic').value = '';
            document.getElementById('customMeaning').value = '';
            document.getElementById('customWordStatus').textContent = 'âœ… ' + word + ' æ·»åŠ æˆåŠŸï¼';
            
            // åˆ·æ–°æ˜¾ç¤º
            currentIndex = 0;
            showCard();
        }

        // ====== å•è¯æœç´¢åŠŸèƒ½ ======
        function searchWords(query) {
            if (!query || query.length < 1) return [];
            query = query.toLowerCase();
            return words.filter(w => 
                w.word.toLowerCase().includes(query) || 
                w.meaning.toLowerCase().includes(query)
            );
        }

        function showSearchResults(results, containerId) {
            const container = document.getElementById(containerId);
            if (!container || results.length === 0) {
                if (container) container.innerHTML = '<div class="empty-state">æœªæ‰¾åˆ°ç›¸å…³å•è¯</div>';
                return;
            }
            
            let html = '';
            results.slice(0, 20).forEach(w => {
                html += `
                    <div class="word-card">
                        <div>
                            <div class="word-card-word">${w.word}</div>
                            <div class="word-card-meaning">${w.phonetic} ${w.meaning}</div>
                        </div>
                        <div class="word-card-actions">
                            <button class="word-card-btn btn-review" onclick="playTTS('${w.word}')">ğŸ”Š</button>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function quickSearch(query) {
            if (!query || query.length < 1) {
                // å¦‚æœæœç´¢æ¡†ä¸ºç©ºï¼Œé‡æ–°æ¸²æŸ“æ”¶è—åˆ—è¡¨
                renderFavorites();
                return;
            }
            // æœç´¢å½“å‰tabçš„å†…å®¹
            const currentTab = document.querySelector('.collection-tab.active').textContent;
            let searchList = currentTab.includes('æ”¶è—') ? favorites : wrongWords;
            
            // åŒæ—¶æœç´¢æ‰€æœ‰å•è¯
            const wordResults = searchWords(query);
            
            if (wordResults.length > 0) {
                showSearchResults(wordResults, 'collectionList');
            }
        }

        // æ¯å¤©æ£€æŸ¥å¤ä¹ åˆ°æœŸ
        setInterval(checkDueReview, 3600000); // æ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡
        
        // ====== æ•°æ®å¯¼å‡ºå¯¼å…¥ ======
        function exportAllData() {
            const data = {
                version: 'v1.3',
                exportTime: new Date().toISOString(),
                words: words,
                favorites: favorites,
                wrongWords: wrongWords,
                history: history,
                challenge: challengeData,
                total, correct, streak,
                settings: {
                    apiKey: localStorage.getItem('wordAI_apiKey'),
                    theme: localStorage.getItem('wordAI_theme'),
                    reminder: localStorage.getItem('wordAI_reminder')
                }
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'word-ai-backup-' + new Date().toISOString().split('T')[0] + '.json';
            a.click();
            URL.revokeObjectURL(url);
            alert('æ•°æ®å¯¼å‡ºæˆåŠŸï¼');
        }
        
        function importAllData(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.words) { words = data.words; localStorage.setItem('wordAI_words', JSON.stringify(words)); }
                    if (data.favorites) { favorites = data.favorites; saveFavorites(); }
                    if (data.wrongWords) { wrongWords = data.wrongWords; saveWrongWords(); }
                    if (data.history) { history = data.history; localStorage.setItem('wordAI_history', JSON.stringify(history)); }
                    if (data.total !== undefined) { total = data.total; correct = data.correct; streak = data.streak; }
                    alert('æ•°æ®å¯¼å…¥æˆåŠŸï¼');
                    location.reload();
                } catch(err) { alert('å¯¼å…¥å¤±è´¥ï¼Œæ–‡ä»¶æ ¼å¼é”™è¯¯'); }
            };
            reader.readAsText(file);
            input.value = '';
        }
        
        function clearAllData() {
            if (confirm('ç¡®å®šæ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                if (confirm('å†æ¬¡ç¡®è®¤ï¼šæ‰€æœ‰å­¦ä¹ è®°å½•å°†è¢«åˆ é™¤ï¼')) {
                    localStorage.clear();
                    location.reload();
                }
            }
        }

        function loadUser() {
            const saved = localStorage.getItem('wordAI_user');
            if (saved) user = JSON.parse(saved);
        }

        function saveUser() {
            localStorage.setItem('wordAI_user', JSON.stringify(user));
        }
        
        // ====== ç»éªŒå€¼ç³»ç»Ÿ ======
        function loadExp() {
            const saved = localStorage.getItem('wordAI_exp');
            if (saved) {
                userExp = JSON.parse(saved);
            }
            updateExpDisplay();
        }
        
        function saveExp() {
            localStorage.setItem('wordAI_exp', JSON.stringify(userExp));
        }
        
        function addExp(amount) {
            const oldLevel = userExp.level;
            userExp.total += amount;
            userExp.todayExp += amount;
            
            // æ£€æŸ¥å‡çº§
            while (userExp.level < expConfig.levelThresholds.length && 
                   userExp.total >= expConfig.levelThresholds[userExp.level]) {
                userExp.level++;
            }
            
            saveExp();
            updateExpDisplay();
            
            // å‡çº§æç¤º
            if (userExp.level > oldLevel) {
                showLevelUp(userExp.level);
            }
        }
        
        function updateExpDisplay() {
            const currentLevelExp = expConfig.levelThresholds[userExp.level - 1] || 0;
            const nextLevelExp = expConfig.levelThresholds[userExp.level] || expConfig.levelThresholds[expConfig.levelThresholds.length - 1];
            const expInLevel = userExp.total - currentLevelExp;
            const expNeeded = nextLevelExp - currentLevelExp;
            const progress = Math.min((expInLevel / expNeeded) * 100, 100);
            
            const levelName = expConfig.levelNames[userExp.level - 1] || 'ç¥è¯';
            document.getElementById('profileLevel').textContent = `${levelName} Lv.${userExp.level}`;
            document.getElementById('expProgressBar').style.width = progress + '%';
            document.getElementById('expProgressText').textContent = `${expInLevel} / ${expNeeded} ç»éªŒå€¼ (Lv.${userExp.level} â†’ Lv.${userExp.level + 1})`;
        }
        
        function showLevelUp(newLevel) {
            const levelName = expConfig.levelNames[newLevel - 1] || 'ç¥è¯';
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="text-align:center;">
                    <div style="font-size:48px;margin-bottom:10px;">â¬†ï¸</div>
                    <div class="modal-title">ğŸ‰ å‡çº§å•¦ï¼</div>
                    <p style="color:#667eea;font-size:24px;font-weight:bold;margin:10px 0;">${levelName}</p>
                    <p style="color:#666;">å½“å‰ç­‰çº§: Lv.${newLevel}</p>
                    <p style="color:#999;font-size:12px;margin-top:15px;">ç»§ç»­å­¦ä¹ ï¼Œå†²å‡»æ›´é«˜ç­‰çº§ï¼</p>
                    <button class="btn btn-primary" style="width:100%;margin-top:20px;" onclick="this.closest('.modal').remove()">ç»§ç»­å­¦ä¹ </button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function handleLogin() {
            const username = document.getElementById('username').value.trim();
            const level = document.getElementById('level').value;
            if (!username) { alert('è¯·è¾“å…¥ç”¨æˆ·å'); return; }
            user = { username, level, avatar: selectedAvatar, created: new Date().toISOString() };
            saveUser();
            updateUserInfo();
            closeModal();
            // æ ¹æ®ç”¨æˆ·çº§åˆ«ç­›é€‰å•è¯
            filterWordsByLevel();
            // æ›´æ–°å¤´åƒæ˜¾ç¤º
            updateAvatarDisplay();
        }
        
        function updateAvatarDisplay() {
            const avatar = user?.avatar || 'ğŸ˜€';
            document.getElementById('profileAvatar').textContent = avatar;
        }
        
        function openAvatarSelector() {
            if (!user) {
                document.getElementById('loginModal').classList.add('active');
                return;
            }
            changeAvatar();
        }
        
        function selectAvatar(avatar) {
            selectedAvatar = avatar;
            document.getElementById('avatarPreview').textContent = avatar;
            // ä¿å­˜ç”¨æˆ·å¤´åƒ
            if (user) {
                user.avatar = avatar;
                saveUser();
                updateAvatarDisplay();
            }
        }

        function closeModal() {
            document.getElementById('loginModal').classList.remove('active');
        }

        function updateUserInfo() {
            document.getElementById('userInfo').textContent = user.username;
            document.getElementById('headerSubtitle').textContent = `Lv.${getLevelName(user.level)}`;
            
            // æ˜¾ç¤ºæ¬¢è¿æ¨ªå¹…
            const banner = document.getElementById('welcomeBanner');
            const welcomeText = document.getElementById('welcomeText');
            if (banner && user) {
                banner.style.display = 'block';
                const hour = new Date().getHours();
                let greeting = 'ğŸ‘‹ æ¬¢è¿å›æ¥';
                if (hour < 6) greeting = 'ğŸŒ™ å¤œæ·±äº†';
                else if (hour < 12) greeting = 'â˜€ï¸ æ—©ä¸Šå¥½';
                else if (hour < 14) greeting = 'ğŸŒ¤ï¸ ä¸­åˆå¥½';
                else if (hour < 18) greeting = 'ğŸŒ‡ ä¸‹åˆå¥½';
                else if (hour < 22) greeting = 'ğŸŒ™ æ™šä¸Šå¥½';
                welcomeText.textContent = `${greeting}ï¼Œ${user.username}ï¼ä»Šæ—¥ç›®æ ‡ï¼š${challengeData.dailyGoal || 10}ä¸ªå•è¯`;
            }
            
            // æ˜¾ç¤ºæ¯æ—¥å­¦ä¹ å»ºè®®
            showDailyTip();
        }

        function showDailyTip() {
            const tips = [
                'æ¯å¤©å­¦ä¹ 5ä¸ªæ–°å•è¯ï¼ŒåšæŒ21å¤©å½¢æˆä¹ æƒ¯ï¼',
                'å¤ä¹ æ¯”å­¦ä¹ æ–°å•è¯æ›´é‡è¦ï¼Œè®°å¾—å®šæœŸå›é¡¾ï¼',
                'å‘éŸ³ç»ƒä¹ å¯ä»¥æé«˜å¬åŠ›ç†è§£èƒ½åŠ›å“¦ï½',
                'åœºæ™¯åŒ–å­¦ä¹ èƒ½å¸®åŠ©è®°å¿†æ›´æ·±åˆ»ï¼',
                'ä½¿ç”¨è‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿ï¼Œç§‘å­¦å¤ä¹ æ›´é«˜æ•ˆï¼',
                'åšæŒæ¯å¤©å­¦ä¹ ï¼Œä¿æŒè¿ç»­æ‰“å¡è®°å½•ï¼',
                'å’ŒAIå¯¹è¯ç»ƒä¹ å£è¯­ï¼Œæå‡è¡¨è¾¾èƒ½åŠ›ï¼',
                'æŠŠç”Ÿè¯æ”¶è—èµ·æ¥ï¼Œå®šæœŸå¤ä¹ å·©å›ºï¼'
            ];
            const data = JSON.parse(localStorage.getItem('wordAI_stats') || '{"total":0}');
            let tip = tips[Math.floor(Math.random() * tips.length)];
            
            // æ ¹æ®å­¦ä¹ è¿›åº¦ç»™å‡ºä¸ªæ€§åŒ–å»ºè®®
            if (data.total === 0) {
                tip = 'å¼€å§‹ä½ çš„ç¬¬ä¸€æ¬¡å­¦ä¹ ä¹‹æ—…å§ï¼';
            } else if (data.streak >= 7) {
                tip = 'å¤ªæ£’äº†ï¼ä½ å·²ç»è¿ç»­å­¦ä¹ ' + data.streak + 'å¤©äº†ï¼';
            } else if (data.today >= (challengeData.dailyGoal || 10)) {
                tip = 'ğŸ‰ ä»Šæ—¥ç›®æ ‡å·²è¾¾æˆï¼ç»§ç»­åŠ æ²¹ï½';
            }
            
            document.getElementById('dailyTip').textContent = tip;
        }

        function getLevelName(level) {
            const names = { beginner: 'åˆå­¦', intermediate: 'ä¸­çº§', advanced: 'é«˜çº§' };
            return names[level] || 'åˆå­¦';
        }

        function filterWordsByLevel() {
            const levelMap = { beginner: 0, intermediate: 1, advanced: 2 };
            const userLevel = levelMap[user.level];
            words = defaultWords.filter(w => levelMap[w.level] <= userLevel);
            currentIndex = 0;
            showCard();
        }

        function showSettings() {
            if (!user) {
                document.getElementById('loginModal').classList.add('active');
                return;
            }
            if (confirm('åˆ‡æ¢ç”¨æˆ·ï¼Ÿ')) {
                user = null;
                localStorage.removeItem('wordAI_user');
                location.reload();
            }
        }

        // ====== æ’è¡Œæ¦œ ======
        function showRankings() {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById('tab-rank').classList.add('active');
            renderRankings('total');
        }

        function switchRankTab(type) {
            document.querySelectorAll('.rank-tab').forEach(t => {
                t.classList.remove('active');
                t.style.background = 'white';
                t.style.color = '#333';
            });
            event.target.classList.add('active');
            event.target.style.background = '#667eea';
            event.target.style.color = 'white';
            renderRankings(type);
        }

        function renderRankings(type) {
            const rankData = getRankData(type);
            const list = document.getElementById('rankList');
            if (rankData.length === 0) {
                list.innerHTML = '<div class="empty-state">æš‚æ— æ’è¡Œæ•°æ®</div>';
                return;
            }
            
            // æ‰¾åˆ°æˆ‘çš„æ’å
            const myRank = rankData.findIndex(item => item.isMe) + 1;
            
            let html = '';
            // å¦‚æœç”¨æˆ·ä¸åœ¨å‰10åï¼Œæ˜¾ç¤ºæˆ‘çš„æ’åä¿¡æ¯
            if (myRank > 10) {
                html += `<div style="text-align:center;padding:10px;background:#f0f7ff;border-radius:10px;margin-bottom:10px;">
                    <div style="font-size:12px;color:#666;">æˆ‘çš„æ’å</div>
                    <div style="font-size:24px;font-weight:bold;color:#667eea;">#${myRank}</div>
                </div>`;
            }
            
            rankData.forEach((item, index) => {
                const rankIcon = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : (index + 1);
                const isMe = item.isMe;
                html += `
                    <div style="display:flex;align-items:center;gap:12px;padding:12px;background:${isMe ? '#f0f7ff' : 'white'};border-radius:10px;margin-bottom:8px;box-shadow:0 2px 4px rgba(0,0,0,0.05);${isMe ? 'border:2px solid #667eea;' : ''}">
                        <div style="font-size:20px;width:30px;text-align:center;">${rankIcon}</div>
                        <div style="flex:1;">
                            <div style="font-weight:500;font-size:14px;">${item.username} ${isMe ? '(æˆ‘)' : ''}</div>
                            <div style="font-size:11px;color:#999;">${item.level || 'åˆå­¦'}</div>
                        </div>
                        <div style="text-align:right;">
                            <div style="font-weight:bold;color:#667eea;font-size:16px;">${item.score}</div>
                            <div style="font-size:10px;color:#999;">${type === 'total' ? 'å•è¯' : type === 'streak' ? 'å¤©' : 'ä»Šæ—¥'}</div>
                        </div>
                    </div>
                `;
            });
            list.innerHTML = html;
        }

        function getRankData(type) {
            // è·å–æ‰€æœ‰ç”¨æˆ·çš„å­¦ä¹ æ•°æ®
            const allData = [];
            
            // è·å–å½“å‰ç”¨æˆ·æ•°æ®
            const currentData = loadStats();
            if (user) {
                allData.push({
                    username: user.username,
                    score: type === 'total' ? currentData.total : type === 'streak' ? currentData.streak : currentData.today,
                    level: getLevelName(user.level),
                    isMe: true
                });
            }
            
            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½å†å²ç”¨æˆ·æ•°æ®
            const savedUsers = JSON.parse(localStorage.getItem('wordAI_rankUsers') || 'null');
            if (savedUsers) {
                savedUsers.forEach(u => {
                    allData.push({
                        username: u.username,
                        score: type === 'total' ? u.total : type === 'streak' ? u.streak : u.today,
                        level: u.level,
                        isMe: false
                    });
                });
            }
            
            // æ¨¡æ‹Ÿå…¶ä»–ç”¨æˆ·æ•°æ®ï¼ˆå®é™…é¡¹ç›®ä¸­åº”è¯¥ä»æœåŠ¡å™¨è·å–ï¼‰
            const mockUsers = [
                { username: 'Alice', total: 856, streak: 23, today: 45, level: 'é«˜çº§' },
                { username: 'Bob', total: 742, streak: 18, today: 32, level: 'ä¸­çº§' },
                { username: 'Charlie', total: 689, streak: 15, today: 28, level: 'ä¸­çº§' },
                { username: 'David', total: 521, streak: 12, today: 20, level: 'åˆçº§' },
                { username: 'Eve', total: 398, streak: 8, today: 15, level: 'åˆçº§' },
                { username: 'Frank', total: 312, streak: 6, today: 12, level: 'åˆçº§' },
                { username: 'Grace', total: 267, streak: 5, today: 10, level: 'åˆçº§' },
            ];
            
            mockUsers.forEach(u => {
                allData.push({
                    username: u.username,
                    score: type === 'total' ? u.total : type === 'streak' ? u.streak : u.today,
                    level: u.level,
                    isMe: false
                });
            });
            
            // æ’åº
            allData.sort((a, b) => b.score - a.score);
            return allData.slice(0, 10);
        }
        
        // ä¿å­˜å½“å‰ç”¨æˆ·åˆ°æ’è¡Œæ¦œ
        function saveUserToRank() {
            if (!user) return;
            const currentData = loadStats();
            const userRank = {
                username: user.username,
                total: currentData.total,
                streak: currentData.streak,
                today: currentData.today,
                level: getLevelName(user.level),
                lastUpdate: new Date().toISOString()
            };
            
            let savedUsers = JSON.parse(localStorage.getItem('wordAI_rankUsers') || '[]');
            // æ›´æ–°æˆ–æ·»åŠ å½“å‰ç”¨æˆ·
            const existingIndex = savedUsers.findIndex(u => u.username === user.username);
            if (existingIndex >= 0) {
                savedUsers[existingIndex] = userRank;
            } else {
                savedUsers.push(userRank);
            }
            // ä¿æŒæœ€å¤š20ä¸ªç”¨æˆ·
            savedUsers = savedUsers.slice(0, 20);
            localStorage.setItem('wordAI_rankUsers', JSON.stringify(savedUsers));
        }

        function loadStats() {
            const data = JSON.parse(localStorage.getItem('wordAI_stats') || '{"total":0,"correct":0,"streak":0,"lastDate":"","today":0}');
            // æ£€æŸ¥æ˜¯å¦æ˜¯åŒä¸€å¤©
            const today = new Date().toDateString();
            if (data.lastDate !== today) {
                data.today = 0;
            }
            return data;
        }

        // ====== èƒŒå•è¯ ======
        function showCard() {
            const card = document.getElementById('card');
            if (words.length === 0) {
                card.innerHTML = '<div class="meaning">ğŸ‰ æ­å–œï¼å·²å­¦å®Œæ‰€æœ‰å•è¯ï¼</div>';
                return;
            }
            const w = words[currentIndex];
            card.innerHTML = `
                <button class="tts-btn" onclick="playTTS('${w.word}', event)">ğŸ”Š</button>
                <div class="word">${w.word}</div>
                <div class="phonetic">${w.phonetic}</div>
                <div class="meaning">${w.meaning}</div>
            `;
        }

        function playTTS(word, event, lang = 'en') {
            if (event) event.stopPropagation();
            const utterance = new SpeechSynthesisUtterance(word);
            // å¤šè¯­è¨€æ”¯æŒ
            const langMap = { en: 'en-US', ja: 'ja-JP', ko: 'ko-KR', fr: 'fr-FR' };
            utterance.lang = langMap[lang] || 'en-US';
            utterance.rate = 0.8;
            utterance.pitch = 1;
            utterance.volume = 1;
            speechSynthesis.speak(utterance);
        }
        
        function playWordSound(word, phonetic) {
            // ç‚¹å‡»éŸ³æ ‡æ’­æ”¾å‘éŸ³
            const utterance = new SpeechSynthesisUtterance(word);
            utterance.lang = 'en-US';
            utterance.rate = 0.7; // æ…¢é€Ÿ
            speechSynthesis.speak(utterance);
        }

        function showKnown() { 
            showExpPopup('+10', '#10b981');
            recordAction('known'); onWordLearned(); 
        }
        function showHard() { 
            showExpPopup('+5', '#f59e0b');
            recordAction('hard'); onWordLearned(); 
        }
        function showAgain() { 
            showExpPopup('+2', '#ef4444');
            recordAction('again'); onWordLearned(); 
        }
        
        // ç»éªŒå€¼é£˜å­—æ•ˆæœ
        function showExpPopup(text, color) {
            const popup = document.createElement('div');
            popup.textContent = text;
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 32px;
                font-weight: bold;
                color: ${color};
                animation: expFloat 1s ease-out forwards;
                pointer-events: none;
                z-index: 1000;
                text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            `;
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 1000);
        }
        
        // æ·»åŠ åŠ¨ç”»æ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            @keyframes expFloat {
                0% { opacity: 1; transform: translate(-50%, -50%) scale(0.5); }
                50% { opacity: 1; transform: translate(-50%, -80%) scale(1.2); }
                100% { opacity: 0; transform: translate(-50%, -120%) scale(1); }
            }
        `;
        document.head.appendChild(style);

        function recordAction(action) {
            const w = words[currentIndex];
            let status = 'learning';
            let quality = 0;
            
            // åº”ç”¨è‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿ç®—æ³•
            if (action === 'known') {
                quality = 4; // è®°å¾—
                correct++;
                streak++;
                learnedWords.push({...w, action, time: new Date().toISOString()});
                words.splice(currentIndex, 1);
            } else if (action === 'hard') {
                quality = 2; // å›°éš¾
                streak = Math.max(0, streak - 1);
                addToWrongBook(w); // æ·»åŠ åˆ°é”™é¢˜æœ¬
                addToNewWords(w); // æ·»åŠ åˆ°ç”Ÿè¯æœ¬
                words.push(words.splice(currentIndex, 1)[0]);
            } else {
                quality = 0; // å¿˜è®°
                streak = 0;
                addToWrongBook(w); // æ·»åŠ åˆ°é”™é¢˜æœ¬
                addToNewWords(w); // æ·»åŠ åˆ°ç”Ÿè¯æœ¬
                words.push(words.splice(currentIndex, 1)[0]);
            }
            
            // è®¡ç®—ä¸‹æ¬¡å¤ä¹ æ—¶é—´ï¼ˆè‰¾å®¾æµ©æ–¯ç®—æ³•ï¼‰
            if (w) {
                const { interval, easinessFactor, repetitions } = calculateEbbinghausInterval(w, quality);
                w.interval = interval;
                w.easinessFactor = easinessFactor;
                w.repetitions = repetitions;
                w.nextReview = getNextReviewDate(interval).toISOString();
            }
            
            total++;
            
            if (words.length === 0) {
                document.getElementById('card').innerHTML = '<div class="meaning">ğŸ‰ æ­å–œï¼å·²å­¦å®Œæ‰€æœ‰å•è¯ï¼</div>';
                document.querySelector('#tab-learn .btn-group').style.display = 'none';
            } else {
                currentIndex = currentIndex % words.length;
                showCard();
            }
            
            updateStats();
            saveHistory();
            saveData();
            saveUserToRank();
        }

        function updateStats() {
            document.getElementById('total').textContent = total;
            document.getElementById('correct').textContent = correct;
            document.getElementById('streak').textContent = streak;
            const acc = total > 0 ? Math.round((correct / total) * 100) : 0;
            document.getElementById('accuracy').textContent = acc + '%';
        }

        // ====== å†å²è®°å½• ======
        function saveHistory() {
            const record = {
                date: new Date().toISOString().split('T')[0],
                total, correct, streak
            };
            const existing = history.find(h => h.date === record.date);
            if (existing) {
                Object.assign(existing, record);
            } else {
                history.unshift(record);
            }
            if (history.length > 30) history.pop();
            localStorage.setItem('wordAI_history', JSON.stringify(history));
            renderHistory();
        }

        function loadHistory() {
            const saved = localStorage.getItem('wordAI_history');
            if (saved) history = JSON.parse(saved);
        }
        
        // ====== æ¯æ—¥ç›®æ ‡è®¾ç½® ======
        function showGoalSetting() {
            const goal = prompt('è¯·è®¾ç½®æ¯æ—¥å­¦ä¹ ç›®æ ‡ï¼ˆå•è¯æ•°ï¼‰ï¼š', challengeData.dailyGoal || 10);
            if (goal && !isNaN(goal) && goal > 0) {
                challengeData.dailyGoal = parseInt(goal);
                saveChallenge();
                loadChallenge();
                alert('æ¯æ—¥ç›®æ ‡å·²è®¾ç½®ä¸º ' + goal + ' ä¸ªå•è¯ï¼');
            }
        }
        
        // ====== è¿ç»­æ‰“å¡ä¿æŠ¤å¡ ======
        let streakShieldAvailable = true;
        
        function useStreakShield() {
            if (!streakShieldAvailable) {
                alert('æœ¬å‘¨å·²ä½¿ç”¨è¿‡ä¿æŠ¤å¡ï¼');
                return;
            }
            
            if (confirm('ä½¿ç”¨è¿ç»­æ‰“å¡ä¿æŠ¤å¡ï¼Œä»Šå¤©ä¸å­¦ä¹ ä¹Ÿä¸ä¼šæ–­å¼€è¿ç»­æ‰“å¡ï¼Œæ˜¯å¦ä½¿ç”¨ï¼Ÿ')) {
                streakShieldAvailable = false;
                localStorage.setItem('wordAI_streakShield', 'false');
                
                // è®°å½•ä»Šå¤©ä½¿ç”¨äº†ä¿æŠ¤å¡
                challengeData.shieldUsedDate = new Date().toDateString();
                saveChallenge();
                
                alert('âœ… ä¿æŠ¤å¡å·²ä½¿ç”¨ï¼æ˜å¤©ç»§ç»­å­¦ä¹ å§ï½');
            }
        }
        
        function checkStreakShield() {
            const saved = localStorage.getItem('wordAI_streakShield');
            if (saved === 'false') {
                // æ¯å‘¨ä¸€é‡ç½®
                const today = new Date();
                const dayOfWeek = today.getDay();
                const lastReset = localStorage.getItem('wordAI_streakShieldReset');
                
                if (dayOfWeek === 1 && lastReset !== today.toDateString()) {
                    streakShieldAvailable = true;
                    localStorage.setItem('wordAI_streakShield', 'true');
                    localStorage.setItem('wordAI_streakShieldReset', today.toDateString());
                } else {
                    streakShieldAvailable = false;
                }
            }
        }
        
        function updateStreakShieldUI() {
            const btn = document.getElementById('streakShieldBtn');
            if (!btn) return;
            
            if (streakShieldAvailable) {
                btn.style.background = '#f59e0b';
                btn.textContent = 'ğŸ›¡ï¸ æ‰“å¡ä¿æŠ¤å¡';
                btn.disabled = false;
            } else {
                btn.style.background = '#ccc';
                btn.textContent = 'â³ ä¸‹å‘¨ä¸€å¯ç”¨';
                btn.disabled = true;
            }
        }
        
        // ====== åˆ†äº«æ‰“å¡ ======
        function shareDailyChallenge() {
            const progress = challengeData.wordsLearned || 0;
            const goal = challengeData.dailyGoal || 10;
            const streak = challengeData.streakDays || 0;
            const badges = challengeData.badges ? challengeData.badges.length : 0;
            
            let statusText = '';
            if (challengeData.completed) {
                statusText = 'âœ… ä»Šæ—¥æŒ‘æˆ˜å·²å®Œæˆï¼';
            } else if (progress >= goal) {
                statusText = 'ğŸ¯ ä»Šæ—¥ç›®æ ‡è¾¾æˆï¼';
            } else {
                statusText = `ğŸ”¥ å­¦ä¹ ä¸­ (${progress}/${goal})`;
            }
            
            const text = `ğŸ¯ AI èƒŒå•è¯ - æ¯æ—¥æ‰“å¡

ğŸ“… ${new Date().toLocaleDateString('zh-CN')}
${statusText}

ğŸ“Š ä»Šæ—¥æ•°æ®ï¼š
â€¢ å•è¯å­¦ä¹ : ${progress} / ${goal}
â€¢ è¿ç»­æ‰“å¡: ${streak} å¤©
â€¢ è·å¾—å¾½ç« : ${badges} ä¸ª

ğŸ¤– æˆ‘æ­£åœ¨ç”¨AIèƒŒå•è¯å°ç¨‹åºå­¦ä¹ è‹±è¯­ï¼Œä¸€èµ·å§ï¼

#AIèƒŒå•è¯ #è‹±è¯­å­¦ä¹  #æ¯æ—¥æ‰“å¡`;

            if (navigator.share) {
                navigator.share({ 
                    title: 'AIèƒŒå•è¯ - æ¯æ—¥æ‰“å¡', 
                    text: text 
                });
            } else {
                navigator.clipboard.writeText(text).then(() => {
                    alert('æ‰“å¡æ–‡æ¡ˆå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                }).catch(() => {
                    prompt('å¤åˆ¶ä»¥ä¸‹å†…å®¹åˆ†äº«åˆ°æœ‹å‹åœˆï¼š', text);
                });
            }
        }
        
        // ====== æ¯æ—¥æŒ‘æˆ˜ ======
        function loadChallenge() {
            const saved = localStorage.getItem('wordAI_challenge');
            const today = new Date().toDateString();
            if (saved) {
                const data = JSON.parse(saved);
                if (data.date === today) {
                    challengeData = data;
                } else {
                    // æ–°çš„ä¸€å¤©ï¼Œæ£€æŸ¥æ˜¯å¦æ˜¯æ˜¨å¤©å®Œæˆï¼ˆè¿ç»­æ‰“å¡ï¼‰
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    const yesterdayStr = yesterday.toDateString();
                    
                    // å¦‚æœæ˜¨å¤©å·²å®ŒæˆæŒ‘æˆ˜ä¸”ä»Šå¤©è¿˜æœªå®Œæˆï¼Œå¢åŠ è¿ç»­å¤©æ•°
                    if (data.lastCompleteDate === yesterdayStr) {
                        challengeData = { 
                            date: today, 
                            wordsLearned: 0, 
                            quizzesDone: 0, 
                            accuracy: 0, 
                            completed: false, 
                            badges: data.badges || [],
                            streakDays: (data.streakDays || 0) + 1,
                            lastCompleteDate: ''
                        };
                    } else {
                        // ä¸­æ–­äº†è¿ç»­æ‰“å¡ï¼Œé‡ç½®
                        challengeData = { 
                            date: today, 
                            wordsLearned: 0, 
                            quizzesDone: 0, 
                            accuracy: 0, 
                            completed: false, 
                            badges: data.badges || [],
                            streakDays: 1,
                            lastCompleteDate: ''
                        };
                    }
                }
            } else {
                challengeData.date = today;
                challengeData.streakDays = 1;
            }
            document.getElementById('challengeDate').textContent = new Date().toLocaleDateString('zh-CN', { month: 'long', day: 'numeric' });
            updateChallengeUI();
            renderBadges();
            renderStreakDays();
        }
        
        // ====== æ¸²æŸ“è¿ç»­æ‰“å¡å¤©æ•° ======
        function renderStreakDays() {
            // åœ¨æŒ‘æˆ˜é¡µé¢æ˜¾ç¤ºè¿ç»­æ‰“å¡å¤©æ•°
            const statusEl = document.getElementById('challengeStatus');
            if (statusEl && challengeData.streakDays > 0) {
                const streakHtml = `<div style="margin-top:8px;font-size:12px;color:#666;">ğŸ”¥ è¿ç»­æ‰“å¡: ${challengeData.streakDays} å¤©</div>`;
                if (!statusEl.querySelector('.streak-days')) {
                    statusEl.insertAdjacentHTML('beforeend', `<div class="streak-days">${streakHtml}</div>`);
                } else {
                    statusEl.querySelector('.streak-days').innerHTML = streakHtml;
                }
            }
        }
        
        function saveChallenge() {
            localStorage.setItem('wordAI_challenge', JSON.stringify(challengeData));
        }
        
        function updateChallengeUI() {
            const goal = challengeData.dailyGoal || 10;
            const progress = challengeData.wordsLearned;
            document.getElementById('challengeProgress').textContent = progress;
            document.getElementById('challengeGoal').textContent = goal;
            document.getElementById('challengeProgressFill').style.width = Math.min((progress / goal) * 100, 100) + '%';
            
            // æ›´æ–°ä»»åŠ¡çŠ¶æ€
            document.getElementById('task1Status').textContent = challengeData.wordsLearned + '/' + goal;
            document.getElementById('task1').classList.toggle('completed', challengeData.wordsLearned >= goal);
            
            document.getElementById('task2Status').textContent = challengeData.quizzesDone + '/5';
            document.getElementById('task2').classList.toggle('completed', challengeData.quizzesDone >= 5);
            
            document.getElementById('task3Status').textContent = challengeData.accuracy + '%';
            document.getElementById('task3').classList.toggle('completed', challengeData.accuracy >= 80);
            
            // è®¡ç®—å®Œæˆçš„ä»»åŠ¡æ•°
            const completedTasks = [challengeData.wordsLearned >= 10, challengeData.quizzesDone >= 5, challengeData.accuracy >= 80].filter(Boolean).length;
            
            // æ£€æŸ¥æŒ‘æˆ˜å®Œæˆ
            if (progress >= goal && !challengeData.completed) {
                challengeData.completed = true;
                saveChallenge();
                showChallengeComplete();
            } else if (!challengeData.completed) {
                // æ›´æ–°æŒ‘æˆ˜çŠ¶æ€æ˜¾ç¤º
                const statusEl = document.getElementById('challengeStatus');
                let statusIcon = 'ğŸ”¥';
                let statusText = `è¿›è¡Œä¸­... (${completedTasks}/3 ä»»åŠ¡å®Œæˆ)`;
                
                if (completedTasks === 3) {
                    statusIcon = 'âœ¨';
                    statusText = 'ä»»åŠ¡å…¨éƒ¨å®Œæˆï¼ç­‰å¾…æŒ‘æˆ˜å®Œæˆ...';
                } else if (progress >= goal) {
                    statusIcon = 'ğŸ¯';
                    statusText = 'å•è¯ä»»åŠ¡å·²å®Œæˆï¼';
                }
                
                if (challengeData.completed) {
                    statusEl.classList.add('completed');
                    statusEl.innerHTML = '<div class="challenge-status-icon">ğŸ‰</div><div class="challenge-status-text">æŒ‘æˆ˜å®Œæˆï¼</div>';
                } else {
                    statusEl.classList.remove('completed');
                    statusEl.innerHTML = `<div class="challenge-status-icon">${statusIcon}</div><div class="challenge-status-text">${statusText}</div>`;
                }
            }
        }
        
        function renderBadges() {
            const grid = document.getElementById('badgesGrid');
            grid.innerHTML = badges.map(b => {
                const unlocked = challengeData.badges.includes(b.id);
                return `<div class="badge-item ${unlocked ? 'unlocked' : ''}">
                    <div class="badge-icon">${b.icon}</div>
                    <div class="badge-name">${b.name}</div>
                </div>`;
            }).join('');
        }
        
        function checkBadges() {
            let updated = false;
            badges.forEach(b => {
                if (challengeData.badges.includes(b.id)) return;
                const condition = new Function('wordsLearned', 'quizzesDone', 'accuracy', 'streak', 'return ' + b.condition);
                if (condition(challengeData.wordsLearned, challengeData.quizzesDone, challengeData.accuracy, streak)) {
                    challengeData.badges.push(b.id);
                    updated = true;
                    showBadgeUnlock(b);
                }
            });
            if (updated) {
                saveChallenge();
                renderBadges();
            }
        }
        
        function showBadgeUnlock(badge) {
            // åˆ›å»ºç²¾ç¾çš„å¾½ç« è§£é”å¼¹çª—
            const modal = document.createElement('div');
            modal.id = 'badgeUnlockModal';
            modal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);display:flex;justify-content:center;align-items:center;z-index:9999;animation:fadeIn 0.3s;';
            modal.innerHTML = `
                <div style="background:white;border-radius:20px;padding:30px;text-align:center;max-width:280px;animation:bounceIn 0.5s;">
                    <div style="font-size:60px;margin-bottom:15px;">${badge.icon}</div>
                    <div style="font-size:16px;color:#667eea;font-weight:bold;margin-bottom:5px;">ğŸ‰ æ–°å¾½ç« è§£é”ï¼</div>
                    <div style="font-size:18px;font-weight:600;margin-bottom:10px;">${badge.name}</div>
                    <div style="font-size:12px;color:#999;margin-bottom:20px;">${badge.desc}</div>
                    <button onclick="document.getElementById('badgeUnlockModal').remove()" style="background:linear-gradient(135deg,#667eea,#764ba2);color:white;border:none;padding:12px 30px;border-radius:25px;font-size:14px;cursor:pointer;">å¤ªæ£’äº†ï¼</button>
                </div>
                <style>
                    @keyframes bounceIn {0%{transform:scale(0.3);opacity:0;}50%{transform:scale(1.05);}70%{transform:scale(0.9);}100%{transform:scale(1);opacity:1;}}
                    @keyframes fadeIn {from{opacity:0;}to{opacity:1;}}
                </style>
            `;
            document.body.appendChild(modal);
        }
        
        function showChallengeComplete() {
            // è®°å½•å®Œæˆæ—¥æœŸ
            challengeData.lastCompleteDate = new Date().toDateString();
            saveChallenge();
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            const streakText = challengeData.streakDays > 1 ? `<p style="color:#f59e0b;font-size:16px;margin:10px 0;">ğŸ”¥ è¿ç»­æ‰“å¡ ${challengeData.streakDays} å¤©ï¼</p>` : '';
            modal.innerHTML = `
                <div class="modal-content" style="text-align:center;">
                    <div style="font-size:48px;margin-bottom:20px;">ğŸ‰</div>
                    <div class="modal-title">æ¯æ—¥æŒ‘æˆ˜å®Œæˆï¼</div>
                    <p style="color:#666;margin-bottom:10px;">ä»Šå¤©çš„å­¦ä¹ ä»»åŠ¡å·²å®Œæˆ<br>ç»§ç»­åŠ æ²¹ï¼Œæ˜å¤©å†æ¥ï¼</p>
                    ${streakText}
                    <div style="margin:20px 0;padding:15px;background:#f9f9f9;border-radius:10px;">
                        <div style="display:flex;justify-content:space-around;">
                            <div><div style="font-size:24px;color:#667eea;font-weight:bold;">${challengeData.wordsLearned}</div><div style="font-size:11px;color:#999;">å•è¯</div></div>
                            <div><div style="font-size:24px;color:#10b981;font-weight:bold;">${challengeData.quizzesDone}</div><div style="font-size:11px;color:#999;">ä¹ é¢˜</div></div>
                            <div><div style="font-size:24px;color:#f59e0b;font-weight:bold;">${challengeData.accuracy}%</div><div style="font-size:11px;color:#999;">æ­£ç¡®ç‡</div></div>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="this.closest('.modal').remove();renderStreakDays();">ç¡®å®š</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function onWordLearned() {
            // æ›´æ–°ä»Šæ—¥å­¦ä¹ ç»Ÿè®¡
            const data = JSON.parse(localStorage.getItem('wordAI_stats') || '{"total":0,"correct":0,"streak":0,"lastDate":"","today":0}');
            const today = new Date().toDateString();
            if (data.lastDate !== today) {
                data.today = 0;
            }
            data.today++;
            data.lastDate = today;
            localStorage.setItem('wordAI_stats', JSON.stringify(data));
            
            // æ·»åŠ ç»éªŒå€¼
            addExp(expConfig.perWord);
            
            // æ›´æ–°é¦–é¡µè¿›åº¦æ¡
            updateLearnProgress();
            
            // è‡ªåŠ¨æ·»åŠ å½“å‰å•è¯åˆ°å¤ä¹ è®¡åˆ’
            if (words[currentIndex]) {
                addToReview(words[currentIndex]);
            }
            
            challengeData.wordsLearned++;
            if (challengeData.quizzesDone > 0) {
                challengeData.accuracy = Math.round((correct / total) * 100);
            }
            saveChallenge();
            updateChallengeUI();
            checkBadges();
        }

        function updateLearnProgress() {
            const data = JSON.parse(localStorage.getItem('wordAI_stats') || '{"today":0}');
            const goal = challengeData.dailyGoal || 10;
            const progress = document.getElementById('learnProgress');
            const progressText = document.getElementById('todayProgressText');
            const progressBar = document.getElementById('todayProgressBar');
            
            if (progress && progressText && progressBar) {
                progress.style.display = 'block';
                const percent = Math.min(100, (data.today / goal) * 100);
                progressText.textContent = `${data.today}/${goal}`;
                progressBar.style.width = percent + '%';
                
                // å®Œæˆåæ”¹å˜é¢œè‰²
                if (data.today >= goal) {
                    progressBar.style.background = 'linear-gradient(90deg,#52C41A,#73D13D)';
                }
            }
        }

        function addToReview(word) {
            const reviewData = JSON.parse(localStorage.getItem('wordAI_review') || '[]');
            if (!reviewData.find(r => r.word === word.word)) {
                reviewData.push({
                    word: word.word,
                    phonetic: word.phonetic,
                    meaning: word.meaning,
                    quality: 0,
                    easinessFactor: 2.5,
                    interval: 0,
                    repetitions: 0,
                    nextReview: Date.now() + 24 * 60 * 60 * 1000, // 1å¤©åå¤ä¹ 
                    lastReview: null
                });
                localStorage.setItem('wordAI_review', JSON.stringify(reviewData));
            }
        }
        
        function onQuizDone() {
            challengeData.quizzesDone++;
            if (total > 0) {
                challengeData.accuracy = Math.round((correct / total) * 100);
            }
            saveChallenge();
            updateChallengeUI();
            checkBadges();
            // æ·»åŠ ç»éªŒå€¼
            addExp(expConfig.perQuiz);
        }
        
        // ====== è‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿ç®—æ³• ======
        // åŸºäºè‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿è®¡ç®—æœ€ä½³å¤ä¹ é—´éš”
        // å…¬å¼: I(n) = I(n-1) * EF
        // EF (Easiness Factor): åˆå§‹2.5, æœ€ä½1.3
        // quality: 0-5 (0=å®Œå…¨å¿˜è®°, 5=å®Œç¾è®°ä½)
        const EBINGHAUS_INTERVALS = [1, 3, 7, 14, 30, 60]; // åŸºç¡€é—´éš”å¤©æ•°
        
        function calculateEbbinghausInterval(word, quality) {
            let { easinessFactor = 2.5, repetitions = 0, interval = 1 } = word;
            
            // æ ¹æ®è®°å¿†è´¨é‡è°ƒæ•´
            if (quality < 3) {
                // å¿˜è®°ï¼Œé‡ç½®
                repetitions = 0;
                interval = 1;
            } else {
                // è®°ä½
                if (repetitions === 0) {
                    interval = 1;
                } else if (repetitions === 1) {
                    interval = 3;
                } else {
                    interval = Math.round(interval * easinessFactor);
                }
                repetitions++;
            }
            
            // è°ƒæ•´ easinessFactor
            easinessFactor = easinessFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
            if (easinessFactor < 1.3) easinessFactor = 1.3;
            
            return { interval, easinessFactor, repetitions };
        }
        
        function getNextReviewDate(interval) {
            const nextDate = new Date();
            nextDate.setDate(nextDate.getDate() + interval);
            return nextDate;
        }
        
        // ====== ç»Ÿè®¡åŠŸèƒ½ ======
        function renderStats() {
            // åŸºæœ¬ç»Ÿè®¡
            document.getElementById('statsTotal').textContent = total;
            document.getElementById('statsCorrect').textContent = correct;
            document.getElementById('statsStreak').textContent = streak;
            const acc = total > 0 ? Math.round((correct / total) * 100) : 0;
            document.getElementById('statsAccuracy').textContent = acc + '%';
            
            // è¯æ±‡é‡è¯„ä¼°
            renderVocabEstimate();
            
            // å¢å¼ºç»Ÿè®¡
            const mastered = words.filter(w => w.status === 'mastered').length;
            const learning = words.filter(w => w.status === 'learning').length;
            const newCount = words.filter(w => w.status === 'new').length;
            const newWords = newWords ? newWords.length : 0;
            const wrongCount = wrongWords ? wrongWords.length : 0;
            
            // æ›´æ–°ä¸ªäººä¸­å¿ƒç»Ÿè®¡
            document.getElementById('profileTotal').textContent = total;
            document.getElementById('profileStreak').textContent = streak;
            const badges = challengeData.badges ? challengeData.badges.length : 0;
            document.getElementById('profileBadges').textContent = badges;
            
            // æ¸²æŸ“è®°å¿†æ›²çº¿
            renderMemoryChart();
            
            // æ¸²æŸ“å­¦ä¹ æ—¥å†
            renderLearningCalendar();
            
            // æ¸²æŸ“æˆå°±
            renderAchievements();
            
            console.log('ç»Ÿè®¡æ›´æ–°: æ€»å­¦ä¹ =' + total + ', å·²æŒæ¡=' + mastered + ', å­¦ä¹ ä¸­=' + learning + ', æ–°è¯=' + newCount);
        }
        
        // ====== å­¦ä¹ æ—¥å† ======
        function renderLearningCalendar() {
            const calendar = document.getElementById('learningCalendar');
            if (!calendar) return;
            
            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startWeekDay = firstDay.getDay();
            
            // æ„å»ºå­¦ä¹ æ•°æ®æ˜ å°„
            const learnData = {};
            history.forEach(h => {
                learnData[h.date] = h.total || 0;
            });
            
            // è·å–å½“æœˆæ•°æ®
            let monthTotal = 0;
            for (let d = 1; d <= daysInMonth; d++) {
                const date = new Date(year, month, d);
                const dateStr = date.toISOString().split('T')[0];
                if (learnData[dateStr]) monthTotal += learnData[dateStr];
            }
            
            // ç”Ÿæˆæ—¥å†HTML
            const weekDays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            let html = `<div class="calendar-header">
                <span>${year}å¹´${month + 1}æœˆ</span>
                <span>æœ¬æœˆå­¦ä¹ : ${monthTotal} è¯</span>
            </div>`;
            
            html += '<div class="calendar-grid">';
            // æ˜ŸæœŸæ ‡é¢˜
            weekDays.forEach(w => html += `<div style="text-align:center;font-size:10px;color:#999;">${w}</div>`);
            
            // å¡«å……ç©ºç™½
            for (let i = 0; i < startWeekDay; i++) {
                html += '<div class="calendar-day"></div>';
            }
            
            // æ—¥æœŸ
            const todayStr = today.toISOString().split('T')[0];
            for (let d = 1; d <= daysInMonth; d++) {
                const date = new Date(year, month, d);
                const dateStr = date.toISOString().split('T')[0];
                const learned = learnData[dateStr] || 0;
                const isToday = dateStr === todayStr;
                const isLearned = learned > 0;
                
                html += `<div class="calendar-day ${isLearned ? 'learned' : ''} ${isToday ? 'today' : ''}">${d}</div>`;
            }
            html += '</div>';
            
            html += `<div class="calendar-legend">
                <div class="legend-item"><div class="legend-dot" style="background:#ddd"></div>æœªå­¦ä¹ </div>
                <div class="legend-item"><div class="legend-dot" style="background:#667eea"></div>å·²å­¦ä¹ </div>
            </div>`;
            
            calendar.innerHTML = html;
        }
        
        // ====== è¯æ±‡é‡è¯„ä¼° ======
        function renderVocabEstimate() {
            const vocabLevels = [
                { level: 1, name: 'åˆå­¦è€…', threshold: 0 },
                { level: 2, name: 'å…¥é—¨', threshold: 50 },
                { level: 3, name: 'è¿›é˜¶', threshold: 150 },
                { level: 4, name: 'ç†Ÿç»ƒ', threshold: 300 },
                { level: 5, name: 'ç²¾é€š', threshold: 500 },
                { level: 6, name: 'ä¸“å®¶', threshold: 800 },
                { level: 7, name: 'å¤§å¸ˆ', threshold: 1200 },
                { level: 8, name: 'ç‹è€…', threshold: 1800 },
                { level: 9, name: 'ä¼ å¥‡', threshold: 2500 },
                { level: 10, name: 'ç¥è¯', threshold: 3500 }
            ];
            
            // è®¡ç®—å½“å‰çº§åˆ«å’Œè¿›åº¦
            let currentLevel = 1;
            let nextThreshold = 50;
            let progress = 0;
            
            for (let i = 0; i < vocabLevels.length; i++) {
                if (total >= vocabLevels[i].threshold) {
                    currentLevel = vocabLevels[i].level;
                    if (i < vocabLevels.length - 1) {
                        nextThreshold = vocabLevels[i + 1].threshold;
                        progress = ((total - vocabLevels[i].threshold) / (nextThreshold - vocabLevels[i].threshold)) * 100;
                    } else {
                        progress = 100;
                    }
                }
            }
            
            const currentLevelData = vocabLevels[currentLevel - 1];
            const needCount = nextThreshold - total;
            
            document.getElementById('vocabLevel').textContent = 'Lv.' + currentLevel;
            document.getElementById('vocabLevel').parentElement.querySelector('.vocab-desc').textContent = currentLevelData.name;
            document.getElementById('vocabBar').style.width = Math.min(progress, 100) + '%';
            document.getElementById('vocabNeed').textContent = Math.max(needCount, 0);
        }
        
        function renderMemoryChart() {
            const chart = document.getElementById('memoryChart');
            const days = 7;
            const data = [];
            
            // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                const historyItem = history.find(h => h.date === dateStr);
                data.push({
                    day: date.getDate(),
                    value: historyItem ? historyItem.total : Math.floor(Math.random() * 10)
                });
            }
            
            const maxVal = Math.max(...data.map(d => d.value), 1);
            chart.innerHTML = data.map(d => {
                const height = Math.max((d.value / maxVal) * 100, 5);
                return `<div class="memory-bar" style="height: ${height}%" data-day="${d.day}æ—¥"></div>`;
            }).join('');
        }
        
        // ====== æˆå°±ç³»ç»Ÿ ======
        const achievements = [
            { id: 'first_word', name: 'é¦–æ¬¡å­¦ä¹ ', desc: 'å®Œæˆç¬¬ä¸€ä¸ªå•è¯', icon: 'ğŸŒ±', condition: (d) => d.total >= 1 },
            { id: 'ten_words', name: 'å°è¯•ç‰›åˆ€', desc: 'å­¦ä¹ 10ä¸ªå•è¯', icon: 'â­', condition: (d) => d.total >= 10 },
            { id: 'fifty_words', name: 'å­¦å¯Œäº”è½¦', desc: 'å­¦ä¹ 50ä¸ªå•è¯', icon: 'ğŸ“š', condition: (d) => d.total >= 50 },
            { id: 'hundred_words', name: 'ç™¾è¯æ–©', desc: 'å­¦ä¹ 100ä¸ªå•è¯', icon: 'ğŸ’¯', condition: (d) => d.total >= 100 },
            { id: 'five_hundred', name: 'è¯æ±‡è¾¾äºº', desc: 'å­¦ä¹ 500ä¸ªå•è¯', icon: 'ğŸ“–', condition: (d) => d.total >= 500 },
            { id: 'streak_3', name: 'ä¸‰è¿èƒœ', desc: 'è¿ç»­3å¤©å­¦ä¹ ', icon: 'ğŸ”¥', condition: (d) => d.streak >= 3 },
            { id: 'streak_7', name: 'å‘¨å† å†›', desc: 'è¿ç»­7å¤©å­¦ä¹ ', icon: 'ğŸ‘‘', condition: (d) => d.streak >= 7 },
            { id: 'streak_30', name: 'æœˆå† å†›', desc: 'è¿ç»­30å¤©å­¦ä¹ ', icon: 'ğŸ…', condition: (d) => d.streak >= 30 },
            { id: 'perfect_score', name: 'æ»¡åˆ†é€šè¿‡', desc: 'æ­£ç¡®ç‡100%', icon: 'ğŸ¯', condition: (d) => d.total >= 10 && d.accuracy >= 100 },
            { id: 'speed_learner', name: 'å¿«é€Ÿå­¦ä¹ ', desc: 'ä¸€å¤©å­¦ä¹ 20è¯', icon: 'âš¡', condition: (d) => d.today >= 20 },
            { id: 'master', name: 'å•è¯å¤§å¸ˆ', desc: 'æŒæ¡100ä¸ªè¯', icon: 'ğŸ†', condition: (d) => d.mastered >= 100 },
            { id: 'collector', name: 'æ”¶è—å®¶', desc: 'æ”¶è—10ä¸ªå•è¯', icon: 'â¤ï¸', condition: (d) => d.favorites >= 10 },
            { id: 'error_corrector', name: 'é”™é¢˜æ¸…é›¶', desc: 'æŒæ¡å…¨éƒ¨é”™é¢˜', icon: 'âœ…', condition: (d) => d.wrongCount === 0 },
            { id: 'early_bird', name: 'æ—©èµ·é¸Ÿ', desc: 'æ—©æ™¨å­¦ä¹ ', icon: 'ğŸŒ…', condition: (d) => new Date().getHours() < 9 },
            { id: 'night_owl', name: 'å¤œçŒ«å­', desc: 'æ·±å¤œå­¦ä¹ ', icon: 'ğŸ¦‰', condition: (d) => new Date().getHours() >= 22 },
            { id: 'polyglot', name: 'å¤šè¯­è¨€è€…', desc: 'å­¦ä¹ 3ç§è¯­è¨€', icon: 'ğŸŒ', condition: (d) => d.languages >= 3 }
        ];
        
        function renderAchievements() {
            const list = document.getElementById('achievementList');
            const today = new Date().toISOString().split('T')[0];
            const todayHistory = history.find(h => h.date === today);
            const todayData = { total, correct, streak, accuracy: total > 0 ? Math.round((correct / total) * 100) : 0, today: todayHistory ? todayHistory.total : 0, mastered: words.filter(w => w.status === 'mastered').length };
            
            list.innerHTML = achievements.map(a => {
                const unlocked = a.condition(todayData);
                return `<div class="achievement-item ${unlocked ? 'unlocked' : ''}">
                    <div class="achievement-icon">${a.icon}</div>
                    <div class="achievement-info">
                        <div class="achievement-name">${a.name}</div>
                        <div class="achievement-desc">${a.desc}</div>
                    </div>
                    <div class="achievement-status">${unlocked ? 'å·²è§£é”' : 'æœªè§£é”'}</div>
                </div>`;
            }).join('');
        }
        
        // ====== å¤šè¯­è¨€å•è¯åº“ ======
        const languageWords = {
            en: [
                { word: 'hello', phonetic: '/hÉ™ËˆloÊŠ/', meaning: 'ä½ å¥½' },
                { word: 'world', phonetic: '/wÉœËrld/', meaning: 'ä¸–ç•Œ' },
                { word: 'love', phonetic: '/lÊŒv/', meaning: 'çˆ±' },
                { word: 'happy', phonetic: '/ËˆhÃ¦pi/', meaning: 'å¿«ä¹' },
                { word: 'learn', phonetic: '/lÉœËrn/', meaning: 'å­¦ä¹ ' }
            ],
            ja: [
                { word: 'ã“ã‚“ã«ã¡ã¯', phonetic: 'kon-ni-chi-wa', meaning: 'ä½ å¥½' },
                { word: 'ã•ã‚ˆã†ãªã‚‰', phonetic: 'sa-yo-na-ra', meaning: 'å†è§' },
                { word: 'ã‚ã‚ŠãŒã¨ã†', phonetic: 'a-ri-ga-to', meaning: 'è°¢è°¢' },
                { word: 'é£Ÿã¹ã‚‹', phonetic: 'ta-be-ru', meaning: 'åƒ' },
                { word: 'é£²ã‚€', phonetic: 'no-mu', meaning: 'å–' }
            ],
            ko: [
                { word: 'ì•ˆë…•í•˜ì„¸ìš”', phonetic: 'an-nyeong-ha-se-yo', meaning: 'ä½ å¥½' },
                { word: 'ê°ì‚¬í•©ë‹ˆë‹¤', phonetic: 'gam-sa-ham-ni-da', meaning: 'è°¢è°¢' },
                { word: 'å†è§', phonetic: 'an-nyeong', meaning: 'å†è§' },
                { word: 'ì‚¬ë‘', phonetic: 'sa-rang', meaning: 'çˆ±' },
                { word: 'ìŒì‹', phonetic: 'eum-sik', meaning: 'é£Ÿç‰©' }
            ],
            fr: [
                { word: 'bonjour', phonetic: '/bÉ”ÌƒÊ’uÊ/', meaning: 'ä½ å¥½' },
                { word: 'merci', phonetic: '/mÉ›Êsi/', meaning: 'è°¢è°¢' },
                { word: 'amour', phonetic: '/amuÊ/', meaning: 'çˆ±' },
                { word: 'bon', phonetic: '/bÉ”Ìƒ/', meaning: 'å¥½' },
                { word: 'apprendre', phonetic: '/apÊÉ‘ÌƒdÊ/', meaning: 'å­¦ä¹ ' }
            ]
        };
        
        let currentLang = 'en';
        
        function switchLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('.lang-card').forEach(c => c.classList.remove('active'));
            event.target.closest('.lang-card').classList.add('active');
            words = [...languageWords[lang]];
            showCard();
            alert('å·²åˆ‡æ¢åˆ°' + {en:'è‹±è¯­',ja:'æ—¥è¯­',ko:'éŸ©è¯­',fr:'æ³•è¯­'}[lang] + 'å­¦ä¹ æ¨¡å¼ï¼');
        }
        
        // ====== å­¦ä¹ å°ç»„ ======
        let groupData = null;
        
        function loadGroup() {
            const saved = localStorage.getItem('wordAI_group');
            if (saved) groupData = JSON.parse(saved);
            renderRanking();
        }
        
        function createGroup() {
            const name = prompt('è¯·è¾“å…¥å°ç»„åç§°:');
            if (!name) return;
            groupData = { name, members: [{name: user?.username || 'æˆ‘', score: total, avatar: 'ğŸ˜€'}] };
            localStorage.setItem('wordAI_group', JSON.stringify(groupData));
            alert('å°ç»„åˆ›å»ºæˆåŠŸï¼');
            renderRanking();
        }
        
        function joinGroup() {
            alert('åŠ å…¥å°ç»„åŠŸèƒ½å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼');
        }
        
        function renderRanking() {
            const list = document.getElementById('rankingList');
            if (!groupData) {
                // æ¨¡æ‹Ÿæ’è¡Œæ¦œ
                const mockData = [
                    {name: 'å­¦ä¹ è¾¾äºº', score: 520, avatar: 'ğŸ†'},
                    {name: 'åšæŒä¸æ‡ˆ', score: 380, avatar: 'â­'},
                    {name: 'è¿›æ­¥é£å¿«', score: 290, avatar: 'ğŸ“š'},
                    {name: user?.username || 'æˆ‘', score: total, avatar: 'ğŸ˜€'},
                    {name: 'æ–°äººå­¦ä¹ ', score: 50, avatar: 'ğŸŒ±'}
                ];
                mockData.sort((a,b) => b.score - a.score);
                list.innerHTML = mockData.map((m, i) => `
                    <div class="ranking-item">
                        <div class="ranking-num ${i<3?'top3':''}">${i+1}</div>
                        <div style="font-size:24px;">${m.avatar}</div>
                        <div class="ranking-info">
                            <div class="ranking-name">${m.name}</div>
                            <div class="ranking-score">${m.score} è¯</div>
                        </div>
                    </div>
                `).join('');
            } else {
                list.innerHTML = '<div class="ranking-item"><div class="ranking-info">å°ç»„æˆå‘˜: ' + groupData.members.length + 'äºº</div></div>';
            }
        }
        
        // ====== å­¦ä¹ åœ°å›¾ ======
        const mapLevels = [
            { id: 1, name: 'å…¥é—¨', icon: 'ğŸŒ±', unlockScore: 0 },
            { id: 2, name: 'åŸºç¡€', icon: 'ğŸ“–', unlockScore: 10 },
            { id: 3, name: 'è¿›é˜¶', icon: 'ğŸ“š', unlockScore: 50 },
            { id: 4, name: 'ä¸­çº§', icon: 'ğŸ’ª', unlockScore: 100 },
            { id: 5, name: 'é«˜çº§', icon: 'ğŸ†', unlockScore: 200 },
            { id: 6, name: 'å¤§å¸ˆ', icon: 'ğŸ‘‘', unlockScore: 500 }
        ];
        
        function renderMap() {
            const container = document.getElementById('mapNodes');
            container.innerHTML = mapLevels.map((level, i) => {
                const unlocked = total >= level.unlockScore;
                const current = i === mapLevels.findIndex(l => total >= l.unlockScore);
                return `
                    <div style="text-align:center;margin:20px 0;">
                        <div class="map-node ${unlocked ? 'unlocked' : ''} ${current ? 'current' : ''}">
                            ${level.icon}
                        </div>
                        <div class="map-label">${level.name}</div>
                        <div style="font-size:10px;color:#999;">${level.unlockScore}è¯</div>
                    </div>
                `;
            }).join('');
        }
        
        // ====== PKå¯¹æˆ˜ ======
        let pkActive = false;
        let pkMyScore = 0;
        let pkAiScore = 0;
        
        function startPK() {
            if (pkActive) return;
            pkActive = true;
            pkMyScore = 0;
            pkAiScore = 0;
            document.getElementById('pkMyScore').textContent = '0';
            document.getElementById('pkAiScore').textContent = '0';
            document.getElementById('pkResult').textContent = '';
            
            // æ¨¡æ‹ŸPK
            let round = 0;
            const pkInterval = setInterval(() => {
                round++;
                pkMyScore += Math.floor(Math.random() * 5);
                pkAiScore += Math.floor(Math.random() * 5);
                document.getElementById('pkMyScore').textContent = pkMyScore;
                document.getElementById('pkAiScore').textContent = pkAiScore;
                
                if (round >= 10) {
                    clearInterval(pkInterval);
                    pkActive = false;
                    let result = '';
                    if (pkMyScore > pkAiScore) result = 'ğŸ‰ èƒœåˆ©ï¼';
                    else if (pkMyScore < pkAiScore) result = 'ğŸ’ª å†æ¥å†å‰ï¼';
                    else result = 'ğŸ¤ å¹³å±€ï¼';
                    document.getElementById('pkResult').textContent = result;
                }
            }, 500);
        }
        
        // ====== åœºæ™¯åŒ–å­¦ä¹  ======
        const sceneWords = {
            travel: [
                { word: 'flight', phonetic: '/flaÉªt/', meaning: 'èˆªç­' },
                { word: 'hotel', phonetic: '/hoÊŠËˆtel/', meaning: 'é…’åº—' },
                { word: 'passport', phonetic: '/ËˆpÃ¦spÉ”Ërt/', meaning: 'æŠ¤ç…§' },
                { word: 'ticket', phonetic: '/ËˆtÉªkÉªt/', meaning: 'ç¥¨' },
                { word: 'destination', phonetic: '/ËŒdestÉªËˆneÉªÊƒÉ™n/', meaning: 'ç›®çš„åœ°' },
                { word: 'luggage', phonetic: '/ËˆlÊŒÉ¡ÉªdÊ’/', meaning: 'è¡Œæ' },
                { word: 'boarding', phonetic: '/ËˆbÉ”ËrdÉªÅ‹/', meaning: 'ç™»æœº' },
                { word: 'reservation', phonetic: '/ËŒrezÉ™rËˆveÉªÊƒÉ™n/', meaning: 'é¢„è®¢' }
            ],
            business: [
                { word: 'meeting', phonetic: '/ËˆmiËtÉªÅ‹/', meaning: 'ä¼šè®®' },
                { word: 'project', phonetic: '/ËˆprÉ‘ËdÊ’ekt/', meaning: 'é¡¹ç›®' },
                { word: 'deadline', phonetic: '/ËˆdedlaÉªn/', meaning: 'æˆªæ­¢æ—¥æœŸ' },
                { word: 'presentation', phonetic: '/ËŒprezÉ™nËˆteÉªÊƒÉ™n/', meaning: 'æ¼”ç¤º' },
                { word: 'colleague', phonetic: '/ËˆkÉ‘ËliËÉ¡/', meaning: 'åŒäº‹' },
                { word: 'schedule', phonetic: '/ËˆskedÊ’uËl/', meaning: 'æ—¥ç¨‹' },
                { word: 'email', phonetic: '/ËˆiËmeÉªl/', meaning: 'é‚®ä»¶' },
                { word: 'report', phonetic: '/rÉªËˆpÉ”Ërt/', meaning: 'æŠ¥å‘Š' }
            ],
            daily: [
                { word: 'breakfast', phonetic: '/ËˆbrekfÉ™st/', meaning: 'æ—©é¤' },
                { word: 'grocery', phonetic: '/ËˆÉ¡roÊŠsÉ™ri/', meaning: 'æ‚è´§' },
                { word: 'neighborhood', phonetic: '/ËˆneÉªbÉ™rhÊŠd/', meaning: 'ç¤¾åŒº' },
                { word: 'apartment', phonetic: '/É™ËˆpÉ‘ËrtmÉ™nt/', meaning: 'å…¬å¯“' },
                { word: 'laundry', phonetic: '/ËˆlÉ”Ëndri/', meaning: 'æ´—è¡£' },
                { word: 'supermarket', phonetic: '/ËˆsuËpÉ™rmÉ‘ËrkÉªt/', meaning: 'è¶…å¸‚' },
                { word: 'pharmacy', phonetic: '/ËˆfÉ‘ËrmÉ™si/', meaning: 'è¯åº—' },
                { word: 'restaurant', phonetic: '/ËˆrestÉ™rÉ‘Ënt/', meaning: 'é¤å…' }
            ],
            tech: [
                { word: 'software', phonetic: '/ËˆsÉ”Ëftwer/', meaning: 'è½¯ä»¶' },
                { word: 'algorithm', phonetic: '/ËˆÃ¦lÉ¡É™rÉªÃ°É™m/', meaning: 'ç®—æ³•' },
                { word: 'database', phonetic: '/ËˆdeÉªtÉ™beÉªs/', meaning: 'æ•°æ®åº“' },
                { word: 'network', phonetic: '/ËˆnetwÉœËrk/', meaning: 'ç½‘ç»œ' },
                { word: 'security', phonetic: '/sÉªËˆkjÊŠrÉ™ti/', meaning: 'å®‰å…¨' },
                { word: 'platform', phonetic: '/ËˆplÃ¦tfÉ”Ërm/', meaning: 'å¹³å°' },
                { word: 'interface', phonetic: '/ËˆÉªntÉ™rfeÉªs/', meaning: 'ç•Œé¢' },
                { word: 'function', phonetic: '/ËˆfÊŒÅ‹kÊƒÉ™n/', meaning: 'åŠŸèƒ½' }
            ]
        };
        
        let currentScene = 'travel';
        
        function selectScene(scene) {
            currentScene = scene;
            document.querySelectorAll('.scene-card').forEach(c => c.classList.remove('active'));
            event.target.closest('.scene-card').classList.add('active');
            nextSceneWord();
        }
        
        function nextSceneWord() {
            const words = sceneWords[currentScene];
            const w = words[Math.floor(Math.random() * words.length)];
            document.getElementById('scene-word').textContent = w.word;
            document.getElementById('scene-phonetic').textContent = w.phonetic;
            document.getElementById('scene-meaning').textContent = w.meaning;
        }
        
        // ====== AIå£è¯­é™ªç»ƒ ======
        const dialogueTopics = [
            "What's your name?",
            "Where are you from?",
            "What do you do for fun?",
            "Tell me about your day.",
            "What's your favorite food?",
            "Do you like traveling?",
            "What did you do today?",
            "What's your hobby?"
        ];
        
        let currentDialogueTopic = '';
        
        function sendDialogue() {
            const input = document.getElementById('dialogueInput');
            const message = input.value.trim();
            if (!message) return;
            
            // æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
            const messages = document.getElementById('dialogueMessages');
            messages.innerHTML += `<div class="dialogue-msg user"><div class="dialogue-bubble">${message}</div></div>`;
            messages.scrollTop = messages.scrollHeight;
            input.value = '';
            
            // æ¨¡æ‹ŸAIå›å¤
            setTimeout(() => {
                const replies = [
                    `Good! Try saying: "${currentDialogueTopic || dialogueTopics[Math.floor(Math.random() * dialogueTopics.length)]}"`,
                    "Great! Keep practicing! Would you like to try another topic?",
                    "Nice response! Let's practice more. What did you eat for breakfast today?",
                    "Excellent! You're making progress! Tell me about your family."
                ];
                const reply = replies[Math.floor(Math.random() * replies.length)];
                messages.innerHTML += `<div class="dialogue-msg ai"><div class="dialogue-bubble">${reply}</div></div>`;
                messages.scrollTop = messages.scrollHeight;
            }, 500);
        }

        function renderHistory() {
            const list = document.getElementById('historyList');
            if (history.length === 0) {
                list.innerHTML = '<div class="empty-state">æš‚æ— å­¦ä¹ è®°å½•</div>';
                return;
            }
            list.innerHTML = history.map(h => `
                <div class="history-item">
                    <span class="history-date">${h.date}</span>
                    <span class="history-count">${h.total} è¯ / ${h.correct} æ­£ç¡®</span>
                </div>
            `).join('');
        }

        // ====== AI å‡ºé¢˜ ======
        async function generateQuiz() {
            // ä¼˜å…ˆä½¿ç”¨æœ¬åœ°é¢˜ç›®
            quizWord = words[Math.floor(Math.random() * words.length)];
            const meanings = words.map(w => w.meaning);
            const correctMeaning = quizWord.meaning;
            const options = [correctMeaning];
            
            while (options.length < 4) {
                const random = meanings[Math.floor(Math.random() * meanings.length)];
                if (!options.includes(random)) options.push(random);
            }
            options.sort(() => Math.random() - 0.5);
            
            document.getElementById('quiz-card').innerHTML = `
                <div class="ai-quiz-badge">ğŸ¤– AI å‡ºé¢˜</div>
                <div class="word">${quizWord.word}</div>
                <div class="phonetic">${quizWord.phonetic}</div>
                <div class="meaning">é€‰æ‹©æ­£ç¡®çš„ä¸­æ–‡é‡Šä¹‰</div>
            `;
            
            document.getElementById('quiz-options').innerHTML = options.map(opt => `
                <button class="quiz-option" onclick="checkAnswer('${opt}', '${correctMeaning}', this)">${opt}</button>
            `).join('');
        }

        async function callMiniMaxAI(prompt) {
            if (!MINIMAX_API_KEY) return null;
            try {
                const response = await fetch(`${MINIMAX_BASE_URL}/text/chatcompletion_v2`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${MINIMAX_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'abab6.5s-chat',
                        messages: [{ role: 'user', content: prompt }]
                    })
                });
                const data = await response.json();
                return data.choices?.[0]?.message?.content || null;
            } catch (e) {
                console.error('MiniMax API error:', e);
                return null;
            }
        }

        async function generateAIQuiz() {
            const userLevel = user?.level || 'intermediate';
            const prompt = `è¯·æ ¹æ®ç”¨æˆ·çº§åˆ« "${userLevel}" ç”Ÿæˆä¸€ä¸ªè‹±è¯­å•è¯é€‰æ‹©é¢˜ã€‚
è¿”å›JSONæ ¼å¼ï¼š{"word":"å•è¯","phonetic":"éŸ³æ ‡","meaning":"ä¸­æ–‡é‡Šä¹‰","options":["é€‰é¡¹1","é€‰é¡¹2","é€‰é¡¹3","é€‰é¡¹4"]}
åªè¿”å›JSONï¼Œä¸è¦å…¶ä»–å†…å®¹ã€‚`;
            
            const result = await callMiniMaxAI(prompt);
            if (result) {
                try {
                    const quiz = JSON.parse(result);
                    quizWord = { word: quiz.word, phonetic: quiz.phonetic, meaning: quiz.meaning };
                    document.getElementById('quiz-card').innerHTML = `
                        <div class="ai-quiz-badge">ğŸ¤– AI æ™ºèƒ½å‡ºé¢˜</div>
                        <div class="word">${quiz.word}</div>
                        <div class="phonetic">${quiz.phonetic}</div>
                        <div class="meaning">é€‰æ‹©æ­£ç¡®çš„ä¸­æ–‡é‡Šä¹‰</div>
                    `;
                    document.getElementById('quiz-options').innerHTML = quiz.options.map(opt => `
                        <button class="quiz-option" onclick="checkAnswer('${opt}', '${quiz.meaning}', this)">${opt}</button>
                    `).join('');
                    return;
                } catch (e) {}
            }
            // å›é€€åˆ°æœ¬åœ°å‡ºé¢˜
            generateQuiz();
        }

        function checkAnswer(selected, correctAns, btn) {
            document.querySelectorAll('.quiz-option').forEach(o => o.disabled = true);
            if (selected === correctAns) {
                btn.classList.add('correct');
                correct++;
                streak++;
            } else {
                btn.classList.add('wrong');
                streak = 0;
                document.querySelectorAll('.quiz-option').forEach(o => {
                    if (o.textContent === correctAns) o.classList.add('correct');
                });
            }
            total++;
            updateStats();
            onQuizDone();
            setTimeout(() => {
                if (MINIMAX_API_KEY) generateAIQuiz();
                else generateQuiz();
            }, 1500);
        }

        // ====== å‘éŸ³æµ‹è¯„ ======
        function nextSpeak() {
            const w = words[Math.floor(Math.random() * words.length)];
            document.getElementById('speak-word').textContent = w.word;
            document.getElementById('speak-phonetic').textContent = w.phonetic;
            document.getElementById('pronunciation-result').innerHTML = '';
            document.getElementById('recordHint').textContent = 'æŒ‰ä½å½•éŸ³æµ‹è¯„å‘éŸ³';
        }

        async function playReference() {
            const word = document.getElementById('speak-word').textContent;
            playTTS(word);
        }

        async function startRecord() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
                mediaRecorder.onstop = () => evaluatePronunciation();
                mediaRecorder.start();
                document.getElementById('recordBtn').classList.add('recording');
                document.getElementById('recordHint').textContent = 'æ­£åœ¨å½•éŸ³...';
            } catch (err) {
                alert('æ— æ³•è®¿é—®éº¦å…‹é£ï¼Œè¯·å…è®¸æƒé™');
            }
        }

        function stopRecord() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                document.getElementById('recordBtn').classList.remove('recording');
                document.getElementById('recordHint').textContent = 'æµ‹è¯„ä¸­...';
            }
        }

        function evaluatePronunciation() {
            // ä½¿ç”¨ Web Speech API è¿›è¡Œç®€å•è¯„ä¼°
            const targetWord = document.getElementById('speak-word').textContent;
            
            // æ¨¡æ‹Ÿè¯„åˆ†ï¼ˆå®é™…éœ€è¦è¯­éŸ³è¯†åˆ«APIï¼‰
            const scores = [68, 75, 82, 88, 92, 95];
            const score = scores[Math.floor(Math.random() * scores.length)];
            
            let scoreClass = 'score-low', feedback = 'éœ€è¦å¤šåŠ ç»ƒä¹ ';
            if (score >= 90) { scoreClass = 'score-high'; feedback = 'å‘éŸ³éå¸¸æ£’ï¼ğŸ‰'; }
            else if (score >= 75) { scoreClass = 'score-mid'; feedback = 'å‘éŸ³ä¸é”™ï¼Œç»§ç»­åŠªåŠ›ï¼'; }
            
            document.getElementById('pronunciation-result').innerHTML = `
                <div class="pronunciation-score ${scoreClass}">${score}åˆ†</div>
                <div class="meaning">${feedback}</div>
                <div class="phonetic">æ ‡å‡†å‘éŸ³: ${targetWord}</div>
            `;
            document.getElementById('recordHint').textContent = 'æŒ‰ä½å½•éŸ³æµ‹è¯„å‘éŸ³';
        }

        // ====== å¤ä¹ æµ‹è¯•åŠŸèƒ½ ======
        let reviewWords = [];
        let currentReviewIndex = 0;

        function loadReviewData() {
            // ä»localStorageåŠ è½½å¤ä¹ æ•°æ®
            const reviewData = JSON.parse(localStorage.getItem('wordAI_review') || '[]');
            const now = Date.now();
            // ç­›é€‰éœ€è¦å¤ä¹ çš„å•è¯ï¼ˆå·²è¿‡æœŸæˆ–ä»Šå¤©åˆ°æœŸï¼‰
            reviewWords = reviewData.filter(w => w.nextReview <= now);
            
            // ç»Ÿè®¡
            const allReviewData = JSON.parse(localStorage.getItem('wordAI_review') || '[]');
            const mastered = allReviewData.filter(w => w.quality >= 4).length;
            
            document.getElementById('reviewDueCount').textContent = reviewWords.length;
            document.getElementById('reviewMasteredCount').textContent = mastered;
            
            const btn = document.getElementById('startReviewBtn');
            if (reviewWords.length === 0) {
                btn.textContent = 'æš‚æ— å¾…å¤ä¹ å•è¯';
                btn.disabled = true;
            } else {
                btn.textContent = `å¼€å§‹å¤ä¹  (${reviewWords.length})`;
                btn.disabled = false;
            }
        }

        function startReview() {
            if (reviewWords.length === 0) return;
            
            document.getElementById('reviewCard').style.display = 'block';
            currentReviewIndex = 0;
            showReviewWord();
        }

        function showReviewWord() {
            if (currentReviewIndex >= reviewWords.length) {
                alert('ğŸ‰ å¤ä¹ å®Œæˆï¼');
                document.getElementById('reviewCard').style.display = 'none';
                loadReviewData();
                return;
            }
            
            const w = reviewWords[currentReviewIndex];
            document.getElementById('reviewWord').textContent = w.word;
            document.getElementById('reviewPhonetic').textContent = w.phonetic;
        }

        function rateReview(quality) {
            // quality: 1=å¿˜äº†, 2=è®°å¾—, 3=è®°ä½, 4=ç²¾é€š
            const w = reviewWords[currentReviewIndex];
            
            // æ›´æ–°å¤ä¹ æ•°æ®
            const reviewData = JSON.parse(localStorage.getItem('wordAI_review') || '[]');
            const idx = reviewData.findIndex(r => r.word === w.word);
            if (idx >= 0) {
                // è‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿è®¡ç®—é—´éš”
                let { easinessFactor = 2.5, interval = 1, repetitions = 0 } = reviewData[idx];
                
                if (quality >= 3) {
                    // è®°ä½äº†ï¼Œå¢åŠ é—´éš”
                    if (repetitions === 0) interval = 1;
                    else if (repetitions === 1) interval = 3;
                    else interval = Math.round(interval * easinessFactor);
                    repetitions++;
                    easinessFactor = Math.max(1.3, easinessFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02)));
                } else {
                    // å¿˜äº†ï¼Œé‡æ–°å¼€å§‹
                    repetitions = 0;
                    interval = 1;
                }
                
                reviewData[idx] = {
                    ...reviewData[idx],
                    quality,
                    easinessFactor,
                    interval,
                    repetitions,
                    nextReview: Date.now() + interval * 24 * 60 * 60 * 1000,
                    lastReview: Date.now()
                };
            } else {
                // æ–°æ·»åŠ çš„å•è¯
                reviewData.push({
                    word: w.word,
                    phonetic: w.phonetic,
                    meaning: w.meaning,
                    quality,
                    easinessFactor: 2.5,
                    interval: 1,
                    repetitions: 0,
                    nextReview: Date.now() + 24 * 60 * 60 * 1000,
                    lastReview: Date.now()
                });
            }
            localStorage.setItem('wordAI_review', JSON.stringify(reviewData));
            
            currentReviewIndex++;
            showReviewWord();
        }

        // ====== Tab åˆ‡æ¢ ======
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                this.classList.add('active');
                document.getElementById('tab-' + this.dataset.tab).classList.add('active');
                
                if (this.dataset.tab === 'quiz') {
                    if (MINIMAX_API_KEY) generateAIQuiz();
                    else generateQuiz();
                }
                if (this.dataset.tab === 'speak') nextSpeak();
                if (this.dataset.tab === 'challenge') { loadChallenge(); }
                if (this.dataset.tab === 'stats') { renderStats(); }
                if (this.dataset.tab === 'scenes') { nextSceneWord(); }
                if (this.dataset.tab === 'dialogue') { currentDialogueTopic = dialogueTopics[Math.floor(Math.random() * dialogueTopics.length)]; }
                if (this.dataset.tab === 'favorites') { renderFavorites(); }
                if (this.dataset.tab === 'wrongbook') { renderWrongWords(); }
                if (this.dataset.tab === 'profile') { updateProfile(); }
                if (this.dataset.tab === 'lang') { }
                if (this.dataset.tab === 'newwords') { renderNewWords(); }
                if (this.dataset.tab === 'group') { loadGroup(); }
                if (this.dataset.tab === 'map') { renderMap(); }
                if (this.dataset.tab === 'pk') { }
                if (this.dataset.tab === 'review') { loadReviewData(); }
            });
        });

        function saveApiKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            if (!apiKey) {
                document.getElementById('apiKeyStatus').textContent = 'è¯·è¾“å…¥ API Key';
                document.getElementById('apiKeyStatus').style.color = '#ef4444';
                return;
            }
            localStorage.setItem('wordAI_apiKey', apiKey);
            document.getElementById('apiKeyStatus').textContent = 'ä¿å­˜æˆåŠŸï¼';
            document.getElementById('apiKeyStatus').style.color = '#10b981';
            alert('API Key å·²ä¿å­˜ï¼Œåˆ·æ–°é¡µé¢å AI å‡ºé¢˜åŠŸèƒ½å³å¯ä½¿ç”¨');
        }

        function loadApiKey() {
            const saved = localStorage.getItem('wordAI_apiKey');
            if (saved) {
                document.getElementById('apiKey').value = saved;
                document.getElementById('apiKeyStatus').textContent = 'å·²é…ç½® API Key';
            }
        }
        
        // ====== PWA å®‰è£…æç¤º ======
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            // æ˜¾ç¤ºå®‰è£…æç¤º
            setTimeout(() => {
                if (!localStorage.getItem('wordAI_pwaDismissed')) {
                    showInstallPrompt();
                }
            }, 5000);
        });
        
        function showInstallPrompt() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.id = 'installPrompt';
            modal.innerHTML = `
                <div class="modal-content" style="text-align:center;">
                    <div style="font-size:48px;margin-bottom:15px;">ğŸ“±</div>
                    <div class="modal-title">å®‰è£…åˆ°æ¡Œé¢</div>
                    <p style="color:#666;margin-bottom:20px;">å°† AI èƒŒå•è¯æ·»åŠ åˆ°æ¡Œé¢ï¼Œéšæ—¶éšåœ°å­¦ä¹ ï¼</p>
                    <button class="btn btn-primary" style="width:100%;margin-bottom:10px;" onclick="installPWA()">ç«‹å³å®‰è£…</button>
                    <button class="btn" style="width:100%;background:#f5f5f5;" onclick="dismissInstall()">æš‚æ—¶ä¸è¦</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        async function installPWA() {
            if (!deferredPrompt) return;
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            deferredPrompt = null;
            document.getElementById('installPrompt')?.remove();
            if (outcome === 'accepted') {
                alert('å®‰è£…æˆåŠŸï¼å¯åœ¨æ¡Œé¢æ‰¾åˆ° AI èƒŒå•è¯');
            }
        }
        
        function dismissInstall() {
            document.getElementById('installPrompt')?.remove();
            localStorage.setItem('wordAI_pwaDismissed', 'true');
        }

        // å¯åŠ¨
        init();
    </script>
</body>
</html>
